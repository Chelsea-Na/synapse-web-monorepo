import{j as e,a as o,F as S}from"./jsx-runtime-9dc53467.js";import{r as y}from"./index-76fb7be0.js";import{h as Q,b2 as X,t as N,v as E,b7 as Y,b8 as ee,b9 as te,U as ae}from"./SynapseClient-5617d165.js";import{g as q,B as L}from"./getEndpoint-ac94413e.js";import{u as k,a as ne,C as oe}from"./HelpPopover-03c99c80.js";import{d as ie}from"./ToastMessage-313b7aae.js";import{u as se,a as re,S as le}from"./SchemaDrivenAnnotationEditor-ef589aad.js";import"./OrientationBanner-a1ca5cdb.js";import{d as de}from"./useEntity-f56cb1ec.js";import"./SkeletonButton-007d85cd.js";import{S as ce}from"./SkeletonTable-dbfcf115.js";import{d as A}from"./dayjs.min-f79c4412.js";import{F as me}from"./FullWidthAlert-706fe840.js";import{f as R}from"./DateFormatter-b058ade0.js";import{g as ue,u as _e,a as pe}from"./useUploadDestination-83102b6b.js";import{a as O}from"./UserBadge-e0142aa3.js";import{B as w}from"./Button-33299b2c.js";import{S as ye}from"./Skeleton-131bd473.js";import{n as he}from"./uniq-e671c73d.js";import{M as fe}from"./Tooltip-801f2a9c.js";function Te(a){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(a))return!1;const s=new Date(a);return s instanceof Date&&!isNaN(s.getTime())&&s.toISOString()===a}function D(a){return typeof a=="number"||typeof a=="boolean"?a.toString():Te(a)?R(A(a)):a}function v(a){const{entityId:s}=a,[t,b]=y.useState(!1),{isInExperimentalMode:l}=Q(),{entityMetadata:d,annotations:c,isLoading:h,refetch:p}=de(s,!0),{data:i}=se(s,{enabled:l}),{data:f,refetch:T}=re(s,{enabled:l&&!!i}),_=l&&!!i,r=!!d&&!!f&&A(d.modifiedOn).diff(A(f.validatedOn))>0,u=y.useCallback(async()=>{b(!0);const m=[p(),T()];await Promise.allSettled(m),b(!1)},[p,T]);return h||t?e(ce,{numRows:3,numCols:2}):o(S,{children:[d&&c&&X(c)?o("div",{className:"placeholder",children:["This"," ",N(E(d.concreteType))," ","has no annotations."]}):null,e("table",{className:"AnnotationsTable",children:o("tbody",{children:[c&&Object.keys(c).map(m=>o("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key",children:m}),e("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(c[m])?c[m].map(D).join(", "):D(c[m])})]},m)),_?o("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e("td",{className:"AnnotationsTable__Row__Value",children:e("a",{href:`${q(L.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${i.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:i.jsonSchemaVersionInfo.schemaName})})]}):null]})}),d&&_&&r&&e(me,{variant:"warning",description:`This ${N(E(d.concreteType))} has changed since it has been last validated. If this ${N(E(d.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{u()}},isGlobal:!1})]})}try{v.displayName="AnnotationsTable",v.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const I=({entityId:a,versionNumber:s})=>{var i,f,T,_,r,u,m;const{data:t}=k(a,s),b=t&&Y(t.entity),l=t?ue(t):void 0,d=(i=t==null?void 0:t.entity)==null?void 0:i.parentId,c=l==null?void 0:l.storageLocationId,{data:h}=_e(d,c,{enabled:d!==void 0&&c!=null});let p;return l&&(p=pe(l,h)),t?e("table",{className:"MetadataTable",children:o("tbody",{children:[o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Name"}),e("td",{className:"MetadataTable__Row__Value",children:(f=t.entity)==null?void 0:f.name})]}),o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Type"}),e("td",{className:"MetadataTable__Row__Value",children:N(t.entityType)})]}),o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e("td",{className:"MetadataTable__Row__Value",children:(T=t.entity)==null?void 0:T.id})]}),b&&o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Version"}),e("td",{className:"MetadataTable__Row__Value",children:ee(t.entity)})]}),p&&o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e("td",{className:"MetadataTable__Row__Value",children:p})]}),o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),o("td",{className:"MetadataTable__Row__Value",children:[e(O,{userId:(_=t.entity)==null?void 0:_.modifiedBy})," at"," ",R(A((r=t.entity)==null?void 0:r.modifiedOn))]})]}),o("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Created By"}),o("td",{className:"MetadataTable__Row__Value",children:[e(O,{userId:(u=t.entity)==null?void 0:u.createdBy})," at"," ",R(A((m=t.entity)==null?void 0:m.createdOn))]})]})]})}):null};try{I.displayName="MetadataTable",I.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const be=["METADATA","ANNOTATIONS"];function B(a){const{entityId:s,versionNumber:t,show:b,onClose:l,initialTab:d="METADATA",showTabs:c=!0,onEditModeChanged:h=he}=a,p=y.useRef(null),[i,f]=y.useState(d),[T,_]=y.useState(!1),[r,u]=y.useState(!1),[m,V]=y.useState(()=>u(!1));y.useEffect(()=>(h(r),()=>{h(!1)}),[r,h]);const{data:n}=k(s,t),x=n&&n.permissions.canEdit,M=n&&te(n.entityType),C=M&&n.entity.isLatestVersion,K=i==="METADATA"&&n&&!window.location.href.includes(s),$=o(w,{variant:"contained",onClick:()=>window.open(`${q(L.PORTAL_ENDPOINT)}#!Synapse:${s}`,"_blank","noopener"),children:["Open"," ",n?N(n==null?void 0:n.entityType):""]}),j=i==="ANNOTATIONS"&&r,P=e(w,{variant:"contained",onClick:()=>{p.current.formElement.current.requestSubmit()},children:"Save Annotations"}),F=i==="ANNOTATIONS"&&r,G=e(w,{variant:"outlined",onClick:()=>{V(()=>()=>u(!1)),_(!0)},children:"Cancel"}),U=x&&i==="ANNOTATIONS"&&!r,W=e(fe,{title:M&&!C?"Annotations can only be edited on the latest version":void 0,children:e(w,{variant:"contained",disabled:M&&!C,onClick:()=>{u(!0)},children:"Edit"})}),H=o(S,{children:[c&&!r?e("div",{className:"Tabs",children:be.map(g=>e("div",{className:"Tab",role:"tab",onClick:z=>{z.stopPropagation(),f(g)},"aria-selected":g===i,children:g},g))}):null,e("div",{style:i==="ANNOTATIONS"?{}:{display:"none"},children:r?e(ae,{children:e(le,{entityId:s,formRef:p,hideActions:!0,onSuccess:()=>{ie("Annotations successfully updated.","success"),u(!1)},onCancel:()=>u(!1)})}):e(v,{entityId:s,versionNumber:t})}),e("div",{style:i==="METADATA"?{}:{display:"none"},children:e(I,{entityId:s,versionNumber:t})})]}),J=e(oe,{open:T,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{_(!1)},onConfirm:()=>{_(!1),m()}}),Z=y.useMemo(()=>{if(n!=null&&n.entity.name){if(i==="ANNOTATIONS")return`${r?"Edit ":""}Annotations for ${n.entity.name}`}else return e(ye,{width:"40%"});return n.entity.name},[i,n==null?void 0:n.entity.name,r]);return e(ne,{className:"EntityMetadata",open:b,onCancel:()=>{r?(_(!0),V(()=>()=>{u(!1),l()})):l()},maxWidth:r?"md":"sm",title:Z,content:H,actions:o(S,{children:[J,F&&G,j&&P,U&&W,K&&$]})})}try{B.displayName="EntityModal",B.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"((isInEditMode: boolean) => void)"}}}}}catch{}export{B as E};
