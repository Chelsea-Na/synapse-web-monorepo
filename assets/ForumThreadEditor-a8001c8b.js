import{j as o,F as q,a as b}from"./jsx-runtime-095bf462.js";import{r as m}from"./index-8db94870.js";import{u as l,cv as G,az as L,aE as f,cw as j,cx as B,cy as O,cz as z,cA as H,cB as Y,cC as D,cD as J,cE as X,cF as Z,cG as ee,cH as te,cI as ae,ah as se}from"./EntityTypeUtils-5ee9d72b.js";import{u as T}from"./useMutation-737f7721.js";import"./getEndpoint-ac94413e.js";import{u as ne}from"./useInfiniteQuery-8e66bb99.js";import{I as P}from"./IconSvg-6aae701c.js";import{D as re,d as ce,C as ie,i as oe}from"./ConfirmationDialog-2052913e.js";import{U as ue}from"./UserSearchBoxV2-7a9d89d2.js";import{s as le}from"./startCase-b2e198bb.js";import{B as de}from"./Box-13f1aabd.js";import{a as ye}from"./FormLabel-7b55e02a.js";function Le(e,a,r,n,t,s){const{accessToken:c,keyFactory:p}=l();return ne(p.getRepliesQueryKey(e,a,r,n,t),async d=>G(c,e,r,d.pageParam,n,a,t),{...s,getNextPageParam:(d,R)=>{const h=R.flatMap(y=>y.results).length;if(d.totalNumberOfResults>h)return h}})}function Ue(e,a){const{accessToken:r,keyFactory:n}=l(),t=async()=>{const s=await z(e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return L(n.getReplyQueryKey(e.threadId,e.id,e.messageKey),t,a)}function ge(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>j(t,r),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function me(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>B(t,r),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Ne(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>O(r,t.replyId),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Ve(e){const{data:a,isLoading:r}=fe(e),{data:n,isLoading:t}=Te(a,{enabled:!!a}),{mutate:s}=ke(),{mutate:c}=we(),p=m.useCallback(()=>{a&&(a!=null&&a.isPinned?c(a):s(a))},[c,s,a]);return{threadData:a,threadBody:n,togglePin:p,isLoading:t||r}}function fe(e,a){const{accessToken:r,keyFactory:n}=l();return L(n.getThreadQueryKey(e),()=>H(e,r),a)}function Te(e,a){const{accessToken:r,keyFactory:n}=l(),t=async()=>{const s=await ae(e==null?void 0:e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return L(n.getThreadBodyQueryKey(e==null?void 0:e.id,e==null?void 0:e.messageKey),t,a)}function he(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>Y(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(t.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function pe(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>D(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Se(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>J(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(t.forumId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Pe(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>X(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function We(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>Z(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ke(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>ee(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function we(e){const a=f(),{accessToken:r,keyFactory:n}=l();return T(t=>te(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}const xe=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],W={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},_=({show:e,onClose:a,handleUserTag:r})=>{const n=m.useCallback((t,s)=>{t&&s&&r(s.userName),a()},[a,r]);return o(q,{children:o(re,{open:e,onCancel:a,title:"Find User or Team",content:o(ue,{placeholder:"Search for a user or team name",onChange:n,typeFilter:se.ALL,focusOnSelect:!0}),sx:{".MuiDialog-paperFullWidth":{overflowY:"visible",".MuiDialogContent-root":{overflowY:"visible"}}}})})};try{_.displayName="UserMentionModal",_.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var K=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(K||{});const A=({placeholder:e,text:a,setText:r})=>{const[n,t]=m.useState("WRITE"),[s,c]=m.useState(0),[p,d]=m.useState(!1),[R,h]=m.useState(!1),y=m.useRef(null);m.useEffect(()=>{const i=y.current;i&&i.setSelectionRange(s,s)},[y,s]),m.useEffect(()=>{var i;(i=y.current)==null||i.focus()},[p]);const M=i=>{const u=[],g=y.current;if(g){const S=g==null?void 0:g.selectionStart,w=a.substring(0,S),x=a.substring(S,a.length);c(S+i.length),u.push(w,`${R?"":"@"}${i.replace(/\s/g,"")}`,x)}r(u.join("")),h(!1)},I=i=>{const u=y.current&&y.current.selectionStart;u&&u>0&&i.charAt(u-1)==="@"&&(h(!0),d(!0))},E=i=>{const u=y.current;if(u){const g=u.selectionStart,S=u.selectionEnd,w=a.substring(g,S),x=a.substring(0,g),F=a.substring(S,a.length),C=W[i].openSyntax,Q=W[i].closeSyntax;switch(i){case"code":{const k=[];k.push(x,C,w,Q,F),r(k.join(`\r
`)),u.focus(),c(g+C.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const k=`${x}${C}${w}${Q}${F}`;u.focus(),c(g+C.length),r(k)}}}};return b("div",{className:"bootstrap-4-backport MarkdownEditor",children:[b("div",{className:"MarkdownEditorControls",children:[o("div",{className:"Tabs",children:Object.keys(K).map(i=>o("button",{className:"Tab",role:"tab","aria-selected":i===n,onClick:u=>{u.stopPropagation(),t(K[i])},children:i},i))}),n==="WRITE"&&b("div",{className:"MarkdownEditorControlsToolbar",children:[xe.map(i=>o("button",{onClick:()=>E(i),children:o(P,{icon:i,label:le(i)})},i)),o("button",{onClick:()=>d(!0),children:o(P,{icon:"tag",label:"Mention"})})]})]}),o("div",{children:n==="WRITE"?o("textarea",{onChange:i=>{r(i.target.value),I(i.target.value)},style:{width:"100%"},rows:6,value:a,ref:y,placeholder:e}):a?o(ce,{markdown:a}):"Nothing to preview"}),o(_,{show:p,onClose:()=>d(!1),handleUserTag:M})]})};try{A.displayName="MarkdownEditor",A.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const $=e=>{const{initialText:a,initialTitle:r,id:n,onClose:t,isReply:s,isDialog:c,openDialog:p}=e,[d,R]=m.useState(r??""),[h,y]=m.useState(a??""),{mutate:M,isLoading:I}=he({onSuccess:()=>t()}),{mutate:E,isLoading:i}=pe({onSuccess:()=>t()}),{mutate:u,isLoading:g}=Se({onSuccess:()=>t()}),{mutate:S,isLoading:w}=ge({onSuccess:()=>t()}),{mutate:x,isLoading:F}=me({onSuccess:()=>t()}),C=i||w||g||I||F,Q=!s&&r,k=(v,V)=>{s?a?x({replyId:n,messageMarkdown:v}):S({threadId:n,messageMarkdown:v}):Q?(M({title:V,threadId:n}),E({messageMarkdown:v,threadId:n})):u({forumId:n,title:V,messageMarkdown:v})},U=b("div",{className:"bootstrap-4-backport",children:[!s&&o(ye,{type:"text",placeholder:"Title",value:d,onChange:v=>R(v.target.value)}),o(A,{text:h,setText:y})]}),N=C?"Saving":"Save";return o(q,{children:c?o(ie,{maxWidth:"md",open:p,onCancel:t,title:s?"Edit Reply":Q?"Edit Thread":"New Thread",content:U,onConfirm:()=>k(h,d),confirmButtonText:N}):b(q,{children:[U,o(de,{display:"flex",justifyContent:"flex-end",children:o(oe,{onCancel:t,onConfirm:()=>k(h,d),confirmButtonText:N})})]})})};try{$.displayName="ForumThreadEditor",$.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}},isDialog:{defaultValue:null,description:"",name:"isDialog",required:!0,type:{name:"boolean"}},openDialog:{defaultValue:null,description:"",name:"openDialog",required:!1,type:{name:"boolean"}}}}}catch{}export{$ as F,Ne as a,Ve as b,Pe as c,We as d,Le as e,Ue as u};
//# sourceMappingURL=ForumThreadEditor-a8001c8b.js.map
