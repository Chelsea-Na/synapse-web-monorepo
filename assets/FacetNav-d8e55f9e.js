import{j as a,a as m,F as q}from"./jsx-runtime-ad672792.js";import{aR as ze,aP as et,bc as We,af as tt,aj as at,bo as nt,bt as lt}from"./index-292d735c.js";import{r as p,R as Qe}from"./index-f1f749bf.js";import{i as rt,r as st,h as ot,a as Ye}from"./queryUtils-c8811bac.js";import{u as Ge,a as je,b as it}from"./use-deep-compare-effect.esm-2b920fea.js";import{s as ct}from"./NoSearchResults-79eea014.js";import{s as ut}from"./NoData-80d05b97.js";import{u as dt}from"./unCamelCase-ec1c2b3d.js";import{C as Q}from"./ColumnType-5116adf5.js";import{p as mt,q as pt,o as ht,i as ft,j as yt,n as gt,V as G,w as de,x as Ct,y as _t,z as bt}from"./SynapseConstants-42953824.js";import{u as Ft}from"./useEntity-16cebd40.js";import{b as Nt}from"./useGetQueryResultBundle-3358bb23.js";import{p as vt,a as St}from"./sqlFunctions-50a4fbc3.js";import{i as _e,a as be,c as Et}from"./QueryFilter-f76c7743.js";import{c as fe}from"./cloneDeep-89c479ce.js";import{i as X}from"./isEqual-ec2cd1d7.js";import{D as A,E as le}from"./ElementWithTooltip-a3afc8b7.js";import{u as ye}from"./useGetInfoFromIds-182cf5c6.js";import{I as W,a as Tt}from"./IconSvg-e02ad7d3.js";import{u as wt}from"./uniqueId-4d05949d.js";import{R as Vt}from"./RadioGroup-2b4593e6.js";import{d as Pe}from"./dayjs.min-e0adaab4.js";import{R as xt}from"./RangeSlider-d970339f.js";import{B as Y}from"./Box-748c1b2e.js";import{S as ae}from"./Skeleton-fac1f03c.js";import{S as It}from"./Stack-83e4ec56.js";import{c as Rt,P as kt}from"./factory-76e91d33.js";import{r as qt}from"./react-sizeme-2217af01.js";import{g as Qt}from"./ColorGradient-3d3e1969.js";import{l as Lt,M as ee}from"./LoadingScreen-31f891cc.js";import{T as Ae}from"./Typography-25de91b6.js";import{B as Pt}from"./Button-7d415009.js";import{a as At}from"./Clear-4b047352.js";import{S as Dt}from"./SelectionCriteriaPill-67ec8f9d.js";import{s as Ut}from"./styled-be3878cf.js";import{B as Bt}from"./Button-251d6b7d.js";const Mt="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",$t="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",Fe=ze(Mt),Ht=ze($t),Ne=Ut(Bt,{label:"WideButton"})(({theme:e})=>({minWidth:"168px",padding:"10px",fontSize:"16px"}));try{Ne.displayName="WideButton",Ne.__docgenInfo={description:"",displayName:"WideButton",props:{children:{defaultValue:null,description:"The content of the component.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<ButtonClasses> & Partial<ClassNameMap<never>>)"}},color:{defaultValue:{value:"'primary'"},description:`The color of the component.
It supports both default and custom theme colors, which can be added as shown in the
[palette customization guide](https://mui.com/material-ui/customization/palette/#adding-new-colors).`,name:"color",required:!1,type:{name:"enum",value:[{value:'"info"'},{value:'"warning"'},{value:'"error"'},{value:'"success"'},{value:'"inherit"'},{value:'"primary"'},{value:'"secondary"'}]}},disabled:{defaultValue:{value:`false
false`},description:"If `true`, the component is disabled.",name:"disabled",required:!1,type:{name:"boolean"}},disableElevation:{defaultValue:{value:"false"},description:"If `true`, no elevation is used.",name:"disableElevation",required:!1,type:{name:"boolean"}},disableFocusRipple:{defaultValue:{value:"false"},description:"If `true`, the  keyboard focus ripple is disabled.",name:"disableFocusRipple",required:!1,type:{name:"boolean"}},endIcon:{defaultValue:null,description:"Element placed after the children.",name:"endIcon",required:!1,type:{name:"ReactNode"}},fullWidth:{defaultValue:{value:"false"},description:"If `true`, the button will take up the full width of its container.",name:"fullWidth",required:!1,type:{name:"boolean"}},href:{defaultValue:null,description:"The URL to link to when the button is clicked.\nIf defined, an `a` element will be used as the root node.",name:"href",required:!1,type:{name:"string"}},size:{defaultValue:{value:"'medium'"},description:"The size of the component.\n`small` is equivalent to the dense button styling.",name:"size",required:!1,type:{name:"enum",value:[{value:'"small"'},{value:'"medium"'},{value:'"large"'}]}},startIcon:{defaultValue:null,description:"Element placed before the children.",name:"startIcon",required:!1,type:{name:"ReactNode"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The variant to use.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"outlined"'},{value:'"contained"'}]}},tabIndex:{defaultValue:{value:"0"},description:"",name:"tabIndex",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"A ref for imperative actions.\nIt currently only supports `focusVisible()` action.",name:"action",required:!1,type:{name:"Ref<ButtonBaseActions>"}},centerRipple:{defaultValue:{value:"false"},description:"If `true`, the ripples are centered.\nThey won't start at the cursor interaction position.",name:"centerRipple",required:!1,type:{name:"boolean"}},disableRipple:{defaultValue:{value:"false"},description:"If `true`, the ripple effect is disabled.\n\n⚠️ Without a ripple there is no styling for :focus-visible by default. Be sure\nto highlight the element by applying separate styles with the `.Mui-focusVisible` class.",name:"disableRipple",required:!1,type:{name:"boolean"}},disableTouchRipple:{defaultValue:{value:"false"},description:"If `true`, the touch ripple effect is disabled.",name:"disableTouchRipple",required:!1,type:{name:"boolean"}},focusRipple:{defaultValue:{value:"false"},description:"If `true`, the base button will have a keyboard focus ripple.",name:"focusRipple",required:!1,type:{name:"boolean"}},focusVisibleClassName:{defaultValue:null,description:`This prop can help identify which element has keyboard focus.
The class name will be applied when the element gains the focus through keyboard interaction.
It's a polyfill for the [CSS :focus-visible selector](https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo).
The rationale for using this feature [is explained here](https://github.com/WICG/focus-visible/blob/HEAD/explainer.md).
A [polyfill can be used](https://github.com/WICG/focus-visible) to apply a \`focus-visible\` class to other components
if needed.`,name:"focusVisibleClassName",required:!1,type:{name:"string"}},LinkComponent:{defaultValue:{value:"'a'"},description:"The component used to render a link when the `href` prop is provided.",name:"LinkComponent",required:!1,type:{name:"ElementType<any>"}},onFocusVisible:{defaultValue:null,description:"Callback fired when the component is focused with a keyboard.\nWe trigger a `onFocus` callback too.",name:"onFocusVisible",required:!1,type:{name:"FocusEventHandler<any>"}},TouchRippleProps:{defaultValue:null,description:"Props applied to the `TouchRipple` element.",name:"TouchRippleProps",required:!1,type:{name:"Partial<TouchRippleProps>"}},touchRippleRef:{defaultValue:null,description:"A ref that points to the `TouchRipple` element.",name:"touchRippleRef",required:!1,type:{name:"Ref<TouchRippleActions>"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLButtonElement | null) => void) | RefObject<HTMLButtonElement> | null"}}}}}catch{}const re=e=>a(ae,{style:{...e.style,display:"inline-block"},...e});try{re.displayName="SkeletonInlineBlock",re.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rounded"'},{value:'"rectangular"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}}}catch{}const $=p.createContext(void 0),ve=({children:e,queryContext:t})=>a($.Provider,{value:t,children:e});function U(){const e=p.useContext($);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function sn(){const e=p.useContext($);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function on(){const e=p.useContext($);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const De=$.Consumer;try{$.displayName="QueryContext",$.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}}}catch{}try{ve.displayName="QueryContextProvider",ve.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}}}catch{}try{De.displayName="QueryContextConsumer",De.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}}}catch{}function Je(e,t){return`${e}${t}`}function Ot(e,t){const l=window.location.search,n=`${e}=${t}`;return l?l.includes(`${e}=`)?window.location.search.slice(l.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${n}`:o).join("&"):`${l.substr(1)}&${n}`:n}function zt(e,t){if(!window.location.search)return;const l=Je(e,t),r=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===l).map(s=>s.split("=")[1])[0];return r?decodeURIComponent(r):void 0}function Wt(e,t,l){const n=t!==void 0?Je(e,t):e,r=Ot(n,l),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${r}`;window.history.replaceState("object or string","Title",o)}function Yt(e,t){const l=zt(e,t);let n;if(l){const r=JSON.parse(l);r.sql&&(n={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:mt|pt|ht|ft|yt,entityId:vt(r.sql),query:r})}return n}function Gt(e){const{initQueryRequest:t,componentIndex:l=0,shouldDeepLink:n=!1,onQueryChange:r}=e,[s,o]=p.useState(t);p.useEffect(()=>{const g=Yt("QueryWrapper",l);g&&o(g)},[l]);const c=p.useCallback(()=>fe(s),[s]),d=p.useCallback(()=>fe(t),[t]),i=p.useCallback(g=>{let b;typeof g=="function"?b=g(c()):b=g;const x=fe(b);if(o(x),x.query){const N=JSON.stringify(x.query);if(n){const L=encodeURIComponent(N);Wt("QueryWrapper",l,L)}r&&r(N)}},[l,c,r,n]),{entityId:y,versionNumber:w}=p.useMemo(()=>St(s.query.sql),[s.query.sql]),C=s.query.limit??gt,I=Math.ceil(((s.query.offset??0)+Number(C))/C),u=p.useCallback(g=>{i(b=>(b.query.limit=g,b))},[i]),_=p.useCallback(g=>{i(b=>(b.query.offset=(g-1)*C,b))},[C,i]),h=p.useCallback(()=>{i(t)},[t,i]);Ge(()=>{s!=t&&h()},[t]);const T=p.useCallback(g=>{i(b=>(b.query.selectedFacets=(b.query.selectedFacets??[]).filter(x=>!X(x,g)),b))},[i]),f=p.useCallback((g,b)=>{i(x=>(x.query.selectedFacets=(x.query.selectedFacets??[]).map(N=>(Fe(N)&&X(N,g)&&(N.facetValues=N.facetValues.filter(L=>L!==b)),N)).filter(N=>Fe(N)?Array.isArray(N.facetValues)&&N.facetValues.length>0:!0),x))},[i]),V=p.useCallback(g=>{i(b=>(b.query.additionalFilters=(b.query.additionalFilters??[]).filter(x=>!X(x,g)),b))},[i]),F=p.useCallback((g,b)=>{i(x=>(x.query.additionalFilters=(x.query.additionalFilters??[]).map(N=>((_e(N)||be(N))&&X(N,g)&&(N.values=N.values.filter(L=>L!==b)),N)).filter(N=>_e(N)||be(N)?Array.isArray(N.values)&&N.values.length>0:!0),x))},[i]);return{entityId:y,versionNumber:w,getInitQueryRequest:d,getLastQueryRequest:c,setQuery:i,pageSize:C,currentPage:I,setPageSize:u,goToPage:_,resetQuery:h,removeSelectedFacet:T,removeValueFromSelectedFacet:f,removeQueryFilter:V,removeValueFromQueryFilter:F}}const me="isShowingFacetFilters",pe="isHidingFacetFilters";function Ue(e){const{initQueryRequest:t,onQueryChange:l,onQueryResultBundleChange:n,lockedColumn:r,componentIndex:s,shouldDeepLink:o}=e,[c,d]=p.useState(void 0),{entityId:i,versionNumber:y,getInitQueryRequest:w,getLastQueryRequest:C,setQuery:I,currentPage:u,pageSize:_,goToPage:h,setPageSize:T,resetQuery:f,removeSelectedFacet:V,removeValueFromSelectedFacet:F,removeQueryFilter:g,removeValueFromQueryFilter:b}=Gt({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:l}),x=p.useMemo(()=>C(),[C]),{data:N,isLoading:L,error:S,isPreviousData:R}=Nt(x,{keepPreviousData:!0},d),v=N==null?void 0:N.responseBody,k=L||R,{data:P}=Ft(i,y);je(()=>{v&&n&&n(JSON.stringify(v))},[v,n]);const K=v?rt(v.facets,v.selectColumns):!0,M=p.useMemo(()=>st(v,r),[v,r]),z=p.useMemo(()=>{const O=C();return ot(O.query,r)},[C,r]),Z=p.useCallback(O=>{var he;return((he=v==null?void 0:v.columnModels)==null?void 0:he.find(Xe=>Xe.name===O))??null},[v==null?void 0:v.columnModels]),E={data:M,currentPage:u,pageSize:_,setPageSize:T,isLoadingNewBundle:k,getLastQueryRequest:C,getInitQueryRequest:w,error:S,entity:P,executeQueryRequest:I,isFacetsAvailable:K,asyncJobStatus:c,goToPage:h,hasResettableFilters:z,removeSelectedFacet:V,removeValueFromSelectedFacet:F,resetQuery:f,removeQueryFilter:g,removeValueFromQueryFilter:b,lockedColumn:r,getColumnModel:Z},{children:D}=e;return a(ve,{queryContext:E,children:a("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${K?"has-facets":""}`,children:D})})}try{Ue.displayName="QueryWrapper",Ue.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}}}catch{}function jt(){return m(q,{children:[a("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),a("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ne=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ne||{});function Jt(){return m("div",{className:"text-center",children:[ct,a("h4",{children:"No Matching Results"}),a("p",{children:"Try checking the spelling or removing filters."})]})}function Kt(){return m("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[ut,a("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const Zt=()=>{try{return JSON.parse(sessionStorage.getItem(Ct)||"")}catch{return[]}},Xt=()=>{try{return JSON.parse(sessionStorage.getItem(_t)||"")}catch{return[]}},ea=()=>{try{return JSON.parse(sessionStorage.getItem(bt)||"")}catch{return[]}},ta=e=>{const t=Zt().find(l=>l.id===e);return(t==null?void 0:t.name)??e},aa=e=>{const t=ea().find(l=>l.id===e);return(t==null?void 0:t.name)||e},na=e=>{const t=Xt().find(l=>l.ownerId===e);return(t==null?void 0:t.userName)||e},la=(e,t)=>{if(e===G)return de;switch(t){case Q.ENTITYID:case Q.ENTITYID_LIST:return ta(e);case Q.USERID:case Q.USERID_LIST:return na(e);case Q.EVALUATIONID:return aa(e);default:return e}},j=p.createContext(void 0),Se=({children:e,queryVisualizationContext:t})=>a(j.Provider,{value:t,children:e});function B(){const e=p.useContext(j);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const Be=j.Consumer;function Me(e){const{noContentPlaceholderType:t=ne.INTERACTIVE}=e,{data:l,getLastQueryRequest:n,isFacetsAvailable:r,isLoadingNewBundle:s,hasResettableFilters:o}=U(),{columnAliases:c={}}=e,[d,i]=p.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:e.defaultShowFacetVisualization??!0,showSearchBar:e.defaultShowSearchBar??!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});p.useEffect(()=>{r||i(F=>({...F,showFacetFilter:!1,showFacetVisualization:!1}))},[r]),p.useEffect(()=>{s&&I([])},[s]);const[y,w]=p.useState([]),[C,I]=p.useState([]),u=n(),_=it(l==null?void 0:l.selectColumns);p.useEffect(()=>{w((_==null?void 0:_.slice(0,e.visibleColumnCount??1/0).map(F=>F.name))??[])},[_,u.query.sql,e.visibleColumnCount]);const h=p.useCallback(F=>{const g=localStorage.getItem("force-display-original-column-names")==="true";return!F||g?F:c[F]?c[F]:dt(F)},[c]),T=p.useCallback(()=>{switch(t){case ne.INTERACTIVE:return o?a(Jt,{}):a(Kt,{});case ne.STATIC:default:return a(jt,{})}},[t,o]),f={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:y,setColumnsToShowInTable:w,selectedRowIndices:C,setSelectedRowIndices:I,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:h,getDisplayValue:la,NoContentPlaceholder:T},{children:V}=e;return a(Se,{queryVisualizationContext:f,children:V})}try{Me.displayName="QueryVisualizationWrapper",Me.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}}}catch{}try{j.displayName="QueryVisualizationContext",j.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}}}catch{}try{Se.displayName="QueryVisualizationContextProvider",Se.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}}}catch{}try{Be.displayName="QueryVisualizationContextConsumer",Be.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}}}catch{}const $e=()=>{const{error:e}=U();return a(et,{error:e})};try{$e.displayName="QueryWrapperErrorBanner",$e.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}}}catch{}const se=e=>{const{checked:t=!1,hideLabel:l=!1,isSelectAll:n=!1,disabled:r=!1}=e,[s,o]=p.useState(t),[c]=p.useState(wt("src-checkbox-"));p.useEffect(()=>{o(t)},[t]);const d=y=>{e.onChange(y.target.checked),n&&y.target.checked===!1?o(!0):o(y.target.checked)};let i="checkbox";return e.className&&(i+=` ${e.className}`),m("div",{className:i,onClick:e.onClick,children:[a("input",{"aria-label":e.label,type:"checkbox",checked:s,id:c,onChange:d,disabled:r,"data-testid":e["data-testid"]}),a("label",{htmlFor:c,children:l?a(q,{}):e.label}),e.children??a(q,{})]})};try{se.displayName="Checkbox",se.__docgenInfo={description:"",displayName:"Checkbox",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},hideLabel:{defaultValue:null,description:"",name:"hideLabel",required:!1,type:{name:"boolean"}},checked:{defaultValue:null,description:"",name:"checked",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: boolean) => void"}},isSelectAll:{defaultValue:null,description:"",name:"isSelectAll",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: SyntheticEvent<HTMLDivElement, Event>) => void)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},"data-testid":{defaultValue:null,description:"",name:"data-testid",required:!1,type:{name:"string"}}}}}catch{}const Ee=e=>m("svg",{...e,className:`Icon-Plus ${e.className??""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]});try{Ee.displayName="IconPlus",Ee.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const Te=e=>m("svg",{...e,className:`Icon-Minus ${e.className??""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]});try{Te.displayName="IconMinus",Te.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const oe=({label:e,isCollapsed:t,onClick:l})=>{const{getColumnDisplayName:n}=B();return m("div",{className:"FacetFilterHeader",children:[a("label",{className:"FacetFilterHeader__label",children:n(e)}),a("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>l(!t),children:t?a(Ee,{className:"icon-plus",title:"Expand Menu"}):a(Te,{className:"icon-minus",title:"Collapse Menu"})})]})};try{oe.displayName="FacetFilterHeader",oe.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}}}catch{}function ra(e){return e.replace(/\s/g,"").toLowerCase()}function He(e,t=[],l=[],n=[]){const{value:r}=e;let s=r;r===G&&(s=de);const o=t.find(i=>i.ownerId===r);o&&(s=o?o.userName:`unknown (${r})`);const c=l.find(i=>i.id===r);c&&(s=c?c.name:`unknown (${r})`);const d=n.find(i=>i.id===r);return d!=null&&d.name&&(s=d.name),`${s}`}function sa(e,t,l){const n=[...e.sort((r,s)=>s.count-r.count)];return t||n.length<=l||n.slice(l).find(r=>r.isSelected)?n:n.splice(0,l)}const J=({facetValues:e,columnModel:t,onClear:l,onChange:n,containerAs:r="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,d]=p.useState(!1),[i,y]=p.useState(o),[w,C]=p.useState(!1),[I,u]=p.useState(!1),[_,h]=p.useState(""),[T,f]=p.useState(e);Ge(()=>{f(e)},[e]);const V=5,F=1500,g=Qe.createRef(),b={};let x;const N=e.filter(E=>E.isSelected).length===0,L=(t==null?void 0:t.columnType)===Q.USERID||(t==null?void 0:t.columnType)===Q.USERID_LIST?e.map(E=>E.value):[],S=ye({ids:L,type:"USER_PROFILE"}),R=(t==null?void 0:t.columnType)===Q.ENTITYID||(t==null?void 0:t.columnType)===Q.ENTITYID_LIST?e.map(E=>E.value):[],v=ye({ids:R,type:"ENTITY_HEADER"}),k=(t==null?void 0:t.columnType)===Q.EVALUATIONID?e.map(E=>E.value):[],P=ye({ids:k,type:"EVALUATION_QUEUE"}),K=E=>{const D=E.target.value;if(h(D),d(!0),!D)e.forEach(H=>{H.isSelected=!1}),f(e);else{const H=e.filter(O=>He(O,S,v,P).toLowerCase().indexOf(D.trim().toLowerCase())>-1?O:null);f(H)}};if(!t)return a(q,{});const M=r==="Dropdown",z=m("div",{className:M?"EnumFacetFilter__dropdown_menu":"",children:[m("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[m("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[a("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{f(e),u(!1),d(!1)},children:a("span",{className:"EnumFacetFilter__previous",children:a(W,{icon:"arrowBack"})})}),_.length>0&&a("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var E;h(""),(E=g.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__reset",children:a(W,{icon:"close"})})}),a("input",{type:"text",placeholder:"Find values",value:_,ref:g,onChange:E=>{K(E)}})]}),!I&&m("div",{className:"EnumFacetFilter__checkAll",children:[a(se,{className:"EnumFacetFilter__checkbox",onChange:()=>{l()},checked:N,label:"All",isSelectAll:!0},"select_all"),a("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var E;h(""),u(!0),(E=g.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__searchicon",children:a(W,{icon:"search"})})})]})]}),m("div",{children:[T.length>0&&sa(T,c||M,V).map((E,D)=>a(oa,{id:ra(E.value),index:D,label:He(E,S,v,P),count:E.count,isDropdown:M,initialIsSelected:E.isSelected,onChange:H=>{b[E.value]=H,clearTimeout(x),x=setTimeout(()=>{n(b),C(!1)},F)}},`checkLabel${D}`)),!M&&m(q,{children:[!c&&T.length>V&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:m("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",T.length,")"]})})}),c&&T.length>V&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:a("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),T.length<=0&&a("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),Z=()=>C(!w);return M?s==="SelectBox"?m(A,{className:"EnumFacetFilter EnumFacetFilterSelect",show:w,onToggle:Z,children:[m(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:[N&&"All",!N&&e.filter(E=>E.isSelected).length===1&&e.filter(E=>E.isSelected)[0].value,!N&&e.filter(E=>E.isSelected).length>1&&"Multiple Values Selected"]}),a(A.Menu,{children:z})]}):m(A,{className:"EnumFacetFilter",show:w,onToggle:Z,children:[a(le,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),a(A.Menu,{children:z})]}):m(q,{children:[a(oe,{isCollapsed:i,label:t.name,onClick:E=>y(E)}),a(We,{className:"EnumFacetFilter",in:!i,children:z})]})};function oa({id:e,index:t,label:l,count:n,isDropdown:r,initialIsSelected:s,onChange:o}){const[c,d]=p.useState(s);return Qe.useEffect(()=>{d(s)},[s]),m("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{r&&(d(!c),o(!c))},children:[a(se,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),o(i)},checked:c,label:l},`${e}-${t}`),r&&m("span",{className:"EnumFacetFilter__count",children:["(",n,")"]}),!r&&a("div",{className:"EnumFacetFilter__count",children:n})]})}try{J.displayName="EnumFacetFilter",J.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const we=({facet:e,isChecked:t,onClick:l})=>{const{getColumnDisplayName:n}=B();return m("button",{className:`Chip ${t?"Checked":""}`,onClick:l,children:[n(e.columnName),a(W,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{we.displayName="FacetChip",we.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}const Ve=e=>{const t="Min value should be less then max value",[l,n]=p.useState(!1),[r,s]=p.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Pe(e.initialValues.min).format("YYYY-MM-DD"),max:Pe(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:i,max:y},w="number")=>{if(i==null||y===null||y===void 0)return n(!1),!0;if(w==="number"){if(Number(i)>Number(y))return n(!0),!1}else if(Date.parse(i)>Date.parse(y))return n(!0),!1;return n(!1),!0},d=(i,y,w="number")=>{c(i,w)&&y(i)};return m("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[m("div",{style:{marginRight:"10px"},children:[a("input",{"aria-label":"min",type:e.type,value:r.min,onChange:({target:i})=>s({min:i.value,max:r.max})},"range_min"),a("div",{children:"to"}),a("input",{"aria-label":"max",type:e.type,value:r.max,onChange:({target:i})=>s({min:r.min,max:i.value})},"range_max")]}),a("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(r,e.onChange,e.type),children:"Apply"}),l&&a("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{Ve.displayName="Range",Ve.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}}}catch{}const xe=({facetResult:e,columnModel:t,onChange:l,collapsed:n=!1})=>{const[r,s]=p.useState(n),o=[{label:de,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:d,selectedMin:i,selectedMax:y}=e;const w=!i&&!y;i=i||c,y=y||d;const C=t.columnType==="DOUBLE"?"number":"date",I=(f,V)=>V?"":f===G?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",u=(f,V)=>{h(f),f!=="RANGE"&&V([f,f])},[_,h]=p.useState(I(i,w));return m("div",{children:[a(oe,{isCollapsed:r,label:t.name,onClick:f=>s(f)}),m(We,{in:!r,children:[a(Vt,{value:_,id:"rangeSelector",options:o,onChange:f=>u(f,l)}),_==="RANGE"&&(c===d?a("label",{children:d}):m(q,{children:[t.columnType==="INTEGER"&&m(xt,{domain:[c,d],initialValues:{min:i,max:y},step:1,doUpdateOnApply:!0,onChange:f=>l([f.min,f.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&a(Ve,{initialValues:{min:i,max:y},type:C,onChange:f=>l([f.min,f.max])},"Range")]}))]})]})};try{xe.displayName="RangeFacetFilter",xe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Ke=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),ia=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Le=(e,t)=>{var s;const l=((s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)??[],n=l.findIndex(o=>o.columnName===e.columnName),r=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return n>-1?r?l.splice(n,1):l[n]=e:l.push(e),l};function ie(e,t,l,n,r=!1){n?t.facetValues.forEach(c=>{c.value===n&&(c.isSelected=r)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=Ke(t),o=Le(s,e);l(o)}const Ie=(e,t,l,n)=>{const r=n&&Object.keys(n)||[];r.length&&t.facetValues.forEach(c=>{r.includes(c.value)&&(c.isSelected=n?!!n[c.value]:!1)});const s=Ke(t),o=Le(s,e);l(o)},ca=(e,t,l,n)=>{t.columnMin=n[0],t.columnMax=n[1];const r=ia(t),s=Le(r,e);l(s)};function ce(e,t){const l=(t??[]).map(n=>n.columnName);return new Set([...e.slice(0,3).map(n=>n.columnName),...l])}function te(){const e=m(It,{direction:"row",gap:"10px",sx:{my:1},children:[a(ae,{width:"15px"}),a(ae,{width:"40%"})]});return m(Y,{className:"FacetFilterControls__facet",children:[a(Y,{className:"FacetFilterHeader",children:a(ae,{width:"100%"})}),m(Y,{children:[e,e,e]})]})}function ua(){const{topLevelControlsState:e}=B(),{showFacetFilter:t}=e;return m("div",{className:`FacetFilterControls ${t?me:pe}`,children:[a(te,{}),a(te,{}),a(te,{}),a(te,{})]})}function Re(e){const{availableFacets:t}=e,{data:l,getLastQueryRequest:n,executeQueryRequest:r}=U(),s=n(),o=l.facets.filter(u=>t==null||t.includes(u.columnName)).filter(u=>!Ye(u)),[c,d]=Qe.useState(ce(o,s.query.selectedFacets)),{topLevelControlsState:i}=B(),{showFacetFilter:y}=i;je(()=>{d(ce(o,s.query.selectedFacets))},[o]);const w=l.selectColumns,C=u=>{const _=n();_.query.selectedFacets=u,_.query.offset=0,r(_)},I=u=>{const _=new Set(c);_.has(u.columnName)?_.delete(u.columnName):_.add(u.columnName),d(_)};return m("div",{className:`FacetFilterControls ${y?me:pe}`,children:[(o??[]).filter(u=>c.has(u.columnName)).map(u=>{const _=w.find(h=>h.name===u.columnName);return m("div",{className:"FacetFilterControls__facet",children:[u.facetType==="enumeration"&&_&&a(J,{containerAs:"Collapsible",collapsed:!1,facetValues:u.facetValues,columnModel:_,onChange:h=>Ie(s,u,C,h),onClear:()=>ie(s,u,C)}),u.facetType==="range"&&_&&a(xe,{facetResult:u,columnModel:_,collapsed:!1,onChange:h=>ca(s,u,C,h)})]},u.columnName)}),m("div",{children:[a("div",{className:"AvailableFacet",children:a("label",{className:"AvailableFacet__label",children:"Available Facets"})}),o.map(u=>a(we,{facet:u,onClick:()=>I(u),isChecked:c.has(u.columnName)},u.columnName))]})]})}function cn(e){const{data:t,isLoadingNewBundle:l}=U();return l?a(ua,{}):t==null||t.facets==null?a(q,{}):a(Re,{...e})}try{ce.displayName="getDefaultShownFacetFilters",ce.__docgenInfo={description:`Determines which facet filters should be shown after loading a new bundle. The shown facets will be the first
three available facets, plus any other facets that have a filter applied.`,displayName:"getDefaultShownFacetFilters",props:{}}}catch{}try{Re.displayName="FacetFilterControls",Re.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{availableFacets:{defaultValue:null,description:"",name:"availableFacets",required:!1,type:{name:"string[]"}}}}}catch{}const da=Rt(kt),ma=19,pa=30,ha={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}};function Ze(e,t){if(!e)return e;const l=e.trim();return l.length>t?l.substr(0,t-1)+"…":e}async function fa(e,t,l,n,r){var u,_;const{colorPalette:s}=Qt(l,e.facetValues.length),o=async(h,T,f)=>{const V=new Map;V.set(G,de);const F=h.map(g=>g.value).filter(g=>g!==G);if(T===Q.ENTITYID||T===Q.ENTITYID_LIST){const g=await nt(F,f);for(const b of g.results)V.set(b.id,b.name)}else if(T===Q.USERID||T===Q.USERID_LIST){const g=await lt(F,f);for(const b of g.children)V.set(b.ownerId,b.userName)}return h.map(g=>({facet:g,label:c(g,!1,V),truncatedLabel:c(g,!0,V),count:g.count}))},c=(h,T,f)=>{let V=f.get(h.value)??h.value;return T&&(V=Ze(V,ma)),V},d=await o(e.facetValues,t,r),i=d.map(h=>h.truncatedLabel),w=e.facetValues.some(h=>h.isSelected)?e.facetValues.map((h,T)=>h.isSelected?s[T]:s[T].replace("rgb(","rgba(").replace(")",", 0.25)")):s,C={values:n==="PIE"?e.facetValues.map(h=>h.count):void 0,labels:d.map(h=>h.label),text:i,x:n==="BAR"?e.facetValues.map(h=>{var T;return((T=d.find(f=>f.facet===h))==null?void 0:T.label)??h.value}):void 0,y:n==="BAR"?e.facetValues.map(h=>h.count):void 0,facetEnumerationValues:e.facetValues.map(h=>h.value),name:e.columnName,hovertemplate:n==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:n==="PIE"?"pie":"bar",pull:n==="PIE"?e.facetValues.map(h=>h.isSelected?.1:0):void 0,marker:{colors:n==="PIE"?w:void 0,color:n==="BAR"?w:void 0}};return{data:[C],labels:d,colors:n==="PIE"?(u=C.marker)==null?void 0:u.colors:(_=C.marker)==null?void 0:_.color}}const ya=(e,t,l)=>{if(e.points&&e.points[0]){const n=e.points[0],r=n.data.facetEnumerationValues[n.pointNumber],s=t.facetValues.find(o=>o.value===r);l(t,s,!s.isSelected)}};function ga(e,t,l){const r=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?r:r/3;return s>l&&(s=l),{width:`${r}px`,height:`${s}px`}}function ke(e){const{labels:t,colors:l=[],isExpanded:n}=e;if(!t)return a(q,{});const r=n?Math.min(t.length,9):Math.min(t.length,4);return r===0?a(q,{}):a("div",{className:`FacetNavPanel__body__legend${n?"--expanded":""}`,children:t.slice(0,r).map((s,o)=>{const c=Ze(s.label,pa);return a(le,{tooltipText:s.label,children:m(Y,{sx:{display:"flex",alignItems:"center",gap:"10px"},children:[a(Y,{sx:{width:"14px",height:"14px",cursor:"default",backgroundColor:l[o]},style:{cursor:"default"}},`legendLabel_${o}`),a(Ae,{variant:"body2",children:c}),a(Ae,{variant:"body2",sx:{color:"grey.600"},children:s.count})]})},s.label)})})}const Ca=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",ue=e=>{const{onHide:t,isModalView:l,applyChangesToFacetFilter:n,applyChangesToGraphSlice:r,index:s,facetToPlot:o,plotType:c,onSetPlotType:d}=e,{accessToken:i}=tt(),{data:y,isLoadingNewBundle:w,getLastQueryRequest:C}=U(),{getColumnDisplayName:I}=B(),[u,_]=p.useState(!1),h=I(o.columnName),T=p.useCallback(()=>{var F,g;return(g=(F=y==null?void 0:y.columnModels)==null?void 0:F.find(b=>b.name===o.columnName))==null?void 0:g.columnType},[y,o.columnName]),{data:f}=at(["extractPlotDataArray",o,T(),s,c,i],()=>fa(o,T(),s,c,i),{enabled:!!o}),V=()=>m("div",{onClick:F=>{F.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),m(A,{children:[a(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),m(A.Menu,{className:"chart-tools",children:[a(A.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),a(A.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!y&&w||!o?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Lt}):m(q,{children:[m(ee,{animation:!1,show:u,onHide:()=>_(!1),backdrop:"static",children:[a(ee.Header,{closeButton:!0,children:a(ee.Title,{children:h??""})}),m(ee.Body,{children:[a(ue,{...e,isModalView:!0}),a("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:a(Pt,{variant:"secondary",className:"SaveFiltersButton",onClick:()=>_(!1),children:"Apply Filters"})})]})]}),m("div",{role:"graphics-document",className:`FacetNavPanel${l?"--expanded":""}`,children:[!l&&m("div",{className:"FacetNavPanel__title",children:[!y&&w?a(re,{width:100}):a("span",{className:"FacetNavPanel__title__name",children:h}),m("div",{className:"FacetNavPanel__title__tools",children:[a(J,{facetValues:o.facetValues,columnModel:y==null?void 0:y.columnModels.find(F=>F.name===o.columnName),onChange:F=>{Ie(C(),o,n,F)},onClear:()=>{ie(C(),o,n)},containerAs:"Dropdown"}),a(le,{tooltipText:"Expand to large graph",callbackFn:()=>_(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),a(le,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),l&&m(q,{children:[m("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),a(J,{facetValues:o.facetValues,columnModel:y==null?void 0:y.columnModels.find(F=>F.name===o.columnName),onChange:F=>{Ie(C(),o,n,F)},onClear:()=>{ie(C(),o,n)},containerAs:"Dropdown",dropdownType:"SelectBox"}),a(At,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:a(Tt,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),a(V,{})]}),m("div",{className:`FacetNavPanel__body${l?"--expanded":""}`,role:"graphics-object",children:[a(qt.SizeMe,{monitorHeight:!0,children:({size:F})=>a("div",{className:Ca(l,c),children:a(da,{layout:ha,data:(f==null?void 0:f.data)??[],style:ga(F.width,c,l?300:150),config:{displayModeBar:!1},onClick:g=>ya(g,o,r)},`${o.columnName}-${c}-${F.width}`)})}),a(ke,{labels:f==null?void 0:f.labels,colors:f==null?void 0:f.colors,isExpanded:l})]})]})]})};try{ke.displayName="FacetPlotLegend",ke.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}}}catch{}try{ue.displayName="FacetNavPanel",ue.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}}}catch{}function _a(e,t,l){const n=t.getColumnModel(e.columnName);return e.values.map(r=>{let s=r;r!=null&&r.startsWith("%")&&(r!=null&&r.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=l.getDisplayValue(s,n.columnType);const o=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${r}`,innerText:o,tooltipText:o,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,r)}}})}function ba(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function Fa(e,t,l){var n;return _e(e)||be(e)?e.columnName===((n=t.lockedColumn)==null?void 0:n.columnName)?[]:_a(e,t,l):Et(e)?[ba(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function Na(e,t,l){var o;if(e.columnName===((o=t.lockedColumn)==null?void 0:o.columnName))return[];const n=t.getColumnModel(e.columnName),{getColumnDisplayName:r,getDisplayValue:s}=l;if(Fe(e))return e.facetValues.map(c=>{const d=s(c,n.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${c}`,innerText:d,tooltipText:`${r(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,c)}}});if(Ht(e)){const c=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:c,tooltipText:`${r(e.columnName)}: ${c}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function va(){var c;const e=U(),t=B(),{getLastQueryRequest:l}=e,n=l(),r=(((c=n.query)==null?void 0:c.additionalFilters)??[]).flatMap(d=>Fa(d,e,t)),s=(n.query.selectedFacets??[]).flatMap(d=>Na(d,e,t)),o=[...r,...s];return a(q,{children:o.map(d=>{const i=encodeURIComponent(d.key);return p.createElement(Dt,{...d,key:i})})})}function qe(e){const{style:t,frontText:l,endText:n="",hideIfUnfiltered:r=!1}=e,{data:s,isLoadingNewBundle:o,resetQuery:c,error:d,hasResettableFilters:i}=U(),{topLevelControlsState:y,unitDescription:w}=B(),C=s==null?void 0:s.queryCount,I=y==null?void 0:y.showFacetFilter,u=i;return d?a(q,{}):a("div",{className:`TotalQueryResults ${I?me:pe} ${i?"hasFilters":""}`,style:t,children:o?a(re,{width:100}):m(q,{children:[(i||!r)&&m("div",{className:"TotalQueryResults__topbar",children:[m("span",{className:"SRC-boldText",children:[l," ",C==null?void 0:C.toLocaleString()," ",w," ",n]}),u&&m("a",{onClick:c,className:"TotalQueryResults__topbar__clearall",children:[a(W,{icon:"deleteSweep"}),"Clear all filters"]})]}),a("div",{className:"TotalQueryResults__selections",children:a(va,{})})]})})}try{qe.displayName="TotalQueryResults",qe.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}}}catch{}const ge=2;function Ce(e,t){var n;return((n=e==null?void 0:e.facets)==null?void 0:n.filter(r=>r.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(r.columnName)>-1)&&r.facetValues.length>0&&!Ye(r)))??[]}const Oe=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:l,isLoadingNewBundle:n,executeQueryRequest:r,error:s,asyncJobStatus:o}=U(),{topLevelControlsState:c}=B(),[d,i]=p.useState([]),[y,w]=p.useState(!0),{showFacetVisualization:C,showFacetFilter:I}=c,u=l();p.useEffect(()=>{const S=Ce(t,e);S.length!==0&&y&&(i(S.map((R,v)=>({name:R.columnName,isHidden:v>=ge,plotType:"PIE"}))),w(!1))},[t,y,e]);const _=S=>{i(R=>R.map((v,k)=>S?{...v,isHidden:!1}:{...v,isHidden:k>=ge}))},h=S=>{u.query.selectedFacets=S,u.query.offset=0,r(u)},T=S=>d.find(k=>k.name===S&&k.isHidden===!0)!==void 0,f=p.useMemo(()=>d.find(S=>S.isHidden===!0)?"MORE":d.length<=ge?"NONE":"LESS",[d]),V=S=>{b(S,"isHidden",!0)},F=(S,R)=>{b(S,"plotType",R)},g=S=>{var v;return((v=d.find(k=>k.name===S))==null?void 0:v.plotType)??"PIE"},b=(S,R,v)=>{i(k=>k.map(P=>P.name===S?{...P,[R]:v}:P))},x=Ce(t,e),N=Ce(t,e).map((S,R)=>({columnName:S.columnName,colorIndex:R})),L=(u==null?void 0:u.query.selectedFacets)!==void 0&&u.query.selectedFacets.length>0||(u==null?void 0:u.query.additionalFilters)!==void 0&&(u==null?void 0:u.query.additionalFilters.length)>0;return s?a(q,{}):!t&&n?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&m("div",{children:[a("span",{className:"spinner"}),o.progressMessage]})}):m(q,{children:[a(qe,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),x.length>0&&m("div",{className:`FacetNav ${C?"":"hidden"} ${I?me:pe} ${f==="LESS"?"less":""}`,children:[a("div",{className:"FacetNav__row",role:"list",children:x.map(S=>{var R;return a("div",{className:"col-sm-12 col-md-4",style:{display:T(S.columnName)?"none":"block"},children:a(ue,{index:(R=N.find(v=>v.columnName===S.columnName))==null?void 0:R.colorIndex,onHide:()=>V(S.columnName),plotType:g(S.columnName),onSetPlotType:v=>F(S.columnName,v),facetToPlot:S,applyChangesToFacetFilter:h,applyChangesToGraphSlice:(v,k,P)=>ie(u,v,h,k==null?void 0:k.value,P),isModalView:!1})},S.columnName)})}),f!=="NONE"&&a("div",{className:"FacetNav__showMoreContainer",children:a(Ne,{variant:"contained",color:"secondary",onClick:()=>_(f==="MORE"),sx:{width:"250px"},children:f==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Oe.displayName="FacetNav",Oe.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}}}catch{}export{se as C,J as E,cn as F,Te as I,ne as N,me as Q,re as S,qe as T,Ne as W,pe as a,B as b,Gt as c,ve as d,Me as e,De as f,on as g,sn as h,Ie as i,ie as j,Be as k,$e as l,Oe as m,Ue as n,Ce as o,fa as p,ga as q,ke as r,Ee as s,U as u};
//# sourceMappingURL=FacetNav-d8e55f9e.js.map
