import{r as _,R as A}from"./index-f1f749bf.js";import{be as ie,bf as se,s as ue,bg as le}from"./SynapseContext-92ac568d.js";import{z as q}from"./SynapseConstants-41b9b1f3.js";import{u as B}from"./useMutation-3ca1ff18.js";import{j as c,a as I,F as G}from"./jsx-runtime-670450c2.js";import{g as z,B as J}from"./getEndpoint-5374ab4d.js";import{F as de}from"./FullWidthAlert-89ce8092.js";import{s as ce}from"./styled-1b6f4d44.js";import{T as pe}from"./TextField-9ea22bba.js";import{B as w}from"./Box-5df43b07.js";import{B as x}from"./Button-41488909.js";import{T as N}from"./TextField-da812849.js";import{L as P}from"./Link-d152009e.js";import{I as me}from"./IconSvg-717bbf22.js";import{I as fe}from"./IconButton-f192840c.js";function ke(t,n){const[i,r]=_.useState("CHOOSE_AUTH_METHOD"),[d,o]=_.useState(),[s,m]=_.useState(),[f,p]=_.useState();_.useEffect(()=>{const a=new URL(window.location.href.replaceAll("#","/")),{searchParams:E}=a;if(E){const O=E.get("userId"),T=E.get("twoFaToken");O&&T&&(m(parseInt(O,10)),p(T),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(i)||r("VERIFICATION_CODE"))}},[i]),_.useEffect(()=>{n&&(p(n.twoFaToken),m(n.userId),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(i)||r("VERIFICATION_CODE"))},[n]),_.useEffect(()=>{o(void 0)},[i]);async function h(a){await ue(a.accessToken),localStorage.setItem(q,a.authenticationReceipt),r("LOGGED_IN"),t&&t()}const{mutate:g,isLoading:R}=B(({username:a,password:E,authenticationReceipt:O})=>ie(a,E,O),{onError:a=>{o(a.reason)},onSuccess:async a=>{"errorCode"in a?(r("VERIFICATION_CODE"),p(a.twoFaToken),m(a.userId)):await h(a)}}),{mutate:D,isLoading:v}=B(se,{onError:a=>{o(a.reason),(a.reason.includes("The provided twoFaToken is invalid")||a.reason.includes("Token has expired"))&&(console.warn(a),o("Something went wrong. Refresh the page and try again."),window.location.href.includes("twoFaToken")&&window.history.replaceState({},document.title,window.location.href.replaceAll(/(twoFaToken|userId)=[^&]*&?/g,"")))},onSuccess:h});return{step:i,onStepChange:r,submitUsernameAndPassword:(a,E)=>{o(void 0);const O=localStorage.getItem(q);g({username:a,password:E,authenticationReceipt:O})},submitOneTimePassword:(a,E=i==="RECOVERY_CODE"?"RECOVERY_CODE":"TOTP")=>{if(o(void 0),f==null||s==null){o("You did not first log in with your password or a third-party identity provider.");return}D({userId:s,twoFaToken:f,otpCode:a,otpType:E})},errorMessage:d,isLoading:R||v}}const ge=ce(pe)`
  input {
    text-align: center;
  }
`,Ee={TextFieldStyled:ge},Oe=t=>c(Ee.TextFieldStyled,{...t}),L={left:"ArrowLeft",right:"ArrowRight",backspace:"Backspace"};function he(t,n){return t<=0?[]:Array.from({length:t},n)}function Ce(t,n,i){return t.map((r,d)=>n===d?i:r)}function W(t){return t.join("")}function Y(t,n){return[...t,n]}function _e(t,n,i){return t.reduce((r,d,o)=>{const{characters:s,restArrayMerged:m}=r;if(o<i)return{restArrayMerged:m,characters:Y(s,d)};const[f,...p]=m;return{restArrayMerged:p,characters:Y(s,f||"")}},{restArrayMerged:n,characters:[]}).characters}function Te(t){return t.split("")}const Q=A.forwardRef((t,n)=>{const{value:i,length:r,onChange:d,TextFieldsProps:o,onComplete:s,validateChar:m,className:f,...p}=t,{onPaste:h,onFocus:g,onKeyDown:R,className:D,...v}=o||{},y=he(r,(e,u)=>({character:i[u]||"",inputRef:A.createRef()})),S=e=>y.findIndex(({inputRef:u})=>u.current===e),a=()=>y.map(({character:e})=>e),E=(e,u)=>{const l=Ce(a(),e,u);return W(l)},O=e=>{var u,l;(l=(u=y[e])==null?void 0:u.inputRef.current)==null||l.focus()},T=e=>{var u,l;(l=(u=y[e])==null?void 0:u.inputRef.current)==null||l.select()},F=e=>{e+1!==r&&(y[e+1].character?T(e+1):O(e+1))},X=e=>{e>0&&T(e-1)},Z=e=>{const u=e.target.value[0]||"",l=S(e.target);if(typeof m=="function"&&!m(u,l))return;const C=E(l,u);d==null||d(C),C.length===r&&(s==null||s(C)),u!==""?C.length<r?F(C.length-1):F(l):C[l]?T(l):X(l)},ee=e=>{e.preventDefault(),e.target.select(),g==null||g(e)},te=e=>{const u=e.target,l=S(u);u.value===e.key?(e.preventDefault(),F(l)):!u.value&&L.backspace===e.key||L.left===e.key?(e.preventDefault(),T(l-1)):L.right===e.key&&(e.preventDefault(),T(l+1)),R==null||R(e)},re=e=>{e.preventDefault();const u=e.target,l=e.clipboardData.getData("text/plain"),C=S(u),ne=a(),H=_e(ne,Te(l),C),k=H.findIndex((oe,ae)=>ae>C&&oe===""),b=W(H);if(d==null||d(b),b.length===r){s==null||s(b),O(r-1);return}k!==-1&&O(k),h==null||h(e)};return c(w,{display:"flex",gap:"20px",alignItems:"center",ref:n,className:`MuiOtpInput-Box ${f||""}`,...p,children:y.map(({character:e,inputRef:u},l)=>c(Oe,{autoComplete:"one-time-code",value:e,inputRef:u,className:`MuiOtpInput-TextField MuiOtpInput-TextField-${l+1} ${D||""}`,onPaste:re,onFocus:ee,onChange:Z,onKeyDown:te,...v},l))})});Q.defaultProps={value:"",length:4,validateChar:()=>!0,onChange:()=>{},onComplete:()=>{},TextFieldsProps:{}};const $=6,Re=["0","1","2","3","4","5","6","7","8","9"];function V(t){const{onSubmit:n,isLoading:i}=t,[r,d]=A.useState("");return I(w,{children:[c(Q,{length:$,value:r,onChange:d,onComplete:n,validateChar:o=>Re.includes(o)||o==="",gap:0,sx:{".MuiFormControl-root:first-of-type > .MuiInputBase-root":{borderTopRightRadius:0,borderBottomRightRadius:0},".MuiFormControl-root:last-of-type > .MuiInputBase-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},".MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root":{borderRadius:0}}}),c(x,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:r.length!==$||i,onClick:o=>{o.preventDefault(),n(r)},children:i?"Verifying...":"Submit"})]})}try{V.displayName="TOTPForm",V.__docgenInfo={description:"",displayName:"TOTPForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function U(t){const{resetPasswordUrl:n=`${z(J.PORTAL_ENDPOINT)}#!PasswordReset:0`,onSubmit:i,isLoading:r}=t,[d,o]=_.useState(""),[s,m]=_.useState("");function f(p){p.preventDefault(),i(d,s)}return I("form",{onSubmit:p=>{f(p)},children:[c(N,{required:!0,fullWidth:!0,autoFocus:!0,autoComplete:"username",label:"Username or Email Address",id:"username",type:"text",value:d,onChange:p=>o(p.target.value)}),c(N,{required:!0,fullWidth:!0,autoComplete:"current-password",label:"Password",id:"current-password",type:"password",value:s,onChange:p=>m(p.target.value)}),c(P,{href:n,children:"Forgot password?"}),c(x,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",disabled:r,sx:{height:"50px",mt:4,mb:2},children:r?"Logging you in...":"Sign in"})]})}try{U.displayName="UsernamePasswordForm",U.__docgenInfo={description:"",displayName:"UsernamePasswordForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(username: string, password: string) => void"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}const ye=19;function M(t){const{onSubmit:n,isLoading:i}=t,[r,d]=A.useState("");return I(w,{children:[c(N,{placeholder:"Enter backup code",value:r,onChange:o=>{const s=o.target.value.toLowerCase().replace(/[^a-z0-9-]/gi,"");d(s)}}),c(x,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:r.length!==ye||i,onClick:o=>{o.preventDefault(),n(r)},children:i?"Verifying...":"Submit"})]})}try{M.displayName="RecoveryCodeForm",M.__docgenInfo={description:"",displayName:"RecoveryCodeForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function j(t){const{ssoRedirectUrl:n,registerAccountUrl:i=`${z(J.PORTAL_ENDPOINT)}#!RegisterAccount:0`,resetPasswordUrl:r,onBeginOAuthSignIn:d,onStepChange:o,step:s,submitUsernameAndPassword:m,submitOneTimePassword:f,errorMessage:p,isLoading:h}=t;return I(G,{children:[s=="CHOOSE_AUTH_METHOD"&&c(le,{onSelectUsernameAndPassword:()=>o("USERNAME_PASSWORD"),onBeginOAuthSignIn:d,ssoRedirectUrl:n}),s==="USERNAME_PASSWORD"&&c(U,{isLoading:h,resetPasswordUrl:r,onSubmit:(g,R)=>{m(g,R)}}),s==="VERIFICATION_CODE"&&I(G,{children:[c(V,{isLoading:h,onSubmit:g=>{f(g,"TOTP")}}),c(P,{align:"center",color:"grey.700",sx:{display:"block",mx:"auto"},onClick:()=>o("RECOVERY_CODE"),children:"Use a backup code instead"})]}),s==="RECOVERY_CODE"&&c(M,{isLoading:h,onSubmit:g=>{f(g,"RECOVERY_CODE")}}),(s==="CHOOSE_AUTH_METHOD"||s==="USERNAME_PASSWORD")&&c(w,{display:"flex",justifyContent:"center",children:c(P,{href:i,align:"center",children:"Don't have an account? Create one now"})}),p&&c(de,{variant:"warning",isGlobal:!1,description:p})]})}try{j.displayName="LoginForm",j.__docgenInfo={description:"",displayName:"LoginForm",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},registerAccountUrl:{defaultValue:null,description:"",name:"registerAccountUrl",required:!1,type:{name:"string"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},twoFactorAuthenticationRequired:{defaultValue:null,description:"",name:"twoFactorAuthenticationRequired",required:!1,type:{name:"TwoFactorAuthErrorResponse"}},submitUsernameAndPassword:{defaultValue:null,description:"",name:"submitUsernameAndPassword",required:!0,type:{name:"(username: string, password: string) => void"}},submitOneTimePassword:{defaultValue:null,description:"",name:"submitOneTimePassword",required:!0,type:{name:"(code: string, otpType?: TwoFactorAuthOtpType | undefined) => void"}},errorMessage:{defaultValue:null,description:"",name:"errorMessage",required:!0,type:{name:"string | undefined"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function Ie(t){switch(t){case"CHOOSE_AUTH_METHOD":return"CHOOSE_AUTH_METHOD";case"USERNAME_PASSWORD":return"CHOOSE_AUTH_METHOD";case"VERIFICATION_CODE":return"CHOOSE_AUTH_METHOD";case"RECOVERY_CODE":return"VERIFICATION_CODE";case"LOGGED_IN":return"LOGGED_IN"}}function K(t){const{step:n,onStepChange:i,sx:r}=t;return n==="USERNAME_PASSWORD"||n==="VERIFICATION_CODE"||n==="RECOVERY_CODE"?c(fe,{type:"button",onClick:()=>{i(Ie(n))},sx:r,children:c(me,{icon:"arrowBack",wrap:!1,sx:{height:"24px",width:"24px"}})}):null}try{K.displayName="LoginFlowBackButton",K.__docgenInfo={description:"",displayName:"LoginFlowBackButton",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps<{}>"}}}}}catch{}export{K as L,j as a,ke as u};
//# sourceMappingURL=LoginFlowBackButton-b555fd80.js.map
