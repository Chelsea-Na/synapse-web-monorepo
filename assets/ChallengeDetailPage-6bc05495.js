var U=Object.defineProperty;var H=(s,a,e)=>a in s?U(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var h=(s,a,e)=>(H(s,typeof a!="symbol"?a+"":a,e),e);import{a as y,j as c,F as w}from"./jsx-runtime-095bf462.js";import{R as S,r as g}from"./index-8db94870.js";import{C as q}from"./ChallengeRegisterButton-5c6423f9.js";import{C as v}from"./ChallengeTeamWizard-7f9e8d54.js";import{N as D,J as P,A as O,a as V}from"./ConfirmationDialog-8155d854.js";import{aU as j,S as d,aX as I,u as T,aR as A,b1 as J}from"./SynapseClient-8589b807.js";import{u as $}from"./useEntity-b5a34353.js";import{u as z}from"./useGetEntityChallenge-952c4fb5.js";import"./OrientationBanner-64c90f6a.js";import"./getEndpoint-ac94413e.js";import{d as M}from"./ToastMessage-bb65120b.js";import"./AccessTokenPage-81afe1c3.js";import"./AccountLevelBadge-9ea59057.js";import"./StandaloneLoginForm-2e7a89c8.js";import"./TwoFactorAuthSettingsPanel-3e2fc816.js";import"./TwoFactorEnrollmentForm-a76e7785.js";import"./TwoFactorBackupCodes-665fe0ed.js";import"./CertificationQuiz-8aad2049.js";import"./index-4908c99f.js";import"./ChallengeSubmission-2d6f9dc7.js";import"./DownloadCartPage-2b3f401c.js";import"./ShowDownloadV2-311e4007.js";import"./useEntitySelection-7921481e.js";import"./EvaluationCard-f31fc9c5.js";import"./EvaluationEditorPage-4ed7491b.js";import"./ExperimentalMode-9a2e3059.js";import{b as W,l as G}from"./IsType-7b3b32fa.js";import{O as B}from"./IconSvg-152a0feb.js";import"./FileUpload-885baf89.js";import"./FeaturedDataTabs-766324b7.js";import"./FeaturedToolsList-64da1fc6.js";import"./DiscussionThread-e5948ff6.js";import"./ForumPage-00253ef4.js";import"./FullWidthAlert-ed39f490.js";import"./Goals-260c1cd2.js";import"./GoogleMap-383eff43.js";import"./Icon-e69bff94.js";import"./ForumThreadEditor-a204216a.js";import"./MarkdownCollapse-186011ad.js";import"./OAuthManagement-21290edc.js";import"./ThemesPlot-ad574855.js";import"./UpsetPlot-8dbe3856.js";import"./ProjectViewCarousel-3c2a4ccc.js";import"./Programs-70a1b6b9.js";import"./QueryCount-9968dd7c.js";import"./RenderIfInView-72581fed.js";import"./Resources-938785ff.js";import"./RssFeedCards-6f8abf0a.js";import"./ElementWithTooltip-548f2ef7.js";import"./SkeletonButton-7cb1189a.js";import"./SkeletonTable-8342824d.js";import"./SkeletonParagraph-acce60fe.js";import"./LeftRightPanel-eb895f4c.js";import"./TextField-a1ee36d3.js";import"./WideButton-480c75b6.js";import"./InputSizedButton-526d020f.js";import"./SubscriptionItem-2c47c86e.js";import"./DropdownSelect-a725bc56.js";import"./SubsectionRowRenderer-94fbe414.js";import"./SynapseFormWrapper-ec71d028.js";import"./SynapseFormSubmissionsGrid-5f8475b0.js";import"./SystemUseNotification-fd25a57a.js";import"./TableFeedCards-d7f13027.js";import"./TermsAndConditions-47350fb8.js";import"./UserCard-4bcb5032.js";import"./UserCardList-142808f4.js";import"./UserCardListRotate-f7104ab0.js";import"./UserCardListGroups-707361ae.js";import"./UserOrTeamBadge-b7f8a5cc.js";import"./UserProfileLinks-9a219051.js";import{a as Y}from"./useTeamMembers-a72547d2.js";class F extends S.Component{constructor(e){super(e);h(this,"formRef");h(this,"submitForm",()=>{this.formRef.current.submit()});h(this,"refresh",()=>{if(this.context.accessToken){const e=[d.getUserProfile(this.context.accessToken),d.getEntity(this.context.accessToken,this.props.formSchemaEntityId),d.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(e).then(t=>{const i=t[0];this.getTargetContainer(i,this.context.accessToken).then(n=>{const r=t[1],o=t[2];this.getSchemaFileContent(n,r,o)})}).catch(t=>{this.onError(t)})}});h(this,"getSchemaFileContent",(e,t,i)=>{const n=[d.getFileResult(t,this.context.accessToken,!0,!0),d.getFileResult(i,this.context.accessToken,!0,!0)];Promise.all(n).then(r=>{try{const o=r.map(l=>I(l.fileHandle,l.preSignedURL));Promise.all(o).then(l=>{const m=JSON.parse(l[0]),u=JSON.parse(l[1]);this.getExistingFileData(e,m,u)}).catch(l=>{console.log("getSchemaFileContent: Error getting form content",l)})}catch(o){console.log("getSchemaFileContent: Error getting schema content",o)}}).catch(r=>{this.onError(r)})});h(this,"getExistingFileData",(e,t,i)=>{const r={entityName:`${t.title}.json`,parentId:e};let o,l;d.lookupChildEntity(r,this.context.accessToken).then(m=>d.getEntity(this.context.accessToken,m.id).then(u=>(l=u,this.props.initFormData?d.getFileResult(l,this.context.accessToken,!0,!0).then(async f=>{try{const p=await I(f.fileHandle,f.preSignedURL);o=JSON.parse(p)}catch(p){console.log("getExistingFileData: Error setting form data",p)}}):Promise.resolve()))).finally(()=>{this.setState({formData:o,currentFileEntity:l,formSchema:t,formUiSchema:i})})});h(this,"getTargetContainer",async(e,t)=>{const i={entityName:e.ownerId,parentId:this.props.parentContainerId};try{const n=await d.lookupChildEntity(i,t);return console.log(`EntityForm uploading to https://www.synapse.org/#!Synapse:${n.id}`),this.setState({userprofile:e,containerId:n.id,isLoading:!1}),n.id}catch(n){return n.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(n)}});h(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});h(this,"onError",e=>{this.setState({error:e,isLoading:!1,successfullyUploaded:!1})});h(this,"onSubmit",({formData:e})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const t=new Blob([JSON.stringify(e)],{type:"text/json"});this.createEntityFile(t)});h(this,"createEntityFile",e=>{const t=`${this.state.formSchema.title}.json`;d.uploadFile(this.context.accessToken,t,e).then(i=>{const n=i.fileHandleId;if(this.state.currentFileEntity){const o={...this.state.currentFileEntity,dataFileHandleId:n};return this.setState({currentFileEntity:o}),d.updateEntity(o,this.context.accessToken)}const r={parentId:this.state.containerId,name:t,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:n};return d.createEntity(r,this.context.accessToken)}).then(i=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(i.id)}).catch(i=>{this.onError(i)})});this.formRef=S.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return y("div",{children:[this.state.error&&y("div",{className:"panel panel-danger errors",children:[c("div",{className:"panel-heading",children:c("h3",{className:"panel-title",children:"Error"})}),c("ul",{className:"list-group",children:y("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&c(D,{validator:P,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:c("div",{style:{display:"none"},children:c("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&y(S.Fragment,{children:[c("span",{children:"Savingâ€¦"}),c("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}h(F,"contextType",j);try{F.displayName="EntityForm",F.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}const x=s=>{const{accessToken:a}=T(),{synId:e,className:t}=s,[i,n]=g.useState(void 0);g.useEffect(()=>{(async()=>{try{const m=await d.getEntity(a,e);if(!W(m))throw new Error(`File Entity expected but found ${m}`);const u={requestedFiles:[{associateObjectId:e,associateObjectType:A.FileEntity,fileHandleId:m.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},p=(await d.getFiles(u,a)).requestedFiles[0].fileHandle;if(p&&G(p))n({externalFileHandle:p,fileEntity:m});else throw new Error(`Not an external file handle: ${p==null?void 0:p.id}`)}catch(m){console.error("Error on getting external file handle = ",m)}})()},[e,a]);const r=i==null?void 0:i.externalFileHandle,o=i==null?void 0:i.fileEntity;return r?c("a",{href:r.externalURL,className:t,target:"_blank",rel:"noopener noreferrer",children:y("span",{children:[o==null?void 0:o.name,c(B,{style:{marginLeft:5}})]})}):c(w,{})};try{x.displayName="ExternalFileHandleLink",x.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}function k({projectId:s}){const{accessToken:a}=T(),[e,t]=g.useState(!1),[i,n]=g.useState(!1),[r,o]=g.useState(),[l,m]=g.useState(!1),{data:u}=J(),{data:f}=$(s),p=E=>{t(E)},b=()=>{n(!0)},N=()=>{m(!0)},{mutate:L}=Y({onSuccess:()=>{M("You are no longer registered for this challenge","info")}}),_=()=>{a&&r&&u&&L({teamId:r.participantTeamId,userId:u.ownerId})},R=()=>{n(!1),a&&t(!0)};return z(s,{enabled:!r,onSettled:(E,C)=>{E&&o(E),C&&console.warn(C)}}),y(w,{children:[c(q,{projectId:s,onJoinClick:b,onLeaveClick:N}),i&&c(O,{entityId:s,teamId:r==null?void 0:r.participantTeamId,onHide:R,renderAsModal:!0,requestObjectName:f==null?void 0:f.name,dialogTitle:"Challenge Terms and Conditions"}),e&&c(v,{projectId:s,onClose:()=>{p(!1)},isShowingModal:!0}),l&&c(V,{open:l,title:"Leave this Challenge?",content:"Are you sure you want to leave this Challenge?",onCancel:()=>m(!1),onConfirm:()=>{_(),m(!1)}})]})}try{k.displayName="ChallengeDetailPage",k.__docgenInfo={description:"",displayName:"ChallengeDetailPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}export{k as C};
//# sourceMappingURL=ChallengeDetailPage-6bc05495.js.map
