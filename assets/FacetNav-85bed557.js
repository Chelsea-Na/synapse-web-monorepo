import{j as n,a as h,F as q}from"./jsx-runtime-670450c2.js";import{a3 as De,aA as Ge,au as Ue,a4 as je,a6 as Je,aF as Ke,aL as Ze}from"./index-fb7124f7.js";import{r as p,R as Ee}from"./index-f1f749bf.js";import{i as Xe,r as et,h as tt,a as Me}from"./queryUtils-e71a474c.js";import{a as Be,b as nt,u as at}from"./use-deep-compare-effect.esm-2b920fea.js";import{s as rt}from"./NoSearchResults-597d4337.js";import{N as lt}from"./NoData-0f1b3dd6.js";import{u as st}from"./unCamelCase-ec1c2b3d.js";import{C as Q}from"./ColumnType-3c5058f3.js";import{o as ot,p as it,n as ct,i as ut,j as dt,v as mt,V as W,H as se,x as pt,y as ht,w as yt}from"./SynapseConstants-f1d07af3.js";import{u as ft}from"./useEntity-eed8dc59.js";import{b as gt}from"./useGetQueryResultBundle-1fdceabd.js";import{p as _t,a as Ct}from"./sqlFunctions-5e40925f.js";import{i as me,a as pe,c as Nt}from"./QueryFilter-986d65bb.js";import{c as ie}from"./cloneDeep-25b04c7f.js";import{i as Z}from"./isEqual-ab4bfafb.js";import{E as te}from"./ElementWithTooltip-8cdb7ce7.js";import{u as ce}from"./useGetInfoFromIds-86a07025.js";import{I as Y,a as Ft}from"./IconSvg-f4681469.js";import{C as $e}from"./Checkbox-44f336ac.js";import{D as A}from"./Dropdown-83007dcc.js";import{R as St}from"./RadioGroup-21807f37.js";import{d as Ve}from"./dayjs.min-c95aebbe.js";import{R as bt}from"./RangeSlider-48927c23.js";import{c as vt,P as Et}from"./factory-76e91d33.js";import{r as Tt}from"./react-sizeme-2217af01.js";import{S as xt}from"./Skeleton-4064b2ac.js";import{g as wt}from"./ColorGradient-fc5a110b.js";import{l as Vt}from"./LoadingScreen-df094095.js";import{M as X}from"./Modal-346748ce.js";import{B as He}from"./Button-7d415009.js";import{T as It}from"./Tooltip-e2a21fb8.js";import{S as Rt}from"./SelectionCriteriaPill-8e0caa78.js";const kt="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",qt="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",he=De(kt),Qt=De(qt),ne=e=>n(xt,{style:{...e.style,display:"inline-block"},...e});try{ne.displayName="SkeletonInlineBlock",ne.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rectangular"'},{value:'"rounded"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}}}catch{}const M=p.createContext(void 0),ye=({children:e,queryContext:t})=>n(M.Provider,{value:t,children:e});function B(){const e=p.useContext(M);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function jn(){const e=p.useContext(M);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function Jn(){const e=p.useContext(M);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Ie=M.Consumer;try{M.displayName="QueryContext",M.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}}}catch{}try{ye.displayName="QueryContextProvider",ye.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}}}catch{}try{Ie.displayName="QueryContextConsumer",Ie.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}}}catch{}function Oe(e,t){return`${e}${t}`}function Lt(e,t){const a=window.location.search,r=`${e}=${t}`;return a?a.includes(`${e}=`)?window.location.search.slice(a.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${r}`:o).join("&"):`${a.substr(1)}&${r}`:r}function Pt(e,t){if(!window.location.search)return;const a=Oe(e,t),l=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===a).map(s=>s.split("=")[1])[0];return l?decodeURIComponent(l):void 0}function At(e,t,a){const r=t!==void 0?Oe(e,t):e,l=Lt(r,a),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${l}`;window.history.replaceState("object or string","Title",o)}function Dt(e,t){const a=Pt(e,t);let r;if(a){const l=JSON.parse(a);l.sql&&(r={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:ot|it|ct|ut|dt,entityId:_t(l.sql),query:l})}return r}function Ut(e){const{initQueryRequest:t,componentIndex:a=0,shouldDeepLink:r=!1,onQueryChange:l}=e,[s,o]=p.useState(t);p.useEffect(()=>{const y=Dt("QueryWrapper",a);y&&o(y)},[a]);const c=p.useCallback(()=>ie(s),[s]),d=p.useCallback(()=>ie(t),[t]),i=p.useCallback(y=>{let C;typeof y=="function"?C=y(c()):C=y;const V=ie(C);if(o(V),V.query){const S=JSON.stringify(V.query);if(r){const L=encodeURIComponent(S);At("QueryWrapper",a,L)}l&&l(S)}},[a,c,l,r]),{entityId:f,versionNumber:x}=p.useMemo(()=>Ct(s.query.sql),[s.query.sql]),F=s.query.limit??mt,I=Math.ceil(((s.query.offset??0)+Number(F))/F),N=p.useCallback(y=>{i(C=>(C.query.limit=y,C))},[i]),w=p.useCallback(y=>{i(C=>(C.query.offset=(y-1)*F,C))},[F,i]),g=p.useCallback(()=>{i(t)},[t,i]),u=p.useCallback(y=>{i(C=>(C.query.selectedFacets=(C.query.selectedFacets??[]).filter(V=>!Z(V,y)),C))},[i]),m=p.useCallback((y,C)=>{i(V=>(V.query.selectedFacets=(V.query.selectedFacets??[]).map(S=>(he(S)&&Z(S,y)&&(S.facetValues=S.facetValues.filter(L=>L!==C)),S)).filter(S=>he(S)?Array.isArray(S.facetValues)&&S.facetValues.length>0:!0),V))},[i]),b=p.useCallback(y=>{i(C=>(C.query.additionalFilters=(C.query.additionalFilters??[]).filter(V=>!Z(V,y)),C))},[i]),_=p.useCallback((y,C)=>{i(V=>(V.query.additionalFilters=(V.query.additionalFilters??[]).map(S=>((me(S)||pe(S))&&Z(S,y)&&(S.values=S.values.filter(L=>L!==C)),S)).filter(S=>me(S)||pe(S)?Array.isArray(S.values)&&S.values.length>0:!0),V))},[i]);return{entityId:f,versionNumber:x,getInitQueryRequest:d,getLastQueryRequest:c,setQuery:i,pageSize:F,currentPage:I,setPageSize:N,goToPage:w,resetQuery:g,removeSelectedFacet:u,removeValueFromSelectedFacet:m,removeQueryFilter:b,removeValueFromQueryFilter:_}}const Te="isShowingFacetFilters",xe="isHidingFacetFilters";function Re(e){const{initQueryRequest:t,onQueryChange:a,onQueryResultBundleChange:r,lockedColumn:l,componentIndex:s,shouldDeepLink:o}=e,[c,d]=p.useState(void 0),{entityId:i,versionNumber:f,getInitQueryRequest:x,getLastQueryRequest:F,setQuery:I,currentPage:N,pageSize:w,goToPage:g,setPageSize:u,resetQuery:m,removeSelectedFacet:b,removeValueFromSelectedFacet:_,removeQueryFilter:y,removeValueFromQueryFilter:C}=Ut({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:a}),V=p.useMemo(()=>F(),[F]),{data:S,isLoading:L,error:E,isPreviousData:R}=gt(V,{keepPreviousData:!0},d),v=S==null?void 0:S.responseBody,k=L||R,{data:P}=ft(i,f);Be(()=>{v&&r&&r(JSON.stringify(v))},[v,r]);const J=v?Xe(v.facets,v.selectColumns):!0,U=p.useMemo(()=>et(v,l),[v,l]),z=p.useMemo(()=>{const O=F();return tt(O.query,l)},[F,l]),K=p.useCallback(O=>{var oe;return((oe=v==null?void 0:v.columnModels)==null?void 0:oe.find(We=>We.name===O))??null},[v==null?void 0:v.columnModels]),T={data:U,currentPage:N,pageSize:w,setPageSize:u,isLoadingNewBundle:k,getLastQueryRequest:F,getInitQueryRequest:x,error:E,entity:P,executeQueryRequest:I,isFacetsAvailable:J,asyncJobStatus:c,goToPage:g,hasResettableFilters:z,removeSelectedFacet:b,removeValueFromSelectedFacet:_,resetQuery:m,removeQueryFilter:y,removeValueFromQueryFilter:C,lockedColumn:l,getColumnModel:K},{children:D}=e;return n(ye,{queryContext:T,children:n("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${J?"has-facets":""}`,children:D})})}try{Re.displayName="QueryWrapper",Re.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}}}catch{}function Mt(){return h(q,{children:[n("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),n("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ee=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ee||{});function Bt(){return h("div",{className:"text-center",children:[rt,n("h4",{children:"No Matching Results"}),n("p",{children:"Try checking the spelling or removing filters."})]})}function $t(){return h("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[lt,n("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const Ht=()=>{try{return JSON.parse(sessionStorage.getItem(pt)||"")}catch{return[]}},Ot=()=>{try{return JSON.parse(sessionStorage.getItem(ht)||"")}catch{return[]}},zt=()=>{try{return JSON.parse(sessionStorage.getItem(yt)||"")}catch{return[]}},Yt=e=>{const t=Ht().find(a=>a.id===e);return(t==null?void 0:t.name)??e},Wt=e=>{const t=zt().find(a=>a.id===e);return(t==null?void 0:t.name)||e},Gt=e=>{const t=Ot().find(a=>a.ownerId===e);return(t==null?void 0:t.userName)||e},jt=(e,t)=>{if(e===W)return se;switch(t){case Q.ENTITYID:case Q.ENTITYID_LIST:return Yt(e);case Q.USERID:case Q.USERID_LIST:return Gt(e);case Q.EVALUATIONID:return Wt(e);default:return e}},G=p.createContext(void 0),fe=({children:e,queryVisualizationContext:t})=>n(G.Provider,{value:t,children:e});function $(){const e=p.useContext(G);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const ke=G.Consumer;function qe(e){const{noContentPlaceholderType:t=ee.INTERACTIVE}=e,{data:a,getLastQueryRequest:r,isFacetsAvailable:l,isLoadingNewBundle:s,hasResettableFilters:o}=B(),{columnAliases:c={}}=e,[d,i]=p.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:e.defaultShowFacetVisualization??!0,showSearchBar:e.defaultShowSearchBar??!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});p.useEffect(()=>{l||i(_=>({..._,showFacetFilter:!1,showFacetVisualization:!1}))},[l]),p.useEffect(()=>{s&&I([])},[s]);const[f,x]=p.useState([]),[F,I]=p.useState([]),N=r(),w=nt(a==null?void 0:a.selectColumns);p.useEffect(()=>{x((w==null?void 0:w.slice(0,e.visibleColumnCount??1/0).map(_=>_.name))??[])},[w,N.query.sql,e.visibleColumnCount]);const g=p.useCallback(_=>{const y=localStorage.getItem("force-display-original-column-names")==="true";return!_||y?_:c[_]?c[_]:st(_)},[c]),u=p.useCallback(()=>{switch(t){case ee.INTERACTIVE:return o?n(Bt,{}):n($t,{});case ee.STATIC:default:return n(Mt,{})}},[t,o]),m={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:f,setColumnsToShowInTable:x,selectedRowIndices:F,setSelectedRowIndices:I,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:g,getDisplayValue:jt,NoContentPlaceholder:u},{children:b}=e;return n(fe,{queryVisualizationContext:m,children:b})}try{qe.displayName="QueryVisualizationWrapper",qe.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}}}catch{}try{G.displayName="QueryVisualizationContext",G.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}}}catch{}try{fe.displayName="QueryVisualizationContextProvider",fe.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}}}catch{}try{ke.displayName="QueryVisualizationContextConsumer",ke.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}}}catch{}const Qe=()=>{const{error:e}=B();return n(Ge,{error:e})};try{Qe.displayName="QueryWrapperErrorBanner",Qe.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}}}catch{}const ge=e=>h("svg",{...e,className:`Icon-Plus ${e.className??""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]});try{ge.displayName="IconPlus",ge.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const _e=e=>h("svg",{...e,className:`Icon-Minus ${e.className??""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&n("title",{children:e.title}),n("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]});try{_e.displayName="IconMinus",_e.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const ae=({label:e,isCollapsed:t,onClick:a})=>{const{getColumnDisplayName:r}=$();return h("div",{className:"FacetFilterHeader",children:[n("label",{className:"FacetFilterHeader__label",children:r(e)}),n("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>a(!t),children:t?n(ge,{className:"icon-plus",title:"Expand Menu"}):n(_e,{className:"icon-minus",title:"Collapse Menu"})})]})};try{ae.displayName="FacetFilterHeader",ae.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}}}catch{}function Jt(e){return e.replace(/\s/g,"").toLowerCase()}function Le(e,t=[],a=[],r=[]){const{value:l}=e;let s=l;l===W&&(s=se);const o=t.find(i=>i.ownerId===l);o&&(s=o?o.userName:`unknown (${l})`);const c=a.find(i=>i.id===l);c&&(s=c?c.name:`unknown (${l})`);const d=r.find(i=>i.id===l);return d!=null&&d.name&&(s=d.name),`${s}`}function Kt(e,t,a){const r=[...e.sort((l,s)=>s.count-l.count)];return t||r.length<=a||r.slice(a).find(l=>l.isSelected)?r:r.splice(0,a)}const j=({facetValues:e,columnModel:t,onClear:a,onChange:r,containerAs:l="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,d]=p.useState(!1),[i,f]=p.useState(o),[x,F]=p.useState(!1),[I,N]=p.useState(!1),[w,g]=p.useState(""),[u,m]=p.useState(e);at(()=>{m(e)},[e]);const b=5,_=1500,y=Ee.createRef(),C={};let V;const S=e.filter(T=>T.isSelected).length===0,L=(t==null?void 0:t.columnType)===Q.USERID||(t==null?void 0:t.columnType)===Q.USERID_LIST?e.map(T=>T.value):[],E=ce({ids:L,type:"USER_PROFILE"}),R=(t==null?void 0:t.columnType)===Q.ENTITYID||(t==null?void 0:t.columnType)===Q.ENTITYID_LIST?e.map(T=>T.value):[],v=ce({ids:R,type:"ENTITY_HEADER"}),k=(t==null?void 0:t.columnType)===Q.EVALUATIONID?e.map(T=>T.value):[],P=ce({ids:k,type:"EVALUATION_QUEUE"}),J=T=>{const D=T.target.value;if(g(D),d(!0),!D)e.forEach(H=>{H.isSelected=!1}),m(e);else{const H=e.filter(O=>Le(O,E,v,P).toLowerCase().indexOf(D.trim().toLowerCase())>-1?O:null);m(H)}};if(!t)return n(q,{});const U=l==="Dropdown",z=h("div",{className:U?"EnumFacetFilter__dropdown_menu":"",children:[h("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[h("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[n("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{m(e),N(!1),d(!1)},children:n("span",{className:"EnumFacetFilter__previous",children:n(Y,{icon:"arrowBack"})})}),w.length>0&&n("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var T;g(""),(T=y.current)==null||T.focus()},children:n("span",{className:"EnumFacetFilter__reset",children:n(Y,{icon:"close"})})}),n("input",{type:"text",placeholder:"Find values",value:w,ref:y,onChange:T=>{J(T)}})]}),!I&&h("div",{className:"EnumFacetFilter__checkAll",children:[n($e,{className:"EnumFacetFilter__checkbox",onChange:()=>{a()},checked:S,label:"All",isSelectAll:!0},"select_all"),n("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var T;g(""),N(!0),(T=y.current)==null||T.focus()},children:n("span",{className:"EnumFacetFilter__searchicon",children:n(Y,{icon:"search"})})})]})]}),h("div",{children:[u.length>0&&Kt(u,c||U,b).map((T,D)=>n(Zt,{id:Jt(T.value),index:D,label:Le(T,E,v,P),count:T.count,isDropdown:U,initialIsSelected:T.isSelected,onChange:H=>{C[T.value]=H,clearTimeout(V),V=setTimeout(()=>{r(C),F(!1)},_)}},`checkLabel${D}`)),!U&&h(q,{children:[!c&&u.length>b&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:h("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",u.length,")"]})})}),c&&u.length>b&&n("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:n("div",{className:"EnumFacetFilter__checkboxContainer",children:n("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),u.length<=0&&n("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),K=()=>F(!x);return U?s==="SelectBox"?h(A,{className:"EnumFacetFilter EnumFacetFilterSelect",show:x,onToggle:K,children:[h(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:[S&&"All",!S&&e.filter(T=>T.isSelected).length===1&&e.filter(T=>T.isSelected)[0].value,!S&&e.filter(T=>T.isSelected).length>1&&"Multiple Values Selected"]}),n(A.Menu,{children:z})]}):h(A,{className:"EnumFacetFilter",show:x,onToggle:K,children:[n(te,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),n(A.Menu,{children:z})]}):h(q,{children:[n(ae,{isCollapsed:i,label:t.name,onClick:T=>f(T)}),n(Ue,{className:"EnumFacetFilter",in:!i,children:z})]})};function Zt({id:e,index:t,label:a,count:r,isDropdown:l,initialIsSelected:s,onChange:o}){const[c,d]=p.useState(s);return Ee.useEffect(()=>{d(s)},[s]),h("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{l&&(d(!c),o(!c))},children:[n($e,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),o(i)},checked:c,label:a},`${e}-${t}`),l&&h("span",{className:"EnumFacetFilter__count",children:["(",r,")"]}),!l&&n("div",{className:"EnumFacetFilter__count",children:r})]})}try{j.displayName="EnumFacetFilter",j.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Ce=({facet:e,isChecked:t,onClick:a})=>{const{getColumnDisplayName:r}=$();return h("button",{className:`Chip ${t?"Checked":""}`,onClick:a,children:[r(e.columnName),n(Y,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{Ce.displayName="FacetChip",Ce.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}const Ne=e=>{const t="Min value should be less then max value",[a,r]=p.useState(!1),[l,s]=p.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Ve(e.initialValues.min).format("YYYY-MM-DD"),max:Ve(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:i,max:f},x="number")=>{if(i==null||f===null||f===void 0)return r(!1),!0;if(x==="number"){if(Number(i)>Number(f))return r(!0),!1}else if(Date.parse(i)>Date.parse(f))return r(!0),!1;return r(!1),!0},d=(i,f,x="number")=>{c(i,x)&&f(i)};return h("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[h("div",{style:{marginRight:"10px"},children:[n("input",{"aria-label":"min",type:e.type,value:l.min,onChange:({target:i})=>s({min:i.value,max:l.max})},"range_min"),n("div",{children:"to"}),n("input",{"aria-label":"max",type:e.type,value:l.max,onChange:({target:i})=>s({min:l.min,max:i.value})},"range_max")]}),n("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(l,e.onChange,e.type),children:"Apply"}),a&&n("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{Ne.displayName="Range",Ne.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}}}catch{}const Fe=({facetResult:e,columnModel:t,onChange:a,collapsed:r=!1})=>{const[l,s]=p.useState(r),o=[{label:se,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:d,selectedMin:i,selectedMax:f}=e;const x=!i&&!f;i=i||c,f=f||d;const F=t.columnType==="DOUBLE"?"number":"date",I=(m,b)=>b?"":m===W?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",N=(m,b)=>{g(m),m!=="RANGE"&&b([m,m])},[w,g]=p.useState(I(i,x));return h("div",{children:[n(ae,{isCollapsed:l,label:t.name,onClick:m=>s(m)}),h(Ue,{in:!l,children:[n(St,{value:w,id:"rangeSelector",options:o,onChange:m=>N(m,a)}),w==="RANGE"&&(c===d?n("label",{children:d}):h(q,{children:[t.columnType==="INTEGER"&&h(bt,{domain:[c,d],initialValues:{min:i,max:f},step:1,doUpdateOnApply:!0,onChange:m=>a([m.min,m.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&n(Ne,{initialValues:{min:i,max:f},type:F,onChange:m=>a([m.min,m.max])},"Range")]}))]})]})};try{Fe.displayName="RangeFacetFilter",Fe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const ze=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),Xt=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},we=(e,t)=>{var s;const a=((s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)??[],r=a.findIndex(o=>o.columnName===e.columnName),l=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return r>-1?l?a.splice(r,1):a[r]=e:a.push(e),a};function re(e,t,a,r,l=!1){r?t.facetValues.forEach(c=>{c.value===r&&(c.isSelected=l)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=ze(t),o=we(s,e);a(o)}const Se=(e,t,a,r)=>{const l=r&&Object.keys(r)||[];l.length&&t.facetValues.forEach(c=>{l.includes(c.value)&&(c.isSelected=r?!!r[c.value]:!1)});const s=ze(t),o=we(s,e);a(o)},en=(e,t,a,r)=>{t.columnMin=r[0],t.columnMax=r[1];const l=Xt(t),s=we(l,e);a(s)};function Pe(e){var g;const{facetsToFilter:t}=e,{data:a,isLoadingNewBundle:r,getLastQueryRequest:l,executeQueryRequest:s}=B(),o=(g=a==null?void 0:a.facets)==null?void 0:g.filter(u=>!Me(u));let c;t==null?c=(o==null?void 0:o.map(u=>u.columnName))??[]:c=t;const[d,i]=Ee.useState([]),{topLevelControlsState:f}=$(),{showFacetFilter:x}=f;if(Be(()=>{i(c.slice(0,3))},[a==null?void 0:a.facets]),!a)return n(q,{});const F=a.selectColumns,I=l(),N=u=>{const m=l();m.query.selectedFacets=u,m.query.offset=0,s(m)},w=u=>{let m=[...d??[""],u.columnName];d.includes(u.columnName)&&(m=m.filter(b=>b!=u.columnName)),i(m)};return h("div",{className:`FacetFilterControls ${x?Te:xe}`,children:[r&&n("div",{children:"Loading..."}),!r&&(o??[]).filter(u=>d.includes(u.columnName)).map((u,m)=>{const b=F.find(_=>_.name===u.columnName);return h("div",{className:"FacetFilterControls__facet",children:[u.facetType==="enumeration"&&b&&n(j,{containerAs:"Collapsible",collapsed:!1,facetValues:u.facetValues,columnModel:b,onChange:_=>Se(I,u,N,_),onClear:()=>re(I,u,N)}),u.facetType==="range"&&b&&n(Fe,{facetResult:u,columnModel:b,collapsed:!1,onChange:_=>en(I,u,N,_)})]},u.columnName)}),h("div",{children:[n("div",{className:"AvailableFacet",children:n("label",{className:"AvailableFacet__label",children:"Available Facets"})}),(o??[]).filter(u=>c.includes(u.columnName)).map(u=>n(Ce,{facet:u,onClick:()=>w(u),isChecked:d.includes(u.columnName)},u.columnName))]})]})}try{Pe.displayName="FacetFilterControls",Pe.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{facetsToFilter:{defaultValue:null,description:"",name:"facetsToFilter",required:!1,type:{name:"string[]"}}}}}catch{}const tn=vt(Et),nn=19,an=30,rn={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},ln=(e,t)=>{t=t||0;let a=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let r=0;r<t;r++)a.indexOf(".")!==-1&&(a=a.replace("0%","%"),a=a.replace(".%","%"));return a};function Ye(e,t){if(!e)return e;const a=e.trim();return a.length>t?a.substr(0,t-1)+"…":e}async function sn(e,t,a,r,l){var N,w;const{colorPalette:s}=wt(a,e.facetValues.length),o=async(g,u,m)=>{const b=new Map;b.set(W,se);const _=g.map(y=>y.value).filter(y=>y!==W);if(u===Q.ENTITYID||u===Q.ENTITYID_LIST){const y=await Ke(_,m);for(const C of y.results)b.set(C.id,C.name)}else if(u===Q.USERID||u===Q.USERID_LIST){const y=await Ze(_,m);for(const C of y.children)b.set(C.ownerId,C.userName)}return g.map(y=>({facet:y,label:c(y,!1,b),truncatedLabel:c(y,!0,b),count:y.count}))},c=(g,u,m)=>{let b=m.get(g.value)??g.value;return u&&(b=Ye(b,nn)),b},d=await o(e.facetValues,t,l),i=d.map(g=>g.truncatedLabel),x=e.facetValues.some(g=>g.isSelected)?e.facetValues.map((g,u)=>g.isSelected?s[u]:s[u].replace("rgb(","rgba(").replace(")",", 0.25)")):s,F={values:r==="PIE"?e.facetValues.map(g=>g.count):void 0,labels:d.map(g=>g.label),text:i,x:r==="BAR"?e.facetValues.map(g=>{var u;return((u=d.find(m=>m.facet===g))==null?void 0:u.label)??g.value}):void 0,y:r==="BAR"?e.facetValues.map(g=>g.count):void 0,facetEnumerationValues:e.facetValues.map(g=>g.value),name:e.columnName,hovertemplate:r==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:r==="PIE"?"pie":"bar",pull:r==="PIE"?e.facetValues.map(g=>g.isSelected?.1:0):void 0,marker:{colors:r==="PIE"?x:void 0,color:r==="BAR"?x:void 0}};return{data:[F],labels:d,colors:r==="PIE"?(N=F.marker)==null?void 0:N.colors:(w=F.marker)==null?void 0:w.color}}const on=(e,t,a)=>{if(e.points&&e.points[0]){const r=e.points[0],l=r.data.facetEnumerationValues[r.pointNumber],s=t.facetValues.find(o=>o.value===l);a(t,s,!s.isSelected)}};function cn(e,t,a){const l=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?l:l/3;return s>a&&(s=a),{width:`${l}px`,height:`${s}px`}}function be(e){const{labels:t,colors:a=[],isExpanded:r}=e;if(!t)return n(q,{});const l=r?Math.min(t.length,9):Math.min(t.length,3);if(l===0)return n(q,{});const s=t.reduce((o,c)=>o+c.count,0);return n("div",{className:`FacetNavPanel__body__legend${r?"--expanded":""}`,children:t.slice(0,l).map((o,c)=>{const i=`(${ln(o.count/s,1)}) ${o.label}`,f=Ye(i,an);return n(te,{tooltipText:o.label,children:h("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[n("div",{style:{backgroundColor:a[c]}}),n("label",{children:f})]},`legendLabel_${c}`)},o.label)})})}const un=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",le=e=>{const{onHide:t,isModalView:a,applyChangesToFacetFilter:r,applyChangesToGraphSlice:l,index:s,facetToPlot:o,plotType:c,onSetPlotType:d}=e,{accessToken:i}=je(),{data:f,isLoadingNewBundle:x,getLastQueryRequest:F}=B(),{getColumnDisplayName:I}=$(),[N,w]=p.useState(!1),g=I(o.columnName),u=p.useCallback(()=>{var _,y;return(y=(_=f==null?void 0:f.columnModels)==null?void 0:_.find(C=>C.name===o.columnName))==null?void 0:y.columnType},[f,o.columnName]),{data:m}=Je(["extractPlotDataArray",o,u(),s,c,i],()=>sn(o,u(),s,c,i),{enabled:!!o}),b=()=>h("div",{onClick:_=>{_.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),h(A,{children:[n(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),h(A.Menu,{className:"chart-tools",children:[n(A.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),n(A.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!f&&x||!o?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Vt}):h(q,{children:[h(X,{animation:!1,show:N,onHide:()=>w(!1),backdrop:"static",children:[n(X.Header,{closeButton:!0,children:n(X.Title,{children:g??""})}),h(X.Body,{children:[n(le,{...e,isModalView:!0}),n("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:n(He,{variant:"secondary",className:"pill-xl SaveFiltersButton",size:"sm",onClick:()=>w(!1),children:"Apply Filters"})})]})]}),h("div",{role:"graphics-document",className:`FacetNavPanel${a?"--expanded":""}`,children:[!a&&h("div",{className:"FacetNavPanel__title",children:[!f&&x?n(ne,{width:100}):n("span",{className:"FacetNavPanel__title__name",children:g}),h("div",{className:"FacetNavPanel__title__tools",children:[n(j,{facetValues:o.facetValues,columnModel:f==null?void 0:f.columnModels.find(_=>_.name===o.columnName),onChange:_=>{Se(F(),o,r,_)},onClear:()=>{re(F(),o,r)},containerAs:"Dropdown"}),n(te,{tooltipText:"Expand to large graph",callbackFn:()=>w(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),n(te,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),a&&h(q,{children:[h("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[n("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),n(j,{facetValues:o.facetValues,columnModel:f==null?void 0:f.columnModels.find(_=>_.name===o.columnName),onChange:_=>{Se(F(),o,r,_)},onClear:()=>{re(F(),o,r)},containerAs:"Dropdown",dropdownType:"SelectBox"}),n(It,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:n(Ft,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),n(b,{})]}),h("div",{className:`FacetNavPanel__body${a?"--expanded":""}`,role:"graphics-object",children:[n(Tt.SizeMe,{monitorHeight:!0,children:({size:_})=>n("div",{className:un(a,c),children:n(tn,{layout:rn,data:(m==null?void 0:m.data)??[],style:cn(_.width,c,a?300:150),config:{displayModeBar:!1},onClick:y=>on(y,o,l)},`${o.columnName}-${c}-${_.width}`)})}),n(be,{labels:m==null?void 0:m.labels,colors:m==null?void 0:m.colors,isExpanded:a})]})]})]})};try{be.displayName="FacetPlotLegend",be.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}}}catch{}try{le.displayName="FacetNavPanel",le.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}}}catch{}function dn(e,t,a){const r=t.getColumnModel(e.columnName);return e.values.map(l=>{let s=l;l!=null&&l.startsWith("%")&&(l!=null&&l.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=a.getDisplayValue(s,r.columnType);const o=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${l}`,innerText:o,tooltipText:o,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,l)}}})}function mn(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function pn(e,t,a){var r;return me(e)||pe(e)?e.columnName===((r=t.lockedColumn)==null?void 0:r.columnName)?[]:dn(e,t,a):Nt(e)?[mn(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function hn(e,t,a){var o;if(e.columnName===((o=t.lockedColumn)==null?void 0:o.columnName))return[];const r=t.getColumnModel(e.columnName),{getColumnDisplayName:l,getDisplayValue:s}=a;if(he(e))return e.facetValues.map(c=>{const d=s(c,r.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${c}`,innerText:d,tooltipText:`${l(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,c)}}});if(Qt(e)){const c=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:c,tooltipText:`${l(e.columnName)}: ${c}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function yn(){var c;const e=B(),t=$(),{getLastQueryRequest:a}=e,r=a(),l=(((c=r.query)==null?void 0:c.additionalFilters)??[]).flatMap(d=>pn(d,e,t)),s=(r.query.selectedFacets??[]).flatMap(d=>hn(d,e,t)),o=[...l,...s];return n(q,{children:o.map(d=>{const i=encodeURIComponent(d.key);return p.createElement(Rt,{...d,key:i})})})}function ve(e){const{style:t,frontText:a,endText:r="",hideIfUnfiltered:l=!1}=e,{data:s,isLoadingNewBundle:o,resetQuery:c,error:d,hasResettableFilters:i}=B(),{topLevelControlsState:f,unitDescription:x}=$(),F=s==null?void 0:s.queryCount,I=f==null?void 0:f.showFacetFilter,N=i;return d?n(q,{}):n("div",{className:`TotalQueryResults ${I?Te:xe} ${i?"hasFilters":""}`,style:t,children:o?n(ne,{width:100}):h(q,{children:[(i||!l)&&h("div",{className:"TotalQueryResults__topbar",children:[h("span",{className:"SRC-boldText",children:[a," ",F==null?void 0:F.toLocaleString()," ",x," ",r]}),N&&h("a",{onClick:c,className:"TotalQueryResults__topbar__clearall",children:[n(Y,{icon:"deleteSweep"}),"Clear all filters"]})]}),n("div",{className:"TotalQueryResults__selections",children:n(yn,{})})]})})}try{ve.displayName="TotalQueryResults",ve.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}}}catch{}const ue=2;function de(e,t){var r;return((r=e==null?void 0:e.facets)==null?void 0:r.filter(l=>l.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(l.columnName)>-1)&&l.facetValues.length>0&&!Me(l)))??[]}const Ae=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:a,isLoadingNewBundle:r,executeQueryRequest:l,error:s,asyncJobStatus:o}=B(),{topLevelControlsState:c}=$(),[d,i]=p.useState([]),[f,x]=p.useState(!0),{showFacetVisualization:F,showFacetFilter:I}=c,N=a();p.useEffect(()=>{const E=de(t,e);E.length!==0&&f&&(i(E.map((R,v)=>({name:R.columnName,isHidden:v>=ue,plotType:"PIE"}))),x(!1))},[t,f,e]);const w=E=>{i(R=>R.map((v,k)=>E?{...v,isHidden:!1}:{...v,isHidden:k>=ue}))},g=E=>{N.query.selectedFacets=E,N.query.offset=0,l(N)},u=E=>d.find(k=>k.name===E&&k.isHidden===!0)!==void 0,m=p.useMemo(()=>d.find(E=>E.isHidden===!0)?"MORE":d.length<=ue?"NONE":"LESS",[d]),b=E=>{C(E,"isHidden",!0)},_=(E,R)=>{C(E,"plotType",R)},y=E=>{var v;return((v=d.find(k=>k.name===E))==null?void 0:v.plotType)??"PIE"},C=(E,R,v)=>{i(k=>k.map(P=>P.name===E?{...P,[R]:v}:P))},V=de(t,e),S=de(t,e).map((E,R)=>({columnName:E.columnName,colorIndex:R})),L=(N==null?void 0:N.query.selectedFacets)!==void 0&&N.query.selectedFacets.length>0||(N==null?void 0:N.query.additionalFilters)!==void 0&&(N==null?void 0:N.query.additionalFilters.length)>0;return s?n(q,{}):!t&&r?n("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&h("div",{children:[n("span",{className:"spinner"}),o.progressMessage]})}):h(q,{children:[n(ve,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),V.length>0&&h("div",{className:`FacetNav ${F?"":"hidden"} ${I?Te:xe} ${m==="LESS"?"less":""}`,children:[n("div",{className:"FacetNav__row",role:"list",children:V.map(E=>{var R;return n("div",{className:"col-sm-12 col-md-4",style:{display:u(E.columnName)?"none":"block"},children:n(le,{index:(R=S.find(v=>v.columnName===E.columnName))==null?void 0:R.colorIndex,onHide:()=>b(E.columnName),plotType:y(E.columnName),onSetPlotType:v=>_(E.columnName,v),facetToPlot:E,applyChangesToFacetFilter:g,applyChangesToGraphSlice:(v,k,P)=>re(N,v,g,k==null?void 0:k.value,P),isModalView:!1})},E.columnName)})}),m!=="NONE"&&n("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:n(He,{variant:"secondary",className:"pill-xl FacetNav__showMore",onClick:()=>w(m==="MORE"),style:{zIndex:500},children:m==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Ae.displayName="FacetNav",Ae.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}}}catch{}export{j as E,Pe as F,_e as I,ee as N,Te as Q,ne as S,ve as T,xe as a,$ as b,Ut as c,ye as d,qe as e,Ie as f,Jn as g,jn as h,Se as i,re as j,ke as k,Qe as l,Ae as m,Re as n,de as o,sn as p,cn as q,be as r,ge as s,B as u};
//# sourceMappingURL=FacetNav-85bed557.js.map
