import{a as S,j as a,F as O}from"./jsx-runtime-9dc53467.js";import{r as s}from"./index-76fb7be0.js";import{S as Se}from"./StepperDialog-28862b4c.js";import{T as U}from"./TextField-1929bba2.js";import{B as g}from"./Box-737945d6.js";import{T as L}from"./Typography-62cfc992.js";import{r as be,i as ye,a as ve}from"./jsx-runtime_commonjs-proxy-dd7a2d35.js";import{f as Re}from"./DateFormatter-ef8a9538.js";import{d as Ie}from"./dayjs.min-f79c4412.js";import{a as Me}from"./RadioGroup-13ffdadd.js";import{d as Ne}from"./Search-9e962970.js";import{B as re}from"./Box-424979b7.js";import{b as xe}from"./InputLabel-060c2cf9.js";import"./SkeletonButton-96bd3884.js";import"./HelpPopover-4d3af69f.js";import{S as we}from"./SkeletonTable-04ae7db3.js";import{h as W,m as ie,n as oe,l as Ae,y as Oe,bq as Le,br as qe,bs as Ue,bt as Fe,bu as Je}from"./SynapseClient-3a93e5ef.js";import{g as Ge,B as He}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-c0eacdfc.js";import{L as ke}from"./react-router-dom-df65e258.js";import{D as je}from"./DataGrid-fc8ecaeb.js";import{c as Be}from"./Stack-eb200119.js";import{B as Ye}from"./Button-a2b8b546.js";import{M as Qe}from"./TextField-4b8d3337.js";import{A as Ve}from"./SynapseConstants-9eba3d2d.js";import{u as De}from"./useGetEntityChallenge-f690e213.js";import{u as Pe}from"./useGetUserTeams-43b5d659.js";import{a as $e}from"./useTeamMembers-b4168d3d.js";const We=Be(),ze=We,Y=({onChangeTeamInfo:t,onError:m})=>{const[d,c]=s.useState({name:"",description:"",message:"",invitees:""}),E=l=>{const i={...d,...l};c(i),t(i)},v=l=>{if(l.split(",").length>3&&m)return m("Please limit the initial number of invited members to three. You may add additional members after the team has been created.");E({invitees:l})};return S(g,{children:[a(L,{variant:"body1",sx:{lineHeight:"20px"},children:"Create a new team for this Challenge!"}),a(U,{id:"name",label:"Team Name",value:d.name,fullWidth:!0,autoFocus:!0,required:!0,onChange:l=>E({name:l.target.value})}),a(g,{display:"flex",children:a(U,{id:"description",label:a(g,{display:"flex",gap:2,children:a(g,{children:"Team Description"})}),value:d.description,fullWidth:!0,multiline:!0,rows:4,onChange:l=>E({description:l.target.value})})}),a(g,{display:"flex",children:a(U,{id:"message",label:a(g,{display:"flex",gap:2,children:a(g,{children:"Recruitment Message"})}),value:d.message,fullWidth:!0,multiline:!0,rows:4,onChange:l=>E({message:l.target.value})})}),a(U,{id:"invitees",label:"Emails of Additional Members to Invite (max 3)",placeholder:"Enter emails separated by comma",value:d.invitees,fullWidth:!0,onChange:l=>v(l.target.value)})]})};try{Y.displayName="CreateChallengeTeam",Y.__docgenInfo={description:"",displayName:"CreateChallengeTeam",props:{onChangeTeamInfo:{defaultValue:null,description:"",name:"onChangeTeamInfo",required:!0,type:{name:"(update: CreateTeamRequest) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"((msg: string) => void)"}}}}}catch{}var z={},Ke=ye;Object.defineProperty(z,"__esModule",{value:!0});var le=z.default=void 0,Xe=Ke(be()),Ze=ve,ea=(0,Xe.default)((0,Ze.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"ControlPoint");le=z.default=ea;const Q=({rowCount:t,onChange:m})=>{const d=t>5?"calc(100% - 8px)":"100%";return S(re,{component:"form",sx:{p:"4px 4px",display:"flex",flexGrow:1,width:d,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[a(re,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:a(Ne,{sx:{color:"#878E95"}})}),a(xe,{onChange:m,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})};try{Q.displayName="ChallengeTeamSearch",Q.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function aa(t,m){const{accessToken:d,keyFactory:c}=W();return ie(c.getTeamListQueryKey(t.sort().join()),()=>oe.getTeamList(t,d),m)}function ta(t,m){const{accessToken:d,keyFactory:c}=W();return ie(c.getChallengeTeamListQueryKey(t),()=>oe.getAllChallengeTeams(d,t),m)}function V({challengeId:t,onSelectTeam:m}){const[d,c]=s.useState([]),[E,v]=s.useState([]),[l,i]=s.useState({}),{data:f}=ta(t),[J,r]=s.useState(),{data:n,isLoading:I}=aa(E,{enabled:!!E.length}),G=o=>{r(o),m(l[o])},M=o=>({id:o.id,name:o.name,created:Re(Ie(o.createdOn),"MM/DD/YY"),description:o.description});s.useEffect(()=>{const o=(f==null?void 0:f.map(_=>_.teamId))??[];v(o)},[f]),s.useEffect(()=>{const o=(n==null?void 0:n.list.filter(p=>p.canRequestMembership!==!1))??[],_=[],R={};o.forEach(p=>{_.push(M(p)),R[p.id]=p}),c(_),i(R)},[n]);const H=o=>{const _=o.target.value.toLowerCase(),R=(n==null?void 0:n.list.filter(b=>b.canRequestMembership!==!1))??[];let p=R;_.length&&(p=R.filter(b=>{var x;return b.name.toLowerCase().includes(_)||((x=b.description)==null?void 0:x.toLowerCase().includes(_))})),c(p.map(b=>M(b)))},h=[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:o=>a(Me,{value:o.id,currentValue:J,onChange:G,label:"",style:{marginBottom:"16px"}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:o=>a(ke,{to:{pathname:`${Ge(He.PORTAL_ENDPOINT)}/#!Team:${o.row.id}`},target:"_blank",children:o.row.name})},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}];return S(g,{sx:{height:220},children:[!I&&S(O,{children:[a(Q,{onChange:H,rowCount:d.length}),a(je,{rows:d,columns:h,rowCount:5,hideFooter:!0,density:"compact",sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"}},getRowClassName:o=>o.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]}),I&&a(we,{numRows:10,numCols:1})]})}try{V.displayName="ChallengeTeamTable",V.__docgenInfo={description:"",displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const D=({challengeId:t,onCreateTeam:m,onSelectTeam:d})=>S(ze,{spacing:1,children:[a(L,{variant:"body1",sx:{lineHeight:"20px"},children:'To participate in a challenge, you need to create a new Team or join an existing one.     By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.     All team members will need a Synapse account so that they can login and accept the team invitation.'}),a(g,{sx:{height:270},children:a(V,{challengeId:t,onSelectTeam:d})}),a(g,{children:a(Ye,{color:"primary",variant:"contained",onClick:m,startIcon:a(le,{}),children:"Create New Team"})})]});try{D.displayName="SelectChallengeTeam",D.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const P=({createdNewTeam:t,teamName:m})=>m?S(O,{children:[S(L,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",t?"created":"joined"," team"," ",a("b",{children:m})," and have been added to this challenge."]}),t&&a(g,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null;try{P.displayName="RegistrationSuccessful",P.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamName:{defaultValue:null,description:"",name:"teamName",required:!0,type:{name:"string | undefined"}}}}}catch{}const $=({team:t,joinMessageChange:m})=>{const[d,c]=s.useState("");if(!t)return null;const E=v=>{const l=v.target.value;c(l),m(l)};return S(O,{children:[S(L,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",a("strong",{children:t.name})," team."]}),a(g,{children:a("strong",{children:"Your Message to Team Managers(s)"})}),a(g,{children:a(Qe,{id:"membershipRequestMessage",value:d,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:E})})]})};try{$.displayName="JoinRequestForm",$.__docgenInfo={description:"",displayName:"JoinRequestForm",props:{team:{defaultValue:null,description:"",name:"team",required:!0,type:{name:"Team | undefined"}},joinMessageChange:{defaultValue:null,description:"",name:"joinMessageChange",required:!0,type:{name:"(msg: string) => void"}}}}}catch{}const F={SELECT_YOUR_CHALLENGE_TEAM:{id:"SELECT_YOUR_CHALLENGE_TEAM",title:"Select Your Challenge Team",nextStep:"JOIN_REQUEST_FORM",nextEnabled:!1},JOIN_REQUEST_FORM:{id:"JOIN_REQUEST_FORM",title:"Request Team Membership",previousStep:"SELECT_YOUR_CHALLENGE_TEAM",confirmStep:"JOIN_REQUEST_SENT",confirmButtonText:"Send Request",confirmEnabled:!0},JOIN_REQUEST_SENT:{id:"JOIN_REQUEST_SENT",title:"Request Sent",confirmButtonText:"Close",confirmEnabled:!0},CREATE_NEW_TEAM:{id:"CREATE_NEW_TEAM",title:"Create Team",confirmStep:"REGISTRATION_SUCCESSFUL",confirmButtonText:"Finish Registration",confirmEnabled:!1,previousStep:"SELECT_YOUR_CHALLENGE_TEAM"},REGISTRATION_SUCCESSFUL:{id:"REGISTRATION_SUCCESSFUL",title:"Registration Successful!"}},B="",se=({projectId:t,isShowingModal:m=!1,onClose:d})=>{const{accessToken:c,keyFactory:E}=W(),[v,l]=s.useState(!0),[i,f]=s.useState(F.SELECT_YOUR_CHALLENGE_TEAM),[J,r]=s.useState(),[n,I]=s.useState(),[G,M]=s.useState(!1),[H,h]=s.useState(!1),[o,_]=s.useState(!1),R=Ae(),[p,b]=s.useState({}),[x,k]=s.useState(!1),[K,X]=s.useState(!1),[N,de]=s.useState({name:"",description:"",message:"",invitees:""}),[ce,ue]=s.useState(""),{data:C}=Oe(),{data:T}=De(t),{data:j,error:Z}=Pe((T==null?void 0:T.id)??B,1);s.useEffect(()=>{if(j){const e=j.results.length>0;e&&(r("Error: You are already a member of a registered submission team for this Challenge."),_(e)),l(!1)}Z&&(r("Error: Could not determine if you are already registered for this Challenge."),l(!1))},[j,Z]),$e((n==null?void 0:n.id)??B,(C==null?void 0:C.ownerId)??B,{enabled:!!n&&!!C,onSettled:(e,u)=>{e&&b({...p,[e.teamId]:e}),u&&r(u.reason)}});const ee=()=>{if(n&&n.id in p){const{canJoin:e,membershipApprovalRequired:u,isMember:y,hasOpenInvitation:w,hasOpenRequest:A}=p[n.id];if(y)return{canJoin:!1,errorMessage:"You are already a member of this team."};if(A)return{canJoin:!1,errorMessage:"Your previous request to join this team is pending review."};if(w||e||u)return{canJoin:!0,needsApproval:u,errorMessage:void 0}}return{canJoin:!1}};s.useEffect(()=>{!!C&&C.ownerId===Ve.toString()&&(l(!1),r("Please login to continue."))},[c,C,t,T]),s.useEffect(()=>{x&&K&&(h(!1),q(i.confirmStep))},[K,x,i]),s.useEffect(()=>{if(n&&n.id in p&&i.id==="SELECT_YOUR_CHALLENGE_TEAM"){const{canJoin:e,errorMessage:u}=ee();if(e){i.nextEnabled||f({...i,nextEnabled:!0});return}i.nextEnabled&&f({...i,nextEnabled:!1}),u&&r(u)}},[p,n,i]);const me=e=>{e&&(r(void 0),I(e))},fe=e=>{de(e);const u=e.name.length>1;f({...i,confirmEnabled:u})},pe=(e=n==null?void 0:n.id)=>{!e||!C||!c||(h(!0),r(void 0),Le(e,C.ownerId,c).then(()=>{T&&R.invalidateQueries(E.getSubmissionTeamsQueryKey(T==null?void 0:T.id)),q("REGISTRATION_SUCCESSFUL")}).catch(u=>{r(`Error joining team: ${u.reason}`)}).finally(()=>{h(!1)}))},he=async()=>{C&&n&&(h(!0),f({...i,nextEnabled:!1}),r(void 0),await qe({teamId:n.id,userId:C.ownerId,message:ce},c).then(()=>{f(F.JOIN_REQUEST_SENT)}).catch(e=>{console.error({err:e}),r(`Error requesting membership: ${e.reason}`)}).finally(()=>{h(!1)}))},ge=async e=>{const u="Error registering challenge team";e&&T?(r(void 0),X(!1),await Fe({challengeId:T.id,teamId:String(e)},c).then(()=>{X(!0)}).catch(y=>{r(`${u}: ${y.reason}`),h(!1)})):(r(`${u}: Invalid team.`),h(!1))},Te=async(e,u)=>{if(!u.length){k(!0);return}const y="Error inviting members";if(e){r(void 0),k(!1);const w=u.split(","),A=[];for(const ne of w)await Je({teamId:String(e),inviteeEmail:ne.trim()},c).catch(()=>{A.push(ne.trim())});A.length?(r(`${y}: ${A.join(", ")}`),h(!1)):k(!0)}else r(`${y}: Invalid team.`),h(!1)},Ee=async()=>{N&&N.name&&N.name.length>1&&(f({...i,confirmEnabled:!1}),h(!0),r(void 0),await Ue({name:N.name,description:N.description},c).then(e=>{M(!0),I(e),ge(e.id),Te(e.id,N.invitees)}).catch(e=>{h(!1),r(`Error creating team: ${e.reason}`),f({...i,confirmEnabled:!0})}))},ae=()=>{r(void 0),M(!1),I(void 0),f({...i,nextEnabled:!1}),d()},te={CREATE_NEW_TEAM:Ee,JOIN_REQUEST_FORM:he,JOIN_REQUEST_SENT:()=>{ae()}},Ce=()=>{switch(i.id){case"SELECT_YOUR_CHALLENGE_TEAM":return c&&T&&!o?a(D,{challengeId:T.id,onCreateTeam:()=>q("CREATE_NEW_TEAM"),onSelectTeam:me}):a(O,{});case"JOIN_REQUEST_FORM":return a($,{team:n,joinMessageChange:ue});case"JOIN_REQUEST_SENT":return a(L,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."});case"REGISTRATION_SUCCESSFUL":return a(P,{createdNewTeam:G,teamName:n==null?void 0:n.name});case"CREATE_NEW_TEAM":return a(Y,{onChangeTeamInfo:fe,onError:r});default:return a(O,{})}};function q(e){if(!e||!F[e])return;r(void 0);const{canJoin:u,errorMessage:y,needsApproval:w}=ee();switch(e){case"SELECT_YOUR_CHALLENGE_TEAM":M(!1);break;case"JOIN_REQUEST_FORM":if(u){if(!w)return pe()}else return r(y);break}f(F[e])}const _e=te[i.id]?te[i.id]:()=>{};return a(Se,{errorMessage:J,onCancel:ae,onStepChange:q,open:m,onConfirm:_e,confirming:H,step:i,content:Ce(),loading:v})};try{se.displayName="ChallengeTeamWizard",se.__docgenInfo={description:"",displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{se as C};
