var J=Object.defineProperty;var $=(o,c,t)=>c in o?J(o,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[c]=t;var h=(o,c,t)=>($(o,typeof c!="symbol"?c+"":c,t),t);import{j as e}from"./jsx-runtime-CKrituN3.js";import{r as S,R}from"./index-CBqU2yxZ.js";import{C as z}from"./ChallengeRegisterButton-DHiBdoem.js";import{C as W}from"./ChallengeTeamWizard-CmfYa4YJ.js";import"./OrientationBanner-_f-Wk-V6.js";import"./getEndpoint-CjoHA800.js";import{h as k,w as D,Q,be as Y,n as u,bf as N,bg as K,bh as X}from"./ApplicationSessionManager-NGEGnQRB.js";import{u as P}from"./useGetEntityChallenge-Q-jUnCW1.js";import{u as Z}from"./useGetUserTeams-qvtU-5GV.js";import{b as ee,c as te,d as re}from"./useTeamMembers-C5Xx0Ird.js";import{A as ne,C as ie,L as se,G as oe}from"./HelpPopover-Dz6k00f8.js";import{d as L}from"./ToastMessage-C2TziZIi.js";import"./AccessTokenPage-ErpW8ydG.js";import"./AccountLevelBadges-mOjnA613.js";import"./LastLoginInfo-DWt5dFHf.js";import"./StandaloneLoginForm-Dn2V84Cx.js";import"./TwoFactorAuthSettingsPanel-DnruZXPR.js";import"./TwoFactorEnrollmentForm-DybGwkgm.js";import"./TwoFactorBackupCodes-BWjrDvuD.js";import"./CertificationQuiz-HRqwcBdn.js";import"./index-Bxi3Yth6.js";import"./AvailableEvaluationQueueList-COOMW3b6.js";import"./ChallengeSubmission-fNaBEJRk.js";import"./FullWidthAlert-jMrvQqfp.js";import"./DownloadCartPage-DdPrmrgn.js";import"./ShowDownloadV2-D-tOhsAb.js";import"./useEntitySelection-d_Og_z47.js";import"./isPlainObject-CBKr2sJD.js";import"./mapValues-Cyn6MZIo.js";import"./index.modern-C_n2QZwm.js";import"./styled-CPWjInoX.js";import"./EvaluationCard-Dw3jzeyE.js";import"./EvaluationEditorPage-Be_T6Zzt.js";import"./ExperimentalMode-Ctd1nIoo.js";import{R as ae,F as le}from"./index-C-UbkUMQ.js";import{O as ce}from"./IconSvg-BuJ4Oh6J.js";import"./FileUpload-BefDDMTi.js";import"./FeaturedDataTabs-DdepxyAy.js";import"./FeaturedToolsList-vNxXiCEo.js";import"./DiscussionThread-Bv1iLfl4.js";import"./ForumPage-DbOpPPsv.js";import"./Goals-BGLZZYdO.js";import"./GoogleMap-C0NxTRVH.js";import"./Icon-DfFhogb1.js";import"./OAuthManagement-ClWncaAA.js";import"./ThemesPlot-D-B4REY_.js";import"./UpsetPlot-DS2dWbH6.js";import"./ProjectViewCarousel-Deb5S9UV.js";import"./Programs-BJq67lDS.js";import"./QueryCount-D2gzI-Ku.js";import"./RenderIfInView-BfyCV26N.js";import"./Resources-uaBAMMx-.js";import"./RssFeedCards-Dk4AhEZT.js";import"./ShowMore-DAczrOMQ.js";import"./SkeletonButton-DtQWvNtv.js";import"./SkeletonTable-ClAWDQLk.js";import"./LeftRightPanel-CHH-CaMP.js";import"./LightTooltip-B6BY62J5.js";import"./StyledFormControl-CkGaCXh8.js";import"./WideButton-o8rbOLAq.js";import"./InputSizedButton-D5ZXHQxU.js";import"./SubscriptionItem-2a5qGhUP.js";import"./DropdownSelect-BNkvE_dG.js";import"./SubsectionRowRenderer-BiefZogX.js";import"./SynapseFormWrapper-BfIUBi4u.js";import"./SynapseFormSubmissionsGrid-DA5qt8Jg.js";import"./SystemUseNotification-BsgE3ldi.js";import"./TableFeedCards-C_RYY40M.js";import"./TermsAndConditions-CXGWjFfe.js";import"./TextField-Bf_k_3vK.js";import"./TimelinePlot-BQ9GTMjA.js";import"./UserBadge-CyVDZd8J.js";import"./UserCardList-DVW472lY.js";import"./UserCardListRotate-Dp9oQQIs.js";import"./UserCardListGroups-BcjDGHfQ.js";import"./UserOrTeamBadge-Cf3e2c7d.js";import"./UserProfileLinks-D-_SQZzN.js";import"./EntityHeaderTable-DQ19R3f_.js";import"./AccessRequirementRelatedProjectsList-C8xvZn9n.js";import{e as me,f as de}from"./useAccessRequirements-CfdMF1IZ.js";import{u as pe}from"./useEntity-om9ll4XG.js";import{S as ue}from"./LoadingScreen-c9I5269y.js";import{M as he}from"./Alert-jLvJNeQC.js";import{T as fe}from"./Typography-BhttL55U.js";import{B as v}from"./Button-BOCcoe4v.js";function _(o){const{open:c,projectId:t,onRegisterComplete:i,onCancel:n}=o,{data:s,error:l}=pe(t),{accessToken:a}=k(),{data:r,error:m}=P(t),g=!!a,{data:y,error:d}=D({enabled:g}),p=r==null?void 0:r.participantTeamId,x=y==null?void 0:y.ownerId,{data:f,error:b}=ee(p,x,{enabled:!!(p&&x)}),{mutateAsync:T,isPending:F,error:j}=te(),{data:C,isSuccess:A,error:M}=me(r==null?void 0:r.participantTeamId,{enabled:!!(r!=null&&r.participantTeamId)}),V=de((C==null?void 0:C.map(E=>String(E.id)))??[]),O=A&&V.every(E=>E.status==="success"&&E.data.isApproved),B=S.useCallback(async()=>{p&&x&&!(f!=null&&f.isMember)&&await T({teamId:p,userId:x}),i()},[T,i,p,f==null?void 0:f.isMember,x]),w=[l,m,d,b,M,j].filter(E=>!!E);let q=f!=null&&f.isMember?"Continue":"Register";return F&&(q="Registering..."),Q(w)?!p||!c?e.jsx(e.Fragment,{}):e.jsx(ne,{dialogTitle:"Challenge Terms and Conditions",subjectId:p,subjectType:ae.TEAM,teamId:r==null?void 0:r.participantTeamId,renderAsModal:!0,requestObjectName:s==null?void 0:s.name,onHide:()=>{n()},customDialogActions:e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outlined",onClick:n,children:"Cancel"}),e.jsx(v,{variant:"contained",onClick:()=>{B()},startIcon:F?e.jsx(ue,{}):void 0,disabled:!O||F,children:q})]})}):e.jsx(he,{severity:"error",children:w.map((E,G)=>e.jsx(fe,{variant:"body1",children:E.reason},G))})}try{_.displayName="ChallengeRequirementsModal",_.__docgenInfo={description:`The challenge requirements modal will
 1. Display the access requirements that must be accepted to join a participant team. The component will guide the user through meeting the requirements.
 2. If the user has accepted the requirements, the user can click 'Register' to join the team
    If the user has not accepted the requirements, the user cannot register for the challenge.`,displayName:"ChallengeRequirementsModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}},onRegisterComplete:{defaultValue:null,description:"",name:"onRegisterComplete",required:!0,type:{name:"() => void"}}}}}catch{}function U({projectId:o}){const{accessToken:c}=k(),t=!!c,[i,n]=S.useState(!1),[s,l]=S.useState(!1),[a,r]=S.useState(!1),{data:m}=D(),g=C=>{n(C)},y=()=>{l(!0)},d=()=>{r(!0)},{data:p}=P(o),{data:x}=Z(p==null?void 0:p.id,1,0,{enabled:!!(t&&p)}),f=x&&x.results.length>0,{mutate:b}=re({onSuccess:()=>{L("You are no longer registered for this challenge","info")},onError:C=>{L(C.reason,"danger")}}),T=()=>{t&&p&&m&&b({teamId:p.participantTeamId,userId:m.ownerId})},F=()=>{l(!1)},j=()=>{l(!1),n(!f)};return e.jsxs(e.Fragment,{children:[e.jsx(z,{projectId:o,onJoinClick:y,onLeaveClick:d}),e.jsx(_,{open:s,projectId:o,onRegisterComplete:j,onCancel:F}),e.jsx(W,{projectId:o,onClose:()=>{g(!1)},isShowingModal:i}),e.jsx(ie,{open:a,title:"Leave this Challenge?",content:"Are you sure you want to leave this Challenge?",onCancel:()=>r(!1),onConfirm:()=>{T(),r(!1)}})]})}try{U.displayName="ChallengeDetailPage",U.__docgenInfo={description:"",displayName:"ChallengeDetailPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}class I extends R.Component{constructor(t){super(t);h(this,"formRef");h(this,"submitForm",()=>{this.formRef.current.submit()});h(this,"refresh",()=>{if(this.context.accessToken){const t=[u.getUserProfile(this.context.accessToken),u.getEntity(this.context.accessToken,this.props.formSchemaEntityId),u.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(t).then(i=>{const n=i[0];this.getTargetContainer(n,this.context.accessToken).then(s=>{const l=i[1],a=i[2];this.getSchemaFileContent(s,l,a)})}).catch(i=>{this.onError(i)})}});h(this,"getSchemaFileContent",(t,i,n)=>{const s=[u.getFileResult(i,this.context.accessToken,!0,!0),u.getFileResult(n,this.context.accessToken,!0,!0)];Promise.all(s).then(l=>{try{const a=l.map(r=>N(r.fileHandle,r.preSignedURL));Promise.all(a).then(r=>{const m=JSON.parse(r[0]),g=JSON.parse(r[1]);this.getExistingFileData(t,m,g)}).catch(r=>{console.log("getSchemaFileContent: Error getting form content",r)})}catch(a){console.log("getSchemaFileContent: Error getting schema content",a)}}).catch(l=>{this.onError(l)})});h(this,"getExistingFileData",(t,i,n)=>{const l={entityName:`${i.title}.json`,parentId:t};let a,r;u.lookupChildEntity(l,this.context.accessToken).then(m=>u.getEntity(this.context.accessToken,m.id).then(g=>(r=g,this.props.initFormData?u.getFileResult(r,this.context.accessToken,!0,!0).then(async y=>{try{const d=await N(y.fileHandle,y.preSignedURL);a=JSON.parse(d)}catch(d){console.log("getExistingFileData: Error setting form data",d)}}):Promise.resolve()))).finally(()=>{this.setState({formData:a,currentFileEntity:r,formSchema:i,formUiSchema:n})})});h(this,"getTargetContainer",async(t,i)=>{const n={entityName:t.ownerId,parentId:this.props.parentContainerId};try{const s=await u.lookupChildEntity(n,i);return console.log(`EntityForm uploading to https://www.synapse.org/#!Synapse:${s.id}`),this.setState({userprofile:t,containerId:s.id,isLoading:!1}),s.id}catch(s){return s.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(s)}});h(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});h(this,"onError",t=>{this.setState({error:t,isLoading:!1,successfullyUploaded:!1})});h(this,"onSubmit",({formData:t})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const i=new Blob([JSON.stringify(t)],{type:"text/json"});this.createEntityFile(i)});h(this,"createEntityFile",t=>{const i=`${this.state.formSchema.title}.json`;u.uploadFile(this.context.accessToken,i,t).then(n=>{const s=n.fileHandleId;if(this.state.currentFileEntity){const a={...this.state.currentFileEntity,dataFileHandleId:s};return this.setState({currentFileEntity:a}),u.updateEntity(a,this.context.accessToken)}const l={parentId:this.state.containerId,name:i,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:s};return u.createEntity(l,this.context.accessToken)}).then(n=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(n.id)}).catch(n=>{this.onError(n)})});this.formRef=R.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return e.jsxs("div",{children:[this.state.error&&e.jsxs("div",{className:"panel panel-danger errors",children:[e.jsx("div",{className:"panel-heading",children:e.jsx("h3",{className:"panel-title",children:"Error"})}),e.jsx("ul",{className:"list-group",children:e.jsxs("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&e.jsx(se,{validator:oe,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:e.jsx("div",{style:{display:"none"},children:e.jsx("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&e.jsxs(R.Fragment,{children:[e.jsx("span",{children:"Saving…"}),e.jsx("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}h(I,"contextType",Y);try{I.displayName="EntityForm",I.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}try{I.contextType.displayName="EntityForm.contextType",I.contextType.__docgenInfo={description:`Context lets components pass information deep down without explicitly
passing props.

Created from {@link createContext}`,displayName:"EntityForm.contextType",props:{}}}catch{}const H=o=>{const{accessToken:c}=k(),{synId:t,className:i}=o,[n,s]=S.useState(void 0);S.useEffect(()=>{(async()=>{try{const m=await u.getEntity(c,t);if(!K(m))throw new Error(`File Entity expected but found ${m}`);const g={requestedFiles:[{associateObjectId:t,associateObjectType:le.FileEntity,fileHandleId:m.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},d=(await u.getFiles(g,c)).requestedFiles[0].fileHandle;if(d&&X(d))s({externalFileHandle:d,fileEntity:m});else throw new Error(`Not an external file handle: ${d==null?void 0:d.id}`)}catch(m){console.error("Error on getting external file handle = ",m)}})()},[t,c]);const l=n==null?void 0:n.externalFileHandle,a=n==null?void 0:n.fileEntity;return l?e.jsx("a",{href:l.externalURL,className:i,target:"_blank",rel:"noopener noreferrer",children:e.jsxs("span",{children:[a==null?void 0:a.name,e.jsx(ce,{style:{marginLeft:5}})]})}):e.jsx(e.Fragment,{})};try{H.displayName="ExternalFileHandleLink",H.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}export{U as C};
