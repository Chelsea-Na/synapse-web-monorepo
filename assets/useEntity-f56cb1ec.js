import{r as T}from"./index-76fb7be0.js";import{aZ as K,h as u,m,n as i,l as f,a_ as h}from"./SynapseClient-5617d165.js";import{u as g}from"./useMutation-0086f62e.js";import{u as P}from"./useQueries-fa0e18e3.js";import{u as I}from"./useInfiniteQuery-7807cef7.js";import"./getEndpoint-ac94413e.js";import"./OrientationBanner-a1ca5cdb.js";import"./jsx-runtime-9dc53467.js";import{i as F}from"./isEqualWith-86a8a0b7.js";import{a as C}from"./isArray-5e3f9107.js";import{i as S}from"./_Map-02912bad.js";import{i as w,o as Q,p as v,a as q}from"./pick-e2ff1673.js";import{g as G}from"./InfiniteQueryUtils-54ae7e6b.js";const M=(e,t)=>{if(!(C(e)||C(t))&&!(!S(e)||!S(t))&&!(!w(e,void 0)&&!w(t,void 0)))return F(Q(e,a=>a===void 0),Q(t,a=>a===void 0),M)};function A(e,t){return F(e,t,M)}function J(e,t){const a=new Set;for(const s of e)a.add(s.id);for(const s of t)if(s.id!=null&&!a.has(s.id))throw new Error(`Proposed schema contains a new column model with ID ${s.id} that is not in the old schema.`)}async function U(e,t,a,s){J(a,s);const n=new Map;for(const y of a)n.set(y.id,y);let c=[];for(const y of s){const r={...y};if(r.id!=null){const d=n.get(r.id);d!=null&&!A(d,r)&&delete r.id}c.push(r)}const o=(await K(e,c)).list,l=[],k=new Set;for(let y=0;y<s.length;y++){const r=s[y].id??null,d=o[y].id;r!=null&&k.add(r),k.add(d),r!=null&&r!==d?l.push({oldColumnId:r,newColumnId:d}):r==null&&l.push({oldColumnId:null,newColumnId:d})}for(const y of a){const r=y.id;k.has(r)||l.push({oldColumnId:r,newColumnId:null})}return{concreteType:"org.sagebionetworks.repo.model.table.TableUpdateTransactionRequest",entityId:t,changes:[{concreteType:"org.sagebionetworks.repo.model.table.TableSchemaChangeRequest",entityId:t,changes:l,orderedColumnIds:o.map(y=>y.id)}]}}function E(e,t,a){return e.invalidateQueries(t.getEntityQueryKey(a))}function X(e,t,a){const{accessToken:s,keyFactory:n}=u();return m(n.getEntityVersionQueryKey(e,t),()=>i.getEntity(s,e,t==null?void 0:t.toString()),a)}function Y(e,t){const{accessToken:a,keyFactory:s}=u(),n=T.useMemo(()=>e.map(c=>({queryKey:s.getEntityVersionQueryKey(c.id,c.versionNumber),queryFn:()=>i.getEntity(a,c.id,c.versionNumber),options:t})),[a,e,s,t]);return P(n)}function j(e){const t=f(),{accessToken:a,keyFactory:s}=u();return g(n=>i.createEntity(n,a),{onSuccess:async(n,c,o)=>{await E(t,s,n.id),t.setQueryData(s.getEntityQueryKey(n.id),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,o)}})}function H(e){const t=f(),{accessToken:a,keyFactory:s}=u();return g(n=>i.updateEntity(n,a),{...e,onSuccess:async(n,c,o)=>{await E(t,s,n.id),t.setQueryData(s.getEntityQueryKey(n.id),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,o)}})}function ee(e){const t=f(),{accessToken:a,keyFactory:s}=u();return g(n=>i.deleteEntity(a,n),{...e,onSuccess:async(n,c,o)=>{await E(t,s,c),e!=null&&e.onSuccess&&await e.onSuccess(n,c,o)}})}function te(e,t){const{accessToken:s,keyFactory:n}=u();return I(n.getEntityVersionsQueryKey(e),async c=>await i.getEntityVersions(e,s,c.pageParam,200),{...t,getNextPageParam:G})}function R(e){return v(e,h[e.concreteType])}function V(e){return q(e,h[e.concreteType])}function ne(e,t,a){const{accessToken:s,keyFactory:n}=u(),c=m(n.getEntityJsonQueryKey(e,t),()=>i.getEntityJson(e,t,s),a),o=T.useMemo(()=>(c==null?void 0:c.data)==null?void 0:R(c.data),[c.data]),l=T.useMemo(()=>(c==null?void 0:c.data)==null?void 0:V(c.data),[c.data]);return{...c,entityMetadata:o,annotations:l}}function se(e){const t=f(),{accessToken:a,keyFactory:s}=u();return g(n=>{const c=n.id;return i.updateEntityJson(c,n,a)},{...e,onSuccess:async(n,c,o)=>{const l=n.id;await E(t,s,l),t.setQueryData(s.getEntityJsonQueryKey(l,!1),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,o)}})}function ae(e,t){const{accessToken:a,keyFactory:s}=u();return m(s.getEntityPathQueryKey(e),()=>i.getEntityPath(e,a),t)}function ce(e,t){const{accessToken:a,keyFactory:s}=u();return m(s.getEntityPathQueryKey(e),()=>i.getEntityACL(e,a),t)}function oe(e,t){const{accessToken:a,keyFactory:s}=u();return m(s.getEntityAliasQueryKey(e),()=>i.getEntityAlias(e,a),t)}function re(e,t,a){const{accessToken:s,keyFactory:n}=u();return m(n.getEntityEvaluationsQueryKey(e),()=>i.getAllEntityEvaluations(e,t,s),a)}function ue(e,t){const{accessToken:a,keyFactory:s}=u();return m(s.getEntityPermissionsQueryKey(e),()=>i.getEntityPermissions(e,a),t)}function ie(e){const t=f(),{accessToken:a,keyFactory:s}=u();return g(n=>i.updateEntityACL(n,a),{...e,onSuccess:async(n,c,o)=>{await E(t,s,n.id),t.setQueryData(s.getEntityACLQueryKey(n.id),n),e!=null&&e.onSuccess&&await e.onSuccess(n,c,o)}})}function ye(e){const t=f(),{accessToken:a,keyFactory:s}=u();return g(async n=>{const c=await U(a,n.entityId,n.originalColumnModels,n.newColumnModels);return i.updateTable(c,a)},{...e,onSuccess:async(n,c,o)=>{await E(t,s,c.entityId),e!=null&&e.onSuccess&&await e.onSuccess(n,c,o)}})}export{ye as a,ae as b,H as c,ne as d,j as e,Y as f,re as g,ie as h,E as i,oe as j,ce as k,ue as l,se as m,ee as n,te as o,X as u};
