import{j as t,a as d,F as Q}from"./jsx-runtime-095bf462.js";import{r as a,R as oe}from"./index-8db94870.js";import{T as ue,V as me,W as ee,X as ye,Y as ge,Z as fe,_ as he,$ as Ce,a0 as _e}from"./SynapseTableCell-92d32807.js";import{a0 as Ie,J as Se}from"./SynapseClient-191a5ad3.js";import{P as we}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-caa14b37.js";import{S as te}from"./RegularExpressions-bc0adf55.js";import{a as xe}from"./useGetEntityHeaders-f40d0574.js";import{I as be,A as Ee}from"./IconSvg-3ab5d71e.js";import"./SkeletonButton-0864bc76.js";import{S as Re}from"./SkeletonTable-c29b0ab8.js";import{p as Fe}from"./papaparse.min-84949987.js";import{u as Ve}from"./UserSearchBoxV2-09041b9e.js";import{T as ae}from"./TextField-725b9717.js";import{E as Te}from"./EntityLink-021955d5.js";import{L as De}from"./Link-342b97d1.js";import{T as v}from"./Typography-214fd772.js";import{M as ie}from"./FormControlLabel-f9f0f4b1.js";import{E as ke}from"./EntityFinderModal-16ab13c4.js";import{V as He,F as Ne}from"./useEntitySelection-35966d81.js";import{c as ve}from"./cloneDeep-105239c7.js";import{p as Ae}from"./pluralize-9608a438.js";import{u as Me}from"./ThemesPlot-f073ff41.js";import{B as f}from"./Box-f664662a.js";import{B as U}from"./Button-f56bbd3a.js";import{I as ne}from"./IconButton-2a435ef1.js";import{I as Pe}from"./InputLabel-f64f330c.js";import{T as Be}from"./Tooltip-f72372f7.js";import{A as qe,a as Ue}from"./AlertTitle-ce329963.js";import{n as Le}from"./uniq-bf9c0936.js";function L({initialValue:r,onChange:o,options:l,delay:p=250,...u}){const[s,h]=a.useState(r);return Ve(()=>{o(s)},[o,s],p),t(ue,{freeSolo:!0,disablePortal:!0,isOptionEqualToValue:(m,y)=>y.length==0||m===y,options:l,value:s,onChange:(m,y)=>{h(y??"")},sx:{marginRight:"10px"},renderInput:m=>t(ae,{...m,...u,value:s,onChange:y=>h(y.target.value)})})}try{L.displayName="DebouncedInput",L.__docgenInfo={description:"",displayName:"DebouncedInput",props:{initialValue:{defaultValue:null,description:"",name:"initialValue",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},delay:{defaultValue:{value:"250"},description:"",name:"delay",required:!1,type:{name:"number"}}}}}catch{}function O({column:r,table:o}){var s;const l=(s=o.getPreFilteredRowModel().flatRows[0])==null?void 0:s.getValue(r.id),p=r.getFilterValue()??"",u=oe.useMemo(()=>typeof l=="number"?[]:Array.from(r.getFacetedUniqueValues().keys()).sort(),[r.getFacetedUniqueValues()]);return t(L,{type:"text",options:u,initialValue:p,onChange:h=>r.setFilterValue(h),label:`Filter by ${r.columnDef.header} (${r.getFacetedUniqueValues().size})`})}try{O.displayName="Filter",O.__docgenInfo={description:"",displayName:"Filter",props:{column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"Column<any, unknown>"}},table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table<any>"}}}}}catch{}function z(r){const{cell:o}=r,{row:l}=o,{original:p}=l,{id:u,isDummy:s}=p;return s?t(De,{href:`${we.PORTAL}#!Synapse:${u}`,children:u}):t(Te,{entity:p})}function j(r){const{cell:o}=r;return t(v,{variant:"body1",children:o.getContext().getValue()})}function $(r){const{cell:o}=r;return t(v,{variant:"body1",sx:{textTransform:"capitalize"},children:o.getContext().getValue()})}function G(r){const{table:o}=r;return t(ie,{checked:o.getIsAllRowsSelected(),indeterminate:o.getIsSomeRowsSelected(),onClick:o.getToggleAllRowsSelectedHandler()})}function W(r){const{row:o}=r;return t(ie,{checked:o.getIsSelected(),disabled:!o.getCanSelect(),indeterminate:o.getIsSomeSelected(),onClick:o.getToggleSelectedHandler()})}try{z.displayName="EntityHeaderNameCell",z.__docgenInfo={description:"",displayName:"EntityHeaderNameCell",props:{}}}catch{}try{j.displayName="EntityHeaderIDCell",j.__docgenInfo={description:"",displayName:"EntityHeaderIDCell",props:{}}}catch{}try{$.displayName="EntityHeaderTypeCell",$.__docgenInfo={description:"",displayName:"EntityHeaderTypeCell",props:{}}}catch{}try{G.displayName="CheckBoxHeader",G.__docgenInfo={description:"",displayName:"CheckBoxHeader",props:{}}}catch{}try{W.displayName="CheckBoxCell",W.__docgenInfo={description:"",displayName:"CheckBoxCell",props:{}}}catch{}const A=r=>d("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t("mask",{id:"mask0_6722_37828",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:t("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),t("g",{mask:"url(#mask0_6722_37828)",children:t("path",{d:"M18 20V17H15V15H18V12H20V15H23V17H20V20H18ZM3 21C2.45 21 1.97917 20.8042 1.5875 20.4125C1.19583 20.0208 1 19.55 1 19V5C1 4.45 1.19583 3.97917 1.5875 3.5875C1.97917 3.19583 2.45 3 3 3H17C17.55 3 18.0208 3.19583 18.4125 3.5875C18.8042 3.97917 19 4.45 19 5V10H17V8H3V19H16V21H3ZM3 6H17V5H3V6Z",fill:"#395979"})})]});try{A.displayName="AddAd",A.__docgenInfo={description:"",displayName:"AddAd",props:{}}}catch{}function Oe(r,o,l){const[p,u]=a.useState({}),[s,h]=a.useState(ve(r)),[m,y]=a.useState(""),[M,V]=a.useState([]),b=a.useCallback(g=>{y(g),o&&o(g)},[o]),S=a.useCallback(g=>{u({}),h(g),l&&l(g),V([]),b("")},[l,b]);return{rowSelection:p,setRowSelection:u,refsInState:s,setRefsInState:S,newEntityIDs:m,setNewEntityIDs:b,parseErrors:M,setParseErrors:V}}const ze={selectMultiple:!0,versionSelection:He.DISALLOWED,initialScope:Ne.ALL_PROJECTS,initialContainer:"root"},je=10,re=r=>{const{references:o,isEditable:l,onUpdate:p=Le,removeSelectedRowsButtonText:u="Remove Selected Rows",onUpdateEntityIDsTextbox:s,objectNameCopy:h="entity",hideTextFieldToPasteValue:m=!1,entityFinderConfiguration:y=ze}=r,[M,V]=a.useState([]),[b,S]=a.useState(!1),{rowSelection:g,setRowSelection:le,refsInState:_,setRefsInState:E,newEntityIDs:c,setNewEntityIDs:T,parseErrors:D,setParseErrors:R}=Oe(o,s,p),P=a.useCallback(n=>{R([`Invalid Synapse ID(s): ${n.join(",")}`])},[R]),B=a.useCallback(n=>{const e=n.map(i=>({targetId:i.trim()}));E([..._,...e])},[_,E]),se=a.useCallback(()=>{c?c.includes(",")?Fe.parse(c,{complete:n=>{if(n.errors.length>0){const e=n.errors.map(i=>i.message);R(e)}else{const e=n.data[0],i=e.filter(I=>!I.trim().match(te));i.length>0?P(i):B(e)}}}):c.trim().match(te)?B([c]):P([c]):(R([]),T(""))},[B,c,P,T,R]),w=Me(Ae(h)),Z=a.useMemo(()=>[{id:"select",header:G,cell:W}],[]),q=a.useMemo(()=>[{accessorFn:n=>n.name,id:"name",cell:z,header:"Name"},{accessorFn:n=>n.id,id:"id",cell:j,header:"SynID"},{accessorFn:n=>n.isDummy?"-":Ie(Se(n)),id:"type",header:"Type",cell:$,filterFn:"includesString"}],[]),de=a.useMemo(()=>l?Z.concat(q):q,[q,l,Z]),J=Object.keys(g).length,{data:F,isSuccess:ce,isLoading:Y}=xe(_,{useErrorBoundary:!0}),k=a.useMemo(()=>{const n=F?F==null?void 0:F.results:[],e=new Set;n.map(C=>e.add(C.id));const I=_.filter(C=>!e.has(C.targetId)).map(C=>({id:C.targetId,name:C.targetId,benefactorId:-1,type:"org.sagebionetworks.repo.model.Project",createdOn:"",modifiedOn:"",createdBy:"",modifiedBy:"",isLatestVersion:!0,isDummy:!0}));return n.concat(I)},[_,F]),x=me({data:k,columns:de,state:{rowSelection:g,columnFilters:M},enableRowSelection:l,onRowSelectionChange:le,onColumnFiltersChange:V,getCoreRowModel:ye(),getFilteredRowModel:ge(),getSortedRowModel:fe(),getFacetedRowModel:he(),getFacetedUniqueValues:Ce(),getFacetedMinMaxValues:_e(),columnResizeMode:"onChange"}),pe=a.useCallback(()=>{const e=k.filter((i,I)=>g[I]!==!0).map(i=>({targetId:i.id}));E(e)},[k,g,E]),X=J>0,H=k.length,K=x.getPrePaginationRowModel().rows.length,N=H>je;return a.useEffect(function(){N||x.setColumnFilters([])},[N]),Y?t(Re,{numCols:3,numRows:10}):ce?d("div",{children:[d(f,{display:"flex",justifyContent:"space-between",p:"12px 10px 10px 5px",children:[N&&d(v,{variant:"body1",sx:{marginBottom:"10px"},children:[H," ",w," ",K<H?`(${K} visible)`:"",X&&t("span",{children:` (${J} selected)`})]}),l&&_.length>0&&t(U,{variant:"contained",disabled:!X,onClick:pe,children:u})]}),t(f,{display:"flex",pb:2,children:x.getHeaderGroups().map(n=>n.headers.map(e=>e.isPlaceholder?null:t(oe.Fragment,{children:e.column.getCanFilter()&&N?t(f,{sx:{flexGrow:1},children:t(O,{column:e.column,table:x})}):null},e.column.id)))}),H>0&&t(f,{sx:n=>({overflow:"auto",maxHeight:"250px",paddingLeft:"2px",th:{height:"38px",backgroundColor:n.palette.grey[200],zIndex:100},"tr:nth-of-type(2n)":{backgroundColor:n.palette.grey[100]}}),children:d("table",{style:{borderCollapse:"collapse",width:"100%"},children:[t("thead",{children:x.getHeaderGroups().map(n=>t("tr",{children:n.headers.map(e=>{let i="5%";switch(e.id){case"name":i="50%";break;case"id":i="22%";break;case"type":i="22%";break}return d("th",{colSpan:e.colSpan,style:{width:i,position:"sticky",top:"0px"},children:[e.isPlaceholder?null:d(f,{display:"flex",alignItems:"center",children:[ee(e.column.columnDef.header,e.getContext()),t(f,{mx:"auto"}),e.column.getCanSort()&&t(ne,{onClick:e.column.getToggleSortingHandler(),size:"small",sx:{marginLeft:"auto",marginRight:"16px"},children:t(be,{icon:e.column.getIsSorted()==="asc"?"sortUp":"sortDown",wrap:!1,fontSize:"inherit",sx:{color:e.column.getIsSorted()?"primary.main":"grey.700",backgroundColor:"none"}})})]}),e.column.getCanResize()&&t("div",{className:`resizer ${e.column.getIsResizing()?"isResizing":""}`,onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler()})]},e.id)})},n.id))}),t("tbody",{children:x.getRowModel().rows.map(n=>t("tr",{style:{height:"30px"},children:n.getVisibleCells().map(e=>t("td",{style:{width:e.column.getSize()},children:ee(e.column.columnDef.cell,e.getContext())},e.id))},n.id))})]})}),t(ke,{configuration:y,promptCopy:`Select ${w} to add to the Synapse ID list`,show:b,title:`Select ${w}`,confirmButtonCopy:`Add ${w}`,onConfirm:n=>{if(m){const e=[..._,...n];E(e),p(e)}else{const e=n.map(C=>C.targetId),I=(c.trim().length>0?c.concat(","):c).concat(e.join(","));T(I)}S(!1)},onCancel:()=>S(!1)}),l&&d(f,{sx:{marginTop:"10px"},children:[m&&d(U,{variant:"outlined",onClick:()=>{S(!0)},startIcon:t(A,{}),children:["Add ",w]}),!m&&d(Q,{children:[t(Pe,{htmlFor:"synIDs",children:"Add Synapse IDs"}),d(f,{sx:{display:"grid",gridTemplateColumns:"auto 50px 150px"},children:[t(ae,{id:"synIDs",name:"synIDs",fullWidth:!0,onChange:n=>{T(n.target.value)},value:c,placeholder:"Enter a list of Synapse IDs (i.e. 'syn123, syn456')"}),t(f,{sx:{padding:"5px 0px 0px 5px"},children:t(Be,{title:"Add a Synapse ID to the list via the Entity Finder",children:t(ne,{onClick:()=>{S(!0)},children:t(A,{})})})}),d(U,{variant:"outlined",onClick:se,disabled:Y||c.trim().length==0,startIcon:t(Ee,{}),children:["Add ",w]})]})]}),D&&D.length>0&&d(qe,{severity:"error",sx:{my:2},children:[t(Ue,{children:"Parsing errors encountered:"}),t("ul",{children:D.map((n,e)=>t(v,{component:D.length>1?"li":"span",lineHeight:1.5,variant:"smallText1",children:n},e))})]})]})]}):t(Q,{})};try{re.displayName="EntityHeaderTable",re.__docgenInfo={description:`Renders a sortable/filterable table for a set of entity references.  If editable, onUpdate will be called back
on any entity added/removed.`,displayName:"EntityHeaderTable",props:{references:{defaultValue:null,description:"",name:"references",required:!0,type:{name:"ReferenceList"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"((updatedRefs: ReferenceList) => void)"}},removeSelectedRowsButtonText:{defaultValue:null,description:"",name:"removeSelectedRowsButtonText",required:!1,type:{name:"string"}},onUpdateEntityIDsTextbox:{defaultValue:null,description:"",name:"onUpdateEntityIDsTextbox",required:!1,type:{name:"((value: string) => void)"}},objectNameCopy:{defaultValue:null,description:"",name:"objectNameCopy",required:!1,type:{name:"string"}},hideTextFieldToPasteValue:{defaultValue:null,description:"",name:"hideTextFieldToPasteValue",required:!1,type:{name:"boolean"}},entityFinderConfiguration:{defaultValue:null,description:"",name:"entityFinderConfiguration",required:!1,type:{name:'Omit<EntityFinderProps, "onSelectedChange">'}}}}}catch{}export{re as E};
//# sourceMappingURL=EntityHeaderTable-8af5fc78.js.map
