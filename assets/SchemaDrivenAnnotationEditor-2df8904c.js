import{j as a,F as j,a as p}from"./jsx-runtime-095bf462.js";import{d as we,H as Ce,L as Ne,M as Ee,A as Ie,a as je,b as xe,c as De,B as Pe}from"./ArrayFieldDescriptionTemplate-f90782b6.js";import"./isPlainObject-1dec192d.js";import"./mapValues-dee13770.js";import{a9 as be,aa as J,ab as le,ac as Oe,ad as pe,ae as Be,af as ke,ag as Re,ah as Le,ai as me,aj as We,ak as $e,al as He,z as Je,am as Ge,t as Me,C as Ke}from"./SynapseTableCell-90ed2cf5.js";import"./uniq-fe955338.js";import{r as F,R as I}from"./index-8db94870.js";import"./index-953d39fd.js";import{u as de,L as ce,t as ue,bv as Se,b3 as Te}from"./SynapseClient-263d1708.js";import{S as Ue}from"./createSvgIcon-c69fbb93.js";import{g as Xe,B as Ye}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-6f1c542d.js";import{a as Ze,l as ze}from"./useEntity-cce959a4.js";import{S as Qe}from"./LoadingScreen-a6a4aa4a.js";import{F as et}from"./FullWidthAlert-e628333c.js";import{g as tt,f as rt}from"./ThemesPlot-223656f8.js";import{G as x}from"./Grid-e97e58b0.js";import{I as _e}from"./InputLabel-f385112e.js";import{i as at}from"./isEqual-ac67b0a5.js";import{d as nt}from"./dayjs.min-59ef0ea6.js";import{C as it}from"./CalendarWithIconFormGroup-f19f913d.js";import{u as ot}from"./use-deep-compare-effect.esm-7a830988.js";import{d as st}from"./ToastMessage-75cae4d1.js";import{T as ve}from"./Tooltip-9098414d.js";import{B as lt}from"./Button-24da439b.js";import{T as Ve,F as dt}from"./TextField-8144cd52.js";import{I as ct}from"./IconButton-5cd80e83.js";import{C as Fe}from"./_getTag-40b07ccb.js";import{T as G}from"./Typography-d5f8f357.js";import{a as ut}from"./MenuList-b8c6d487.js";import{A as O}from"./AlertTitle-aed9db43.js";import{L as pt}from"./Link-a60839ec.js";import{B as fe}from"./Box-fd1c0045.js";import{D as mt}from"./Divider-e92f465f.js";function ft(e,t){const{accessToken:r,keyFactory:n}=de();return ce(n.getEntityBoundJsonSchemaQueryKey(e),()=>ue.getSchemaBinding(e,r),t)}function rr(e,t){const{accessToken:r,keyFactory:n}=de();return ce(n.getEntitySchemaValidationResultsQueryKey(e),()=>ue.getSchemaValidationResults(e,r),t)}function ht(e,t){const{keyFactory:r}=de();return ce(r.getValidationSchemaQueryKey(e),async()=>(await ue.getValidationSchema(e)).validationSchema,t)}const B=e=>a(Ue,{...e,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a("path",{d:"M14 10H2V12H14V10ZM14 6H2V8H14V6ZM18 14V10H16V14H12V16H16V20H18V16H22V14H18ZM2 16H10V14H2V16Z"})});try{B.displayName="AddToList",B.__docgenInfo={description:"",displayName:"AddToList",props:{ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: SVGSVGElement | null) => void) | RefObject<SVGSVGElement> | null"}},component:{defaultValue:null,description:"",name:"component",required:!1,type:{name:"ElementType<any>"}}}}}catch{}function yt(e){const t={};return Object.keys(e).forEach(r=>{let n=e[r];Array.isArray(n)?(n=n.filter(o=>o!=null),Te(n)||(t[r]=n)):t[r]=n}),t}function gt(e={}){return Object.keys(e).reduce((t,r)=>(e[r]!==null&&(t[r]=e[r]),t),{})}function M(e){var t,r;return(t=e.property)!=null&&t.startsWith("[")?e.property.substring(2,e.property.length-2):(r=e.property)!=null&&r.startsWith(".")?e.property.substring(1):e.property||""}function bt(e){return t=>{const r=tt(t,n=>n.property);return Object.keys(r).map(n=>{const o=r[n];o.some(l=>l.message==="should match some schema in anyOf")&&o.every(l=>l.message==="should be string"||l.message==="should be equal to constant"?!0:l.message==="should match some schema in anyOf")&&o.length>0&&(o[0].message="should be equal to one of the allowed values",r[n]=[o[0]])}),t=rt(r),e&&(t=t.map(n=>{const o=M(n);return o&&Se[e].includes(o)&&(n.message=`"${o}" is a reserved internal key and cannot be used.`),n})),t}}function K(e){return Array.isArray(e)?e:typeof e=="string"?e.split(",").map(t=>t.trim()):[e]}const Ae=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z/,St=["String","Integer","Float","Boolean","Datetime"];function U(e){return e.length===0?"String":e.every(t=>typeof t=="number"||t==="NaN")?e.every(t=>Number.isInteger(t))?"Integer":"Float":e.every(t=>typeof t=="boolean")?"Boolean":e.every(t=>typeof t=="string")&&e.every(t=>!!Ae.exec(t))?"Datetime":"String"}function he(e,t){switch(t){case"Integer":return e.map(r=>Number.isNaN(Number(r))?0:Math.floor(Number(r)));case"Float":return e.map(r=>{const n=parseFloat(r);return Number.isNaN(n)?"NaN":Number.isInteger(n)?n.toFixed(1):n});case"Datetime":return e.map(r=>typeof r=="string"&&Ae.exec(r)?r:new Date().toISOString());case"Boolean":return e.map(r=>!!r);case"String":default:return e.map(r=>String(r))}}function X(e){switch(e){case"Datetime":return{type:"string",format:"datetime"};case"Boolean":return{type:"boolean"};case"Float":return{type:"number"};case"Integer":return{type:"integer"};case"String":default:return{type:"string"}}}function Y(e){const{formData:t,onChange:r,registry:n,schema:o,name:c,onDropPropertyClick:f,idSchema:l}=e,m=l.$id,{ArrayField:g}=n.fields,{SelectWidget:h}=n.widgets,[u,y]=F.useState(U(K(t))),[d,_]=F.useState(u);F.useEffect(()=>{function i(){if(Array.isArray(t)){const T=t.length===0||t.every(s=>s==null||s==""),A=he(t,d);(T||d!==u)&&at(t,A)&&y(d)}}i()},[d]),F.useEffect(()=>{function i(){if(Array.isArray(t))if(t.every(T=>T==null))f(c)(new CustomEvent("dropEmptyProperty"));else{const T=he(t,d);y(d),r(T)}}i()},[u]);const S=X(u);return Array.isArray(t)?p(we,{value:{dropProperty:i=>{f(c)(i)}},children:[p(x,{item:!0,xs:2,children:[a(_e,{htmlFor:`${m}-type`,children:"Type"}),a(h,{name:"Type",id:`${m}-type`,schema:{},options:{enumOptions:St.map(i=>({label:i,value:i}))},value:u,onChange:i=>{_(i)},disabled:e.disabled,readOnly:e.readonly,required:!0,isClearable:!1,onBlur:()=>{},onFocus:()=>{},registry:n,label:"Type"})]}),a(x,{item:!0,xs:7,children:a(g,{...e,schema:{...o,items:{...S}}})}),u!==d&&a(et,{variant:"warning",title:"Data may be lost when converting types",description:`Are you sure you want to convert ${c} from ${u} to ${d}? Current values may be lost on conversion.`,primaryButtonConfig:{text:"Convert",onClick:()=>{y(d)}},secondaryButtonConfig:{text:"Cancel",onClick:()=>{_(u)}},isGlobal:!1})]}):(r(K(t)),a(j,{}))}try{U.displayName="guessPropertyType",U.__docgenInfo={description:"",displayName:"guessPropertyType",props:{}}}catch{}try{X.displayName="getSchemaForPropertyType",X.__docgenInfo={description:"Maps a Synapse Annotation PropertyType to a JSON Schema that captures the type and format.",displayName:"getSchemaForPropertyType",props:{}}}catch{}try{Y.displayName="AdditionalPropertiesSchemaField",Y.__docgenInfo={description:`react-jsonschema-form SchemaField override for "additionalProperties" only. In Synapse these are "custom annotations".
Modifies the data to provide full compatibility with Synapse annotations features.

This component provides these enhancements to the SchemaField:
- Supports selecting a type, and changing the input widget appropriately
- Identifying the type on mount
- Treat all field values as arrays
- When the last array value is removed, remove the entire key from the form.`,displayName:"AdditionalPropertiesSchemaField",props:{onDropPropertyClick:{defaultValue:null,description:"",name:"onDropPropertyClick",required:!0,type:{name:"(key: string) => (event: any) => void"}}}}}catch{}const Z=e=>{const{SelectWidget:t}=e.registry.widgets;return a(t,{...e,options:{enumOptions:[{value:!0,label:"true"},{value:!1,label:"false"}]}})};try{Z.displayName="BooleanWidget",Z.__docgenInfo={description:"Select widget compatible with react-jsonschema-form booleans",displayName:"BooleanWidget",props:{}}}catch{}const z=({disabled:e,value:t,onChange:r})=>a(it,{disabled:e,value:t?nt(t):"",setterCallback:n=>{n==null||typeof n=="string"?r(n):r(n.toISOString())}});try{z.displayName="DateTimeWidget",z.__docgenInfo={description:"DateTime picker widget compatible with react-jsonschema-form and Synapse Datetime annotations.",displayName:"DateTimeWidget",props:{}}}catch{}function Q(e){const{description:t,disabled:r,formData:n,idSchema:o,onAddClick:c,properties:f,readonly:l,registry:m,required:g,schema:h,title:u,uiSchema:y}=e,d=be(y),_=J("TitleFieldTemplate",m,d),S=J("DescriptionFieldTemplate",m,d),i=F.useRef(new Set);return ot(()=>{if("properties"in h&&h.properties){const T=Object.keys(h.properties),A=new Set(T.filter(s=>!h.properties[s][le]));if(i.current!=null){const s=Array.from(i.current).filter(v=>!A.has(v)&&!!n&&n[v]!=null&&Array.isArray(n[v])&&n[v].filter(q=>q!=null).length>0);s.length>0&&st(`The following annotations are no longer specified by the schema and have been converted to custom fields: ${s.join(", ")}.`,"warning",{title:"Fields No Longer Specified By Schema"})}i.current=A}},[h.properties]),p("fieldset",{id:o.$id,children:[(d.title||u)&&a(_,{id:`${o.$id}__title`,schema:h,title:d.title||u,required:g,uiSchema:y,registry:m}),(d.description||t)&&a(S,{id:`${o.$id}__description`,description:d.description||t,registry:m,schema:h}),f.map(T=>T.content),Oe(h,y,n)&&a(ve,{title:"Add a new custom field",placement:"top",children:a(lt,{sx:{my:2},variant:"contained",className:"object-property-expand",onClick:c(h),disabled:r||l,"aria-label":"Add Custom Field",children:a(B,{})})})]})}try{Q.displayName="ObjectFieldTemplate",Q.__docgenInfo={description:`Derived from the base ObjectFieldTemplate with annotations-editor-specific changes
- Custom button for adding additional properties
- Tracks properties to show a toast message if a property is converted to an additionalProperty because it was
  dropped from the schema (e.g. in a conditional schema)

See https://github.com/rjsf-team/react-jsonschema-form/blob/main/packages/mui/src/ObjectFieldTemplate/ObjectFieldTemplate.tsx`,displayName:"ObjectFieldTemplate",props:{title:{defaultValue:null,description:"A string value containing the title for the object",name:"title",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"A string value containing the description for the object",name:"description",required:!1,type:{name:"string"}},disabled:{defaultValue:null,description:"A boolean value stating if the object is disabled",name:"disabled",required:!1,type:{name:"boolean"}},properties:{defaultValue:null,description:"An array of objects representing the properties in the object",name:"properties",required:!0,type:{name:"ObjectFieldTemplatePropertyType[]"}},onAddClick:{defaultValue:null,description:"Returns a function that adds a new property to the object (to be used with additionalProperties)",name:"onAddClick",required:!0,type:{name:"(schema: S) => () => void"}},readonly:{defaultValue:null,description:"A boolean value stating if the object is read-only",name:"readonly",required:!1,type:{name:"boolean"}},required:{defaultValue:null,description:"A boolean value stating if the object is required",name:"required",required:!1,type:{name:"boolean"}},hideError:{defaultValue:null,description:"A boolean value stating if the field is hiding its errors",name:"hideError",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"The schema object for this object",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this object field",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},idSchema:{defaultValue:null,description:"An object containing the id for this object & ids for its properties",name:"idSchema",required:!0,type:{name:"IdSchema<T>"}},errorSchema:{defaultValue:null,description:"The optional validation errors in the form of an `ErrorSchema`",name:"errorSchema",required:!1,type:{name:"ErrorSchema<T>"}},formData:{defaultValue:null,description:"The form data for the object",name:"formData",required:!1,type:{name:"Record<string, any> | null"}},formContext:{defaultValue:null,description:"The `formContext` object that was passed to Form",name:"formContext",required:!1,type:{name:"GenericObjectType"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}}}}}catch{}const ee=e=>{const{BaseInputTemplate:t}=e.registry.templates;let r;return(e.schema.type==="number"||e.schema.type==="integer")&&(r="text"),a(t,{...e,options:{...e.options,inputType:r}})};try{ee.displayName="TextWidget",ee.__docgenInfo={description:`This TextWidget is almost identical to the rjsf TextWidget, except we handle numbers like strings to prevent issues if
the actual annotation data is not a string.`,displayName:"TextWidget",props:{}}}catch{}try{Widget.displayName="Widget",Widget.__docgenInfo={description:"The definition of a React-based Widget component",displayName:"Widget",props:{}}}catch{}function te(e){const{fields:{ObjectField:t}}=ke();return F.useEffect(()=>{const{schema:r,formData:n,onChange:o}=e,c={...n};r[pe]&&(Object.entries(r[pe]).forEach(([f,l])=>{const m=c[f];l[le]?Array.isArray(m)||(c[f]=K(m)):typeof l=="object"&&"type"in l&&l.type!=="array"&&Array.isArray(m)&&(c[f]=m.map(g=>`${g}`).join(", "))}),Be(n,c)||o(c))}),a(t,{...e})}try{te.displayName="CustomObjectField",te.__docgenInfo={description:"Extends the",displayName:"CustomObjectField",props:{}}}catch{}function re(e){const{id:t,classNames:r,disabled:n,label:o,onKeyChange:c,readonly:f,required:l,schema:m,children:g,registry:h}=e,{translateString:u}=h,y=u(Re.KeyLabel,[""]);if(!(le in m))return a("div",{className:r,children:g});const _=({target:S})=>{S&&c(S.value)};return a("div",{className:r,children:p(x,{container:!0,sx:{my:2},columnSpacing:2,rowSpacing:0,children:[a(x,{item:!0,xs:3,children:a(Ve,{fullWidth:!0,required:l,label:y,defaultValue:o,disabled:n||f,id:`${t}-key`,name:`${t}-key`,onBlur:f?void 0:_,type:"text"})}),g]})})}try{re.displayName="WrapIfAdditionalTemplate",re.__docgenInfo={description:"The `WrapIfAdditional` component is used by the `FieldTemplate` to rename, or remove properties that are\npart of an `additionalProperties` part of a schema.",displayName:"WrapIfAdditionalTemplate",props:{children:{defaultValue:null,description:"The field or widget component instance for this field row",name:"children",required:!0,type:{name:"ReactNode"}},label:{defaultValue:null,description:"The computed label for this field, as a string",name:"label",required:!0,type:{name:"string"}},style:{defaultValue:null,description:"An object containing the style as defined in the `uiSchema`",name:"style",required:!1,type:{name:"StyleHTMLAttributes<any>"}},id:{defaultValue:null,description:"The id of the field in the hierarchy. You can use it to render a label targeting the wrapped widget",name:"id",required:!0,type:{name:"string"}},disabled:{defaultValue:null,description:"A boolean value stating if the field is disabled",name:"disabled",required:!0,type:{name:"boolean"}},required:{defaultValue:null,description:"A boolean value stating if the field is required",name:"required",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"The schema object for this field",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this field",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},readonly:{defaultValue:null,description:"A boolean value stating if the field is read-only",name:"readonly",required:!0,type:{name:"boolean"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}},onDropPropertyClick:{defaultValue:null,description:"The property drop/removal event handler; Called when a field is removed in an additionalProperty context",name:"onDropPropertyClick",required:!0,type:{name:"(value: string) => () => void"}},classNames:{defaultValue:null,description:"A string containing the base CSS classes, merged with any custom ones defined in your uiSchema",name:"classNames",required:!1,type:{name:"string"}},onKeyChange:{defaultValue:null,description:"The key change event handler; Called when the key associated with a field is changed for an additionalProperty",name:"onKeyChange",required:!0,type:{name:"(value: string) => () => void"}}}}}catch{}function ae(e){const{id:t,label:r,children:n,errors:o,help:c,description:f,hidden:l,required:m,displayLabel:g,registry:h,uiSchema:u,schema:y}=e,d=be(u),_=J("WrapIfAdditionalTemplate",h,d),[S,i]=F.useState(!1);return l?a("div",{className:"hidden",children:n}):p(_,{...e,children:[(g||y.type==="boolean")&&p("div",{className:"LabelContainer",children:[p(_e,{htmlFor:t,children:[r,m&&a("span",{className:"required",children:"*"})]}),a(ve,{title:"More Info",children:a(ct,{onClick:T=>{T.preventDefault(),i(!S)},"aria-expanded":S,size:"small",children:a(Ce,{color:"primary",sx:{width:"16px",height:"16px"}})})})]}),n,a(x,{item:!0,xs:12,children:o}),a(Fe,{className:"field-description",in:S,children:f}),c]})}try{ae.displayName="FieldTemplate",ae.__docgenInfo={description:"",displayName:"FieldTemplate",props:{id:{defaultValue:null,description:"The id of the field in the hierarchy. You can use it to render a label targeting the wrapped widget",name:"id",required:!0,type:{name:"string"}},classNames:{defaultValue:null,description:"A string containing the base CSS classes, merged with any custom ones defined in your uiSchema",name:"classNames",required:!1,type:{name:"string"}},style:{defaultValue:null,description:"An object containing the style as defined in the `uiSchema`",name:"style",required:!1,type:{name:"StyleHTMLAttributes<any>"}},label:{defaultValue:null,description:"The computed label for this field, as a string",name:"label",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"A component instance rendering the field description, if one is defined (this will use any custom\n`DescriptionField` defined)",name:"description",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},rawDescription:{defaultValue:null,description:"A string containing any `ui:description` uiSchema directive defined",name:"rawDescription",required:!1,type:{name:"string"}},children:{defaultValue:null,description:"The field or widget component instance for this field row",name:"children",required:!0,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},errors:{defaultValue:null,description:"A component instance listing any encountered errors for this field",name:"errors",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},rawErrors:{defaultValue:null,description:"An array of strings listing all generated error messages from encountered errors for this field",name:"rawErrors",required:!1,type:{name:"string[]"}},help:{defaultValue:null,description:"A component instance rendering any `ui:help` uiSchema directive defined",name:"help",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>>"}},rawHelp:{defaultValue:null,description:"A string containing any `ui:help` uiSchema directive defined. **NOTE:** `rawHelp` will be `undefined` if passed\n`ui:help` is a React component instead of a string",name:"rawHelp",required:!1,type:{name:"string"}},hidden:{defaultValue:null,description:"A boolean value stating if the field should be hidden",name:"hidden",required:!1,type:{name:"boolean"}},required:{defaultValue:null,description:"A boolean value stating if the field is required",name:"required",required:!1,type:{name:"boolean"}},readonly:{defaultValue:null,description:"A boolean value stating if the field is read-only",name:"readonly",required:!0,type:{name:"boolean"}},hideError:{defaultValue:null,description:"A boolean value stating if the field is hiding its errors",name:"hideError",required:!1,type:{name:"boolean"}},disabled:{defaultValue:null,description:"A boolean value stating if the field is disabled",name:"disabled",required:!0,type:{name:"boolean"}},displayLabel:{defaultValue:null,description:`A boolean value stating if the label should be rendered or not. This is useful for nested fields in arrays where
you don't want to clutter the UI`,name:"displayLabel",required:!1,type:{name:"boolean"}},schema:{defaultValue:null,description:"The schema object for this field",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this field",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},formContext:{defaultValue:null,description:"The `formContext` object that was passed to `Form`",name:"formContext",required:!1,type:{name:"GenericObjectType"}},formData:{defaultValue:null,description:"The formData for this field",name:"formData",required:!1,type:{name:"T"}},onChange:{defaultValue:null,description:"The value change event handler; Can be called with a new value to change the value for this field",name:"onChange",required:!0,type:{name:"(newFormData: any, es?: ErrorSchema<any> | undefined, id?: string | undefined) => any"}},onKeyChange:{defaultValue:null,description:"The key change event handler; Called when the key associated with a field is changed for an additionalProperty",name:"onKeyChange",required:!0,type:{name:"(value: string) => () => void"}},onDropPropertyClick:{defaultValue:null,description:"The property drop/removal event handler; Called when a field is removed in an additionalProperty context",name:"onDropPropertyClick",required:!0,type:{name:"(value: string) => () => void"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}}}}}catch{}function qe(e){if(Array.isArray(e)||typeof e=="boolean")return"unknown";const{type:t,enum:r}=e;return t==="array"&&typeof e.items=="object"?`List of ${qe(e.items)}`:r?"enumeration":Array.isArray(t)?t.reduce((n,o)=>`${n}, ${o}`,""):t||"unknown"}function ne(e){const{description:t,schema:r}=e,n=qe(r);return a(Fe,{className:"field-description",in:!0,children:a("table",{className:"FieldDescriptionTable",children:p("tbody",{children:[t&&p("tr",{children:[a("th",{children:"Description"}),a("td",{children:t})]}),p("tr",{children:[a("th",{children:"Type"}),a("td",{children:n})]})]})})})}try{ne.displayName="FieldDescriptionTable",ne.__docgenInfo={description:"",displayName:"FieldDescriptionTable",props:{schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"JSONSchema7"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"ReactNode"}}}}}catch{}function ie(e){const{description:t,schema:r={}}=e;return r.type==="object"?a(G,{variant:"body1",sx:{my:2},children:t}):a(ne,{schema:r,description:t})}try{ie.displayName="DescriptionFieldTemplate",ie.__docgenInfo={description:"",displayName:"DescriptionFieldTemplate",props:{id:{defaultValue:null,description:"The id of the field description in the hierarchy",name:"id",required:!0,type:{name:"string"}},schema:{defaultValue:null,description:"The schema object for the field being described",name:"schema",required:!0,type:{name:"RJSFSchema"}},uiSchema:{defaultValue:null,description:"The uiSchema object for this description field",name:"uiSchema",required:!1,type:{name:"UiSchema<any, RJSFSchema, any>"}},description:{defaultValue:null,description:"The description of the field being rendered",name:"description",required:!0,type:{name:"string | ReactElement<any, string | JSXElementConstructor<any>>"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<any, RJSFSchema, any>"}}}}}catch{}const Tt=["date","datetime-local","file","time"];function oe(e){const{id:t,name:r,placeholder:n,required:o,readonly:c,disabled:f,type:l,label:m,value:g,onChange:h,onChangeOverride:u,onBlur:y,onFocus:d,autofocus:_,options:S,schema:i,uiSchema:T,rawErrors:A=[],formContext:s,registry:v,InputLabelProps:q,...E}=e,k=!0,R=Le(i,l,S),{step:w,min:L,max:W,...$}=R,N={inputProps:{step:w,min:L,max:W,...i.examples?{list:me(t)}:void 0},...$},H=({target:{value:V}})=>h(V===""?S.emptyValue:V),D=({target:{value:V}})=>y(t,V),P=({target:{value:V}})=>d(t,V),b=Tt.includes(l)?{...q,shrink:!0}:q;let C;return(i.default||i.const)&&(C=JSON.stringify(i.default||i.const)+" (derived)"),p(j,{children:[a(Ve,{id:t,name:t,placeholder:C||n,label:We(m||void 0,k,!1),autoFocus:_,required:!1,disabled:f||c,...N,value:g||g===0?g:"",error:A.length>0,onChange:u||H,onBlur:D,onFocus:P,InputLabelProps:b,...E,inputProps:{"aria-label":t},"aria-describedby":$e(t,!!i.examples)}),Array.isArray(i.examples)&&a("datalist",{id:me(t),children:i.examples.concat(i.default&&!i.examples.includes(i.default)?[i.default]:[]).map(V=>a("option",{value:V},V))})]})}try{oe.displayName="BaseInputTemplate",oe.__docgenInfo={description:"The `BaseInputTemplate` is the template to use to render the basic `<input>` component for the `core` theme.\nIt is used as the template for rendering many of the <input> based widgets that differ by `type` and callbacks only.\nIt can be customized/overridden for other themes or individual implementations as needed.",displayName:"BaseInputTemplate",props:{}}}catch{}function se(e){const{errors:t=[],idSchema:r}=e;if(t.length===0)return null;const n=He(r);return a(ut,{dense:!0,disablePadding:!0,children:t.map((o,c)=>a(Ne,{disableGutters:!0,children:a(dt,{id:n,sx:{color:"error.main"},children:o})},c))})}try{se.displayName="FieldErrorTemplate",se.__docgenInfo={description:"The `FieldErrorTemplate` component renders the errors local to the particular field",displayName:"FieldErrorTemplate",props:{errorSchema:{defaultValue:null,description:"The errorSchema constructed by `Form`",name:"errorSchema",required:!1,type:{name:"ErrorSchema<T>"}},errors:{defaultValue:null,description:"An array of the errors",name:"errors",required:!1,type:{name:"(string | ReactElement<any, string | JSXElementConstructor<any>>)[]"}},idSchema:{defaultValue:null,description:"The tree of unique ids for every child field",name:"idSchema",required:!0,type:{name:"IdSchema<T>"}},schema:{defaultValue:null,description:"The schema that was passed to field",name:"schema",required:!0,type:{name:"JSONSchema7"}},uiSchema:{defaultValue:null,description:"The uiSchema that was passed to field",name:"uiSchema",required:!1,type:{name:"UiSchema<T, S, F>"}},registry:{defaultValue:null,description:"The `registry` object",name:"registry",required:!0,type:{name:"Registry<T, S, F>"}}}}}catch{}function _t(e){return e?Se[e].reduce((t,r)=>(t[`^${r}$`]={not:{}},t),{}):{}}function ye(e,t){let r=gt(e);return t&&(r=yt(r)),r}function ge(e){const{entityId:t,schemaId:r,validationSchema:n,liveValidate:o=!1,onSuccess:c=()=>{},onCancel:f,formRef:l,onChange:m}=e,g=F.useRef(null),h=l??g,[u,y]=I.useState(void 0),[d,_]=I.useState(void 0),[S,i]=I.useState(!1),[T,A]=I.useState(!1),{entityMetadata:s,annotations:v}=Ze(t,!1,{staleTime:1/0,enabled:!!t,useErrorBoundary:!0}),[q,E]=I.useState(v),k=F.useMemo(()=>_t(s==null?void 0:s.concreteType),[s==null?void 0:s.concreteType]),R=F.useCallback(bt(s==null?void 0:s.concreteType),[s==null?void 0:s.concreteType]);F.useEffect(()=>{v&&E(v)},[v]);const{data:w,isLoading:L}=ft(t,{enabled:!!t,refetchOnWindowFocus:!1,useErrorBoundary:!0}),{data:W,isLoading:$}=ht(r??(w==null?void 0:w.jsonSchemaVersionInfo.$id)??"",{enabled:!!r||!!w,useErrorBoundary:!0}),N=n||W,H=L||$,D=ze({onSuccess:()=>{c()},onError:b=>{_(b),i(!0)}});function P(){D.mutate({...ye(q,!0),...s})}return a("div",{className:"JsonSchemaFormContainer",children:H?a("div",{className:"LoadingPlaceholder",children:a(Qe,{size:30})}):p(j,{children:[s&&w&&p(O,{severity:"info",sx:{mb:2},children:[a("b",{children:s.name})," requires scientific annotations specified by ",a("b",{children:w.jsonSchemaVersionInfo.$id}),". ",a("b",{children:a(pt,{href:`${Xe(Ye.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${w.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:"View required schema (JSON)"})})]}),s&&Te(q)&&w===null&&a(O,{severity:"info",children:p(fe,{display:"flex",alignItems:"center",gap:.5,children:[p(G,{variant:"smallText1",children:[a("b",{children:s.name})," has no annotations. Click the"," "]}),a(B,{}),a(G,{variant:"smallText1",children:"button to annotate."})]})}),q!=null&&p(Ee,{validator:Je,className:"JsonSchemaForm",liveValidate:o,noHtml5Validate:!0,experimental_defaultFormStateBehavior:{emptyObjectFields:"skipDefaults"},fields:{ObjectField:te},templates:{ArrayFieldDescriptionTemplate:Ie,ArrayFieldItemTemplate:je,ArrayFieldTemplate:xe,ArrayFieldTitleTemplate:De,BaseInputTemplate:oe,FieldErrorTemplate:se,FieldTemplate:ae,ObjectFieldTemplate:Q,WrapIfAdditionalTemplate:re,ButtonTemplates:Pe,DescriptionFieldTemplate:ie,ErrorListTemplate:()=>null},ref:h,disabled:D.isLoading,schema:{...N??{},patternProperties:{...(N==null?void 0:N.patternProperties)??{},...k},additionalProperties:(N==null?void 0:N.additionalProperties)??!0},uiSchema:{"ui:options":{copyable:!0,duplicateKeySuffixSeparator:"_"},additionalProperties:{"ui:field":Y}},transformErrors:R,formData:q,onChange:({formData:b})=>{m&&m(b),E(b),y(void 0)},onBlur:()=>{E(ye(q,!1))},onSubmit:({formData:b,errors:C},V)=>{V.preventDefault(),C&&C.length>0&&y(C),i(!1),E(b),P()},onError:b=>{y(b),u&&t&&A(!0)},widgets:{TextWidget:ee,DateTimeWidget:z,SelectWidget:Ge,CheckboxWidget:Z},children:[u&&p(O,{severity:"error",sx:{my:2},children:[a("b",{children:"Validation errors found:"}),a("ul",{children:u.map((b,C)=>p("li",{children:[a("b",{children:`${M(b)}: `})," ",`${b.message}`]},C))})]}),d&&S&&p(O,{severity:"error",sx:{my:2},children:["Annotations could not be updated: ",d.reason]}),!l&&p(j,{children:[a(mt,{sx:{my:2}}),a(fe,{display:"flex",justifyContent:"space-between",sx:{gridRowStart:5},children:a(Me,{hasCancelButton:f!==void 0,onCancel:()=>{f&&f()},onConfirm:()=>{h.current.formElement.current.requestSubmit()},confirmButtonText:t?"Save":"Validate"})})]})]}),T&&a(Ke,{open:!0,onConfirm:()=>{P(),A(!1)},onCancel:()=>{A(!1)},title:"Update Annotations",content:p(j,{children:[a("div",{children:"The following errors exist with the annotations you entered:"}),a("div",{children:a("ul",{children:(u??[]).map((b,C)=>p("li",{children:[a("b",{children:`${M(b)}: `})," ",`${b.message}`]},C))})}),a("div",{children:"Are you sure you want to save the invalid annotations?"})]}),confirmButtonText:"Save"})]})})}try{ge.displayName="SchemaDrivenAnnotationEditor",ge.__docgenInfo={description:`Renders a form for editing an entity's annotations. The component also supports supplying just a schema ID,
but work to support annotation flows without an entity (i.e. before creating entities) is not yet complete.`,displayName:"SchemaDrivenAnnotationEditor",props:{entityId:{defaultValue:null,description:"The entity whose annotations should be edited with the form",name:"entityId",required:!1,type:{name:"string"}},schemaId:{defaultValue:null,description:"If no entity ID is supplied, the schema to use for the form",name:"schemaId",required:!1,type:{name:"string"}},validationSchema:{defaultValue:null,description:"May be used to directly provide a JSON Schema to use for the form",name:"validationSchema",required:!1,type:{name:"JSONSchema7"}},formRef:{defaultValue:null,description:"Optionally supply a ref to the form to handle submission externally with `formRef.current.submit()`. If provided, the editor will not render its own submit UI.",name:"formRef",required:!1,type:{name:"RefObject<Form<any, RJSFSchema, any>>"}},liveValidate:{defaultValue:null,description:"Provide live input validation. This can cause major performance degradation.",name:"liveValidate",required:!1,type:{name:"boolean"}},onSuccess:{defaultValue:null,description:"Invoked after a successful form submission",name:"onSuccess",required:!1,type:{name:"(() => void)"}},onCancel:{defaultValue:null,description:"If defined and formRef is not supplied, shows a 'Cancel' button and runs this effect on click",name:"onCancel",required:!1,type:{name:"(() => void)"}},onChange:{defaultValue:null,description:"Passes new form data upon each change to the form",name:"onChange",required:!1,type:{name:"((annotations: Record<string, unknown>) => void)"}}}}}catch{}export{B as A,ge as S,rr as a,ft as u};
//# sourceMappingURL=SchemaDrivenAnnotationEditor-2df8904c.js.map
