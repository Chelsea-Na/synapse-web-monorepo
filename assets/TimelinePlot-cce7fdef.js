import{a as b,j as n,F as H}from"./jsx-runtime-095bf462.js";import{r as I}from"./index-8db94870.js";import{J as te}from"./SynapseClient-c9a5bd80.js";import"./getEndpoint-ac94413e.js";import{b as j}from"./SynapseConstants-fd8b2600.js";import{a as g}from"./queryUtils-351d6066.js";import{p as D,g as se}from"./SqlFunctions-dbbb8cfa.js";import{a as z}from"./useGetQueryResultBundle-d2a30342.js";import{c as re,P as oe}from"./factory-275e83af.js";import{d as L}from"./dayjs.min-59ef0ea6.js";import{O as ne,p as ae,N as ie}from"./ObservationCard-36e41ee3.js";import{D as le}from"./Dialog-e3cfbd15.js";import{g as B}from"./ColorGradient-3d3e1969.js";import{B as v}from"./Box-9af7e41c.js";import{T as ue}from"./Typography-661a732d.js";import"./LeftRightPanel-9a9b154d.js";import{S as de}from"./StyledFormControl-28c005fa.js";import"./WideButton-fd5c5981.js";import"./InputSizedButton-9ea1c513.js";import{I as ce}from"./InputLabel-ee349efc.js";import{S as me}from"./Select-87888e94.js";import{M as pe}from"./MenuItem-c009f542.js";import{S as E}from"./Skeleton-a13486d8.js";const he="species",fe="observationphase",P={concreteType:"org.sagebionetworks.repo.model.table.QueryResultBundle",queryResult:{concreteType:"org.sagebionetworks.repo.model.table.QueryResult",queryResults:{concreteType:"org.sagebionetworks.repo.model.table.RowSet",tableId:"syn52408661",etag:"a3270cb2-4373-4e12-9981-e12326e54ad1",headers:[{name:"species",columnType:"STRING",id:"152514"},{name:"observationPhase",columnType:"STRING",id:"197976"},{name:"observationPhaseOrder",columnType:"INTEGER",id:"198102"},{name:"observationTimeMax",columnType:"INTEGER",id:"198103"},{name:"observationTimeUnits",columnType:"STRING",id:"198101"}],rows:[{rowId:9,versionNumber:4,values:["Danio rerio","embryo","1","7","days"]},{rowId:10,versionNumber:4,values:["Danio rerio","larval","2","3","months"]},{rowId:11,versionNumber:4,values:["Danio rerio","juvenile","3","6","months"]},{rowId:12,versionNumber:4,values:["Danio rerio","adult","4","12","months"]},{rowId:16,versionNumber:4,values:["Drosophila","embryo","1","24","hours"]},{rowId:17,versionNumber:4,values:["Drosophila","larval","2","5","days"]},{rowId:18,versionNumber:4,values:["Drosophila","pupal","3","12","days"]},{rowId:19,versionNumber:4,values:["Drosophila","adult","4","5","weeks"]},{rowId:1,versionNumber:4,values:["Mus musculus","prenatal","1","21","days"]},{rowId:2,versionNumber:4,values:["Mus musculus","postnatal","2","6","months"]},{rowId:20,versionNumber:4,values:["Rattus norvegicus","prenatal","1","23","days"]},{rowId:21,versionNumber:4,values:["Rattus norvegicus","neonatal","2","4","weeks"]},{rowId:22,versionNumber:4,values:["Rattus norvegicus","weanling","3","2","months"]},{rowId:23,versionNumber:4,values:["Rattus norvegicus","juvenile","4","3","months"]},{rowId:24,versionNumber:4,values:["Rattus norvegicus","adolescent","5","6","months"]},{rowId:25,versionNumber:4,values:["Rattus norvegicus","adult","6","12","months"]},{rowId:13,versionNumber:4,values:["Saccharomyces","log phase","1","7","days"]},{rowId:14,versionNumber:4,values:["Saccharomyces","stationary phase","2","2","weeks"]},{rowId:15,versionNumber:4,values:["Saccharomyces","death phase","3","3","weeks"]},{rowId:3,versionNumber:4,values:["Sus scrofa","prenatal","1","115","days"]},{rowId:4,versionNumber:4,values:["Sus scrofa","neonatal","2","3","months"]},{rowId:5,versionNumber:4,values:["Sus scrofa","weanling","3","6","months"]},{rowId:6,versionNumber:4,values:["Sus scrofa","juvenile","4","12","months"]},{rowId:7,versionNumber:4,values:["Sus scrofa","adolescent","5","2","years"]},{rowId:8,versionNumber:4,values:["Sus scrofa","adult","6","3","years"]}]}}};var k;const ve=(k=P.queryResult)==null?void 0:k.queryResults.headers.findIndex(e=>e.name.toLowerCase()===he);var Q;const O=(Q=P.queryResult)==null?void 0:Q.queryResults.headers.findIndex(e=>e.name.toLowerCase()===fe),ye=re(oe),ge=(e,t,u,i)=>{let a=-1;return{timepoints:t.map((o,l)=>{const r=parseFloat(o.values[u.time]),c=o.values[u.timeUnits];return o.rowId==i&&(a=l),e.add(r,c)}),hoverOverIndex:a}},M=e=>e.length==0?L().add(1,"days"):e.reduce((t,u)=>!t||u.isAfter(t)?u:t),Ie=(e,t)=>{if(e.timepoints==null||e.timepoints.length==0)return[{x:[L().format()],y:[.5],mode:"lines",line:{color:"blue",width:2},customdata:[],hoverinfo:"none"}];const u=e.timepoints.reduce((a,s,o)=>{const l=a;return l[s.format()]||(l[s.format()]=[]),l[s.format()].push(t[o]),a},{});return e.timepoints.map((a,s)=>{const o=a.format(),l=s==e.hoverOverIndex,c=u[o].map(h=>h.rowId);return{x:[o,o,o],y:[0,.5,1],mode:"lines",line:{color:l?"black":"gray",width:2},customdata:[c,c,c],hoverinfo:"none"}})},be=(e,t,u,i,a,s)=>{const o=[{x:e.add(1,"day").format(),y:-1,text:"                             ",showarrow:!1,textangle:"270",height:15}];if(i&&a&&s){const l=s>1?`(${s})`:"",r=e.add(i,a);o.push({x:r.format(),y:-1,text:`${i} ${ae(a,i)} ${l}`,showarrow:!1,textangle:"270",height:15})}return{hovermode:"closest",dragmode:!1,showlegend:!1,xaxis:{showgrid:!1,showticklabels:!1,showline:!1,zeroline:!1},yaxis:{range:[-1,1],showgrid:!1,zeroline:!1,showline:!1,showticklabels:!1},annotations:o,shapes:[{type:"rect",x0:e.subtract(t.diff(e)/10).format(),x1:t.add(t.diff(e)/3).format(),y0:.25,y1:.75,fillcolor:u,opacity:.8,line:{width:0}}],margin:{l:0,r:0,t:60,b:60}}},q=({color:e,rowData:t,schema:u,widthPx:i})=>{const[a,s]=I.useState(),[o,l]=I.useState(),r=L(),c=I.useRef(null),h=a==null?void 0:a.points[0].customdata,f=t==null?void 0:t.filter(p=>h==null?void 0:h.includes(p.rowId)),m=o==null?void 0:o.points[0].customdata,d=t==null?void 0:t.filter(p=>m==null?void 0:m.includes(p.rowId)),x=d&&d.length>0?parseFloat(d[0].values[u.time]):void 0,S=d&&d.length>0?d[0].values[u.timeUnits]:void 0,_=ge(r,t,u,(m==null?void 0:m.length)>0?m[0]:void 0),T=M(_.timepoints);return b("div",{ref:c,style:{width:i},children:[n(ye,{style:{width:i,height:"220px"},data:Ie(_,t),layout:be(r,T,e,x,S,d.length),config:{displayModeBar:!1},useResizeHandler:!0,onClick:p=>{s(p),l(void 0)},onHover:p=>{l(p)},onUnhover:()=>{l(void 0)}}),f&&n(le,{onClose:()=>s(void 0),open:!!f&&f.length>0,children:f.map(p=>n(ne,{data:p.values,schema:u,includePortalCardClass:!1},p.rowId))})]})};try{M.displayName="getMaxDate",M.__docgenInfo={description:"",displayName:"getMaxDate",props:{}}}catch{}try{q.displayName="TimelinePhase",q.__docgenInfo={description:"",displayName:"TimelinePhase",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},rowData:{defaultValue:null,description:"",name:"rowData",required:!0,type:{name:"Row[]"}},schema:{defaultValue:null,description:"",name:"schema",required:!0,type:{name:"ObservationCardSchema"}},widthPx:{defaultValue:null,description:"",name:"widthPx",required:!0,type:{name:"number"}}}}}catch{}const C=({color:e,phaseName:t})=>b(v,{sx:{display:"flex",alignItems:"center",gap:"7px"},children:[n(v,{sx:{backgroundColor:e,width:"20px",height:"20px"}}),n(ue,{variant:"body1",children:t==null?void 0:t.toUpperCase()})]});try{C.displayName="TimelineLegendItem",C.__docgenInfo={description:"",displayName:"TimelineLegendItem",props:{color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},phaseName:{defaultValue:null,description:"",name:"phaseName",required:!0,type:{name:"string | null"}}}}}catch{}const A=({sql:e,additionalFilters:t=[],species:u,setSpecies:i})=>{var c,h;const a=D(e),s=z({entityId:a,query:{sql:`SELECT species FROM ${a} WHERE species IS NOT null GROUP BY species`,additionalFilters:t},partMask:j,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"}),{data:o,isLoading:l}=s,r=(h=(c=o==null?void 0:o.queryResult)==null?void 0:c.queryResults)==null?void 0:h.rows;return I.useEffect(()=>{r&&i(r.length>0?r[0].values[0]:null)},[r,i]),l||!r||r.length<2?n(H,{}):n(v,{children:b(de,{children:[n(ce,{children:"Species"}),n(me,{sx:{marginLeft:"2px",marginBottom:"2px"},value:u,defaultValue:r[0].values[0],label:"Species",onChange:f=>i(f.target.value),children:r==null?void 0:r.map(f=>{const m=f.values[0];return n(pe,{value:m,children:m},m)})})]})})};try{A.displayName="TimelinePlotSpeciesSelector",A.__docgenInfo={description:"",displayName:"TimelinePlotSpeciesSelector",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},additionalFilters:{defaultValue:{value:"[]"},description:"",name:"additionalFilters",required:!1,type:{name:"QueryFilter[]"}},species:{defaultValue:null,description:"",name:"species",required:!1,type:{name:"string | null"}},setSpecies:{defaultValue:null,description:"",name:"setSpecies",required:!0,type:{name:"Dispatch<SetStateAction<string | null | undefined>>"}}}}}catch{}const Ne=e=>{const[t,u]=I.useState({width:1,height:2});return I.useEffect(()=>{const i=()=>{if(e.current){const a=e.current.getBoundingClientRect(),{width:s,height:o}=a,l=Math.round(s),r=Math.round(o);(t.width!=l||t.height!=r)&&u({width:l,height:r})}};return i(),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}},[t.height,t.width,e]),t},we="phase",_e="time",xe="timeunits",Se="submittername",Te="text",Re="tag",Ee="submitteruserid",Oe="doi",F=({sql:e,searchParams:t,sqlOperator:u,defaultSpecies:i})=>{var U;const a=D(e),[s,o]=I.useState(i),l=I.createRef(),r=Ne(l),c=se(a,t,u)??[],h=s?{columnName:"species",concreteType:"org.sagebionetworks.repo.model.table.ColumnSingleValueQueryFilter",values:[s],operator:te.EQUAL}:void 0,f=[...c];h&&f.push(h);const m=z({entityId:a,query:{sql:`${e} WHERE observationTime IS NOT NULL`,sort:[{column:"observationTime",direction:"ASC"}],additionalFilters:f},partMask:j,concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest"},{enabled:!!s}),{data:d,isLoading:x}=m;if(x)return n(Me,{});const S=g(we,d),_=g(_e,d),T=g(xe,d),p=g(Se,d),G=g(Te,d),$=g(Oe,d),W=g(Re,d),K=g(Ee,d),Y={submitterName:p,submitterUserId:K,tag:W,text:G,time:_,timeUnits:T,doi:$};let N=[];if(s){const y=(U=P.queryResult)==null?void 0:U.queryResults.rows.filter(w=>w.values[ve]==s);if(!y||y.length==0)return n(H,{});N=y}if(s===null)return n(ie,{});const J=r.width?r.width/N.length:0,X=N.map(()=>"auto").join(" ");return b(v,{children:[b(v,{sx:{display:"flex",justifyContent:"space-between"},children:[n(v,{children:!i&&n(A,{setSpecies:o,species:s,sql:e,additionalFilters:c})}),n(v,{sx:{display:"flex",justifyContent:"flex-end",gap:"25px"},children:N.map((y,w)=>{const{colorPalette:R}=B(w,1);return n(C,{color:R[0],phaseName:y.values[O]},y.rowId)})})]}),s&&n("div",{ref:l,children:n(v,{sx:{display:"inline-grid",gridTemplateColumns:X,minWidth:r.width,maxWidth:r.width},className:"forcePlotlyDefaultCursor",children:N.map((y,w)=>{var V;const{colorPalette:R}=B(w,1),Z=(V=d==null?void 0:d.queryResult)==null?void 0:V.queryResults.rows.filter(ee=>ee.values[S]==y.values[O]);return n(q,{name:y.values[O],color:R[0],rowData:Z,schema:Y,widthPx:J},y.rowId)})})})]})},Me=()=>b(v,{children:[b(v,{sx:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[n(E,{height:"45px",width:"80px"}),n(E,{height:"45px",width:"80px"})]}),n(v,{sx:{display:"flex"},children:n(E,{height:"150px",width:"100%"})})]});try{F.displayName="TimelinePlot",F.__docgenInfo={description:"",displayName:"TimelinePlot",props:{sql:{defaultValue:null,description:"",name:"sql",required:!0,type:{name:"string"}},searchParams:{defaultValue:null,description:"",name:"searchParams",required:!1,type:{name:"Record<string, string>"}},sqlOperator:{defaultValue:null,description:"",name:"sqlOperator",required:!1,type:{name:"enum",value:[{value:'"LIKE"'},{value:'"EQUAL"'},{value:'"IN"'},{value:'"HAS"'},{value:'"HAS_LIKE"'}]}},defaultSpecies:{defaultValue:null,description:"",name:"defaultSpecies",required:!1,type:{name:"string"}}}}}catch{}export{F as T};
//# sourceMappingURL=TimelinePlot-cce7fdef.js.map
