import{a as S,j as e,F as O}from"./jsx-runtime-9dc53467.js";import{r}from"./index-76fb7be0.js";import{S as ye}from"./StepperDialog-780267a9.js";import{T as F}from"./TextField-12f5946f.js";import{B as g}from"./Box-8faf86fd.js";import{T as L}from"./Typography-1d068b0b.js";import{r as ve,i as Re,a as Me}from"./jsx-runtime_commonjs-proxy-00bc9f93.js";import{f as Ie}from"./DateFormatter-b058ade0.js";import{d as Ne}from"./dayjs.min-f79c4412.js";import{a as xe}from"./RadioGroup-bfe7e0a4.js";import{d as we}from"./Search-b46373ca.js";import{B as ie}from"./Box-551bafc7.js";import{b as Ae}from"./InputLabel-fd013c0b.js";import"./SkeletonButton-007d85cd.js";import"./HelpPopover-5f6932ac.js";import{S as Oe}from"./SkeletonTable-dbfcf115.js";import{h as K,m as le,n as de,l as Le,y as qe,bq as Ue,br as Fe,bs as Je,bt as Ge,bu as He}from"./SynapseClient-5617d165.js";import{g as ke,B as je}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-a1ca5cdb.js";import{L as Be}from"./react-router-dom-c5ce8b71.js";import{D as Ye}from"./DataGrid-fe87f0ef.js";import{c as Qe}from"./Stack-4eda368b.js";import{B as De}from"./Button-33299b2c.js";import{M as Pe}from"./TextField-259737a9.js";import{A as Ve}from"./SynapseConstants-6baf84cd.js";import{u as $e}from"./useGetEntityChallenge-b1ec62f8.js";import{u as We}from"./useGetUserTeams-5ecc110f.js";import{a as ze}from"./useTeamMembers-d890c5e2.js";const Ke=Qe(),Xe=Ke;function Ze(t,m){const{accessToken:d,keyFactory:c}=K();return le(c.getTeamListQueryKey(t.sort().join()),()=>de.getTeamList(t,d),m)}function ea(t,m){const{accessToken:d,keyFactory:c}=K();return le(c.getChallengeTeamListQueryKey(t),()=>de.getAllChallengeTeams(d,t),m)}const D=({onChangeTeamInfo:t,onError:m})=>{const[d,c]=r.useState({name:"",description:"",message:"",invitees:""}),E=l=>{const i={...d,...l};c(i),t(i)},v=l=>{if(l.split(",").length>3&&m)return m("Please limit the initial number of invited members to three. You may add additional members after the team has been created.");E({invitees:l})};return S(g,{children:[e(L,{variant:"body1",sx:{lineHeight:"20px"},children:"Create a new team for this Challenge!"}),e(F,{id:"name",label:"Team Name",value:d.name,fullWidth:!0,autoFocus:!0,required:!0,onChange:l=>E({name:l.target.value})}),e(g,{display:"flex",children:e(F,{id:"description",label:e(g,{display:"flex",gap:2,children:e(g,{children:"Team Description"})}),value:d.description,fullWidth:!0,multiline:!0,rows:4,onChange:l=>E({description:l.target.value})})}),e(g,{display:"flex",children:e(F,{id:"message",label:e(g,{display:"flex",gap:2,children:e(g,{children:"Recruitment Message"})}),value:d.message,fullWidth:!0,multiline:!0,rows:4,onChange:l=>E({message:l.target.value})})}),e(F,{id:"invitees",label:"Emails of Additional Members to Invite (max 3)",placeholder:"Enter emails separated by comma",value:d.invitees,fullWidth:!0,onChange:l=>v(l.target.value)})]})};try{D.displayName="CreateChallengeTeam",D.__docgenInfo={description:"",displayName:"CreateChallengeTeam",props:{onChangeTeamInfo:{defaultValue:null,description:"",name:"onChangeTeamInfo",required:!0,type:{name:"(update: CreateTeamRequest) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"((msg: string) => void)"}}}}}catch{}var X={},aa=Re;Object.defineProperty(X,"__esModule",{value:!0});var ce=X.default=void 0,ta=aa(ve()),na=Me;ce=X.default=(0,ta.default)((0,na.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"ControlPoint");const P=({rowCount:t,onChange:m})=>{const d=t>5?"calc(100% - 8px)":"100%";return S(ie,{component:"form",sx:{p:"4px 4px",display:"flex",flexGrow:1,width:d,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e(ie,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e(we,{sx:{color:"#878E95"}})}),e(Ae,{onChange:m,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})};try{P.displayName="ChallengeTeamSearch",P.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function V({challengeId:t,onSelectTeam:m}){const[d,c]=r.useState([]),[E,v]=r.useState([]),[l,i]=r.useState({}),{data:f}=ea(t),[G,s]=r.useState(),{data:n,isLoading:M}=Ze(E,{enabled:!!E.length}),H=o=>{s(o),m(l[o])},I=o=>({id:o.id,name:o.name,created:Ie(Ne(o.createdOn),"MM/DD/YY"),description:o.description});r.useEffect(()=>{const o=(f==null?void 0:f.map(_=>_.teamId))??[];v(o)},[f]),r.useEffect(()=>{const o=(n==null?void 0:n.list.filter(h=>h.canRequestMembership!==!1))??[],_=[],R={};o.forEach(h=>{_.push(I(h)),R[h.id]=h}),c(_),i(R)},[n]);const k=o=>{const _=o.target.value.toLowerCase(),R=(n==null?void 0:n.list.filter(b=>b.canRequestMembership!==!1))??[];let h=R;_.length&&(h=R.filter(b=>{var x;return b.name.toLowerCase().includes(_)||((x=b.description)==null?void 0:x.toLowerCase().includes(_))})),c(h.map(b=>I(b)))},p=[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:o=>e(xe,{value:o.id,checked:o.id===G,onChange:H,label:"",style:{marginBottom:"16px"}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:o=>e(Be,{to:{pathname:`${ke(je.PORTAL_ENDPOINT)}/#!Team:${o.row.id}`},target:"_blank",children:o.row.name})},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}];return S(g,{sx:{height:220},children:[!M&&S(O,{children:[e(P,{onChange:k,rowCount:d.length}),e(Ye,{rows:d,columns:p,rowCount:5,hideFooter:!0,density:"compact",sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"}},getRowClassName:o=>o.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]}),M&&e(Oe,{numRows:10,numCols:1})]})}try{V.displayName="ChallengeTeamTable",V.__docgenInfo={description:"",displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const $=({challengeId:t,onCreateTeam:m,onSelectTeam:d})=>S(Xe,{spacing:1,children:[e(L,{variant:"body1",sx:{lineHeight:"20px"},children:'To participate in a challenge, you need to create a new Team or join an existing one.     By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.     All team members will need a Synapse account so that they can login and accept the team invitation.'}),e(g,{sx:{height:270},children:e(V,{challengeId:t,onSelectTeam:d})}),e(g,{children:e(De,{color:"primary",variant:"contained",onClick:m,startIcon:e(ce,{}),children:"Create New Team"})})]});try{$.displayName="SelectChallengeTeam",$.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const W=({createdNewTeam:t,teamName:m})=>m?S(O,{children:[S(L,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",t?"created":"joined"," team"," ",e("b",{children:m})," and have been added to this challenge."]}),t&&e(g,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null;try{W.displayName="RegistrationSuccessful",W.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamName:{defaultValue:null,description:"",name:"teamName",required:!0,type:{name:"string | undefined"}}}}}catch{}const z=({team:t,joinMessageChange:m})=>{const[d,c]=r.useState("");if(!t)return null;const E=v=>{const l=v.target.value;c(l),m(l)};return S(O,{children:[S(L,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e("strong",{children:t.name})," team."]}),e(g,{children:e("strong",{children:"Your Message to Team Managers(s)"})}),e(g,{children:e(Pe,{id:"membershipRequestMessage",value:d,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:E})})]})};try{z.displayName="JoinRequestForm",z.__docgenInfo={description:"",displayName:"JoinRequestForm",props:{team:{defaultValue:null,description:"",name:"team",required:!0,type:{name:"Team | undefined"}},joinMessageChange:{defaultValue:null,description:"",name:"joinMessageChange",required:!0,type:{name:"(msg: string) => void"}}}}}catch{}const J={SELECT_YOUR_CHALLENGE_TEAM:{id:"SELECT_YOUR_CHALLENGE_TEAM",title:"Select Your Challenge Team",nextStep:"JOIN_REQUEST_FORM",nextEnabled:!1},JOIN_REQUEST_FORM:{id:"JOIN_REQUEST_FORM",title:"Request Team Membership",previousStep:"SELECT_YOUR_CHALLENGE_TEAM",confirmStep:"JOIN_REQUEST_SENT",confirmButtonText:"Send Request",confirmEnabled:!0},JOIN_REQUEST_SENT:{id:"JOIN_REQUEST_SENT",title:"Request Sent",confirmButtonText:"Close",confirmEnabled:!0},CREATE_NEW_TEAM:{id:"CREATE_NEW_TEAM",title:"Create Team",confirmStep:"REGISTRATION_SUCCESSFUL",confirmButtonText:"Finish Registration",confirmEnabled:!1,previousStep:"SELECT_YOUR_CHALLENGE_TEAM"},REGISTRATION_SUCCESSFUL:{id:"REGISTRATION_SUCCESSFUL",title:"Registration Successful!"}},Q="",oe=({projectId:t,isShowingModal:m=!1,onClose:d})=>{const{accessToken:c,keyFactory:E}=K(),[v,l]=r.useState(!0),[i,f]=r.useState(J.SELECT_YOUR_CHALLENGE_TEAM),[G,s]=r.useState(),[n,M]=r.useState(),[H,I]=r.useState(!1),[k,p]=r.useState(!1),[o,_]=r.useState(!1),R=Le(),[h,b]=r.useState({}),[x,j]=r.useState(!1),[Z,ee]=r.useState(!1),[N,me]=r.useState({name:"",description:"",message:"",invitees:""}),[ue,fe]=r.useState(""),{data:C}=qe(),{data:T}=$e(t),{data:B,error:ae}=We((T==null?void 0:T.id)??Q,1);r.useEffect(()=>{if(B){const a=B.results.length>0;a&&(s("Error: You are already a member of a registered submission team for this Challenge."),_(a)),l(!1)}ae&&(s("Error: Could not determine if you are already registered for this Challenge."),l(!1))},[B,ae]);const{data:q,error:Y}=ze((n==null?void 0:n.id)??Q,(C==null?void 0:C.ownerId)??Q,{enabled:!!n&&!!C});r.useEffect(()=>{q&&b(a=>({...a,[q.teamId]:q}))},[q]),r.useEffect(()=>{Y&&s(Y.reason)},[Y]);const te=()=>{if(n&&n.id in h){const{canJoin:a,membershipApprovalRequired:u,isMember:y,hasOpenInvitation:w,hasOpenRequest:A}=h[n.id];if(y)return{canJoin:!1,errorMessage:"You are already a member of this team."};if(A)return{canJoin:!1,errorMessage:"Your previous request to join this team is pending review."};if(w||a||u)return{canJoin:!0,needsApproval:u,errorMessage:void 0}}return{canJoin:!1}};r.useEffect(()=>{!!C&&C.ownerId===Ve.toString()&&(l(!1),s("Please login to continue."))},[c,C,t,T]),r.useEffect(()=>{x&&Z&&(p(!1),U(i.confirmStep))},[Z,x,i]),r.useEffect(()=>{if(n&&n.id in h&&i.id==="SELECT_YOUR_CHALLENGE_TEAM"){const{canJoin:a,errorMessage:u}=te();if(a){i.nextEnabled||f({...i,nextEnabled:!0});return}i.nextEnabled&&f({...i,nextEnabled:!1}),u&&s(u)}},[h,n,i]);const pe=a=>{a&&(s(void 0),M(a))},he=a=>{me(a);const u=a.name.length>1;f({...i,confirmEnabled:u})},ge=(a=n==null?void 0:n.id)=>{!a||!C||!c||(p(!0),s(void 0),Ue(a,C.ownerId,c).then(()=>{T&&R.invalidateQueries(E.getSubmissionTeamsQueryKey(T==null?void 0:T.id)),U("REGISTRATION_SUCCESSFUL")}).catch(u=>{s(`Error joining team: ${u.reason}`)}).finally(()=>{p(!1)}))},Te=async()=>{C&&n&&(p(!0),f({...i,nextEnabled:!1}),s(void 0),await Fe({teamId:n.id,userId:C.ownerId,message:ue},c).then(()=>{f(J.JOIN_REQUEST_SENT)}).catch(a=>{console.error({err:a}),s(`Error requesting membership: ${a.reason}`)}).finally(()=>{p(!1)}))},Ee=async a=>{const u="Error registering challenge team";a&&T?(s(void 0),ee(!1),await Ge({challengeId:T.id,teamId:String(a)},c).then(()=>{ee(!0)}).catch(y=>{s(`${u}: ${y.reason}`),p(!1)})):(s(`${u}: Invalid team.`),p(!1))},Ce=async(a,u)=>{if(!u.length){j(!0);return}const y="Error inviting members";if(a){s(void 0),j(!1);const w=u.split(","),A=[];for(const se of w)await He({teamId:String(a),inviteeEmail:se.trim()},c).catch(()=>{A.push(se.trim())});A.length?(s(`${y}: ${A.join(", ")}`),p(!1)):j(!0)}else s(`${y}: Invalid team.`),p(!1)},_e=async()=>{N&&N.name&&N.name.length>1&&(f({...i,confirmEnabled:!1}),p(!0),s(void 0),await Je({name:N.name,description:N.description},c).then(a=>{I(!0),M(a),Ee(a.id),Ce(a.id,N.invitees)}).catch(a=>{p(!1),s(`Error creating team: ${a.reason}`),f({...i,confirmEnabled:!0})}))},ne=()=>{s(void 0),I(!1),M(void 0),f({...i,nextEnabled:!1}),d()},re={CREATE_NEW_TEAM:_e,JOIN_REQUEST_FORM:Te,JOIN_REQUEST_SENT:()=>{ne()}},Se=()=>{switch(i.id){case"SELECT_YOUR_CHALLENGE_TEAM":return c&&T&&!o?e($,{challengeId:T.id,onCreateTeam:()=>U("CREATE_NEW_TEAM"),onSelectTeam:pe}):e(O,{});case"JOIN_REQUEST_FORM":return e(z,{team:n,joinMessageChange:fe});case"JOIN_REQUEST_SENT":return e(L,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."});case"REGISTRATION_SUCCESSFUL":return e(W,{createdNewTeam:H,teamName:n==null?void 0:n.name});case"CREATE_NEW_TEAM":return e(D,{onChangeTeamInfo:he,onError:s});default:return e(O,{})}};function U(a){if(!a||!J[a])return;s(void 0);const{canJoin:u,errorMessage:y,needsApproval:w}=te();switch(a){case"SELECT_YOUR_CHALLENGE_TEAM":I(!1);break;case"JOIN_REQUEST_FORM":if(u){if(!w)return ge()}else return s(y);break}f(J[a])}const be=re[i.id]?re[i.id]:()=>{};return e(ye,{errorMessage:G,onCancel:ne,onStepChange:U,open:m,onConfirm:()=>{be()},confirming:k,step:i,content:Se(),loading:v})};try{oe.displayName="ChallengeTeamWizard",oe.__docgenInfo={description:"",displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{oe as C};
