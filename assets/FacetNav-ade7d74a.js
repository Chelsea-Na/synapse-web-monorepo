import{j as a,a as m,F as q}from"./jsx-runtime-ad672792.js";import{ag as He,aO as Xe,aH as Oe,ah as et,aj as tt,aT as at,aY as nt}from"./SynapseContext-218e56f5.js";import{r as p,R as qe}from"./index-f1f749bf.js";import{i as lt,r as rt,h as st,a as ze}from"./queryUtils-ae0ddfde.js";import{u as Ye,a as We,b as ot}from"./use-deep-compare-effect.esm-2b920fea.js";import{s as it}from"./NoSearchResults-79eea014.js";import{s as ct}from"./NoData-80d05b97.js";import{u as ut}from"./unCamelCase-ec1c2b3d.js";import{C as Q}from"./ColumnType-5116adf5.js";import{p as dt,q as mt,o as pt,i as ht,j as ft,n as yt,V as W,J as ue,x as gt,y as _t,w as Ct}from"./SynapseConstants-9d1f6e44.js";import{u as Ft}from"./useEntity-19872358.js";import{b as Nt}from"./useGetQueryResultBundle-00e2bfc0.js";import{p as St,a as bt}from"./sqlFunctions-177617cc.js";import{i as Ce,a as Fe,c as vt}from"./QueryFilter-ebe1b660.js";import{c as he}from"./cloneDeep-7188e6a3.js";import{i as Z}from"./isEqual-2709c6eb.js";import{D as A,E as ne}from"./ElementWithTooltip-7b6706fb.js";import{u as fe}from"./useGetInfoFromIds-bc74918b.js";import{I as Y,a as Et}from"./IconSvg-6905ab9a.js";import{u as wt}from"./uniqueId-4d05949d.js";import{R as Tt}from"./RadioGroup-2b4593e6.js";import{d as Le}from"./dayjs.min-e0adaab4.js";import{R as xt}from"./RangeSlider-d547757a.js";import{B as ye}from"./Box-2e3c1244.js";import{S as te}from"./Skeleton-cff63b1c.js";import{S as Vt}from"./Stack-e5639b81.js";import{c as It,P as Rt}from"./factory-76e91d33.js";import{r as kt}from"./react-sizeme-2217af01.js";import{g as qt}from"./ColorGradient-3d3e1969.js";import{l as Qt}from"./LoadingScreen-ded2c742.js";import{M as X}from"./Modal-6ffa84ac.js";import{B as Ge}from"./Button-7d415009.js";import{a as Lt}from"./Clear-a9f76abf.js";import{S as Pt}from"./SelectionCriteriaPill-6a475729.js";const At="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",Dt="org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",Ne=He(At),Ut=He(Dt),le=e=>a(te,{style:{...e.style,display:"inline-block"},...e});try{le.displayName="SkeletonInlineBlock",le.__docgenInfo={description:"Skeleton with a display value of `inline-block`. MUI applies `display: block` with high specificity, so it's easiest to just apply the style to the component.",displayName:"SkeletonInlineBlock",props:{animation:{defaultValue:{value:"'pulse'"},description:"The animation.\nIf `false` the animation effect is disabled.",name:"animation",required:!1,type:{name:'false | "pulse" | "wave"'}},children:{defaultValue:null,description:"Optional children to infer width and height from.",name:"children",required:!1,type:{name:"ReactNode"}},classes:{defaultValue:null,description:"Override or extend the styles applied to the component.",name:"classes",required:!1,type:{name:"(Partial<SkeletonClasses> & Partial<ClassNameMap<never>>)"}},height:{defaultValue:null,description:`Height of the skeleton.
Useful when you don't want to adapt the skeleton to a text element but for instance a card.`,name:"height",required:!1,type:{name:"string | number"}},sx:{defaultValue:null,description:"The system prop that allows defining system overrides as well as additional CSS styles.",name:"sx",required:!1,type:{name:"SxProps<Theme>"}},variant:{defaultValue:{value:"'text'"},description:"The type of content that will be rendered.",name:"variant",required:!1,type:{name:"enum",value:[{value:'"text"'},{value:'"rounded"'},{value:'"rectangular"'},{value:'"circular"'}]}},width:{defaultValue:null,description:`Width of the skeleton.
Useful when the skeleton is inside an inline element with no width of its own.`,name:"width",required:!1,type:{name:"string | number"}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"((instance: HTMLSpanElement | null) => void) | RefObject<HTMLSpanElement> | null"}}}}}catch{}const B=p.createContext(void 0),Se=({children:e,queryContext:t})=>a(B.Provider,{value:t,children:e});function U(){const e=p.useContext(B);if(e===void 0)throw new Error("useQueryContext must be used within a QueryWrapper");return e}function tn(){const e=p.useContext(B);if(e===void 0)throw new Error("usePaginatedQueryContext must be used within a QueryWrapper");return e}function an(){const e=p.useContext(B);if(e===void 0)throw new Error("useInfiniteQueryContext must be used within a QueryWrapper");return e}const Pe=B.Consumer;try{B.displayName="QueryContext",B.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryContext",props:{}}}catch{}try{Se.displayName="QueryContextProvider",Se.__docgenInfo={description:"Provides data related to a Synapse table query, and functions for iterating through pages of the data.",displayName:"QueryContextProvider",props:{queryContext:{defaultValue:null,description:"",name:"queryContext",required:!0,type:{name:"QueryContextType"}}}}}catch{}try{Pe.displayName="QueryContextConsumer",Pe.__docgenInfo={description:"",displayName:"QueryContextConsumer",props:{}}}catch{}function je(e,t){return`${e}${t}`}function Mt(e,t){const n=window.location.search,l=`${e}=${t}`;return n?n.includes(`${e}=`)?window.location.search.slice(n.indexOf("?")+1).split("&").map(o=>o.split("=")[0]===e?`${l}`:o).join("&"):`${n.substr(1)}&${l}`:l}function $t(e,t){if(!window.location.search)return;const n=je(e,t),r=window.location.search.slice(window.location.search.indexOf("?")+1).split("&").filter(s=>s.split("=")[0]===n).map(s=>s.split("=")[1])[0];return r?decodeURIComponent(r):void 0}function Bt(e,t,n){const l=t!==void 0?je(e,t):e,r=Mt(l,n),s=window.location,o=`${s.protocol}//${s.hostname}${s.port?":"+s.port:""}${s.pathname}?${r}`;window.history.replaceState("object or string","Title",o)}function Ht(e,t){const n=$t(e,t);let l;if(n){const r=JSON.parse(n);r.sql&&(l={concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:dt|mt|pt|ht|ft,entityId:St(r.sql),query:r})}return l}function Ot(e){const{initQueryRequest:t,componentIndex:n=0,shouldDeepLink:l=!1,onQueryChange:r}=e,[s,o]=p.useState(t);p.useEffect(()=>{const g=Ht("QueryWrapper",n);g&&o(g)},[n]);const c=p.useCallback(()=>he(s),[s]),d=p.useCallback(()=>he(t),[t]),i=p.useCallback(g=>{let F;typeof g=="function"?F=g(c()):F=g;const V=he(F);if(o(V),V.query){const S=JSON.stringify(V.query);if(l){const L=encodeURIComponent(S);Bt("QueryWrapper",n,L)}r&&r(S)}},[n,c,r,l]),{entityId:h,versionNumber:T}=p.useMemo(()=>bt(s.query.sql),[s.query.sql]),_=s.query.limit??yt,I=Math.ceil(((s.query.offset??0)+Number(_))/_),u=p.useCallback(g=>{i(F=>(F.query.limit=g,F))},[i]),C=p.useCallback(g=>{i(F=>(F.query.offset=(g-1)*_,F))},[_,i]),f=p.useCallback(()=>{i(t)},[t,i]);Ye(()=>{s!=t&&f()},[t]);const w=p.useCallback(g=>{i(F=>(F.query.selectedFacets=(F.query.selectedFacets??[]).filter(V=>!Z(V,g)),F))},[i]),y=p.useCallback((g,F)=>{i(V=>(V.query.selectedFacets=(V.query.selectedFacets??[]).map(S=>(Ne(S)&&Z(S,g)&&(S.facetValues=S.facetValues.filter(L=>L!==F)),S)).filter(S=>Ne(S)?Array.isArray(S.facetValues)&&S.facetValues.length>0:!0),V))},[i]),x=p.useCallback(g=>{i(F=>(F.query.additionalFilters=(F.query.additionalFilters??[]).filter(V=>!Z(V,g)),F))},[i]),N=p.useCallback((g,F)=>{i(V=>(V.query.additionalFilters=(V.query.additionalFilters??[]).map(S=>((Ce(S)||Fe(S))&&Z(S,g)&&(S.values=S.values.filter(L=>L!==F)),S)).filter(S=>Ce(S)||Fe(S)?Array.isArray(S.values)&&S.values.length>0:!0),V))},[i]);return{entityId:h,versionNumber:T,getInitQueryRequest:d,getLastQueryRequest:c,setQuery:i,pageSize:_,currentPage:I,setPageSize:u,goToPage:C,resetQuery:f,removeSelectedFacet:w,removeValueFromSelectedFacet:y,removeQueryFilter:x,removeValueFromQueryFilter:N}}const de="isShowingFacetFilters",me="isHidingFacetFilters";function Ae(e){const{initQueryRequest:t,onQueryChange:n,onQueryResultBundleChange:l,lockedColumn:r,componentIndex:s,shouldDeepLink:o}=e,[c,d]=p.useState(void 0),{entityId:i,versionNumber:h,getInitQueryRequest:T,getLastQueryRequest:_,setQuery:I,currentPage:u,pageSize:C,goToPage:f,setPageSize:w,resetQuery:y,removeSelectedFacet:x,removeValueFromSelectedFacet:N,removeQueryFilter:g,removeValueFromQueryFilter:F}=Ot({initQueryRequest:t,shouldDeepLink:o,componentIndex:s,onQueryChange:n}),V=p.useMemo(()=>_(),[_]),{data:S,isLoading:L,error:v,isPreviousData:R}=Nt(V,{keepPreviousData:!0},d),b=S==null?void 0:S.responseBody,k=L||R,{data:P}=Ft(i,h);We(()=>{b&&l&&l(JSON.stringify(b))},[b,l]);const J=b?lt(b.facets,b.selectColumns):!0,$=p.useMemo(()=>rt(b,r),[b,r]),z=p.useMemo(()=>{const O=_();return st(O.query,r)},[_,r]),K=p.useCallback(O=>{var pe;return((pe=b==null?void 0:b.columnModels)==null?void 0:pe.find(Ze=>Ze.name===O))??null},[b==null?void 0:b.columnModels]),E={data:$,currentPage:u,pageSize:C,setPageSize:w,isLoadingNewBundle:k,getLastQueryRequest:_,getInitQueryRequest:T,error:v,entity:P,executeQueryRequest:I,isFacetsAvailable:J,asyncJobStatus:c,goToPage:f,hasResettableFilters:z,removeSelectedFacet:x,removeValueFromSelectedFacet:N,resetQuery:y,removeQueryFilter:g,removeValueFromQueryFilter:F,lockedColumn:r,getColumnModel:K},{children:D}=e;return a(Se,{queryContext:E,children:a("div",{className:`SRC-wrapper ${k?"SRC-logo-cursor":""} ${J?"has-facets":""}`,children:D})})}try{Ae.displayName="QueryWrapper",Ae.__docgenInfo={description:"Component that manages the state of a Synapse table query. Data can be accessed via QueryContext using\neither `useQueryContext` or `QueryContextConsumer`.",displayName:"QueryWrapper",props:{initQueryRequest:{defaultValue:null,description:"",name:"initQueryRequest",required:!0,type:{name:"QueryBundleRequest"}},componentIndex:{defaultValue:null,description:"",name:"componentIndex",required:!1,type:{name:"number"}},shouldDeepLink:{defaultValue:null,description:"",name:"shouldDeepLink",required:!1,type:{name:"boolean"}},onQueryChange:{defaultValue:null,description:"",name:"onQueryChange",required:!1,type:{name:"((newQueryJson: string) => void)"}},onQueryResultBundleChange:{defaultValue:null,description:"",name:"onQueryResultBundleChange",required:!1,type:{name:"((newQueryResultBundleJson: string) => void)"}},lockedColumn:{defaultValue:null,description:"",name:"lockedColumn",required:!1,type:{name:"LockedColumn"}}}}}catch{}function zt(){return m(q,{children:[a("p",{className:"SRC-no-results-title",children:"There is currently no content here."}),a("p",{className:"SRC-no-results-description",children:"Information is always being updated, so check back later to see if content has been added."})]})}var ae=(e=>(e.INTERACTIVE="INTERACTIVE",e.STATIC="STATIC",e))(ae||{});function Yt(){return m("div",{className:"text-center",children:[it,a("h4",{children:"No Matching Results"}),a("p",{children:"Try checking the spelling or removing filters."})]})}function Wt(){return m("div",{className:"text-center SRCBorderedPanel SRCBorderedPanel--padded2x",children:[ct,a("div",{style:{marginTop:"20px",fontStyle:"italic"},children:"This table is currently empty"})]})}const Gt=()=>{try{return JSON.parse(sessionStorage.getItem(gt)||"")}catch{return[]}},jt=()=>{try{return JSON.parse(sessionStorage.getItem(_t)||"")}catch{return[]}},Jt=()=>{try{return JSON.parse(sessionStorage.getItem(Ct)||"")}catch{return[]}},Kt=e=>{const t=Gt().find(n=>n.id===e);return(t==null?void 0:t.name)??e},Zt=e=>{const t=Jt().find(n=>n.id===e);return(t==null?void 0:t.name)||e},Xt=e=>{const t=jt().find(n=>n.ownerId===e);return(t==null?void 0:t.userName)||e},ea=(e,t)=>{if(e===W)return ue;switch(t){case Q.ENTITYID:case Q.ENTITYID_LIST:return Kt(e);case Q.USERID:case Q.USERID_LIST:return Xt(e);case Q.EVALUATIONID:return Zt(e);default:return e}},G=p.createContext(void 0),be=({children:e,queryVisualizationContext:t})=>a(G.Provider,{value:t,children:e});function M(){const e=p.useContext(G);if(e===void 0)throw new Error("useQueryVisualizationContext must be used within a QueryWrapper");return e}const De=G.Consumer;function Ue(e){const{noContentPlaceholderType:t=ae.INTERACTIVE}=e,{data:n,getLastQueryRequest:l,isFacetsAvailable:r,isLoadingNewBundle:s,hasResettableFilters:o}=U(),{columnAliases:c={}}=e,[d,i]=p.useState({showColumnFilter:!0,showFacetFilter:!0,showFacetVisualization:e.defaultShowFacetVisualization??!0,showSearchBar:e.defaultShowSearchBar??!1,showDownloadConfirmation:!1,showColumnSelectDropdown:!1,showSqlEditor:!1});p.useEffect(()=>{r||i(N=>({...N,showFacetFilter:!1,showFacetVisualization:!1}))},[r]),p.useEffect(()=>{s&&I([])},[s]);const[h,T]=p.useState([]),[_,I]=p.useState([]),u=l(),C=ot(n==null?void 0:n.selectColumns);p.useEffect(()=>{T((C==null?void 0:C.slice(0,e.visibleColumnCount??1/0).map(N=>N.name))??[])},[C,u.query.sql,e.visibleColumnCount]);const f=p.useCallback(N=>{const g=localStorage.getItem("force-display-original-column-names")==="true";return!N||g?N:c[N]?c[N]:ut(N)},[c]),w=p.useCallback(()=>{switch(t){case ae.INTERACTIVE:return o?a(Yt,{}):a(Wt,{});case ae.STATIC:default:return a(zt,{})}},[t,o]),y={topLevelControlsState:d,setTopLevelControlsState:i,columnsToShowInTable:h,setColumnsToShowInTable:T,selectedRowIndices:_,setSelectedRowIndices:I,rgbIndex:e.rgbIndex,unitDescription:e.unitDescription,showLastUpdatedOn:e.showLastUpdatedOn,getColumnDisplayName:f,getDisplayValue:ea,NoContentPlaceholder:w},{children:x}=e;return a(be,{queryVisualizationContext:y,children:x})}try{Ue.displayName="QueryVisualizationWrapper",Ue.__docgenInfo={description:`QueryVisualizationWrapper manages UI state for components that query tables in Synapse. That state can be accessed
or updated using QueryVisualizationContext. A QueryVisualizationWrapper must be used within a QueryWrapper.`,displayName:"QueryVisualizationWrapper",props:{rgbIndex:{defaultValue:null,description:"",name:"rgbIndex",required:!1,type:{name:"number"}},unitDescription:{defaultValue:null,description:"",name:"unitDescription",required:!1,type:{name:"string"}},columnAliases:{defaultValue:null,description:"Mapping from column name to the name that should be shown for the column",name:"columnAliases",required:!1,type:{name:"Record<string, string>"}},visibleColumnCount:{defaultValue:null,description:"",name:"visibleColumnCount",required:!1,type:{name:"number"}},hiddenColumns:{defaultValue:null,description:"",name:"hiddenColumns",required:!1,type:{name:"string[]"}},defaultShowFacetVisualization:{defaultValue:null,description:"",name:"defaultShowFacetVisualization",required:!1,type:{name:"boolean"}},defaultShowSearchBar:{defaultValue:null,description:"",name:"defaultShowSearchBar",required:!1,type:{name:"boolean"}},showLastUpdatedOn:{defaultValue:null,description:"",name:"showLastUpdatedOn",required:!1,type:{name:"boolean"}},noContentPlaceholderType:{defaultValue:null,description:"Default is INTERACTIVE",name:"noContentPlaceholderType",required:!1,type:{name:"enum",value:[{value:'"INTERACTIVE"'},{value:'"STATIC"'}]}}}}}catch{}try{G.displayName="QueryVisualizationContext",G.__docgenInfo={description:"This must be exported to use the context in class components.",displayName:"QueryVisualizationContext",props:{}}}catch{}try{be.displayName="QueryVisualizationContextProvider",be.__docgenInfo={description:"Provides fields and functions related to visualizing a Synapse table query. For actual query data, see QueryContextProvider.",displayName:"QueryVisualizationContextProvider",props:{queryVisualizationContext:{defaultValue:null,description:"",name:"queryVisualizationContext",required:!0,type:{name:"QueryVisualizationContextType"}}}}}catch{}try{De.displayName="QueryVisualizationContextConsumer",De.__docgenInfo={description:"",displayName:"QueryVisualizationContextConsumer",props:{}}}catch{}const Me=()=>{const{error:e}=U();return a(Xe,{error:e})};try{Me.displayName="QueryWrapperErrorBanner",Me.__docgenInfo={description:"Error banner that automatically pulls the error from QueryContext.",displayName:"QueryWrapperErrorBanner",props:{}}}catch{}const re=e=>{const{checked:t=!1,hideLabel:n=!1,isSelectAll:l=!1,disabled:r=!1}=e,[s,o]=p.useState(t),[c]=p.useState(wt("src-checkbox-"));p.useEffect(()=>{o(t)},[t]);const d=h=>{e.onChange(h.target.checked),l&&h.target.checked===!1?o(!0):o(h.target.checked)};let i="checkbox";return e.className&&(i+=` ${e.className}`),m("div",{className:i,onClick:e.onClick,children:[a("input",{"aria-label":e.label,type:"checkbox",checked:s,id:c,onChange:d,disabled:r,"data-testid":e["data-testid"]}),a("label",{htmlFor:c,children:n?a(q,{}):e.label}),e.children??a(q,{})]})};try{re.displayName="Checkbox",re.__docgenInfo={description:"",displayName:"Checkbox",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},hideLabel:{defaultValue:null,description:"",name:"hideLabel",required:!1,type:{name:"boolean"}},checked:{defaultValue:null,description:"",name:"checked",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: boolean) => void"}},isSelectAll:{defaultValue:null,description:"",name:"isSelectAll",required:!1,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((event: SyntheticEvent<HTMLDivElement, Event>) => void)"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},"data-testid":{defaultValue:null,description:"",name:"data-testid",required:!1,type:{name:"string"}}}}}catch{}const ve=e=>m("svg",{...e,className:`Icon-Plus ${e.className??""}`,width:"15",height:"14",viewBox:"0 0 15 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 8H8.38867V14H6.38867V8H0.388672V6H6.38867V0H8.38867V6H14.3887V8Z"})]});try{ve.displayName="IconPlus",ve.__docgenInfo={description:"",displayName:"IconPlus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const Ee=e=>m("svg",{...e,className:`Icon-Minus ${e.className??""}`,width:"15",height:"2",viewBox:"0 0 15 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.title&&a("title",{children:e.title}),a("path",{d:"M14.3887 2H8.38867H6.38867H0.388672V0H6.38867H8.38867H14.3887V2Z"})]});try{Ee.displayName="IconMinus",Ee.__docgenInfo={description:"",displayName:"IconMinus",props:{title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"string"}}}}}catch{}const se=({label:e,isCollapsed:t,onClick:n})=>{const{getColumnDisplayName:l}=M();return m("div",{className:"FacetFilterHeader",children:[a("label",{className:"FacetFilterHeader__label",children:l(e)}),a("button",{className:"FacetFilterHeader__collapseToggleBtn",onClick:()=>n(!t),children:t?a(ve,{className:"icon-plus",title:"Expand Menu"}):a(Ee,{className:"icon-minus",title:"Collapse Menu"})})]})};try{se.displayName="FacetFilterHeader",se.__docgenInfo={description:"",displayName:"FacetFilterHeader",props:{label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},isCollapsed:{defaultValue:null,description:"",name:"isCollapsed",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"(newValue: boolean) => void"}}}}}catch{}function ta(e){return e.replace(/\s/g,"").toLowerCase()}function $e(e,t=[],n=[],l=[]){const{value:r}=e;let s=r;r===W&&(s=ue);const o=t.find(i=>i.ownerId===r);o&&(s=o?o.userName:`unknown (${r})`);const c=n.find(i=>i.id===r);c&&(s=c?c.name:`unknown (${r})`);const d=l.find(i=>i.id===r);return d!=null&&d.name&&(s=d.name),`${s}`}function aa(e,t,n){const l=[...e.sort((r,s)=>s.count-r.count)];return t||l.length<=n||l.slice(n).find(r=>r.isSelected)?l:l.splice(0,n)}const j=({facetValues:e,columnModel:t,onClear:n,onChange:l,containerAs:r="Collapsible",dropdownType:s="Icon",collapsed:o=!1})=>{const[c,d]=p.useState(!1),[i,h]=p.useState(o),[T,_]=p.useState(!1),[I,u]=p.useState(!1),[C,f]=p.useState(""),[w,y]=p.useState(e);Ye(()=>{y(e)},[e]);const x=5,N=1500,g=qe.createRef(),F={};let V;const S=e.filter(E=>E.isSelected).length===0,L=(t==null?void 0:t.columnType)===Q.USERID||(t==null?void 0:t.columnType)===Q.USERID_LIST?e.map(E=>E.value):[],v=fe({ids:L,type:"USER_PROFILE"}),R=(t==null?void 0:t.columnType)===Q.ENTITYID||(t==null?void 0:t.columnType)===Q.ENTITYID_LIST?e.map(E=>E.value):[],b=fe({ids:R,type:"ENTITY_HEADER"}),k=(t==null?void 0:t.columnType)===Q.EVALUATIONID?e.map(E=>E.value):[],P=fe({ids:k,type:"EVALUATION_QUEUE"}),J=E=>{const D=E.target.value;if(f(D),d(!0),!D)e.forEach(H=>{H.isSelected=!1}),y(e);else{const H=e.filter(O=>$e(O,v,b,P).toLowerCase().indexOf(D.trim().toLowerCase())>-1?O:null);y(H)}};if(!t)return a(q,{});const $=r==="Dropdown",z=m("div",{className:$?"EnumFacetFilter__dropdown_menu":"",children:[m("div",{className:"EnumFacetFilter__checkboxContainer--forAll",children:[m("div",{className:I?"EnumFacetFilter__search active":"EnumFacetFilter__search",children:[a("button",{className:"EnumFacetFilter__closeSearch",onClick:()=>{y(e),u(!1),d(!1)},children:a("span",{className:"EnumFacetFilter__previous",children:a(Y,{icon:"arrowBack"})})}),C.length>0&&a("button",{className:"EnumFacetFilter__resetSearch",onClick:()=>{var E;f(""),(E=g.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__reset",children:a(Y,{icon:"close"})})}),a("input",{type:"text",placeholder:"Find values",value:C,ref:g,onChange:E=>{J(E)}})]}),!I&&m("div",{className:"EnumFacetFilter__checkAll",children:[a(re,{className:"EnumFacetFilter__checkbox",onChange:()=>{n()},checked:S,label:"All",isSelectAll:!0},"select_all"),a("button",{className:"EnumFacetFilter__searchbtn",onClick:()=>{var E;f(""),u(!0),(E=g.current)==null||E.focus()},children:a("span",{className:"EnumFacetFilter__searchicon",children:a(Y,{icon:"search"})})})]})]}),m("div",{children:[w.length>0&&aa(w,c||$,x).map((E,D)=>a(na,{id:ta(E.value),index:D,label:$e(E,v,b,P),count:E.count,isDropdown:$,initialIsSelected:E.isSelected,onChange:H=>{F[E.value]=H,clearTimeout(V),V=setTimeout(()=>{l(F),_(!1)},N)}},`checkLabel${D}`)),!$&&m(q,{children:[!c&&w.length>x&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!0),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:m("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:["Show all (",w.length,")"]})})}),c&&w.length>x&&a("button",{className:"EnumFacetFilter__showMoreFacetsBtn",onClick:()=>d(!1),children:a("div",{className:"EnumFacetFilter__checkboxContainer",children:a("div",{className:"EnumFacetFilter__showMoreFacetsLabel",children:"Show less"})})})]}),w.length<=0&&a("div",{className:"EnumFacetFilter__noMatch",children:"No match found"})]})]}),K=()=>_(!T);return $?s==="SelectBox"?m(A,{className:"EnumFacetFilter EnumFacetFilterSelect",show:T,onToggle:K,children:[m(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:[S&&"All",!S&&e.filter(E=>E.isSelected).length===1&&e.filter(E=>E.isSelected)[0].value,!S&&e.filter(E=>E.isSelected).length>1&&"Multiple Values Selected"]}),a(A.Menu,{children:z})]}):m(A,{className:"EnumFacetFilter",show:T,onToggle:K,children:[a(ne,{tooltipText:"Filter by specific facet",darkTheme:!1,icon:"filter"},"facetFilterTooltip"),a(A.Menu,{children:z})]}):m(q,{children:[a(se,{isCollapsed:i,label:t.name,onClick:E=>h(E)}),a(Oe,{className:"EnumFacetFilter",in:!i,children:z})]})};function na({id:e,index:t,label:n,count:l,isDropdown:r,initialIsSelected:s,onChange:o}){const[c,d]=p.useState(s);return qe.useEffect(()=>{d(s)},[s]),m("div",{className:"EnumFacetFilter__checkboxContainer",onClick:()=>{r&&(d(!c),o(!c))},children:[a(re,{className:"EnumFacetFilter__checkbox",onClick:i=>i.stopPropagation(),onChange:i=>{d(i),o(i)},checked:c,label:n},`${e}-${t}`),r&&m("span",{className:"EnumFacetFilter__count",children:["(",l,")"]}),!r&&a("div",{className:"EnumFacetFilter__count",children:l})]})}try{j.displayName="EnumFacetFilter",j.__docgenInfo={description:"*********** QUERY ENUM CONMPONENT  ************",displayName:"EnumFacetFilter",props:{facetValues:{defaultValue:null,description:"",name:"facetValues",required:!0,type:{name:"FacetColumnResultValueCount[]"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(facetNamesMap: Record<string, string>) => void"}},onClear:{defaultValue:null,description:"",name:"onClear",required:!0,type:{name:"() => void"}},containerAs:{defaultValue:{value:"Collapsible"},description:"",name:"containerAs",required:!1,type:{name:"enum",value:[{value:'"Collapsible"'},{value:'"Dropdown"'}]}},dropdownType:{defaultValue:{value:"Icon"},description:"",name:"dropdownType",required:!1,type:{name:"enum",value:[{value:'"Icon"'},{value:'"SelectBox"'}]}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const we=({facet:e,isChecked:t,onClick:n})=>{const{getColumnDisplayName:l}=M();return m("button",{className:`Chip ${t?"Checked":""}`,onClick:n,children:[l(e.columnName),a(Y,{icon:t?"check":"add",sx:{width:"14px",paddingLeft:"0.2rem"}})]})};try{we.displayName="FacetChip",we.__docgenInfo={description:"",displayName:"FacetChip",props:{facet:{defaultValue:null,description:"",name:"facet",required:!0,type:{name:"FacetColumnResult"}},isChecked:{defaultValue:null,description:"",name:"isChecked",required:!0,type:{name:"boolean"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}const Te=e=>{const t="Min value should be less then max value",[n,l]=p.useState(!1),[r,s]=p.useState(()=>e.type==="number"&&e.initialValues?e.initialValues:e.initialValues&&{min:Le(e.initialValues.min).format("YYYY-MM-DD"),max:Le(e.initialValues.max).format("YYYY-MM-DD")}||{min:void 0,max:void 0}),o=e.className?`range ${e.className}`:"range",c=({min:i,max:h},T="number")=>{if(i==null||h===null||h===void 0)return l(!1),!0;if(T==="number"){if(Number(i)>Number(h))return l(!0),!1}else if(Date.parse(i)>Date.parse(h))return l(!0),!1;return l(!1),!0},d=(i,h,T="number")=>{c(i,T)&&h(i)};return m("div",{className:o,style:{display:"flex",flexWrap:"wrap"},children:[m("div",{style:{marginRight:"10px"},children:[a("input",{"aria-label":"min",type:e.type,value:r.min,onChange:({target:i})=>s({min:i.value,max:r.max})},"range_min"),a("div",{children:"to"}),a("input",{"aria-label":"max",type:e.type,value:r.max,onChange:({target:i})=>s({min:r.min,max:i.value})},"range_max")]}),a("button",{className:"btn btn-link SRC-noPadding",onClick:()=>d(r,e.onChange,e.type),children:"Apply"}),n&&a("div",{className:"SRC-danger-color",children:e.errorText||t})]})};try{Te.displayName="Range",Te.__docgenInfo={description:"",displayName:"Range",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"number"'},{value:'"date"'}]}},initialValues:{defaultValue:null,description:"",name:"initialValues",required:!1,type:{name:"RangeValues<string | number>"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},errorText:{defaultValue:null,description:"",name:"errorText",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValues: RangeValues<string | number>) => void"}}}}}catch{}const xe=({facetResult:e,columnModel:t,onChange:n,collapsed:l=!1})=>{const[r,s]=p.useState(l),o=[{label:ue,value:"org.sagebionetworks.UNDEFINED_NULL_NOTSET"},{label:"Any",value:""},{label:"Range",value:"RANGE"}];let{columnMin:c,columnMax:d,selectedMin:i,selectedMax:h}=e;const T=!i&&!h;i=i||c,h=h||d;const _=t.columnType==="DOUBLE"?"number":"date",I=(y,x)=>x?"":y===W?"org.sagebionetworks.UNDEFINED_NULL_NOTSET":"RANGE",u=(y,x)=>{f(y),y!=="RANGE"&&x([y,y])},[C,f]=p.useState(I(i,T));return m("div",{children:[a(se,{isCollapsed:r,label:t.name,onClick:y=>s(y)}),m(Oe,{in:!r,children:[a(Tt,{value:C,id:"rangeSelector",options:o,onChange:y=>u(y,n)}),C==="RANGE"&&(c===d?a("label",{children:d}):m(q,{children:[t.columnType==="INTEGER"&&m(xt,{domain:[c,d],initialValues:{min:i,max:h},step:1,doUpdateOnApply:!0,onChange:y=>n([y.min,y.max]),children:[") ",">"]},"RangeSlider"),(t.columnType==="DATE"||t.columnType==="DOUBLE")&&a(Te,{initialValues:{min:i,max:h},type:_,onChange:y=>n([y.min,y.max])},"Range")]}))]})]})};try{xe.displayName="RangeFacetFilter",xe.__docgenInfo={description:"",displayName:"RangeFacetFilter",props:{facetResult:{defaultValue:null,description:"",name:"facetResult",required:!0,type:{name:"FacetColumnResultRange"}},columnModel:{defaultValue:null,description:"",name:"columnModel",required:!0,type:{name:"SelectColumn"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(range: (string | number | undefined)[]) => void"}},collapsed:{defaultValue:{value:"false"},description:"",name:"collapsed",required:!1,type:{name:"boolean"}}}}}catch{}const Je=e=>({concreteType:"org.sagebionetworks.repo.model.table.FacetColumnValuesRequest",columnName:e.columnName,facetValues:e.facetValues.filter(t=>t.isSelected).map(t=>t.value)}),la=e=>{let t={concreteType:"org.sagebionetworks.repo.model.table.FacetColumnRangeRequest",columnName:e.columnName};return e.columnMin&&(t={...t,min:e.columnMin,max:e.columnMax}),t},Qe=(e,t)=>{var s;const n=((s=t==null?void 0:t.query)==null?void 0:s.selectedFacets)??[],l=n.findIndex(o=>o.columnName===e.columnName),r=e.concreteType==="org.sagebionetworks.repo.model.table.FacetColumnValuesRequest"&&(!e.facetValues||!e.facetValues.length);return l>-1?r?n.splice(l,1):n[l]=e:n.push(e),n};function oe(e,t,n,l,r=!1){l?t.facetValues.forEach(c=>{c.value===l&&(c.isSelected=r)}):t.facetValues.forEach(c=>{c.isSelected=!1});const s=Je(t),o=Qe(s,e);n(o)}const Ve=(e,t,n,l)=>{const r=l&&Object.keys(l)||[];r.length&&t.facetValues.forEach(c=>{r.includes(c.value)&&(c.isSelected=l?!!l[c.value]:!1)});const s=Je(t),o=Qe(s,e);n(o)},ra=(e,t,n,l)=>{t.columnMin=l[0],t.columnMax=l[1];const r=la(t),s=Qe(r,e);n(s)};function ie(e,t){const n=(t??[]).map(l=>l.columnName);return new Set([...e.slice(0,3).map(l=>l.columnName),...n])}function ee(){const e=m(Vt,{direction:"row",gap:"10px",sx:{my:1},children:[a(te,{width:"15px"}),a(te,{width:"40%"})]});return m(ye,{className:"FacetFilterControls__facet",children:[a(ye,{className:"FacetFilterHeader",children:a(te,{width:"100%"})}),m(ye,{children:[e,e,e]})]})}function sa(){const{topLevelControlsState:e}=M(),{showFacetFilter:t}=e;return m("div",{className:`FacetFilterControls ${t?de:me}`,children:[a(ee,{}),a(ee,{}),a(ee,{}),a(ee,{})]})}function Ie(e){const{availableFacets:t}=e,{data:n,getLastQueryRequest:l,executeQueryRequest:r}=U(),s=l(),o=n.facets.filter(u=>t==null||t.includes(u.columnName)).filter(u=>!ze(u)),[c,d]=qe.useState(ie(o,s.query.selectedFacets)),{topLevelControlsState:i}=M(),{showFacetFilter:h}=i;We(()=>{d(ie(o,s.query.selectedFacets))},[o]);const T=n.selectColumns,_=u=>{const C=l();C.query.selectedFacets=u,C.query.offset=0,r(C)},I=u=>{const C=new Set(c);C.has(u.columnName)?C.delete(u.columnName):C.add(u.columnName),d(C)};return m("div",{className:`FacetFilterControls ${h?de:me}`,children:[(o??[]).filter(u=>c.has(u.columnName)).map(u=>{const C=T.find(f=>f.name===u.columnName);return m("div",{className:"FacetFilterControls__facet",children:[u.facetType==="enumeration"&&C&&a(j,{containerAs:"Collapsible",collapsed:!1,facetValues:u.facetValues,columnModel:C,onChange:f=>Ve(s,u,_,f),onClear:()=>oe(s,u,_)}),u.facetType==="range"&&C&&a(xe,{facetResult:u,columnModel:C,collapsed:!1,onChange:f=>ra(s,u,_,f)})]},u.columnName)}),m("div",{children:[a("div",{className:"AvailableFacet",children:a("label",{className:"AvailableFacet__label",children:"Available Facets"})}),o.map(u=>a(we,{facet:u,onClick:()=>I(u),isChecked:c.has(u.columnName)},u.columnName))]})]})}function nn(e){const{data:t,isLoadingNewBundle:n}=U();return n?a(sa,{}):t==null||t.facets==null?a(q,{}):a(Ie,{...e})}try{ie.displayName="getDefaultShownFacetFilters",ie.__docgenInfo={description:`Determines which facet filters should be shown after loading a new bundle. The shown facets will be the first
three available facets, plus any other facets that have a filter applied.`,displayName:"getDefaultShownFacetFilters",props:{}}}catch{}try{Ie.displayName="FacetFilterControls",Ie.__docgenInfo={description:"",displayName:"FacetFilterControls",props:{availableFacets:{defaultValue:null,description:"",name:"availableFacets",required:!1,type:{name:"string[]"}}}}}catch{}const oa=It(Rt),ia=19,ca=30,ua={showlegend:!1,annotations:[],margin:{l:0,r:0,b:0,t:0,pad:0},yaxis:{visible:!1,showgrid:!1},xaxis:{visible:!1,showgrid:!1}},da=(e,t)=>{t=t||0;let n=(Math.round(100*e*Math.pow(10,t))*Math.pow(.1,t)).toFixed(t)+"%";for(let l=0;l<t;l++)n.indexOf(".")!==-1&&(n=n.replace("0%","%"),n=n.replace(".%","%"));return n};function Ke(e,t){if(!e)return e;const n=e.trim();return n.length>t?n.substr(0,t-1)+"…":e}async function ma(e,t,n,l,r){var u,C;const{colorPalette:s}=qt(n,e.facetValues.length),o=async(f,w,y)=>{const x=new Map;x.set(W,ue);const N=f.map(g=>g.value).filter(g=>g!==W);if(w===Q.ENTITYID||w===Q.ENTITYID_LIST){const g=await at(N,y);for(const F of g.results)x.set(F.id,F.name)}else if(w===Q.USERID||w===Q.USERID_LIST){const g=await nt(N,y);for(const F of g.children)x.set(F.ownerId,F.userName)}return f.map(g=>({facet:g,label:c(g,!1,x),truncatedLabel:c(g,!0,x),count:g.count}))},c=(f,w,y)=>{let x=y.get(f.value)??f.value;return w&&(x=Ke(x,ia)),x},d=await o(e.facetValues,t,r),i=d.map(f=>f.truncatedLabel),T=e.facetValues.some(f=>f.isSelected)?e.facetValues.map((f,w)=>f.isSelected?s[w]:s[w].replace("rgb(","rgba(").replace(")",", 0.25)")):s,_={values:l==="PIE"?e.facetValues.map(f=>f.count):void 0,labels:d.map(f=>f.label),text:i,x:l==="BAR"?e.facetValues.map(f=>{var w;return((w=d.find(y=>y.facet===f))==null?void 0:w.label)??f.value}):void 0,y:l==="BAR"?e.facetValues.map(f=>f.count):void 0,facetEnumerationValues:e.facetValues.map(f=>f.value),name:e.columnName,hovertemplate:l==="PIE"?"<b>%{text}</b><br>%{value} (%{percent})<br><extra></extra>":"<b>%{text}: </b><br>%{value} <br><extra></extra>",textinfo:"none",type:l==="PIE"?"pie":"bar",pull:l==="PIE"?e.facetValues.map(f=>f.isSelected?.1:0):void 0,marker:{colors:l==="PIE"?T:void 0,color:l==="BAR"?T:void 0}};return{data:[_],labels:d,colors:l==="PIE"?(u=_.marker)==null?void 0:u.colors:(C=_.marker)==null?void 0:C.color}}const pa=(e,t,n)=>{if(e.points&&e.points[0]){const l=e.points[0],r=l.data.facetEnumerationValues[l.pointNumber],s=t.facetValues.find(o=>o.value===r);n(t,s,!s.isSelected)}};function ha(e,t,n){const r=e?e*(t==="BAR"?.8:.6):200;let s=t==="PIE"?r:r/3;return s>n&&(s=n),{width:`${r}px`,height:`${s}px`}}function Re(e){const{labels:t,colors:n=[],isExpanded:l}=e;if(!t)return a(q,{});const r=l?Math.min(t.length,9):Math.min(t.length,3);if(r===0)return a(q,{});const s=t.reduce((o,c)=>o+c.count,0);return a("div",{className:`FacetNavPanel__body__legend${l?"--expanded":""}`,children:t.slice(0,r).map((o,c)=>{const i=`(${da(o.count/s,1)}) ${o.label}`,h=Ke(i,ca);return a(ne,{tooltipText:o.label,children:m("div",{className:"FacetNavPanel__body__legend__row",style:{cursor:"default"},children:[a("div",{style:{backgroundColor:n[c]}}),a("label",{children:h})]},`legendLabel_${c}`)},o.label)})})}const fa=(e,t)=>e?`FacetNavPanel__body__plot--expanded${t==="BAR"?"Bar":"Pie"}`:"FacetNavPanel__body__plot",ce=e=>{const{onHide:t,isModalView:n,applyChangesToFacetFilter:l,applyChangesToGraphSlice:r,index:s,facetToPlot:o,plotType:c,onSetPlotType:d}=e,{accessToken:i}=et(),{data:h,isLoadingNewBundle:T,getLastQueryRequest:_}=U(),{getColumnDisplayName:I}=M(),[u,C]=p.useState(!1),f=I(o.columnName),w=p.useCallback(()=>{var N,g;return(g=(N=h==null?void 0:h.columnModels)==null?void 0:N.find(F=>F.name===o.columnName))==null?void 0:g.columnType},[h,o.columnName]),{data:y}=tt(["extractPlotDataArray",o,w(),s,c,i],()=>ma(o,w(),s,c,i),{enabled:!!o}),x=()=>m("div",{onClick:N=>{N.stopPropagation()},className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Chart Type"}),m(A,{children:[a(A.Toggle,{className:"secondary-caret",variant:"gray-select",children:c==="PIE"?"Pie Chart":"Bar Chart"}),m(A.Menu,{className:"chart-tools",children:[a(A.Item,{as:"button",onClick:()=>d("BAR"),children:"Bar Chart"}),a(A.Item,{as:"button",onClick:()=>d("PIE"),children:"Pie Chart"})]})]})]});return!h&&T||!o?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:Qt}):m(q,{children:[m(X,{animation:!1,show:u,onHide:()=>C(!1),backdrop:"static",children:[a(X.Header,{closeButton:!0,children:a(X.Title,{children:f??""})}),m(X.Body,{children:[a(ce,{...e,isModalView:!0}),a("div",{className:"bootstrap-4-backport SaveFiltersButtonContainer",children:a(Ge,{variant:"secondary",className:"SaveFiltersButton",onClick:()=>C(!1),children:"Apply Filters"})})]})]}),m("div",{role:"graphics-document",className:`FacetNavPanel${n?"--expanded":""}`,children:[!n&&m("div",{className:"FacetNavPanel__title",children:[!h&&T?a(le,{width:100}):a("span",{className:"FacetNavPanel__title__name",children:f}),m("div",{className:"FacetNavPanel__title__tools",children:[a(j,{facetValues:o.facetValues,columnModel:h==null?void 0:h.columnModels.find(N=>N.name===o.columnName),onChange:N=>{Ve(_(),o,l,N)},onClear:()=>{oe(_(),o,l)},containerAs:"Dropdown"}),a(ne,{tooltipText:"Expand to large graph",callbackFn:()=>C(!0),className:"SRC-primary-color",darkTheme:!1,icon:"expand"},"expandGraph"),a(ne,{tooltipText:"Hide graph under Show More",callbackFn:()=>t(),className:"SRC-primary-color",darkTheme:!1,icon:"close"},"hideGraph")]})]}),n&&m(q,{children:[m("div",{className:"bootstrap-4-backport SRC-labeled-dropdown",children:[a("span",{className:"SRC-labeled-dropdown__label",children:"Filter All Data By"}),a(j,{facetValues:o.facetValues,columnModel:h==null?void 0:h.columnModels.find(N=>N.name===o.columnName),onChange:N=>{Ve(_(),o,l,N)},onClear:()=>{oe(_(),o,l)},containerAs:"Dropdown",dropdownType:"SelectBox"}),a(Lt,{title:"Selecting items in this dropdown will affect all facets on the Explore page.",children:a(Et,{className:"SRC-hand-cursor SRC-secondary-text-color"})})]}),a(x,{})]}),m("div",{className:`FacetNavPanel__body${n?"--expanded":""}`,role:"graphics-object",children:[a(kt.SizeMe,{monitorHeight:!0,children:({size:N})=>a("div",{className:fa(n,c),children:a(oa,{layout:ua,data:(y==null?void 0:y.data)??[],style:ha(N.width,c,n?300:150),config:{displayModeBar:!1},onClick:g=>pa(g,o,r)},`${o.columnName}-${c}-${N.width}`)})}),a(Re,{labels:y==null?void 0:y.labels,colors:y==null?void 0:y.colors,isExpanded:n})]})]})]})};try{Re.displayName="FacetPlotLegend",Re.__docgenInfo={description:"",displayName:"FacetPlotLegend",props:{labels:{defaultValue:null,description:"",name:"labels",required:!1,type:{name:"FacetWithLabel[]"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"string[]"}},isExpanded:{defaultValue:null,description:"",name:"isExpanded",required:!0,type:{name:"boolean"}}}}}catch{}try{ce.displayName="FacetNavPanel",ce.__docgenInfo={description:"",displayName:"FacetNavPanel",props:{applyChangesToGraphSlice:{defaultValue:null,description:"",name:"applyChangesToGraphSlice",required:!0,type:{name:"(facet: FacetColumnResultValues, value: FacetColumnResultValueCount | undefined, isSelected: boolean) => void"}},applyChangesToFacetFilter:{defaultValue:null,description:"",name:"applyChangesToFacetFilter",required:!0,type:{name:"(facets: FacetColumnRequest[]) => void"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},facetToPlot:{defaultValue:null,description:"",name:"facetToPlot",required:!0,type:{name:"FacetColumnResultValues"}},plotType:{defaultValue:null,description:"",name:"plotType",required:!0,type:{name:"enum",value:[{value:'"PIE"'},{value:'"BAR"'}]}},onSetPlotType:{defaultValue:null,description:"",name:"onSetPlotType",required:!0,type:{name:"(plotType: PlotType) => void"}},onHide:{defaultValue:null,description:"",name:"onHide",required:!0,type:{name:"() => void"}},isModalView:{defaultValue:null,description:"",name:"isModalView",required:!0,type:{name:"boolean"}},onCloseModal:{defaultValue:null,description:"",name:"onCloseModal",required:!1,type:{name:"(() => void)"}}}}}catch{}function ya(e,t,n){const l=t.getColumnModel(e.columnName);return e.values.map(r=>{let s=r;r!=null&&r.startsWith("%")&&(r!=null&&r.endsWith("%"))&&(s=s.substring(1,s.length-1)),s=n.getDisplayValue(s,l.columnType);const o=`${e.columnName}: ${s}`;return{key:`queryFilter-${e.concreteType}-${e.columnName}-${r}`,innerText:o,tooltipText:o,onRemoveFilter:()=>{t.removeValueFromQueryFilter(e,r)}}})}function ga(e,t){return{key:`queryFilter-${e.concreteType}-${e.searchExpression}`,innerText:e.searchExpression,tooltipText:`Text matches: "${e.searchExpression}"`,onRemoveFilter:()=>{t.removeQueryFilter(e)}}}function _a(e,t,n){var l;return Ce(e)||Fe(e)?e.columnName===((l=t.lockedColumn)==null?void 0:l.columnName)?[]:ya(e,t,n):vt(e)?[ga(e,t)]:(console.log("Unknown query filter type",e.concreteType),[])}function Ca(e,t,n){var o;if(e.columnName===((o=t.lockedColumn)==null?void 0:o.columnName))return[];const l=t.getColumnModel(e.columnName),{getColumnDisplayName:r,getDisplayValue:s}=n;if(Ne(e))return e.facetValues.map(c=>{const d=s(c,l.columnType);return{key:`facet-${e.concreteType}-${e.columnName}-${c}`,innerText:d,tooltipText:`${r(e.columnName)}: ${d}`,onRemoveFilter:()=>{t.removeValueFromSelectedFacet(e,c)}}});if(Ut(e)){const c=`${e.min} - ${e.max}`;return[{key:`facet-${e.concreteType}-${e.columnName}-${e.min}-${e.max}`,innerText:c,tooltipText:`${r(e.columnName)}: ${c}`,onRemoveFilter:()=>{t.removeSelectedFacet(e)}}]}else return console.log("Unknown facet type",e.concreteType),[]}function Fa(){var c;const e=U(),t=M(),{getLastQueryRequest:n}=e,l=n(),r=(((c=l.query)==null?void 0:c.additionalFilters)??[]).flatMap(d=>_a(d,e,t)),s=(l.query.selectedFacets??[]).flatMap(d=>Ca(d,e,t)),o=[...r,...s];return a(q,{children:o.map(d=>{const i=encodeURIComponent(d.key);return p.createElement(Pt,{...d,key:i})})})}function ke(e){const{style:t,frontText:n,endText:l="",hideIfUnfiltered:r=!1}=e,{data:s,isLoadingNewBundle:o,resetQuery:c,error:d,hasResettableFilters:i}=U(),{topLevelControlsState:h,unitDescription:T}=M(),_=s==null?void 0:s.queryCount,I=h==null?void 0:h.showFacetFilter,u=i;return d?a(q,{}):a("div",{className:`TotalQueryResults ${I?de:me} ${i?"hasFilters":""}`,style:t,children:o?a(le,{width:100}):m(q,{children:[(i||!r)&&m("div",{className:"TotalQueryResults__topbar",children:[m("span",{className:"SRC-boldText",children:[n," ",_==null?void 0:_.toLocaleString()," ",T," ",l]}),u&&m("a",{onClick:c,className:"TotalQueryResults__topbar__clearall",children:[a(Y,{icon:"deleteSweep"}),"Clear all filters"]})]}),a("div",{className:"TotalQueryResults__selections",children:a(Fa,{})})]})})}try{ke.displayName="TotalQueryResults",ke.__docgenInfo={description:"",displayName:"TotalQueryResults",props:{style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}},frontText:{defaultValue:null,description:"",name:"frontText",required:!0,type:{name:"string"}},endText:{defaultValue:null,description:"",name:"endText",required:!1,type:{name:"string"}},applyChanges:{defaultValue:null,description:"",name:"applyChanges",required:!1,type:{name:"((newFacets: FacetColumnRequest[]) => void)"}},hideIfUnfiltered:{defaultValue:null,description:"",name:"hideIfUnfiltered",required:!1,type:{name:"boolean"}}}}}catch{}const ge=2;function _e(e,t){var l;return((l=e==null?void 0:e.facets)==null?void 0:l.filter(r=>r.facetType==="enumeration"&&(!(t!=null&&t.length)||t.indexOf(r.columnName)>-1)&&r.facetValues.length>0&&!ze(r)))??[]}const Be=({facetsToPlot:e})=>{const{data:t,getLastQueryRequest:n,isLoadingNewBundle:l,executeQueryRequest:r,error:s,asyncJobStatus:o}=U(),{topLevelControlsState:c}=M(),[d,i]=p.useState([]),[h,T]=p.useState(!0),{showFacetVisualization:_,showFacetFilter:I}=c,u=n();p.useEffect(()=>{const v=_e(t,e);v.length!==0&&h&&(i(v.map((R,b)=>({name:R.columnName,isHidden:b>=ge,plotType:"PIE"}))),T(!1))},[t,h,e]);const C=v=>{i(R=>R.map((b,k)=>v?{...b,isHidden:!1}:{...b,isHidden:k>=ge}))},f=v=>{u.query.selectedFacets=v,u.query.offset=0,r(u)},w=v=>d.find(k=>k.name===v&&k.isHidden===!0)!==void 0,y=p.useMemo(()=>d.find(v=>v.isHidden===!0)?"MORE":d.length<=ge?"NONE":"LESS",[d]),x=v=>{F(v,"isHidden",!0)},N=(v,R)=>{F(v,"plotType",R)},g=v=>{var b;return((b=d.find(k=>k.name===v))==null?void 0:b.plotType)??"PIE"},F=(v,R,b)=>{i(k=>k.map(P=>P.name===v?{...P,[R]:b}:P))},V=_e(t,e),S=_e(t,e).map((v,R)=>({columnName:v.columnName,colorIndex:R})),L=(u==null?void 0:u.query.selectedFacets)!==void 0&&u.query.selectedFacets.length>0||(u==null?void 0:u.query.additionalFilters)!==void 0&&(u==null?void 0:u.query.additionalFilters.length)>0;return s?a(q,{}):!t&&l?a("div",{className:"SRC-loadingContainer SRC-centerContentColumn",children:(o==null?void 0:o.progressMessage)&&m("div",{children:[a("span",{className:"spinner"}),o.progressMessage]})}):m(q,{children:[a(ke,{frontText:"",endText:L?"filtered by":"",hideIfUnfiltered:!0}),V.length>0&&m("div",{className:`FacetNav ${_?"":"hidden"} ${I?de:me} ${y==="LESS"?"less":""}`,children:[a("div",{className:"FacetNav__row",role:"list",children:V.map(v=>{var R;return a("div",{className:"col-sm-12 col-md-4",style:{display:w(v.columnName)?"none":"block"},children:a(ce,{index:(R=S.find(b=>b.columnName===v.columnName))==null?void 0:R.colorIndex,onHide:()=>x(v.columnName),plotType:g(v.columnName),onSetPlotType:b=>N(v.columnName,b),facetToPlot:v,applyChangesToFacetFilter:f,applyChangesToGraphSlice:(b,k,P)=>oe(u,b,f,k==null?void 0:k.value,P),isModalView:!1})},v.columnName)})}),y!=="NONE"&&a("div",{className:"FacetNav__showMoreContainer bootstrap-4-backport",children:a(Ge,{variant:"secondary",className:"btn-wide FacetNav__showMore",onClick:()=>C(y==="MORE"),children:y==="LESS"?"Hide Charts":"View All Charts"})})]})]})};try{Be.displayName="FacetNav",Be.__docgenInfo={description:"",displayName:"FacetNav",props:{facetsToPlot:{defaultValue:null,description:"",name:"facetsToPlot",required:!1,type:{name:"string[]"}}}}}catch{}export{re as C,j as E,nn as F,Ee as I,ae as N,de as Q,le as S,ke as T,me as a,M as b,Ot as c,Se as d,Ue as e,Pe as f,an as g,tn as h,Ve as i,oe as j,De as k,Me as l,Be as m,Ae as n,_e as o,ma as p,ha as q,Re as r,ve as s,U as u};
//# sourceMappingURL=FacetNav-ade7d74a.js.map
