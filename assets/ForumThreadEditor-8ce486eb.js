import{j as i,F as $,a as C}from"./jsx-runtime-670450c2.js";import{r as y}from"./index-f1f749bf.js";import{a4 as o,cQ as W,bJ as m,cR as K,cS as j,a6 as N,cT as G,cU as O,cV as H,cW as B,cX as Y,cY as z,cZ as J,c_ as X,c$ as Z,d0 as D,d1 as ee,aY as ae}from"./index-861a53dd.js";import{u as g}from"./useMutation-7eda838d.js";import{u as te}from"./useInfiniteQuery-a2eb5133.js";import{I as P}from"./IconSvg-27bfb1b7.js";import{e as se}from"./AccessRequirementList-9c683ba7.js";import{U as ne}from"./UserSearchBoxV2-dd857a68.js";import{M as I}from"./Modal-346748ce.js";import{s as re}from"./startCase-6fa446f1.js";import{b as ce}from"./isArray-a82322d9.js";import{B as V}from"./Button-7d415009.js";function _e(e,t,s,a,n,r){const{accessToken:f}=o();return te(["reply",e,s,n,a,t],async l=>W(f,e,s,l.pageParam,a,t,n),{...r,getNextPageParam:(l,S)=>{const x=S.flatMap(v=>v.results).length;if(l.totalNumberOfResults>x)return x}})}function qe(e,t){const{accessToken:s}=o(),a=async()=>{const n=await O(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return N(["reply",e.threadId,e.id,e.messageKey],a,t)}function ie(e){const t=m(),{accessToken:s}=o();return g(a=>K(a,s),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["reply",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function oe(e){const t=m(),{accessToken:s}=o();return g(a=>j(a,s),{...e,onSuccess:async(a,n,r)=>{t.invalidateQueries(["reply",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Ee(e){const t=m(),{accessToken:s}=o();return g(a=>G(s,a.replyId),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["reply",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Le(e){const{data:t,isLoading:s}=ue(e),{data:a,isLoading:n}=le(t,{enabled:!!t}),{mutate:r}=me(),{mutate:f}=ge(),l=y.useCallback(()=>{t&&(t!=null&&t.isPinned?f(t):r(t))},[f,r,t]);return{threadData:t,threadBody:a,togglePin:l,isLoading:n||s}}function ue(e,t){const{accessToken:s}=o();return N(["thread",e,s],()=>H(e,s),t)}function le(e,t){const{accessToken:s}=o(),a=async()=>{const n=await ee(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return N(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,s],a,t)}function de(e){const t=m(),{accessToken:s}=o();return g(a=>B(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",a.forumId]),await t.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function ye(e){const t=m(),{accessToken:s}=o();return g(a=>Y(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function fe(e){const t=m(),{accessToken:s}=o();return g(a=>z(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",a.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Ue(e){const t=m(),{accessToken:s}=o();return g(a=>J(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",n.forumId]),await t.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Qe(e){const t=m(),{accessToken:s}=o();return g(a=>X(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",n.forumId]),await t.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function me(e){const t=m(),{accessToken:s}=o();return g(a=>Z(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.id]),await t.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function ge(e){const t=m(),{accessToken:s}=o();return g(a=>D(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.id]),await t.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}const he=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],F={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},L=({show:e,onClose:t,handleUserTag:s})=>{const a=y.useCallback((n,r)=>{n&&r&&s(r.userName),t()},[t,s]);return i($,{children:C(I,{show:e,onHide:t,backdrop:"static",animation:!1,children:[i(I.Header,{closeButton:!0,children:i(I.Title,{children:"Find User or Team"})}),i(I.Body,{children:i(ne,{placeholder:"Search for a user or team name",onChange:a,typeFilter:ae.ALL,focusOnSelect:!0})})]})})};try{L.displayName="UserMentionModal",L.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var U=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(U||{});const Q=({placeholder:e,text:t,setText:s})=>{const[a,n]=y.useState("WRITE"),[r,f]=y.useState(0),[l,S]=y.useState(!1),[x,v]=y.useState(!1),p=y.useRef(null);y.useEffect(()=>{const c=p.current;c&&c.setSelectionRange(r,r)},[p,r]),y.useEffect(()=>{var c;(c=p.current)==null||c.focus()},[l]);const R=c=>{const u=[],d=p.current;if(d){const T=d==null?void 0:d.selectionStart,w=t.substring(0,T),b=t.substring(T,t.length);f(T+c.length+1),u.push(w,`${x?"":"@"}${c.replace(/\s/g,"")}`,b)}s(u.join("")),v(!1)},_=c=>{c.key=="@"&&(v(!0),S(!0))},q=c=>{const u=p.current;if(u){const d=u.selectionStart,T=u.selectionEnd,w=t.substring(d,T),b=t.substring(0,d),h=t.substring(T,t.length),k=F[c].openSyntax,E=F[c].closeSyntax;switch(c){case"code":{const M=[];M.push(b,k,w,E,h),s(M.join(`\r
`)),u.focus(),f(d+k.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const M=`${b}${k}${w}${E}${h}`;u.focus(),f(d+k.length),s(M)}}}};return C("div",{className:"bootstrap-4-backport MarkdownEditor",children:[C("div",{className:"MarkdownEditorControls",children:[i("div",{className:"Tabs",children:Object.keys(U).map(c=>i("button",{className:"Tab",role:"tab","aria-selected":c===a,onClick:u=>{u.stopPropagation(),n(U[c])},children:c},c))}),a==="WRITE"&&C("div",{className:"MarkdownEditorControlsToolbar",children:[he.map(c=>i("button",{onClick:()=>q(c),children:i(P,{icon:c,label:re(c)})},c)),i("button",{onClick:()=>S(!0),children:i(P,{icon:"tag",label:"Mention"})})]})]}),i("div",{children:a==="WRITE"?i("textarea",{onChange:c=>s(c.target.value),style:{width:"100%"},rows:6,value:t,ref:p,placeholder:e,onKeyDown:_}):t?i(se,{markdown:t}):"Nothing to preview"}),i(L,{show:l,onClose:()=>S(!1),handleUserTag:R})]})};try{Q.displayName="MarkdownEditor",Q.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const A=({initialText:e,initialTitle:t,id:s,onClose:a,isReply:n})=>{const[r,f]=y.useState(t??""),[l,S]=y.useState(e??""),{mutate:x,isLoading:v}=de({onSuccess:()=>a()}),{mutate:p,isLoading:R}=ye({onSuccess:()=>a()}),{mutate:_,isLoading:q}=fe({onSuccess:()=>a()}),{mutate:c,isLoading:u}=ie({onSuccess:()=>a()}),{mutate:d,isLoading:T}=oe({onSuccess:()=>a()}),w=R||u||q||v||T,b=(h,k)=>{n?e?d({replyId:s,messageMarkdown:h}):c({threadId:s,messageMarkdown:h}):t?(x({title:k,threadId:s}),p({messageMarkdown:h,threadId:s})):_({forumId:s,title:k,messageMarkdown:h})};return C("div",{className:"bootstrap-4-backport",children:[!n&&i(ce,{type:"text",placeholder:"Title",value:r,onChange:h=>f(h.target.value)}),i(Q,{text:l,setText:S}),C("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i(V,{onClick:a,variant:"light",children:"Cancel"}),i(V,{disabled:w,onClick:()=>b(l,r),variant:"primary",children:w?"Saving":"Save"})]})]})};try{A.displayName="ForumThreadEditor",A.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}}}catch{}export{A as F,Ee as a,Le as b,Ue as c,Qe as d,_e as e,qe as u};
//# sourceMappingURL=ForumThreadEditor-8ce486eb.js.map
