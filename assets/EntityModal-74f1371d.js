import{j as e,a as t,F as R}from"./jsx-runtime-095bf462.js";import{r as T}from"./index-8db94870.js";import{u as H,b5 as U,T as b,t as v,b6 as W,b7 as J,b8 as z,ac as Q}from"./SynapseClient-6827eecb.js";import{g as C,B as O}from"./getEndpoint-ac94413e.js";import{u as D,b as X}from"./SynapseTableCell-9cf0b11a.js";import{d as Y}from"./ToastMessage-785e6476.js";import{u as Z,a as ee,S as ae}from"./SchemaDrivenAnnotationEditor-2dd04385.js";import"./OrientationBanner-ecffb496.js";import{a as te}from"./useEntity-90b7859b.js";import"./SkeletonButton-53ae0bfd.js";import{S as ne}from"./SkeletonTable-5263c31a.js";import{d as A}from"./dayjs.min-59ef0ea6.js";import{F as oe}from"./FullWidthAlert-a85e5287.js";import{f as V}from"./DateFormatter-82149740.js";import{g as ie,a as se}from"./FileHandleUtils-21abeac0.js";import{a as I}from"./UserBadge-cc759ecf.js";import{B as N}from"./Button-c45f00b4.js";import{S as le}from"./Skeleton-2bd04c38.js";import{T as re}from"./Tooltip-6a83a77a.js";function E(u){const{entityId:s}=u,[a,p]=T.useState(!1),{isInExperimentalMode:_}=H(),{entityMetadata:o,annotations:l,isLoading:y,refetch:i}=te(s,!0),{data:c}=Z(s,{enabled:_}),{data:r,refetch:d}=ee(s,{enabled:_&&!!c}),h=_&&!!c,w=!!o&&!!r&&A(o.modifiedOn).diff(A(r.validatedOn))>0,n=T.useCallback(async()=>{p(!0);const m=[i(),d()];await Promise.allSettled(m),p(!1)},[i,d]);return y||a?e(ne,{numRows:3,numCols:2}):t(R,{children:[o&&l&&U(l)?t("div",{className:"placeholder",children:["This"," ",b(v(o.concreteType))," ","has no annotations."]}):null,e("table",{className:"AnnotationsTable",children:t("tbody",{children:[l&&Object.keys(l).map(m=>t("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key",children:m}),e("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(l[m])?l[m].join(", "):l[m].toString()})]},m)),h?t("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e("td",{className:"AnnotationsTable__Row__Value",children:e("a",{href:`${C(O.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${c.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:c.jsonSchemaVersionInfo.schemaName})})]}):null]})}),o&&h&&w&&e(oe,{variant:"warning",description:`This ${b(v(o.concreteType))} has changed since it has been last validated. If this ${b(v(o.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{n()}},isGlobal:!1})]})}try{E.displayName="AnnotationsTable",E.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const g=({entityId:u,versionNumber:s})=>{var l,y,i,c,r,d;const{data:a}=D(u,s),p=a&&W(a.entity),_=a?ie(a):void 0;let o;return _&&(o=se(_)),a?e("table",{className:"MetadataTable",children:t("tbody",{children:[t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Name"}),e("td",{className:"MetadataTable__Row__Value",children:(l=a.entity)==null?void 0:l.name})]}),t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Type"}),e("td",{className:"MetadataTable__Row__Value",children:b(a.entityType)})]}),t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e("td",{className:"MetadataTable__Row__Value",children:(y=a.entity)==null?void 0:y.id})]}),p&&t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Version"}),e("td",{className:"MetadataTable__Row__Value",children:J(a.entity)})]}),o&&t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e("td",{className:"MetadataTable__Row__Value",children:o})]}),t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),t("td",{className:"MetadataTable__Row__Value",children:[e(I,{userId:(i=a.entity)==null?void 0:i.modifiedBy})," at"," ",V(A((c=a.entity)==null?void 0:c.modifiedOn))]})]}),t("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Created By"}),t("td",{className:"MetadataTable__Row__Value",children:[e(I,{userId:(r=a.entity)==null?void 0:r.createdBy})," at"," ",V(A((d=a.entity)==null?void 0:d.createdOn))]})]})]})}):null};try{g.displayName="MetadataTable",g.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const de=["METADATA","ANNOTATIONS"];function B(u){const{entityId:s,versionNumber:a,show:p,onClose:_,initialTab:o="METADATA",showTabs:l=!0}=u,y=T.useRef(null),[i,c]=T.useState(o),[r,d]=T.useState(!1),[h,w]=T.useState(!1),{data:n}=D(s,a),m=n&&n.permissions.canEdit,M=n&&z(n.entityType),S=M&&n.entity.isLatestVersion,k=i==="METADATA"&&n&&!window.location.href.includes(s),q=t(N,{variant:"contained",onClick:()=>window.open(`${C(O.PORTAL_ENDPOINT)}#!Synapse:${s}`,"_blank","noopener"),children:["Open"," ",n?b(n==null?void 0:n.entityType):""]}),x=i==="ANNOTATIONS"&&r,K=e(N,{variant:"contained",onClick:()=>{y.current.formElement.current.requestSubmit()},children:"Save Annotations"}),j=i==="ANNOTATIONS"&&r,F=e(N,{variant:"outlined",onClick:()=>{h&&d(!1),w(!h)},children:h?"Are you sure? Unsaved changes will be lost":"Cancel"}),P=m&&i==="ANNOTATIONS"&&!r,L=e(re,{title:M&&!S?"Annotations can only be edited on the latest version":void 0,children:e(N,{variant:"contained",disabled:M&&!S,onClick:()=>{d(!0)},children:"Edit"})}),$=t(R,{children:[l&&!r?e("div",{className:"Tabs",children:de.map(f=>e("div",{className:"Tab",role:"tab",onClick:G=>{G.stopPropagation(),c(f)},"aria-selected":f===i,children:f},f))}):null,e("div",{style:i==="ANNOTATIONS"?{}:{display:"none"},children:r?e(Q,{children:e(ae,{entityId:s,formRef:y,onSuccess:()=>{Y("Annotations successfully updated.","success"),d(!1)},onCancel:()=>d(!1)})}):e(E,{entityId:s,versionNumber:a})}),e("div",{style:i==="METADATA"?{}:{display:"none"},children:e(g,{entityId:s,versionNumber:a})})]});return e(X,{className:"EntityMetadata",open:p,onCancel:_,maxWidth:r?"md":"sm",title:n?n.entity.name:e(le,{width:"40%"}),content:$,actions:t(R,{children:[j&&F,x&&K,P&&L,k&&q]})})}try{B.displayName="EntityModal",B.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}}}}}catch{}export{B as E};
//# sourceMappingURL=EntityModal-74f1371d.js.map
