import{j as l,a as c,F as W}from"./jsx-runtime-670450c2.js";import{r as _}from"./index-f1f749bf.js";import{E as j}from"./ElementWithTooltip-d7345aaf.js";import{u as J}from"./unCamelCase-ec1c2b3d.js";import{a4 as K,ap as Z}from"./index-5643b5a3.js";import{r as q}from"./sqlFunctions-eaf5f980.js";import{c as X,P as U}from"./factory-76e91d33.js";import{l as f}from"./lodash.default-f81662ad.js";import{l as O}from"./LoadingScreen-bca9d5a7.js";import{i as ee}from"./SynapseConstants-f1d07af3.js";import"./_commonjsHelpers-042e6b4d.js";import"./SynapseTableConstants-942d2b0b.js";import"./IconSvg-0e7cf93d.js";import"./SvgIcon-51e1f886.js";import"./extends-98964cd2.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./styled-abc8f272.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-eaaa54fe.js";import"./Tooltip-266dd013.js";import"./useTheme-1b437015.js";import"./inheritsLoose-d541526f.js";import"./setPrototypeOf-0bb37fbe.js";import"./index-96c5f47c.js";import"./TransitionGroupContext-ab7f4b4e.js";import"./useIsFocusVisible-c754a498.js";import"./RegularExpressions-efc8426f.js";import"./Dropdown-5293cc7a.js";import"./Button-7d415009.js";import"./usePrevious-9f30f8c7.js";import"./createWithBsPrefix-e09f51dd.js";import"./index-4d501b15.js";import"./hook-c05d8d9f.js";import"./contains-60f9209b.js";import"./usePopperMarginModifiers-3c86461d.js";import"./hasClass-ec9efd32.js";import"./isRequiredForA11y-0a29da5f.js";import"./FullWidthAlert-59d3d098.js";import"./divWithClassName-46957a4f.js";import"./Typography-4e56074b.js";import"./Fade-f3cad5fb.js";import"./isArray-a82322d9.js";import"./getEndpoint-5374ab4d.js";import"./IconButton-4918d20b.js";import"./ButtonBase-359737e8.js";import"./emotion-react.browser.esm-421a64bf.js";import"./assertThisInitialized-081f9914.js";import"./Link-f2f6852b.js";import"./Button-2476b393.js";import"./QueryFilter-422779f1.js";import"./_baseClone-2235d922.js";import"./_Set-bb23dcec.js";import"./isEmpty-1d225a5e.js";import"./isEqual-0cd94ab2.js";import"./_cacheHas-c96cd36c.js";import"./_setToArray-3d6ec6fd.js";import"./pick-871c2e0e.js";import"./toString-3056297c.js";import"./isSymbol-b6149709.js";import"./_baseSlice-cf92e063.js";import"./uniq-4715bcdf.js";import"./toInteger-9b1425fc.js";import"./without-b3c566d4.js";import"./startCase-6fa446f1.js";import"./upperFirst-6d18bcef.js";import"./omitBy-8d56ab61.js";import"./times-a253c348.js";import"./union-46cb31f1.js";import"./uniqueId-9feaf103.js";import"./cloneDeep-4fd27594.js";import"./groupBy-2c5e33b5.js";import"./toLower-e173e626.js";import"./Modal-03fc1f7b.js";import"./useWillUnmount-7fb15b8a.js";import"./removeClass-164fd327.js";import"./useWaitForDOMRef-54076dc2.js";const te=X(U);function oe(e,o){const t=f.cloneDeep(e);if(!o)return t;o.backgroundColor&&(t.plot_bgcolor=o.backgroundColor),t.yaxis.showticklabels=!1,t.xaxis.range=[-5,o.maxValue+30],t.xaxis.visible=o.isXAxis,t.showlegend=o.isLegend,t.margin={t:0,b:o.isXAxis?50:0,l:0,r:0,pad:15};let a=30;return o.isLegend&&(a=35,t.margin.pad=0,t.xaxis={visible:!1,zeroline:!1,showgrid:!1,showline:!1,range:[0,1]},t.yaxis={visible:!1,showline:!1}),o.isXAxis&&(t.yaxis={visible:!1,showgrid:!1,showline:!1},a=50),t.height=a,t}function re(e,o){const t=new Array(e.length);return o.forEach(a=>{const r=e.indexOf(a.y);t[r]=a.x}),t}function ae(e,o,t,a){const r=t===void 0;var d=f.uniq(e.map(p=>p.group));const i=[],u=["y-down","triangle-up","cross-thin-open","triangle-up-open-dot","star-square-open","diamond-x"];return d.forEach((p,s)=>{i.push({type:"scatter",x:r?[-10]:re(t,e.filter(g=>g.group===p)),y:t,text:[p],hovertemplate:"%{x} %{text}<extra></extra>",mode:"markers",name:p,marker:{color:o.markerFill,line:{color:o.markerLine,width:1},symbol:a?a[p]:u[s],size:o.markerSize}})}),i}const C=({plotData:e,optionsConfig:o,layoutConfig:t,label:a,id:r,xMax:d,style:i={width:"100%",height:"100%"},markerSymbols:u,plotStyle:p={markerFill:"#515359",markerLine:"#515359",markerSize:9,backgroundColor:"transparent"},onClick:s,isLegend:g=!1,isXAxis:P=!1})=>{const S=a?[a]:void 0;return l(te,{layout:oe(t,{isLegend:g,isXAxis:P,maxValue:d,backgroundColor:p.backgroundColor}),style:i,data:ae(e,p,S,u),config:o,onClick:k=>s?s(k):f.noop},`dotPlot_${r}`)};try{C.displayName="DotPlot",C.__docgenInfo={description:"",displayName:"DotPlot",props:{plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Partial<Layout>"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Partial<Config>"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},style:{defaultValue:{value:"{ width: '100%', height: '100%' }"},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},isLegend:{defaultValue:{value:"false"},description:"",name:"isLegend",required:!1,type:{name:"boolean"}},isXAxis:{defaultValue:{value:"false"},description:"",name:"isXAxis",required:!1,type:{name:"boolean"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!1,type:{name:"number"}},plotStyle:{defaultValue:{value:`{
    markerFill: '#515359',
    markerLine: '#515359',
    markerSize: 9,
    backgroundColor: 'transparent',
  }`},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},markerSymbols:{defaultValue:null,description:"",name:"markerSymbols",required:!1,type:{name:"Dictionary"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"Function"}}}}}catch{}const le=X(U);function ie(e,o,t){o&&(e=e.filter(i=>i.y===o));var a=f.uniq(e.map(i=>i.group)).sort();const r=[],d=["(28,118,175,1)","rgba(91,176,181,1)"];return a.forEach((i,u)=>{const p=e.filter(s=>s.group===i);r.push({x:p.map(s=>s.x),y:p.map(s=>s.y),name:i,orientation:"h",marker:{color:t?t[i]:d[u],width:1},text:[i],hovertemplate:"%{x} %{text}<extra></extra>",type:"bar"})}),r}function se(e,{isTop:o,maxValue:t,backgroundColor:a}){const r=f.cloneDeep(e);return r.xaxis={visible:!1,range:[0,t]},a&&(r.plot_bgcolor=a,r.paper_bgcolor=a),o||(r.hoverlabel={font:{size:10}}),r.showlegend=!1,r.height=o?40:20,r}const T=({plotData:e,optionsConfig:o,isTop:t,layoutConfig:a,label:r,xMax:d,colors:i,plotStyle:u={backgroundColor:"transparent"},style:p={width:"100%",height:"100%"},onClick:s})=>l(le,{style:p,layout:se(a,{isTop:t,maxValue:d,backgroundColor:u.backgroundColor}),config:o,data:ie(e,r,i),onClick:g=>s?s(g):f.noop});try{T.displayName="BarPlot",T.__docgenInfo={description:"",displayName:"BarPlot",props:{isTop:{defaultValue:null,description:"",name:"isTop",required:!0,type:{name:"boolean"}},style:{defaultValue:{value:"{ width: '100%', height: '100%' }"},description:"",name:"style",required:!1,type:{name:"CSSProperties"}},plotData:{defaultValue:null,description:"",name:"plotData",required:!0,type:{name:"GraphItem[]"}},layoutConfig:{defaultValue:null,description:"",name:"layoutConfig",required:!0,type:{name:"Partial<Layout>"}},optionsConfig:{defaultValue:null,description:"",name:"optionsConfig",required:!0,type:{name:"Partial<Config>"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},xMax:{defaultValue:null,description:"",name:"xMax",required:!0,type:{name:"number"}},colors:{defaultValue:null,description:"",name:"colors",required:!1,type:{name:"Dictionary"}},plotStyle:{defaultValue:{value:"{ backgroundColor: 'transparent' }"},description:"",name:"plotStyle",required:!1,type:{name:"PlotStyle"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"Function"}}}}}catch{}const b={displayModeBar:!1,responsive:!0,scrollZoom:!1,editable:!1,autosizable:!0},ne={delayShow:0,place:"right",type:"light",effect:"solid",border:!0},V={showlegend:!0,dragmode:!1,legend:{font:{size:11},y:1.1,xanchor:"right",x:1,orientation:"h"},xaxis:{visible:!0,fixedrange:!0,zeroline:!1,showgrid:!1,showline:!0,linecolor:"#ddd",autotick:!0,ticks:"outside",tickcolor:"#ddd"},yaxis:{fixedrange:!0,zeroline:!1,gridcolor:"#ddd",automargin:!0},margin:{pad:20},hovermode:"closest"},$={barmode:"stack",showlegend:!1,dragmode:!1,hovermode:"closest",yaxis:{visible:!1,fixedrange:!0},margin:{l:0,r:0,b:0,t:0,pad:0}};function L(e,{xField:o,yField:t,groupField:a,entityId:r,whereClause:d,infoField:i}){const u=`SELECT ${o} as "x", ${t} as "y", ${i?i+' as "info", ':""}   ${a} as "group" FROM ${r} ${d?" WHERE "+d:""}`;return Z({concreteType:"org.sagebionetworks.repo.model.table.QueryBundleRequest",partMask:ee,entityId:r,query:{sql:u}},e).then(s=>s.queryResult.queryResults)}function w(e,o){const t=e.reduce((r,d)=>(r[d[o]]=(d[o]in r?Number(r[d[o]]):0)+Number(d.x),r),{}),a=[];for(const r in t)a.push({[o]:r,count:t[r]});return a}const A=(e,o)=>{const t=e.points[0].data;let a=t.y[0],r=t.name;return o&&([a,r]=[r,a]),{facetValue:a,type:r,event:e.event}},de=(e,o)=>l("div",{className:"ThemesPlot__barPlotLegend",children:o.map((t,a)=>c("div",{style:{float:"left"},children:[l("div",{className:"ThemesPlot__barPlotLegend__label",style:{backgroundColor:`${e?e[t]:"transparent"}`}},"topBar_label"),l("div",{className:"ThemesPlot__barPlotLegend__graph",children:t},"topBar_graph")," "]},`topBar_${a}`))}),R=(e,o)=>{for(let t in e)e[t]=e[t].replace(",1)",`, ${o})`).replace(",1.0)",`, ${o})`);return e},pe=(e,o)=>f.first(e.filter(t=>t.y===o).map(t=>t.info)),B=({dotPlot:e,topBarPlot:o,sideBarPlot:t,tooltipProps:a=ne,onPointClick:r,dotPlotYAxisLabel:d="Research Themes"})=>{const{accessToken:i}=K(),[u,p]=_.useState(!1),[s,g]=_.useState([]),[P,S]=_.useState([]),[k,G]=_.useState([]);_.useEffect(()=>{const n=L(i,e),y=L(i,o),h=L(i,t);return Promise.all([n,y,h]).then(m=>{g(q(m[0].headers,m[0].rows)),S(q(m[1].headers,m[1].rows)),G(q(m[2].headers,m[2].rows)),p(!0)}).catch(m=>{throw m}),()=>{}},[i,e,o,t]);let N=[],F=[],D=0,E=0,M=[],v=[];return u&&(v=w(k,"y"),N=v.sort((n,y)=>y.count-n.count).map(n=>n.y),E=Math.max(...v.map(n=>n.count)),D=Math.max(...s.map(n=>Number(n.x))),M=f.orderBy(w(P,"y"),["y"]),F=f.orderBy(w(P,"group"),["group"]).map(n=>n.group)),c(W,{children:[!u&&O,u&&c("div",{className:"ThemesPlot",children:[l("div",{className:"ThemesPlot__dotPlotLegend",children:l(C,{id:"head",plotData:s,isLegend:!0,markerSymbols:e.markerSymbols,style:{width:"100%",height:"100%"},layoutConfig:V,optionsConfig:{...b,responsive:!0,staticPlot:!0},plotStyle:{...e.plotStyle,backgroundColor:"transparent"}})}),o.colors&&de(o.colors,F),M.map((n,y)=>c("div",{className:"ThemesPlot__topBarPlot",children:[c("div",{className:"ThemesPlot__topBarPlot__label",children:[n.count," ",J(n.y)]}),l("div",{className:"ThemesPlot__topBarPlot__plot",children:l(T,{style:{width:"100%",height:"100%"},layoutConfig:f.cloneDeep($),optionsConfig:{...b},plotData:P,isTop:!0,label:n.y,xMax:n.count,onClick:h=>r(A(h,!0)),colors:y%2===0?o.colors:R({...o.colors},"1")})})]},`topBarDiv_${y}`)),c("div",{style:{display:"flex",position:"relative"},children:[l("div",{className:"ThemesPlot__dotPlotYLabel",children:d}),c("div",{className:"ThemesPlot__dotPlot",children:[N.map((n,y)=>{var h,m;return c("div",{className:"ThemesPlot__dotPlot__row",style:{backgroundColor:(h=e.plotStyle)==null?void 0:h.backgroundColor},children:[l("div",{className:"ThemesPlot__dotPlot__barColumn",children:l(j,{tooltipText:`${pe(s,n)} `,tooltipVisualProps:a,callbackFn:()=>f.noop,children:c("div",{children:[l("span",{className:"ThemesPlot__dotPlot__themeLabel",children:n}),l("br",{}),c("span",{className:"ThemesPlot__dotPlot__countLabel",children:[v[y].count," ",t.countLabel]}),l("br",{}),l(T,{style:{width:"100%"},layoutConfig:$,optionsConfig:b,plotData:k,isTop:!1,xMax:E,label:n,colors:R({...o.colors},"1")})]})})}),l("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",children:l("div",{style:{width:"100%",backgroundColor:(m=e.plotStyle)==null?void 0:m.backgroundColor},children:l(C,{id:y+"",onClick:H=>r(A(H,!1)),plotData:s,plotStyle:e.plotStyle,markerSymbols:e.markerSymbols,xMax:D,label:n,layoutConfig:V,optionsConfig:{...b,responsive:!1}})})})]},`plotDiv_${+y}`)}),c("div",{className:"ThemesPlot__dotPlot__row",children:[l("div",{className:"ThemesPlot__dotPlot__barColumn",style:{textAlign:"right"},children:"VOLUME:"}),l("div",{className:"ThemesPlot__dotPlot__dotPlotColumn",style:{marginTop:"0px"},children:l(C,{id:"footer",plotData:s,isXAxis:!0,xMax:D,layoutConfig:V,optionsConfig:{...b,responsive:!1}})})]})]})]}),l("div",{})]})]})},Y=B;try{B.displayName="ThemesPlot",B.__docgenInfo={description:"",displayName:"ThemesPlot",props:{onPointClick:{defaultValue:null,description:"",name:"onPointClick",required:!0,type:{name:"({ facetValue, type, event }: ClickCallbackParams) => void"}},dotPlot:{defaultValue:null,description:"",name:"dotPlot",required:!0,type:{name:"PlotProps"}},topBarPlot:{defaultValue:null,description:"",name:"topBarPlot",required:!0,type:{name:"PlotProps"}},sideBarPlot:{defaultValue:null,description:"",name:"sideBarPlot",required:!0,type:{name:"PlotProps"}},tooltipProps:{defaultValue:{value:`{
  delayShow: 0,
  place: 'right',
  type: 'light',
  effect: 'solid',
  border: true,
}`},description:"",name:"tooltipProps",required:!1,type:{name:"TooltipVisualProps"}},dotPlotYAxisLabel:{defaultValue:{value:"Research Themes"},description:"",name:"dotPlotYAxisLabel",required:!1,type:{name:"string"}}}}}catch{}const Nt={title:"Home Page/ThemesPlot",component:Y,argTypes:{}},ue=e=>l(Y,{...e}),x=ue.bind({});x.args={onPointClick:e=>{console.log(e.event)},topBarPlot:{entityId:"syn21641485",xField:"totalCount",yField:"groupBy",groupField:"consortium",colors:{CSBC:"rgba(64,123,160, 1)","PS-ON":"rgba(91,176,181,1)",ICBP:"rgba(197, 191, 223, 1)",TEC:"rgba(156, 196, 233, 1)"},whereClause:"totalCount is not NULL"},sideBarPlot:{entityId:"syn21649281",xField:"totalCount",yField:"theme",groupField:"consortium",countLabel:"grants",plotStyle:{backgroundColor:"#f5f9fa"},colors:{CSBC:"#1c76af","PS-ON":"#5bb0b5",ICBP:"#9cc4e9",TEC:"#c5bfdf"}},dotPlot:{entityId:"syn21639584",xField:"totalCount",yField:"theme",groupField:"groupBy",infoField:"themeDescription",whereClause:"groupBy IN ('publications', 'tools', 'datasets')",markerSymbols:{tools:"y-down",datasets:"diamond-x",publications:"circle"},plotStyle:{markerLine:"rgba(0, 0, 0,1)",markerFill:"rgba(255, 255, 255,1)",markerSize:11,backgroundColor:"#f5f9fa"}}};var z,I,Q;x.parameters={...x.parameters,docs:{...(z=x.parameters)==null?void 0:z.docs,source:{originalSource:"args => <ThemesPlot {...args} />",...(Q=(I=x.parameters)==null?void 0:I.docs)==null?void 0:Q.source}}};const Ft=["ThemesPlotDemo"];export{x as ThemesPlotDemo,Ft as __namedExportsOrder,Nt as default};
//# sourceMappingURL=ThemesPlot.stories-30aff947.js.map
