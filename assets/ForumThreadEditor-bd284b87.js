import{j as i,F as $,a as b}from"./jsx-runtime-670450c2.js";import{r as f}from"./index-f1f749bf.js";import{a4 as o,cE as W,a6 as N,bJ as m,cF as K,cG as G,cH as j,cI as O,cJ as H,cK as B,cL as z,cM as J,cN as Y,cO as X,cP as Z,cQ as D,cR as ee,aY as ae}from"./SynapseContext-0510efef.js";import{u as g}from"./useMutation-0a006ef5.js";import{u as te}from"./useInfiniteQuery-4a12d5f1.js";import{I as P}from"./IconSvg-1961918c.js";import{f as se}from"./AccessRequirementList-afc59fbd.js";import{U as ne}from"./UserSearchBoxV2-8459c147.js";import{M as I}from"./Modal-4281cfd8.js";import{s as re}from"./startCase-6fa446f1.js";import{b as ce}from"./isArray-a82322d9.js";import{B as F}from"./Button-7d415009.js";function _e(e,t,s,a,n,r){const{accessToken:y}=o();return te(["reply",e,s,n,a,t],async l=>W(y,e,s,l.pageParam,a,t,n),{...r,getNextPageParam:(l,S)=>{const x=S.flatMap(v=>v.results).length;if(l.totalNumberOfResults>x)return x}})}function qe(e,t){const{accessToken:s}=o(),a=async()=>{const n=await O(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return N(["reply",e.threadId,e.id,e.messageKey],a,t)}function ie(e){const t=m(),{accessToken:s}=o();return g(a=>K(a,s),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["reply",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function oe(e){const t=m(),{accessToken:s}=o();return g(a=>G(a,s),{...e,onSuccess:async(a,n,r)=>{t.invalidateQueries(["reply",a.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Ee(e){const t=m(),{accessToken:s}=o();return g(a=>j(s,a.replyId),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["reply",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Le(e){const{data:t,isLoading:s}=ue(e),{data:a,isLoading:n}=le(t,{enabled:!!t}),{mutate:r}=me(),{mutate:y}=ge(),l=f.useCallback(()=>{t&&(t!=null&&t.isPinned?y(t):r(t))},[y,r,t]);return{threadData:t,threadBody:a,togglePin:l,isLoading:n||s}}function ue(e,t){const{accessToken:s}=o();return N(["thread",e,s],()=>H(e,s),t)}function le(e,t){const{accessToken:s}=o(),a=async()=>{const n=await ee(e.messageKey,s);return(await fetch(n.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return N(["thread",e==null?void 0:e.id,e==null?void 0:e.messageKey,s],a,t)}function de(e){const t=m(),{accessToken:s}=o();return g(a=>B(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",a.forumId]),await t.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function fe(e){const t=m(),{accessToken:s}=o();return g(a=>z(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.threadId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function ye(e){const t=m(),{accessToken:s}=o();return g(a=>J(s,a),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",a.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Qe(e){const t=m(),{accessToken:s}=o();return g(a=>Y(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",n.forumId]),await t.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function Ue(e){const t=m(),{accessToken:s}=o();return g(a=>X(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["forumthread",n.forumId]),await t.invalidateQueries(["thread",n.id]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function me(e){const t=m(),{accessToken:s}=o();return g(a=>Z(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.id]),await t.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}function ge(e){const t=m(),{accessToken:s}=o();return g(a=>D(s,a.id),{...e,onSuccess:async(a,n,r)=>{await t.invalidateQueries(["thread",n.id]),await t.invalidateQueries(["forumthread",n.forumId]),e!=null&&e.onSuccess&&await e.onSuccess(a,n,r)}})}const he=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],V={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},L=({show:e,onClose:t,handleUserTag:s})=>{const a=f.useCallback((n,r)=>{n&&r&&s(r.userName),t()},[t,s]);return i($,{children:b(I,{show:e,onHide:t,backdrop:"static",animation:!1,children:[i(I.Header,{closeButton:!0,children:i(I.Title,{children:"Find User or Team"})}),i(I.Body,{children:i(ne,{placeholder:"Search for a user or team name",onChange:a,typeFilter:ae.ALL,focusOnSelect:!0})})]})})};try{L.displayName="UserMentionModal",L.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var Q=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(Q||{});const U=({placeholder:e,text:t,setText:s})=>{const[a,n]=f.useState("WRITE"),[r,y]=f.useState(0),[l,S]=f.useState(!1),[x,v]=f.useState(!1),p=f.useRef(null);f.useEffect(()=>{const c=p.current;c&&c.setSelectionRange(r,r)},[p,r]),f.useEffect(()=>{var c;(c=p.current)==null||c.focus()},[l]);const R=c=>{const u=[],d=p.current;if(d){const T=d==null?void 0:d.selectionStart,w=t.substring(0,T),M=t.substring(T,t.length);y(T+c.length+1),u.push(w,`${x?"":"@"}${c.replace(/\s/g,"")}`,M)}s(u.join("")),v(!1)},_=c=>{c.key=="@"&&(v(!0),S(!0))},q=c=>{const u=p.current;if(u){const d=u.selectionStart,T=u.selectionEnd,w=t.substring(d,T),M=t.substring(0,d),h=t.substring(T,t.length),k=V[c].openSyntax,E=V[c].closeSyntax;switch(c){case"code":{const C=[];C.push(M,k,w,E,h),s(C.join(`\r
`)),u.focus(),y(d+k.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const C=`${M}${k}${w}${E}${h}`;u.focus(),y(d+k.length),s(C)}}}};return b("div",{className:"bootstrap-4-backport MarkdownEditor",children:[b("div",{className:"MarkdownEditorControls",children:[i("div",{className:"Tabs",children:Object.keys(Q).map(c=>i("button",{className:"Tab",role:"tab","aria-selected":c===a,onClick:u=>{u.stopPropagation(),n(Q[c])},children:c},c))}),a==="WRITE"&&b("div",{className:"MarkdownEditorControlsToolbar",children:[he.map(c=>i("button",{onClick:()=>q(c),children:i(P,{icon:c,label:re(c)})},c)),i("button",{onClick:()=>S(!0),children:i(P,{icon:"tag",label:"Mention"})})]})]}),i("div",{children:a==="WRITE"?i("textarea",{onChange:c=>s(c.target.value),style:{width:"100%"},rows:6,value:t,ref:p,placeholder:e,onKeyDown:_}):t?i(se,{markdown:t}):"Nothing to preview"}),i(L,{show:l,onClose:()=>S(!1),handleUserTag:R})]})};try{U.displayName="MarkdownEditor",U.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const A=({initialText:e,initialTitle:t,id:s,onClose:a,isReply:n})=>{const[r,y]=f.useState(t??""),[l,S]=f.useState(e??""),{mutate:x,isLoading:v}=de({onSuccess:()=>a()}),{mutate:p,isLoading:R}=fe({onSuccess:()=>a()}),{mutate:_,isLoading:q}=ye({onSuccess:()=>a()}),{mutate:c,isLoading:u}=ie({onSuccess:()=>a()}),{mutate:d,isLoading:T}=oe({onSuccess:()=>a()}),w=R||u||q||v||T,M=(h,k)=>{n?e?d({replyId:s,messageMarkdown:h}):c({threadId:s,messageMarkdown:h}):t?(x({title:k,threadId:s}),p({messageMarkdown:h,threadId:s})):_({forumId:s,title:k,messageMarkdown:h})};return b("div",{className:"bootstrap-4-backport",children:[!n&&i(ce,{type:"text",placeholder:"Title",value:r,onChange:h=>y(h.target.value)}),i(U,{text:l,setText:S}),b("div",{style:{display:"flex",justifyContent:"flex-end"},children:[i(F,{onClick:a,variant:"light",children:"Cancel"}),i(F,{disabled:w,onClick:()=>M(l,r),variant:"primary",children:w?"Saving":"Save"})]})]})};try{A.displayName="ForumThreadEditor",A.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}}}catch{}export{A as F,Ee as a,Le as b,Qe as c,Ue as d,_e as e,qe as u};
//# sourceMappingURL=ForumThreadEditor-bd284b87.js.map
