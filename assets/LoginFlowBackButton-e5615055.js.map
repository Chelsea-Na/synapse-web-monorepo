{"version":3,"file":"LoginFlowBackButton-e5615055.js","sources":["../../src/lib/utils/hooks/useLogin.ts","../../../../node_modules/.pnpm/mui-one-time-password-input@1.0.4_7tz6pw5yjfnj6pyam4y5hsxs3m/node_modules/mui-one-time-password-input/dist/mui-one-time-password-input.es.js","../../src/lib/containers/auth/TOTPForm.tsx","../../src/lib/containers/auth/UsernamePasswordForm.tsx","../../src/lib/containers/auth/RecoveryCodeForm.tsx","../../src/lib/containers/auth/LoginForm.tsx","../../src/lib/containers/auth/LoginFlowBackButton.tsx"],"sourcesContent":["import { Dispatch, SetStateAction, useEffect, useState } from 'react'\nimport { SynapseClient } from '../index'\nimport { LoginResponse } from '../synapseTypes'\nimport {\n  TwoFactorAuthLoginRequest,\n  TwoFactorAuthOtpType,\n} from '../synapseTypes/TwoFactorAuthLoginRequest'\nimport { TwoFactorAuthErrorResponse } from '../synapseTypes/ErrorResponse'\nimport { AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY } from '../SynapseConstants'\nimport { useMutation } from 'react-query'\nimport { SynapseClientError } from '../SynapseClientError'\n\nexport type UseLoginReturn = {\n  step:\n    | 'CHOOSE_AUTH_METHOD'\n    | 'USERNAME_PASSWORD'\n    | 'VERIFICATION_CODE'\n    | 'RECOVERY_CODE'\n    | 'LOGGED_IN'\n  onStepChange: Dispatch<SetStateAction<UseLoginReturn['step']>>\n  submitUsernameAndPassword: (username: string, password: string) => void\n  submitOneTimePassword: (\n    code: string,\n    /* The type of one time password code that can be used to authenticate through two-factor authentication. Default is based on current value of `step` */\n    otpType?: TwoFactorAuthOtpType,\n  ) => void\n  errorMessage: string | undefined\n  isLoading: boolean\n}\n\n/**\n * Stateful hook that manages logging into Synapse\n */\nexport default function useLogin(\n  sessionCallback?: () => void,\n  twoFaErrorResponse?: TwoFactorAuthErrorResponse,\n): UseLoginReturn {\n  const [step, setStep] = useState<UseLoginReturn['step']>('CHOOSE_AUTH_METHOD')\n  const [errorMessage, setErrorMessage] = useState<string>()\n  const [userId, setUserId] = useState<number>()\n  const [twoFaToken, setTwoFaToken] = useState<string>()\n\n  /*\n   * In SWC, if logging in with OAuth, the servlet will call POST /oauth2/session2 to get the access token.\n   *\n   * If the user has 2FA enabled, the servlet will receive a 401 with the userId and twoFaToken in the response.\n   * The servlet will then redirect the user to the login page with the userId and twoFaToken in the searchParams.\n   *\n   * This effect will check if the search params are present, and change the step to 'VERIFICATION_CODE' if they are.\n   */\n  useEffect(() => {\n    // Replace the hash with a slash to handle SWC, which uses a hash in the URL. Otherwise, the searchParams aren't found\n    const fullUrl: URL = new URL(window.location.href.replaceAll('#', '/'))\n\n    const { searchParams } = fullUrl\n    if (searchParams) {\n      const userId = searchParams.get('userId')\n      const twoFaToken = searchParams.get('twoFaToken')\n      if (userId && twoFaToken) {\n        setUserId(parseInt(userId, 10))\n        setTwoFaToken(twoFaToken)\n        if (\n          !['VERIFICATION_CODE', 'RECOVERY_CODE', 'LOGGED_IN'].includes(step)\n        ) {\n          setStep('VERIFICATION_CODE')\n        }\n      }\n    }\n  }, [step])\n\n  /*\n   * In client-only apps (like Portals), if logging in with OAuth, the client app will call POST /oauth2/session2 to get the access token.\n   *\n   * If the user has 2FA enabled, the client app will receive a 401 with the userId and twoFaToken in the response.\n   *\n   * The app can pass the error response as a prop/argument, and we'll use it here to jump straight to the VERIFICATION_CODE step.\n   */\n  useEffect(() => {\n    if (twoFaErrorResponse) {\n      setTwoFaToken(twoFaErrorResponse.twoFaToken)\n      setUserId(twoFaErrorResponse.userId)\n      if (!['VERIFICATION_CODE', 'RECOVERY_CODE', 'LOGGED_IN'].includes(step)) {\n        setStep('VERIFICATION_CODE')\n      }\n    }\n  }, [twoFaErrorResponse])\n\n  async function finishLogin(loginResponse: LoginResponse) {\n    await SynapseClient.setAccessTokenCookie(loginResponse.accessToken)\n    localStorage.setItem(\n      AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY,\n      loginResponse.authenticationReceipt,\n    )\n    setStep('LOGGED_IN')\n\n    if (sessionCallback) {\n      sessionCallback()\n    }\n  }\n\n  const {\n    mutate: mutateLoginWithUsernameAndPassword,\n    isLoading: isLoadingLoginWithUsernameAndPassword,\n  } = useMutation<\n    LoginResponse | TwoFactorAuthErrorResponse,\n    SynapseClientError,\n    { username: string; password: string; authenticationReceipt: string | null }\n  >(\n    ({ username, password, authenticationReceipt }) =>\n      SynapseClient.login(username, password, authenticationReceipt),\n    {\n      onError: error => {\n        setErrorMessage(error.reason)\n      },\n      onSuccess: async loginResponse => {\n        if ('errorCode' in loginResponse) {\n          setStep('VERIFICATION_CODE')\n          setTwoFaToken(loginResponse.twoFaToken)\n          setUserId(loginResponse.userId)\n        } else {\n          await finishLogin(loginResponse)\n        }\n      },\n    },\n  )\n\n  const {\n    mutate: mutateLoginWith2FACode,\n    isLoading: isLoadingLoginWith2FACode,\n  } = useMutation<LoginResponse, SynapseClientError, TwoFactorAuthLoginRequest>(\n    SynapseClient.loginWith2fa,\n    {\n      onError: e => {\n        setErrorMessage(e.reason)\n        if (\n          // The twoFaToken wasn't transmitted correctly\n          e.reason.includes('The provided twoFaToken is invalid') ||\n          // The user waited too long to enter the code.\n          e.reason.includes('Token has expired')\n        ) {\n          console.warn(e)\n          // Instruct the user refresh to start over.\n          setErrorMessage(\n            'Something went wrong. Refresh the page and try again.',\n          )\n          // If the 2FA token is in the search parameters, remove it so the user doesn't just get the same error again.\n          if (window.location.href.includes('twoFaToken')) {\n            window.history.replaceState(\n              {},\n              document.title,\n              // using regex because SWC hashbang doesn't work with URLSearchParams\n              window.location.href.replaceAll(\n                /(twoFaToken|userId)=[^&]*&?/g,\n                '',\n              ),\n            )\n          }\n        }\n      },\n      onSuccess: finishLogin,\n    },\n  )\n\n  const submitUsernameAndPassword: UseLoginReturn['submitUsernameAndPassword'] =\n    (username, password) => {\n      setErrorMessage(undefined)\n      const authenticationReceipt = localStorage.getItem(\n        AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY,\n      )\n      mutateLoginWithUsernameAndPassword({\n        username,\n        password,\n        authenticationReceipt,\n      })\n    }\n\n  const submitOneTimePassword: UseLoginReturn['submitOneTimePassword'] = (\n    code,\n    otpType = step === 'RECOVERY_CODE' ? 'RECOVERY_CODE' : 'TOTP',\n  ) => {\n    setErrorMessage(undefined)\n    if (twoFaToken == null || userId == null) {\n      // This could happen if the 2FA component exists on its own route, and the user directly navigates to it without first logging in with credentials/OAuth\n      setErrorMessage(\n        'You did not first log in with your password or a third-party identity provider.',\n      )\n      return\n    }\n    const request: TwoFactorAuthLoginRequest = {\n      userId: userId,\n      twoFaToken: twoFaToken,\n      otpCode: code,\n      otpType: otpType,\n    }\n    mutateLoginWith2FACode(request)\n  }\n\n  return {\n    step,\n    onStepChange: setStep,\n    submitUsernameAndPassword,\n    submitOneTimePassword: submitOneTimePassword,\n    errorMessage,\n    isLoading:\n      isLoadingLoginWithUsernameAndPassword || isLoadingLoginWith2FACode,\n  }\n}\n","import T from \"react\";\nimport v from \"@mui/material/Box\";\nimport { styled as L } from \"@mui/material/styles\";\nimport W from \"@mui/material/TextField\";\nimport { jsx as C } from \"react/jsx-runtime\";\nconst q = L(W)`\n  input {\n    text-align: center;\n  }\n`, z = {\n  TextFieldStyled: q\n}, G = (n) => /* @__PURE__ */ C(z.TextFieldStyled, {\n  ...n\n}), F = {\n  left: \"ArrowLeft\",\n  right: \"ArrowRight\",\n  backspace: \"Backspace\"\n};\nfunction H(n, o) {\n  return n <= 0 ? [] : Array.from({ length: n }, o);\n}\nfunction J(n, o, i) {\n  return n.map((a, s) => o === s ? i : a);\n}\nfunction w(n) {\n  return n.join(\"\");\n}\nfunction B(n, o) {\n  return [...n, o];\n}\nfunction Q(n, o, i) {\n  return n.reduce(\n    (a, s, d) => {\n      const { characters: p, restArrayMerged: f } = a;\n      if (d < i)\n        return {\n          restArrayMerged: f,\n          characters: B(p, s)\n        };\n      const [h, ...g] = f;\n      return {\n        restArrayMerged: g,\n        characters: B(p, h || \"\")\n      };\n    },\n    {\n      restArrayMerged: o,\n      characters: []\n    }\n  ).characters;\n}\nfunction U(n) {\n  return n.split(\"\");\n}\nconst X = T.forwardRef((n, o) => {\n  const {\n    value: i,\n    length: a,\n    onChange: s,\n    TextFieldsProps: d,\n    onComplete: p,\n    validateChar: f,\n    className: h,\n    ...g\n  } = n, {\n    onPaste: P,\n    onFocus: R,\n    onKeyDown: S,\n    className: k,\n    ...M\n  } = d || {}, u = H(a, (e, r) => ({\n    character: i[r] || \"\",\n    inputRef: T.createRef()\n  })), m = (e) => u.findIndex(({\n    inputRef: r\n  }) => r.current === e), D = () => u.map(({\n    character: e\n  }) => e), E = (e, r) => {\n    const t = J(D(), e, r);\n    return w(t);\n  }, x = (e) => {\n    u[e]?.inputRef.current?.focus();\n  }, l = (e) => {\n    u[e]?.inputRef.current?.select();\n  }, y = (e) => {\n    e + 1 !== a && (u[e + 1].character ? l(e + 1) : x(e + 1));\n  }, N = (e) => {\n    e > 0 && l(e - 1);\n  }, K = (e) => {\n    const r = e.target.value[0] || \"\", t = m(e.target);\n    if (typeof f == \"function\" && !f(r, t))\n      return;\n    const c = E(t, r);\n    s?.(c), c.length === a && p?.(c), r !== \"\" ? c.length < a ? y(c.length - 1) : y(t) : c[t] ? l(t) : N(t);\n  }, V = (e) => {\n    e.preventDefault(), e.target.select(), R?.(e);\n  }, b = (e) => {\n    const r = e.target, t = m(r);\n    r.value === e.key ? (e.preventDefault(), y(t)) : !r.value && F.backspace === e.key || F.left === e.key ? (e.preventDefault(), l(t - 1)) : F.right === e.key && (e.preventDefault(), l(t + 1)), S?.(e);\n  }, j = (e) => {\n    e.preventDefault();\n    const r = e.target, t = e.clipboardData.getData(\"text/plain\"), c = m(r), $ = D(), A = Q($, U(t), c), O = A.findIndex((Y, _) => _ > c && Y === \"\"), I = w(A);\n    if (s?.(I), I.length === a) {\n      p?.(I), x(a - 1);\n      return;\n    }\n    O !== -1 && x(O), P?.(e);\n  };\n  return /* @__PURE__ */ C(v, {\n    display: \"flex\",\n    gap: \"20px\",\n    alignItems: \"center\",\n    ref: o,\n    className: `MuiOtpInput-Box ${h || \"\"}`,\n    ...g,\n    children: u.map(({\n      character: e,\n      inputRef: r\n    }, t) => /* @__PURE__ */ C(G, {\n      autoComplete: \"one-time-code\",\n      value: e,\n      inputRef: r,\n      className: `MuiOtpInput-TextField MuiOtpInput-TextField-${t + 1} ${k || \"\"}`,\n      onPaste: j,\n      onFocus: V,\n      onChange: K,\n      onKeyDown: b,\n      ...M\n    }, t))\n  });\n});\nX.defaultProps = {\n  value: \"\",\n  length: 4,\n  validateChar: () => !0,\n  onChange: () => {\n  },\n  onComplete: () => {\n  },\n  TextFieldsProps: {}\n};\nexport {\n  X as MuiOtpInput\n};\n","import React from 'react'\nimport { Box, Button } from '@mui/material'\nimport { MuiOtpInput } from 'mui-one-time-password-input'\nimport { UseLoginReturn } from '../../utils/hooks'\n\nconst TOTP_LENGTH = 6\nconst DIGIT_CHARACTERS = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']\n\ntype TOTPFormProps = {\n  onSubmit: (value: string) => void\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function TOTPForm(props: TOTPFormProps) {\n  const { onSubmit, isLoading } = props\n  const [verificationCode, setVerificationCode] = React.useState('')\n  return (\n    <Box>\n      <MuiOtpInput\n        length={TOTP_LENGTH}\n        value={verificationCode}\n        onChange={setVerificationCode}\n        onComplete={onSubmit}\n        validateChar={(character: string) => {\n          return DIGIT_CHARACTERS.includes(character) || character === ''\n        }}\n        gap={0}\n        sx={{\n          '.MuiFormControl-root:first-of-type > .MuiInputBase-root': {\n            borderTopRightRadius: 0,\n            borderBottomRightRadius: 0,\n          },\n          '.MuiFormControl-root:last-of-type > .MuiInputBase-root': {\n            borderTopLeftRadius: 0,\n            borderBottomLeftRadius: 0,\n          },\n          '.MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root':\n            {\n              borderRadius: 0,\n            },\n        }}\n      />\n\n      <Button\n        fullWidth\n        type=\"submit\"\n        color=\"primary\"\n        variant=\"contained\"\n        sx={{\n          height: '50px',\n          mt: 4,\n          mb: 2,\n        }}\n        disabled={verificationCode.length !== TOTP_LENGTH || isLoading}\n        onClick={e => {\n          e.preventDefault()\n          onSubmit(verificationCode)\n        }}\n      >\n        {isLoading ? 'Verifying...' : 'Submit'}\n      </Button>\n    </Box>\n  )\n}\n","import { Button, Link } from '@mui/material'\nimport React, { useState } from 'react'\nimport {\n  BackendDestinationEnum,\n  getEndpoint,\n} from '../../utils/functions/getEndpoint'\nimport TextField from '../TextField'\nimport { UseLoginReturn } from '../../utils/hooks'\n\ntype UsernamePasswordFormProps = {\n  onSubmit: (username: string, password: string) => void\n  resetPasswordUrl?: string\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function UsernamePasswordForm(props: UsernamePasswordFormProps) {\n  const {\n    resetPasswordUrl = `${getEndpoint(\n      BackendDestinationEnum.PORTAL_ENDPOINT,\n    )}#!PasswordReset:0`,\n    onSubmit,\n    isLoading,\n  } = props\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n\n  function handleLogin(e: React.SyntheticEvent) {\n    e.preventDefault()\n    onSubmit(username, password)\n  }\n  return (\n    <form\n      onSubmit={e => {\n        handleLogin(e)\n      }}\n    >\n      <TextField\n        required\n        fullWidth\n        autoFocus\n        autoComplete=\"username\"\n        label=\"Username or Email Address\"\n        id=\"username\"\n        type=\"text\"\n        value={username}\n        onChange={e => setUsername(e.target.value)}\n      />\n      <TextField\n        required\n        fullWidth\n        autoComplete=\"current-password\"\n        label=\"Password\"\n        id=\"current-password\"\n        type=\"password\"\n        value={password}\n        onChange={e => setPassword(e.target.value)}\n      />\n      <Link href={resetPasswordUrl}>Forgot password?</Link>\n      <Button\n        fullWidth\n        type=\"submit\"\n        color=\"primary\"\n        variant=\"contained\"\n        disabled={isLoading}\n        sx={{\n          height: '50px',\n          mt: 4,\n          mb: 2,\n        }}\n      >\n        {isLoading ? 'Logging you in...' : 'Sign in'}\n      </Button>\n    </form>\n  )\n}\n","import React from 'react'\nimport { Box, Button } from '@mui/material'\nimport TextField from '../TextField'\nimport { UseLoginReturn } from '../../utils/hooks'\n\n// 16 characters separated into chunks of 4 by 3 hyphens\nconst RECOVERY_CODE_LENGTH = 19\n\ntype RecoveryCodeFormProps = {\n  onSubmit: (value: string) => void\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function RecoveryCodeForm(props: RecoveryCodeFormProps) {\n  const { onSubmit, isLoading } = props\n  const [recoveryCode, setRecoveryCode] = React.useState('')\n  return (\n    <Box>\n      <TextField\n        placeholder=\"Enter backup code\"\n        value={recoveryCode}\n        onChange={e => {\n          // coerce the input to lowercase and remove any nonalphanumeric or hyphen characters\n          const valueWithAllowedChars = e.target.value\n            .toLowerCase()\n            .replace(/[^a-z0-9-]/gi, '')\n          setRecoveryCode(valueWithAllowedChars)\n        }}\n      />\n\n      <Button\n        fullWidth\n        type=\"submit\"\n        color=\"primary\"\n        variant=\"contained\"\n        sx={{\n          height: '50px',\n          mt: 4,\n          mb: 2,\n        }}\n        disabled={recoveryCode.length !== RECOVERY_CODE_LENGTH || isLoading}\n        onClick={e => {\n          e.preventDefault()\n          onSubmit(recoveryCode)\n        }}\n      >\n        {isLoading ? 'Verifying...' : 'Submit'}\n      </Button>\n    </Box>\n  )\n}\n","import React from 'react'\nimport {\n  BackendDestinationEnum,\n  getEndpoint,\n} from '../../utils/functions/getEndpoint'\nimport { Box, Link } from '@mui/material'\nimport FullWidthAlert from '../FullWidthAlert'\nimport { UseLoginReturn } from '../../utils/hooks'\nimport { TwoFactorAuthErrorResponse } from '../../utils/synapseTypes/ErrorResponse'\nimport TOTPForm from './TOTPForm'\nimport UsernamePasswordForm from './UsernamePasswordForm'\nimport AuthenticationMethodSelection from './AuthenticationMethodSelection'\nimport RecoveryCodeForm from './RecoveryCodeForm'\n\ntype Props = {\n  ssoRedirectUrl?: string\n  registerAccountUrl?: string\n  resetPasswordUrl?: string\n  /* Invoked before redirecting to Google. Useful in portals where we may want to store the current URL to redirect back here. */\n  onBeginOAuthSignIn?: () => void\n  step: UseLoginReturn['step']\n  onStepChange: (step: UseLoginReturn['step']) => void\n  /* optionally pass the 2FA error response to directly start the 2FA challenge */\n  twoFactorAuthenticationRequired?: TwoFactorAuthErrorResponse\n  submitUsernameAndPassword: UseLoginReturn['submitUsernameAndPassword']\n  submitOneTimePassword: UseLoginReturn['submitOneTimePassword']\n  errorMessage: UseLoginReturn['errorMessage']\n  isLoading: UseLoginReturn['isLoading']\n}\n\nexport default function LoginForm(props: Props) {\n  const {\n    ssoRedirectUrl,\n    registerAccountUrl = `${getEndpoint(\n      BackendDestinationEnum.PORTAL_ENDPOINT,\n    )}#!RegisterAccount:0`,\n    resetPasswordUrl,\n    onBeginOAuthSignIn,\n    onStepChange,\n    step,\n    submitUsernameAndPassword,\n    submitOneTimePassword,\n    errorMessage,\n    isLoading,\n  } = props\n\n  return (\n    <>\n      {step == 'CHOOSE_AUTH_METHOD' && (\n        <AuthenticationMethodSelection\n          onSelectUsernameAndPassword={() => onStepChange('USERNAME_PASSWORD')}\n          onBeginOAuthSignIn={onBeginOAuthSignIn}\n          ssoRedirectUrl={ssoRedirectUrl}\n        />\n      )}\n      {step === 'USERNAME_PASSWORD' && (\n        <UsernamePasswordForm\n          isLoading={isLoading}\n          resetPasswordUrl={resetPasswordUrl}\n          onSubmit={(username, password) => {\n            submitUsernameAndPassword(username, password)\n          }}\n        />\n      )}\n      {step === 'VERIFICATION_CODE' && (\n        <>\n          <TOTPForm\n            isLoading={isLoading}\n            onSubmit={totp => {\n              submitOneTimePassword(totp, 'TOTP')\n            }}\n          />\n          <Link\n            align={'center'}\n            color={'grey.700'}\n            sx={{ display: 'block', mx: 'auto' }}\n            onClick={() => onStepChange('RECOVERY_CODE')}\n          >\n            Use a backup code instead\n          </Link>\n        </>\n      )}\n      {step === 'RECOVERY_CODE' && (\n        <RecoveryCodeForm\n          isLoading={isLoading}\n          onSubmit={recoveryCode => {\n            submitOneTimePassword(recoveryCode, 'RECOVERY_CODE')\n          }}\n        />\n      )}\n      {(step === 'CHOOSE_AUTH_METHOD' || step === 'USERNAME_PASSWORD') && (\n        <Box display={'flex'} justifyContent={'center'}>\n          <Link href={registerAccountUrl} align={'center'}>\n            Don&apos;t have an account? Create one now\n          </Link>\n        </Box>\n      )}\n      {errorMessage && (\n        <FullWidthAlert\n          variant={'warning'}\n          isGlobal={false}\n          description={errorMessage}\n        />\n      )}\n    </>\n  )\n}\n","import { IconButton, SxProps } from '@mui/material'\nimport IconSvg from '../IconSvg'\nimport React from 'react'\nimport { UseLoginReturn } from '../../utils/hooks'\n\ntype LoginFormBackButtonProps = {\n  step: UseLoginReturn['step']\n  onStepChange: (step: UseLoginReturn['step']) => void\n  sx?: SxProps\n}\n\nfunction getPreviousStep(currentStep: UseLoginReturn['step']) {\n  switch (currentStep) {\n    case 'CHOOSE_AUTH_METHOD':\n      // Should never happen\n      return 'CHOOSE_AUTH_METHOD'\n    case 'USERNAME_PASSWORD':\n      return 'CHOOSE_AUTH_METHOD'\n    case 'VERIFICATION_CODE':\n      // Could have reached this step from either username + password or OAuth sign in, so go back to the beginning\n      return 'CHOOSE_AUTH_METHOD'\n    case 'RECOVERY_CODE':\n      return 'VERIFICATION_CODE'\n    case 'LOGGED_IN':\n      // Should never happen\n      return 'LOGGED_IN'\n  }\n}\n\nexport default function LoginFlowBackButton(props: LoginFormBackButtonProps) {\n  const { step, onStepChange, sx } = props\n  const shouldRender =\n    step === 'USERNAME_PASSWORD' ||\n    step === 'VERIFICATION_CODE' ||\n    step === 'RECOVERY_CODE'\n\n  if (!shouldRender) {\n    return null\n  }\n  return (\n    <IconButton\n      type=\"button\"\n      onClick={() => {\n        onStepChange(getPreviousStep(step))\n      }}\n      sx={sx}\n    >\n      <IconSvg\n        icon=\"arrowBack\"\n        wrap={false}\n        sx={{ height: '24px', width: '24px' }}\n      />\n    </IconButton>\n  )\n}\n"],"names":["useLogin","sessionCallback","twoFaErrorResponse","step","setStep","useState","errorMessage","setErrorMessage","userId","setUserId","twoFaToken","setTwoFaToken","useEffect","fullUrl","searchParams","finishLogin","loginResponse","SynapseClient.setAccessTokenCookie","AUTHENTICATION_RECEIPT_LOCALSTORAGE_KEY","mutateLoginWithUsernameAndPassword","isLoadingLoginWithUsernameAndPassword","useMutation","username","password","authenticationReceipt","SynapseClient.login","error","mutateLoginWith2FACode","isLoadingLoginWith2FACode","SynapseClient.loginWith2fa","e","code","otpType","q","L","W","z","G","n","C","F","H","o","J","i","a","s","w","B","Q","d","p","f","h","g","U","X","T","P","R","S","k","M","u","r","m","D","t","x","_b","_a","l","y","N","K","c","V","b","j","$","A","O","Y","_","I","v","TOTP_LENGTH","DIGIT_CHARACTERS","TOTPForm","props","onSubmit","isLoading","verificationCode","setVerificationCode","React","jsxs","Box","jsx","MuiOtpInput","character","Button","UsernamePasswordForm","resetPasswordUrl","getEndpoint","BackendDestinationEnum","setUsername","setPassword","handleLogin","TextField","Link","RECOVERY_CODE_LENGTH","RecoveryCodeForm","recoveryCode","setRecoveryCode","valueWithAllowedChars","LoginForm","ssoRedirectUrl","registerAccountUrl","onBeginOAuthSignIn","onStepChange","submitUsernameAndPassword","submitOneTimePassword","Fragment","AuthenticationMethodSelection","totp","FullWidthAlert","getPreviousStep","currentStep","LoginFlowBackButton","sx","IconButton","IconSvg"],"mappings":"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"}