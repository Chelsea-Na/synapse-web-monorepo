import{a as b,j as t,F}from"./jsx-runtime-9dc53467.js";import{r as s}from"./index-76fb7be0.js";import{S as Ie}from"./StepperDialog-c9743aec.js";import{T as H}from"./TextField-1929bba2.js";import{B as C}from"./Box-737945d6.js";import{T as J}from"./Typography-62cfc992.js";import{r as Me,i as Ne,a as xe}from"./jsx-runtime_commonjs-proxy-dd7a2d35.js";import{f as we}from"./DateFormatter-10da315c.js";import{d as Ae}from"./dayjs.min-f79c4412.js";import{a as Oe}from"./RadioGroup-13ffdadd.js";import{d as Le}from"./Search-9e962970.js";import{B as oe}from"./Box-424979b7.js";import{b as qe}from"./InputLabel-060c2cf9.js";import"./SkeletonButton-96bd3884.js";import"./HelpPopover-6cef0b43.js";import{S as Ue}from"./SkeletonTable-04ae7db3.js";import{o as X,s as ue,t as me,r as Fe,H as Je,bu as le,bv as Ge,bw as He,bx as Qe,by as je}from"./SynapseClient-4fd58c49.js";import{g as ke,B as Be}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-c0eacdfc.js";import{L as Ye}from"./react-router-dom-d06960fd.js";import{D as Ve}from"./DataGrid-93b4f6e5.js";import{c as De}from"./Stack-eb200119.js";import{B as Pe}from"./Button-a2b8b546.js";import{M as $e}from"./TextField-4b8d3337.js";import{j as We}from"./SynapseConstants-c93e8ee4.js";import{u as ze}from"./useGetEntityChallenge-226575df.js";import{u as Ke}from"./useGetUserTeams-26e73fa8.js";import{b as de}from"./useTeamMembers-fa8585be.js";const Xe=De(),Ze=Xe,D=({onChangeTeamInfo:a,onError:m})=>{const[c,i]=s.useState({name:"",description:"",message:"",invitees:""}),f=d=>{const o={...c,...d};i(o),a(o)},R=d=>{if(d.split(",").length>3&&m)return m("Please limit the initial number of invited members to three. You may add additional members after the team has been created.");f({invitees:d})};return b(C,{children:[t(J,{variant:"body1",sx:{lineHeight:"20px"},children:"Create a new team for this Challenge!"}),t(H,{id:"name",label:"Team Name",value:c.name,fullWidth:!0,autoFocus:!0,required:!0,onChange:d=>f({name:d.target.value})}),t(C,{display:"flex",children:t(H,{id:"description",label:t(C,{display:"flex",gap:2,children:t(C,{children:"Team Description"})}),value:c.description,fullWidth:!0,multiline:!0,rows:4,onChange:d=>f({description:d.target.value})})}),t(C,{display:"flex",children:t(H,{id:"message",label:t(C,{display:"flex",gap:2,children:t(C,{children:"Recruitment Message"})}),value:c.message,fullWidth:!0,multiline:!0,rows:4,onChange:d=>f({message:d.target.value})})}),t(H,{id:"invitees",label:"Emails of Additional Members to Invite (max 3)",placeholder:"Enter emails separated by comma",value:c.invitees,fullWidth:!0,onChange:d=>R(d.target.value)})]})};try{D.displayName="CreateChallengeTeam",D.__docgenInfo={description:"",displayName:"CreateChallengeTeam",props:{onChangeTeamInfo:{defaultValue:null,description:"",name:"onChangeTeamInfo",required:!0,type:{name:"(update: CreateTeamRequest) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"((msg: string) => void)"}}}}}catch{}var Z={},et=Ne;Object.defineProperty(Z,"__esModule",{value:!0});var fe=Z.default=void 0,tt=et(Me()),at=xe,nt=(0,tt.default)((0,at.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"ControlPoint");fe=Z.default=nt;const P=({rowCount:a,onChange:m})=>{const c=a>5?"calc(100% - 8px)":"100%";return b(oe,{component:"form",sx:{p:"4px 4px",display:"flex",flexGrow:1,width:c,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[t(oe,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:t(Le,{sx:{color:"#878E95"}})}),t(qe,{onChange:m,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})};try{P.displayName="ChallengeTeamSearch",P.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function rt(a,m){const{accessToken:c,keyFactory:i}=X();return ue(i.getTeamListQueryKey(a.sort().join()),()=>me.getTeamList(a,c),m)}function st(a,m){const{accessToken:c,keyFactory:i}=X();return ue(i.getChallengeTeamListQueryKey(a),()=>me.getAllChallengeTeams(c,a),m)}function $({challengeId:a,onSelectTeam:m}){const[c,i]=s.useState([]),[f,R]=s.useState([]),[d,o]=s.useState({}),{data:p}=st(a),[j,r]=s.useState(),{data:n,isLoading:I}=rt(f,{enabled:!!f.length}),k=l=>{r(l),m(d[l])},M=l=>({id:l.id,name:l.name,created:we(Ae(l.createdOn),"MM/DD/YY"),description:l.description});s.useEffect(()=>{const l=(p==null?void 0:p.map(_=>_.teamId))??[];R(l)},[p]),s.useEffect(()=>{const l=(n==null?void 0:n.list.filter(h=>h.canRequestMembership!==!1))??[],_=[],S={};l.forEach(h=>{_.push(M(h)),S[h.id]=h}),i(_),o(S)},[n]);const B=l=>{const _=l.target.value.toLowerCase(),S=(n==null?void 0:n.list.filter(y=>y.canRequestMembership!==!1))??[];let h=S;_.length&&(h=S.filter(y=>{var x;return y.name.toLowerCase().includes(_)||((x=y.description)==null?void 0:x.toLowerCase().includes(_))})),i(h.map(y=>M(y)))},T=[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:l=>t(Oe,{value:l.id,currentValue:j,onChange:k,label:"",style:{marginBottom:"16px"}})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:l=>t(Ye,{to:{pathname:`${ke(Be.PORTAL_ENDPOINT)}/#!Team:${l.row.id}`},target:"_blank",children:l.row.name})},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}];return b(C,{sx:{height:220},children:[!I&&b(F,{children:[t(P,{onChange:B,rowCount:c.length}),t(Ve,{rows:c,columns:T,rowCount:5,hideFooter:!0,density:"compact",sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"}},getRowClassName:l=>l.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]}),I&&t(Ue,{numRows:10,numCols:1})]})}try{$.displayName="ChallengeTeamTable",$.__docgenInfo={description:"",displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const W=({challengeId:a,onCreateTeam:m,onSelectTeam:c})=>b(Ze,{spacing:1,children:[t(J,{variant:"body1",sx:{lineHeight:"20px"},children:'To participate in a challenge, you need to create a new Team or join an existing one.     By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.     All team members will need a Synapse account so that they can login and accept the team invitation.'}),t(C,{sx:{height:270},children:t($,{challengeId:a,onSelectTeam:c})}),t(C,{children:t(Pe,{color:"primary",variant:"contained",onClick:m,startIcon:t(fe,{}),children:"Create New Team"})})]});try{W.displayName="SelectChallengeTeam",W.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const z=({createdNewTeam:a,teamName:m})=>m?b(F,{children:[b(J,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",a?"created":"joined"," team"," ",t("b",{children:m})," and have been added to this challenge."]}),a&&t(C,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null;try{z.displayName="RegistrationSuccessful",z.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamName:{defaultValue:null,description:"",name:"teamName",required:!0,type:{name:"string | undefined"}}}}}catch{}const K=({team:a,joinMessageChange:m})=>{const[c,i]=s.useState("");if(!a)return null;const f=R=>{const d=R.target.value;i(d),m(d)};return b(F,{children:[b(J,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",t("strong",{children:a.name})," team."]}),t(C,{children:t("strong",{children:"Your Message to Team Managers(s)"})}),t(C,{children:t($e,{id:"membershipRequestMessage",value:c,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:f})})]})};try{K.displayName="JoinRequestForm",K.__docgenInfo={description:"",displayName:"JoinRequestForm",props:{team:{defaultValue:null,description:"",name:"team",required:!0,type:{name:"Team | undefined"}},joinMessageChange:{defaultValue:null,description:"",name:"joinMessageChange",required:!0,type:{name:"(msg: string) => void"}}}}}catch{}const Q={SELECT_YOUR_CHALLENGE_TEAM:{id:"SELECT_YOUR_CHALLENGE_TEAM",title:"Select Your Challenge Team",nextStep:"JOIN_REQUEST_FORM",nextEnabled:!1},JOIN_REQUEST_FORM:{id:"JOIN_REQUEST_FORM",title:"Request Team Membership",previousStep:"SELECT_YOUR_CHALLENGE_TEAM",confirmStep:"JOIN_REQUEST_SENT",confirmButtonText:"Send Request",confirmEnabled:!0},JOIN_REQUEST_SENT:{id:"JOIN_REQUEST_SENT",title:"Request Sent",confirmButtonText:"Close",confirmEnabled:!0},CREATE_NEW_TEAM:{id:"CREATE_NEW_TEAM",title:"Create Team",confirmStep:"REGISTRATION_SUCCESSFUL",confirmButtonText:"Finish Registration",confirmEnabled:!1,previousStep:"SELECT_YOUR_CHALLENGE_TEAM"},REGISTRATION_SUCCESSFUL:{id:"REGISTRATION_SUCCESSFUL",title:"Registration Successful!"}},U="",ce=({projectId:a,isShowingModal:m=!1,onClose:c})=>{const{accessToken:i,keyFactory:f}=X(),[R,d]=s.useState(!0),[o,p]=s.useState(Q.SELECT_YOUR_CHALLENGE_TEAM),[j,r]=s.useState(),[n,I]=s.useState(),[k,M]=s.useState(!1),[B,T]=s.useState(!1),[l,_]=s.useState(!1),S=Fe(),[h,y]=s.useState({}),[x,Y]=s.useState(!1),[ee,te]=s.useState(!1),[N,pe]=s.useState({name:"",description:"",message:"",invitees:""}),[he,ge]=s.useState(""),{data:E}=Je(),{data:g}=ze(a),w=g?g.participantTeamId:U,A=E?E.ownerId:U,{data:O}=de(w,A);s.useEffect(()=>{O&&!(O!=null&&O.isMember)&&i&&le(w,A,i).then(()=>{S.invalidateQueries(f.getMembershipStatusQueryKey(w,A)),S.invalidateQueries(f.getIsUserMemberOfTeamQueryKey(w,A))}).catch(e=>{r(e.reason)})},[i,w,A,O,S,f]);const{data:V,error:ae}=Ke((g==null?void 0:g.id)??U,1);s.useEffect(()=>{if(V){const e=V.results.length>0;e&&(r("Error: You are already a member of a registered submission team for this Challenge."),_(e)),d(!1)}ae&&(r("Error: Could not determine if you are already registered for this Challenge."),d(!1))},[V,ae]),de((n==null?void 0:n.id)??U,(E==null?void 0:E.ownerId)??U,{enabled:!!n&&!!E,onSettled:(e,u)=>{e&&y({...h,[e.teamId]:e}),u&&r(u.reason)}});const ne=()=>{if(n&&n.id in h){const{canJoin:e,membershipApprovalRequired:u,isMember:v,hasOpenInvitation:L,hasOpenRequest:q}=h[n.id];if(v)return{canJoin:!1,errorMessage:"You are already a member of this team."};if(q)return{canJoin:!1,errorMessage:"Your previous request to join this team is pending review."};if(L||e||u)return{canJoin:!0,needsApproval:u,errorMessage:void 0}}return{canJoin:!1}};s.useEffect(()=>{!!E&&E.ownerId===We.toString()&&(d(!1),r("Please login to continue."))},[i,E,a,g]),s.useEffect(()=>{x&&ee&&(T(!1),G(o.confirmStep))},[ee,x,o]),s.useEffect(()=>{if(n&&n.id in h&&o.id==="SELECT_YOUR_CHALLENGE_TEAM"){const{canJoin:e,errorMessage:u}=ne();if(e){o.nextEnabled||p({...o,nextEnabled:!0});return}o.nextEnabled&&p({...o,nextEnabled:!1}),u&&r(u)}},[h,n,o]);const Te=e=>{e&&(r(void 0),I(e))},Ee=e=>{pe(e);const u=e.name.length>1;p({...o,confirmEnabled:u})},Ce=(e=n==null?void 0:n.id)=>{!e||!E||!i||(T(!0),r(void 0),le(e,E.ownerId,i).then(()=>{g&&S.invalidateQueries(f.getSubmissionTeamsQueryKey(g==null?void 0:g.id)),G("REGISTRATION_SUCCESSFUL")}).catch(u=>{r(`Error joining team: ${u.reason}`)}).finally(()=>{T(!1)}))},_e=async()=>{E&&n&&(T(!0),p({...o,nextEnabled:!1}),r(void 0),await Ge(n.id,E.ownerId,he,void 0,i).then(()=>{p(Q.JOIN_REQUEST_SENT)}).catch(e=>{console.error({err:e}),r(`Error requesting membership: ${e.reason}`)}).finally(()=>{T(!1)}))},Se=async e=>{const u="Error registering challenge team";e&&g?(r(void 0),te(!1),await Qe(i,g.id,e).then(()=>{te(!0)}).catch(v=>{r(`${u}: ${v.reason}`),T(!1)})):(r(`${u}: Invalid team.`),T(!1))},be=async(e,u)=>{if(!u.length){Y(!0);return}const v="Error inviting members";if(e){r(void 0),Y(!1);const L=u.split(","),q=[];for(const ie of L)await je(i,e,ie.trim()).catch(()=>{q.push(ie.trim())});q.length?(r(`${v}: ${q.join(", ")}`),T(!1)):Y(!0)}else r(`${v}: Invalid team.`),T(!1)},ye=async()=>{N&&N.name&&N.name.length>1&&(p({...o,confirmEnabled:!1}),T(!0),r(void 0),await He(i,N.name,N.description).then(e=>{M(!0),I(e),Se(e.id),be(e.id,N.invitees)}).catch(e=>{T(!1),r(`Error creating team: ${e.reason}`),p({...o,confirmEnabled:!0})}))},re=()=>{r(void 0),M(!1),I(void 0),p({...o,nextEnabled:!1}),c()},se={CREATE_NEW_TEAM:ye,JOIN_REQUEST_FORM:_e,JOIN_REQUEST_SENT:()=>{re()}},ve=()=>{switch(o.id){case"SELECT_YOUR_CHALLENGE_TEAM":return i&&g&&!l?t(W,{challengeId:g.id,onCreateTeam:()=>G("CREATE_NEW_TEAM"),onSelectTeam:Te}):t(F,{});case"JOIN_REQUEST_FORM":return t(K,{team:n,joinMessageChange:ge});case"JOIN_REQUEST_SENT":return t(J,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."});case"REGISTRATION_SUCCESSFUL":return t(z,{createdNewTeam:k,teamName:n==null?void 0:n.name});case"CREATE_NEW_TEAM":return t(D,{onChangeTeamInfo:Ee,onError:r});default:return t(F,{})}};function G(e){if(!e||!Q[e])return;r(void 0);const{canJoin:u,errorMessage:v,needsApproval:L}=ne();switch(e){case"SELECT_YOUR_CHALLENGE_TEAM":M(!1);break;case"JOIN_REQUEST_FORM":if(u){if(!L)return Ce()}else return r(v);break}p(Q[e])}const Re=se[o.id]?se[o.id]:()=>{};return t(Ie,{errorMessage:j,onCancel:re,onStepChange:G,open:m,onConfirm:Re,confirming:B,step:o,content:ve(),loading:R})};try{ce.displayName="ChallengeTeamWizard",ce.__docgenInfo={description:"",displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{ce as C};
