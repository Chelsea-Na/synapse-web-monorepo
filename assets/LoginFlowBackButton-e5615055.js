import{r as T,R as A}from"./index-f1f749bf.js";import{be as ie,bf as se,s as ue,bg as le}from"./SynapseContext-286d21a2.js";import{z as q}from"./SynapseConstants-41b9b1f3.js";import{u as B}from"./useMutation-f5a4a2e1.js";import{j as c,a as I,F as G}from"./jsx-runtime-670450c2.js";import{g as z,B as J}from"./getEndpoint-5374ab4d.js";import{F as de}from"./FullWidthAlert-9afcbd85.js";import{s as ce}from"./styled-42ab246b.js";import{T as pe}from"./TextField-00f4dfa1.js";import{B as w}from"./Box-b7ffd230.js";import{B as x}from"./Button-86068eae.js";import{T as N}from"./TextField-b3de9e0e.js";import{L as P}from"./Link-867a3d74.js";import{I as me}from"./IconSvg-b84bdf52.js";import{I as fe}from"./IconButton-21d62889.js";function ke(t,n){const[s,r]=T.useState("CHOOSE_AUTH_METHOD"),[d,a]=T.useState(),[i,m]=T.useState(),[f,p]=T.useState();T.useEffect(()=>{const o=new URL(window.location.href.replaceAll("#","/")),{searchParams:E}=o;if(E){const O=E.get("userId"),_=E.get("twoFaToken");O&&_&&(m(parseInt(O,10)),p(_),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(s)||r("VERIFICATION_CODE"))}},[s]),T.useEffect(()=>{n&&(p(n.twoFaToken),m(n.userId),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(s)||r("VERIFICATION_CODE"))},[n]);async function h(o){await ue(o.accessToken),localStorage.setItem(q,o.authenticationReceipt),r("LOGGED_IN"),t&&t()}const{mutate:g,isLoading:R}=B(({username:o,password:E,authenticationReceipt:O})=>ie(o,E,O),{onError:o=>{a(o.reason)},onSuccess:async o=>{"errorCode"in o?(r("VERIFICATION_CODE"),p(o.twoFaToken),m(o.userId)):await h(o)}}),{mutate:D,isLoading:v}=B(se,{onError:o=>{a(o.reason),(o.reason.includes("The provided twoFaToken is invalid")||o.reason.includes("Token has expired"))&&(console.warn(o),a("Something went wrong. Refresh the page and try again."),window.location.href.includes("twoFaToken")&&window.history.replaceState({},document.title,window.location.href.replaceAll(/(twoFaToken|userId)=[^&]*&?/g,"")))},onSuccess:h});return{step:s,onStepChange:r,submitUsernameAndPassword:(o,E)=>{a(void 0);const O=localStorage.getItem(q);g({username:o,password:E,authenticationReceipt:O})},submitOneTimePassword:(o,E=s==="RECOVERY_CODE"?"RECOVERY_CODE":"TOTP")=>{if(a(void 0),f==null||i==null){a("You did not first log in with your password or a third-party identity provider.");return}D({userId:i,twoFaToken:f,otpCode:o,otpType:E})},errorMessage:d,isLoading:R||v}}const ge=ce(pe)`
  input {
    text-align: center;
  }
`,Ee={TextFieldStyled:ge},Oe=t=>c(Ee.TextFieldStyled,{...t}),L={left:"ArrowLeft",right:"ArrowRight",backspace:"Backspace"};function he(t,n){return t<=0?[]:Array.from({length:t},n)}function Ce(t,n,s){return t.map((r,d)=>n===d?s:r)}function W(t){return t.join("")}function Y(t,n){return[...t,n]}function _e(t,n,s){return t.reduce((r,d,a)=>{const{characters:i,restArrayMerged:m}=r;if(a<s)return{restArrayMerged:m,characters:Y(i,d)};const[f,...p]=m;return{restArrayMerged:p,characters:Y(i,f||"")}},{restArrayMerged:n,characters:[]}).characters}function Te(t){return t.split("")}const Q=A.forwardRef((t,n)=>{const{value:s,length:r,onChange:d,TextFieldsProps:a,onComplete:i,validateChar:m,className:f,...p}=t,{onPaste:h,onFocus:g,onKeyDown:R,className:D,...v}=a||{},y=he(r,(e,u)=>({character:s[u]||"",inputRef:A.createRef()})),S=e=>y.findIndex(({inputRef:u})=>u.current===e),o=()=>y.map(({character:e})=>e),E=(e,u)=>{const l=Ce(o(),e,u);return W(l)},O=e=>{var u,l;(l=(u=y[e])==null?void 0:u.inputRef.current)==null||l.focus()},_=e=>{var u,l;(l=(u=y[e])==null?void 0:u.inputRef.current)==null||l.select()},F=e=>{e+1!==r&&(y[e+1].character?_(e+1):O(e+1))},X=e=>{e>0&&_(e-1)},Z=e=>{const u=e.target.value[0]||"",l=S(e.target);if(typeof m=="function"&&!m(u,l))return;const C=E(l,u);d==null||d(C),C.length===r&&(i==null||i(C)),u!==""?C.length<r?F(C.length-1):F(l):C[l]?_(l):X(l)},ee=e=>{e.preventDefault(),e.target.select(),g==null||g(e)},te=e=>{const u=e.target,l=S(u);u.value===e.key?(e.preventDefault(),F(l)):!u.value&&L.backspace===e.key||L.left===e.key?(e.preventDefault(),_(l-1)):L.right===e.key&&(e.preventDefault(),_(l+1)),R==null||R(e)},re=e=>{e.preventDefault();const u=e.target,l=e.clipboardData.getData("text/plain"),C=S(u),ne=o(),H=_e(ne,Te(l),C),k=H.findIndex((oe,ae)=>ae>C&&oe===""),b=W(H);if(d==null||d(b),b.length===r){i==null||i(b),O(r-1);return}k!==-1&&O(k),h==null||h(e)};return c(w,{display:"flex",gap:"20px",alignItems:"center",ref:n,className:`MuiOtpInput-Box ${f||""}`,...p,children:y.map(({character:e,inputRef:u},l)=>c(Oe,{autoComplete:"one-time-code",value:e,inputRef:u,className:`MuiOtpInput-TextField MuiOtpInput-TextField-${l+1} ${D||""}`,onPaste:re,onFocus:ee,onChange:Z,onKeyDown:te,...v},l))})});Q.defaultProps={value:"",length:4,validateChar:()=>!0,onChange:()=>{},onComplete:()=>{},TextFieldsProps:{}};const $=6,Re=["0","1","2","3","4","5","6","7","8","9"];function V(t){const{onSubmit:n,isLoading:s}=t,[r,d]=A.useState("");return I(w,{children:[c(Q,{length:$,value:r,onChange:d,onComplete:n,validateChar:a=>Re.includes(a)||a==="",gap:0,sx:{".MuiFormControl-root:first-of-type > .MuiInputBase-root":{borderTopRightRadius:0,borderBottomRightRadius:0},".MuiFormControl-root:last-of-type > .MuiInputBase-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},".MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root":{borderRadius:0}}}),c(x,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:r.length!==$||s,onClick:a=>{a.preventDefault(),n(r)},children:s?"Verifying...":"Submit"})]})}try{V.displayName="TOTPForm",V.__docgenInfo={description:"",displayName:"TOTPForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function U(t){const{resetPasswordUrl:n=`${z(J.PORTAL_ENDPOINT)}#!PasswordReset:0`,onSubmit:s,isLoading:r}=t,[d,a]=T.useState(""),[i,m]=T.useState("");function f(p){p.preventDefault(),s(d,i)}return I("form",{onSubmit:p=>{f(p)},children:[c(N,{required:!0,fullWidth:!0,autoFocus:!0,autoComplete:"username",label:"Username or Email Address",id:"username",type:"text",value:d,onChange:p=>a(p.target.value)}),c(N,{required:!0,fullWidth:!0,autoComplete:"current-password",label:"Password",id:"current-password",type:"password",value:i,onChange:p=>m(p.target.value)}),c(P,{href:n,children:"Forgot password?"}),c(x,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",disabled:r,sx:{height:"50px",mt:4,mb:2},children:r?"Logging you in...":"Sign in"})]})}try{U.displayName="UsernamePasswordForm",U.__docgenInfo={description:"",displayName:"UsernamePasswordForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(username: string, password: string) => void"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}const ye=19;function M(t){const{onSubmit:n,isLoading:s}=t,[r,d]=A.useState("");return I(w,{children:[c(N,{placeholder:"Enter backup code",value:r,onChange:a=>{const i=a.target.value.toLowerCase().replace(/[^a-z0-9-]/gi,"");d(i)}}),c(x,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:r.length!==ye||s,onClick:a=>{a.preventDefault(),n(r)},children:s?"Verifying...":"Submit"})]})}try{M.displayName="RecoveryCodeForm",M.__docgenInfo={description:"",displayName:"RecoveryCodeForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function j(t){const{ssoRedirectUrl:n,registerAccountUrl:s=`${z(J.PORTAL_ENDPOINT)}#!RegisterAccount:0`,resetPasswordUrl:r,onBeginOAuthSignIn:d,onStepChange:a,step:i,submitUsernameAndPassword:m,submitOneTimePassword:f,errorMessage:p,isLoading:h}=t;return I(G,{children:[i=="CHOOSE_AUTH_METHOD"&&c(le,{onSelectUsernameAndPassword:()=>a("USERNAME_PASSWORD"),onBeginOAuthSignIn:d,ssoRedirectUrl:n}),i==="USERNAME_PASSWORD"&&c(U,{isLoading:h,resetPasswordUrl:r,onSubmit:(g,R)=>{m(g,R)}}),i==="VERIFICATION_CODE"&&I(G,{children:[c(V,{isLoading:h,onSubmit:g=>{f(g,"TOTP")}}),c(P,{align:"center",color:"grey.700",sx:{display:"block",mx:"auto"},onClick:()=>a("RECOVERY_CODE"),children:"Use a backup code instead"})]}),i==="RECOVERY_CODE"&&c(M,{isLoading:h,onSubmit:g=>{f(g,"RECOVERY_CODE")}}),(i==="CHOOSE_AUTH_METHOD"||i==="USERNAME_PASSWORD")&&c(w,{display:"flex",justifyContent:"center",children:c(P,{href:s,align:"center",children:"Don't have an account? Create one now"})}),p&&c(de,{variant:"warning",isGlobal:!1,description:p})]})}try{j.displayName="LoginForm",j.__docgenInfo={description:"",displayName:"LoginForm",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},registerAccountUrl:{defaultValue:null,description:"",name:"registerAccountUrl",required:!1,type:{name:"string"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},twoFactorAuthenticationRequired:{defaultValue:null,description:"",name:"twoFactorAuthenticationRequired",required:!1,type:{name:"TwoFactorAuthErrorResponse"}},submitUsernameAndPassword:{defaultValue:null,description:"",name:"submitUsernameAndPassword",required:!0,type:{name:"(username: string, password: string) => void"}},submitOneTimePassword:{defaultValue:null,description:"",name:"submitOneTimePassword",required:!0,type:{name:"(code: string, otpType?: TwoFactorAuthOtpType | undefined) => void"}},errorMessage:{defaultValue:null,description:"",name:"errorMessage",required:!0,type:{name:"string | undefined"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}}}catch{}function Ie(t){switch(t){case"CHOOSE_AUTH_METHOD":return"CHOOSE_AUTH_METHOD";case"USERNAME_PASSWORD":return"CHOOSE_AUTH_METHOD";case"VERIFICATION_CODE":return"CHOOSE_AUTH_METHOD";case"RECOVERY_CODE":return"VERIFICATION_CODE";case"LOGGED_IN":return"LOGGED_IN"}}function K(t){const{step:n,onStepChange:s,sx:r}=t;return n==="USERNAME_PASSWORD"||n==="VERIFICATION_CODE"||n==="RECOVERY_CODE"?c(fe,{type:"button",onClick:()=>{s(Ie(n))},sx:r,children:c(me,{icon:"arrowBack",wrap:!1,sx:{height:"24px",width:"24px"}})}):null}try{K.displayName="LoginFlowBackButton",K.__docgenInfo={description:"",displayName:"LoginFlowBackButton",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps<{}>"}}}}}catch{}export{K as L,j as a,ke as u};
//# sourceMappingURL=LoginFlowBackButton-e5615055.js.map
