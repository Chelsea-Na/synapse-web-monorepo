import{a as i,j as e,F as ie}from"./jsx-runtime-ad672792.js";import{r as n}from"./index-f1f749bf.js";import{f as oe}from"./DateFormatter-842bed60.js";import{d as ae}from"./dayjs.min-e0adaab4.js";import{ai as I,d2 as Se,bt as z,d3 as ve,d4 as be,d5 as we,d6 as Ae,d7 as _e}from"./SynapseContext-d313cbec.js";import{u as Y}from"./useMutation-d80eaf70.js";import{u as ke}from"./useInfiniteQuery-7e8e431b.js";import{d as T}from"./ToastMessage-524a41fb.js";import{H as ne,I as G}from"./IconSvg-6d8374ab.js";import{W as me}from"./WarningDialog-273b33d0.js";import{M as u,S as Te}from"./LoadingScreen-402343c0.js";import{u as Ie}from"./useDebouncedEffect-601ad775.js";import"./getEndpoint-ac94413e.js";import{T as L}from"./Typography-33ebb906.js";import{R as F}from"./Row-264af41d.js";import{C as y}from"./Col-1f1afacc.js";import{F as l}from"./Form-4a4de212.js";import{a as se}from"./Clear-499958d6.js";import{B as g}from"./Button-7d415009.js";import{A as Ne}from"./Alert-84d62a08.js";import{C as Oe}from"./CopyToClipboardInput-4904924c.js";import{T as Me}from"./Table-6b0350f2.js";import"./_commonjsHelpers-042e6b4d.js";import"./utc-8a3e1a17.js";import"./inheritsLoose-d541526f.js";import"./setPrototypeOf-0bb37fbe.js";import"./isArray-5e3f9107.js";import"./index-96c5f47c.js";import"./extends-98964cd2.js";import"./SynapseConstants-9d1f6e44.js";import"./SvgIcon-08a7d1dd.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./styled-25e9c81a.js";import"./emotion-use-insertion-effect-with-fallbacks.browser.esm-3d5299f2.js";import"./Box-4cee9ecb.js";import"./extendSxProp-f2003eec.js";import"./Button-182a752c.js";import"./ButtonBase-d1b34a95.js";import"./emotion-react.browser.esm-dd348113.js";import"./assertThisInitialized-081f9914.js";import"./TransitionGroupContext-a2b6e27b.js";import"./useForkRef-dd8a6e5c.js";import"./useTheme-419a64bd.js";import"./mutation-80949caa.js";import"./infiniteQueryBehavior-b692f36a.js";import"./FullWidthAlert-7708c4df.js";import"./divWithClassName-1aeead00.js";import"./createWithBsPrefix-e09f51dd.js";import"./index-4d501b15.js";import"./removeClass-164fd327.js";import"./hasClass-ec9efd32.js";import"./uniqueId-4d05949d.js";import"./toString-cc90cb98.js";import"./isSymbol-7c514724.js";import"./AccessRequirementList-d1733c6a.js";import"./useGetInfoFromIds-07fb992b.js";import"./use-deep-compare-effect.esm-2b920fea.js";import"./index-5d0cf067.js";import"./uniq-4b064199.js";import"./_baseSlice-cf92e063.js";import"./_isIterateeCall-54465d38.js";import"./_MapCache-65b087e4.js";import"./_baseTimes-8cccc40f.js";import"./_isIndex-af14b756.js";import"./toInteger-7fff8bf4.js";import"./_cacheHas-3dd920ab.js";import"./without-c10e69cb.js";import"./isArrayLikeObject-089af80a.js";import"./_setToArray-3d6ec6fd.js";import"./StandaloneLoginForm-57ce82b7.js";import"./LoginFlowBackButton-9d3d0371.js";import"./TextField-3ecb7c82.js";import"./InputLabel-deb0bbd6.js";import"./ownerWindow-2c76219e.js";import"./isHostComponent-fa76b8d9.js";import"./isMuiElement-d529b771.js";import"./index-1aacdabe.js";import"./Popover-11254ce5.js";import"./Modal-a5bf9c71.js";import"./Fade-d6b62a61.js";import"./getScrollbarSize-ac846fe6.js";import"./createChainedFunction-0bab83cf.js";import"./Paper-832645e7.js";import"./MenuList-fa1b4ddf.js";import"./TextField-29d449a3.js";import"./Link-f3022853.js";import"./IconButton-47147883.js";import"./UserCard-7f7526bb.js";import"./SkeletonTable-f95355ab.js";import"./times-d1118743.js";import"./Skeleton-fcc77827.js";import"./RegularExpressions-bc0adf55.js";import"./react-intersection-observer.esm-8bf16175.js";import"./EntityIcon-7f0a8693.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./uniq-0a81e481.js";import"./mapValues-397ddd59.js";import"./hasIn-cc60ed45.js";import"./_basePickBy-3c68a3e5.js";import"./CustomSelectWidget-90c38008.js";import"./Select-40119e12.esm-41209acb.js";import"./toConsumableArray-35da523d.js";import"./getPrototypeOf-e4242ba0.js";import"./isNativeReflectConstruct-ff095bc2.js";import"./isPlainObject-7844357c.js";import"./now-50a2697b.js";import"./union-98f36c05.js";import"./pick-09c8459b.js";import"./_baseClone-0d24ce97.js";import"./_baseMap-3fef3b3e.js";import"./isEqual-20a71e93.js";import"./_baseFor-d254fa1e.js";import"./factory-76e91d33.js";import"./sqlFunctions-783bb8e8.js";import"./QueryFilter-ab706eb8.js";import"./useEntity-c8966376.js";import"./SynapseTableConstants-942d2b0b.js";import"./FacetNav-6301dd93.js";import"./queryUtils-7639a20c.js";import"./cloneDeep-c3de8e39.js";import"./NoSearchResults-79eea014.js";import"./NoData-80d05b97.js";import"./unCamelCase-ec1c2b3d.js";import"./ColumnType-5116adf5.js";import"./useGetQueryResultBundle-8a54fdb6.js";import"./merge-1cd54690.js";import"./ElementWithTooltip-71b82886.js";import"./usePrevious-9f30f8c7.js";import"./hook-c05d8d9f.js";import"./contains-60f9209b.js";import"./isRequiredForA11y-755ca9bb.js";import"./RadioGroup-2b4593e6.js";import"./RangeSlider-d547757a.js";import"./Stack-2d799158.js";import"./react-sizeme-2217af01.js";import"./ColorGradient-3d3e1969.js";import"./colorPalette-c43701fe.js";import"./SelectionCriteriaPill-3f7506bf.js";import"./Close-3fe7e5c0.js";import"./useDownloadList-fd94913b.js";import"./FileUpload-9d1c2eb0.js";import"./DialogContent-b05606ad.js";import"./DialogTitle-1caff05b.js";import"./QueryCount-9891cb07.js";import"./react-select.esm-79d5fc5d.js";import"./IconList-438c97bd.js";import"./UserCardList-46fb2fe0.js";import"./useAccessRequirements-256c72bd.js";import"./RestrictionInformation-32ce14e2.js";import"./ManagedACTAccessRequirementStatus-9671fe8d.js";import"./UserSearchBox-62aced6e.js";import"./UserOrTeamBadge-4a1183de.js";import"./EntityLink-c502bc2f.js";import"./ErrorChip-35ce70ec.js";import"./Avatar-bd1368dd.js";import"./SynapseVideo-8c25a9c8.js";import"./useWaitForDOMRef-b2ebcbef.js";import"./FormLabel-897d2462.js";import"./FormGroup-08e5002f.js";function xe(o){const{accessToken:m,keyFactory:p}=I();return ke(p.getMyOAuthClientsQueryKey(),async t=>await Se(m,t.pageParam),{...o,getNextPageParam:t=>t.nextPageToken})}function Ee(o){const m=z(),{accessToken:p,keyFactory:t}=I();return Y(s=>ve(s,p),{...o,onSuccess:async(s,h,f)=>{await m.invalidateQueries(t.getMyOAuthClientsQueryKey()),o!=null&&o.onSuccess&&await o.onSuccess(s,h,f)}})}function Re(o){const m=z(),{accessToken:p,keyFactory:t}=I();return Y(s=>be(s,p),{...o,onSuccess:async(s,h,f)=>{await m.invalidateQueries(t.getMyOAuthClientsQueryKey()),o!=null&&o.onSuccess&&await o.onSuccess(s,h,f)}})}function qe(o){const m=z(),{accessToken:p,keyFactory:t}=I();return Y(s=>we(s,p),{...o,onSuccess:async(s,h,f)=>{await m.invalidateQueries(t.getMyOAuthClientsQueryKey()),o!=null&&o.onSuccess&&await o.onSuccess(s,h,f)}})}const Be=500,W=({isShowingModal:o=!1,isEdit:m,onClose:p,client:t,setIsShowingConfirmModal:s,isShowingConfirmModal:h,setIsShowingModal:f})=>{const{accessToken:v}=I(),[N,O]=n.useState(""),[a,S]=n.useState([{uri:""}]),[b,w]=n.useState(),[A,M]=n.useState(),[_,C]=n.useState(),[x,E]=n.useState(),[V,P]=n.useState(!1),[Q,U]=n.useState(!1),[c,pe]=n.useState(),[D,k]=n.useState(),ue="Are you absolutely sure?",he="Editing this detail will render your client invalid and will require you to resubmit verification. This action cannot be undone.",K="Click Add URI to add more Redirect URIs",R=n.useMemo(()=>({client_id:t==null?void 0:t.client_id,client_name:N,redirect_uris:(a==null?void 0:a.map(r=>r.uri))??[""],policy_uri:b,client_uri:A,sector_identifier_uri:_??"",tos_uri:x,etag:t==null?void 0:t.etag}),[t==null?void 0:t.client_id,t==null?void 0:t.etag,N,A,b,a,_,x]);n.useEffect(()=>{O((t==null?void 0:t.client_name)??""),S((t==null?void 0:t.redirect_uris.map(r=>({uri:r})))??[{uri:""}]),w((t==null?void 0:t.policy_uri)??""),M((t==null?void 0:t.client_uri)??""),C((t==null?void 0:t.sector_identifier_uri)??void 0),E((t==null?void 0:t.tos_uri)??"")},[o,t]),Ie(()=>{v&&Ae(R,v).then(r=>{P(r.reverificationRequired)})},[v,R],Be);const q=()=>{O(""),S([{uri:""}]),w(""),M(""),C(""),E(""),p()},$=()=>{s(!1),U(!1)},{mutate:fe}=qe({onSuccess:()=>{T("Successfully created","success"),k(void 0),q()},onError:r=>{k(r)}}),{mutate:Z,isLoading:J}=Re({onSuccess:()=>{T("Successfully saved","success"),k(void 0),q()},onError:r=>{k(r),f(!0)}}),{mutate:ge}=Ee({onSuccess:()=>{T("Successfully deleted","success"),q()},onError:r=>{T(r.reason,"danger")}}),Ce=()=>{try{v&&(pe(R),V===!0?s(!0):m?Z(R):fe(R))}catch(r){T(r.reason,"danger")}},X=()=>{a&&S([...a,{uri:""}])},ee=r=>{if(a){const d=[...a];d.splice(r,1),S(d)}},te=(r,d)=>{if(a){const{name:B,value:ye}=r.target,re=[...a];re[d][B]=ye,S(re)}};return i("div",{className:"bootstrap-4-backport",children:[i(u,{show:o&&!h,animation:!1,backdrop:"static",onHide:()=>{q(),k(void 0)},size:"lg",className:"OAuthDialog bootstrap-4-backport",children:[e(u.Header,{closeButton:!0,children:e(u.Title,{children:m?"Client Details":"Create New OAuth Client"})}),i(u.Body,{children:[J&&e("div",{className:"SRC-center-text",children:e(Te,{size:40})}),!J&&i(ie,{children:[e(L,{variant:"body1",children:"To protect you and your users, your consent screen and application will need to be verified by Sage Bionetworks. Before your consent screen and application are verified by Sage Bionetworks, you can still test your application with limitations."}),m&&i(L,{style:{marginTop:"16px"},variant:"label",children:["Client ID: ",t==null?void 0:t.client_id]}),i(F,{children:[e(y,{lg:6,md:6,sm:12,xs:12,children:i(l.Group,{className:"required",children:[e(l.Label,{htmlFor:"clientName",children:"Client Name"}),e(l.Control,{required:!0,onChange:r=>O(r.target.value),placeholder:"Client Name",type:"text",value:N,id:"clientName"})]})}),i(y,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{className:"required",htmlFor:"clientUri",children:"Client Homepage"}),e(l.Control,{onChange:r=>M(r.target.value),placeholder:"https://",type:"text",value:A,id:"clientUri"})]})]}),e(F,{children:!m&&i(ie,{children:[e(y,{lg:6,md:6,sm:12,xs:12,children:i(l.Group,{className:"required",children:[e(l.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(se,{title:K,placement:"top",children:e(ne,{className:"HelpButton"})}),a==null?void 0:a.map((r,d)=>i("div",{children:[e(l.Control,{name:"uri",required:!0,id:`redirect-uri-${d}`,onChange:B=>te(B,d),value:r.uri,placeholder:"https://",type:"text"}),a.length>1&&e("button",{onClick:()=>ee(d),children:e(G,{icon:"delete",sx:{color:"error.main"}})}),a.length-1===d&&e(g,{onClick:X,disabled:r.uri.length===0,children:"Add URI"})]},d))]})}),i(y,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Sector Identifier URI"}),e(l.Control,{onChange:r=>C(r.target.value),placeholder:"https://",type:"text"})]})]})}),i(F,{children:[i(y,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Link to Privacy Policy"}),e(l.Control,{onChange:r=>w(r.target.value),placeholder:"https://",type:"text",value:b})]}),i(y,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Links to Terms of Service"}),e(l.Control,{onChange:r=>E(r.target.value),placeholder:"https://",type:"text",value:x})]})]}),m&&i("div",{className:"danger",children:[e(L,{style:{marginTop:"8px"},color:"error",variant:"headline3",children:"DANGER ZONE"}),e(L,{variant:"smallText1",children:"Editing the following information will render your client invalid and will require you to create it again and resubmit verification if needed."}),i(F,{children:[i(y,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{htmlFor:"redirect-uri-0",children:"Redirect URI(s)"}),e(se,{title:K,placement:"top",children:e(ne,{className:"HelpButton"})}),a==null?void 0:a.map((r,d)=>i("div",{children:[e(l.Control,{id:`redirect-uri-${d}`,required:!0,name:"uri",onChange:B=>te(B,d),value:r.uri,placeholder:"https://",type:"text"}),a.length>1&&e("button",{onClick:()=>ee(d),children:e(G,{icon:"delete",sx:{color:"error.main"}})}),a.length-1===d&&e(g,{onClick:X,disabled:r.uri.length===0,children:"Add Uri"})]},d))]}),i(y,{lg:6,md:6,sm:12,xs:12,children:[e(l.Label,{children:"Sector Identifier URI"}),e(l.Control,{onChange:r=>C(r.target.value),placeholder:"https://",type:"text",value:_})]})]}),i("button",{className:"delete-button",onClick:()=>{U(!0),s(!0)},children:[e(G,{icon:"delete",sx:{color:"error.main"}}),"DELETE CLIENT"]})]})]})]}),D&&e(Ne,{variant:"danger",children:D==null?void 0:D.reason}),i(u.Footer,{children:[e(g,{variant:"default",onClick:()=>{q(),k(void 0)},children:"CANCEL"}),e(g,{variant:"primary",onClick:Ce,children:"Save"})]})]}),e(me,{open:h,title:ue,content:he,onCancel:$,onConfirm:()=>{Q?ge(t==null?void 0:t.client_id):Z(c),$()},confirmButtonColor:"error",confirmButtonText:"Yes, Continue"})]})};try{W.displayName="CreateOAuthModal",W.__docgenInfo={description:"",displayName:"CreateOAuthModal",props:{isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},isEdit:{defaultValue:null,description:"",name:"isEdit",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},setIsShowingConfirmModal:{defaultValue:null,description:"",name:"setIsShowingConfirmModal",required:!0,type:{name:"(a: boolean) => void"}},isShowingConfirmModal:{defaultValue:null,description:"",name:"isShowingConfirmModal",required:!0,type:{name:"boolean"}},client:{defaultValue:null,description:"",name:"client",required:!1,type:{name:"OAuthClient"}},setIsShowingModal:{defaultValue:null,description:"",name:"setIsShowingModal",required:!0,type:{name:"(a: boolean) => void"}}}}}catch{}const j=()=>{const{accessToken:o}=I(),[m,p]=n.useState(!1),[t,s]=n.useState(!1),[h,f]=n.useState(),[v,N]=n.useState(!1),[O,a]=n.useState(!1),[S,b]=n.useState(!1),[w,A]=n.useState(),[M,_]=n.useState(!1),{data:C,hasNextPage:x,fetchNextPage:E}=xe(),V=(C==null?void 0:C.pages.flatMap(c=>c.results))??[],P="Are you absolutely sure?",Q="If you have an existing secret, generating a new secret will make your application invalid after generation. This action cannot be undone.",U=async()=>{a(!1);try{const c=await _e(o,h==null?void 0:h.client_id);f(void 0),b(!0),A(c.client_secret)}catch(c){T(c.reason,"danger")}};return i("div",{className:"bootstrap-4-backport OAuthEditor",children:[e(g,{onClick:()=>{p(!0),s(!1)},style:{float:"right"},children:"Create New Client"}),i(Me,{striped:!0,children:[e("thead",{children:i("tr",{children:[e("th",{children:"Created"}),e("th",{children:"Modified"}),e("th",{children:"ID"}),e("th",{children:"Client"}),e("th",{children:"Verified"}),e("th",{children:"App Secret"}),e("th",{children:"Actions"})]})}),e("tbody",{children:V.map(c=>i("tr",{children:[e("td",{children:oe(ae(c.createdOn))}),e("td",{children:oe(ae(c.modifiedOn))}),e("td",{children:c.client_id}),e("td",{children:c.client_name}),e("td",{children:c.verified?"Yes":e(g,{variant:"outline",size:"sm",onClick:()=>_(!0),children:"SUBMIT VERIFICATION"})}),e("td",{children:e(g,{variant:"outline",onClick:()=>{f(c),a(!0)},size:"sm",children:"GENERATE SECRET"})}),e("td",{children:e(g,{variant:"outline",onClick:()=>{f(c),s(!0),p(!0)},size:"sm",children:"EDIT"})})]},c.client_id))})]}),x&&e("div",{className:"text-center",children:e(g,{variant:"primary",onClick:()=>{E()},children:"Load more"})}),e(W,{onClose:()=>{p(!1)},isShowingModal:m,client:t?h:void 0,isEdit:t,setIsShowingConfirmModal:N,isShowingConfirmModal:v,setIsShowingModal:p}),i(u,{show:M,animation:!1,backdrop:"static",className:"bootstrap-4-backport",onHide:()=>_(!1),children:[e(u.Header,{closeButton:!0,children:e(u.Title,{children:"Submit Verification"})}),i(u.Body,{children:[i("p",{children:["In order to verify an OAuth client please submit a request to the"," ",e("a",{target:"_blank",rel:"noopener noreferrer",href:"https://sagebionetworks.jira.com/servicedesk/customer/portal/9",children:"Synapse Service Desk."})]}),e("b",{children:"Please list the following items in your request:"}),i("ul",{children:[e("li",{children:"Your name"}),i("li",{children:["The ID of the client to be verified ",e("br",{})]}),e("li",{children:"A description of your application"})]})]}),e(u.Footer,{})]}),e(me,{open:O,title:P,content:Q,onCancel:()=>{a(!1),f(void 0)},onConfirm:U,confirmButtonColor:"error",confirmButtonText:"Yes, Continue"}),w&&i(u,{show:S,animation:!1,backdrop:"static",className:"bootstrap-4-backport",onHide:()=>{b(!1),A(void 0)},children:[e(u.Header,{closeButton:!0,children:e(u.Title,{children:"App Secret"})}),i(u.Body,{children:[i("p",{children:[e("b",{children:"This secret will not be able to be retrieved again."})," If needed, in order to generate a new secret select Generate from the Client List."]}),e(Oe,{value:w,inputWidth:"350px"})]})]})]})};try{j.displayName="OAuthManagement",j.__docgenInfo={description:"",displayName:"OAuthManagement",props:{}}}catch{}const Ri={title:"Synapse/OAuthManagement",component:j},H={};var le,ce,de;H.parameters={...H.parameters,docs:{...(le=H.parameters)==null?void 0:le.docs,source:{originalSource:"{}",...(de=(ce=H.parameters)==null?void 0:ce.docs)==null?void 0:de.source}}};const qi=["OAuthManagementDemo"];export{H as OAuthManagementDemo,qi as __namedExportsOrder,Ri as default};
//# sourceMappingURL=OAuthManagement.stories-58d42b11.js.map
