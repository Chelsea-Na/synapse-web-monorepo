import{j as o,F as P,a as Q}from"./jsx-runtime-095bf462.js";import{r as g}from"./index-8db94870.js";import{u as l,cv as V,az as K,aE as f,cw as W,cx as $,cy as G,cz as j,cA as O,cB as z,cC as B,cD as H,cE as Y,cF as J,cG as X,cH as Z,cI as D,ah as ee}from"./EntityTypeUtils-5f3d9964.js";import{u as h}from"./useMutation-02461f19.js";import"./getEndpoint-ac94413e.js";import{u as te}from"./useInfiniteQuery-649dc958.js";import{I as A}from"./IconSvg-3a259b5a.js";import{D as ae,c as se}from"./ConfirmationDialog-c177a538.js";import{U as ne}from"./UserSearchBoxV2-7eaff957.js";import{s as re}from"./startCase-b2e198bb.js";import{a as ce}from"./FormLabel-7b55e02a.js";import{B as L}from"./Button-5637ed55.js";function be(e,t,r,n,a,s){const{accessToken:c,keyFactory:T}=l();return te(T.getRepliesQueryKey(e,t,r,n,a),async m=>V(c,e,r,m.pageParam,n,t,a),{...s,getNextPageParam:(m,C)=>{const k=C.flatMap(d=>d.results).length;if(m.totalNumberOfResults>k)return k}})}function Ie(e,t){const{accessToken:r,keyFactory:n}=l(),a=async()=>{const s=await j(e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return K(n.getReplyQueryKey(e.threadId,e.id,e.messageKey),a,t)}function ie(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>W(a,r),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllRepliesQueryKey(a.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function oe(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>$(a,r),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllRepliesQueryKey(a.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function _e(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>G(r,a.replyId),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllRepliesQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function qe(e){const{data:t,isLoading:r}=ue(e),{data:n,isLoading:a}=le(t,{enabled:!!t}),{mutate:s}=me(),{mutate:c}=fe(),T=g.useCallback(()=>{t&&(t!=null&&t.isPinned?c(t):s(t))},[c,s,t]);return{threadData:t,threadBody:n,togglePin:T,isLoading:a||r}}function ue(e,t){const{accessToken:r,keyFactory:n}=l();return K(n.getThreadQueryKey(e),()=>O(e,r),t)}function le(e,t){const{accessToken:r,keyFactory:n}=l(),a=async()=>{const s=await D(e==null?void 0:e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return K(n.getThreadBodyQueryKey(e==null?void 0:e.id,e==null?void 0:e.messageKey),a,t)}function de(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>z(r,a),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllForumThreadsQueryKey(a.forumId)),await t.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function ye(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>B(r,a),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function ge(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>H(r,a),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllForumThreadsQueryKey(a.forumId)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function Ee(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>Y(r,a.id),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await t.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function Ke(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>J(r,a.id),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await t.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function me(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>X(r,a.id),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await t.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}function fe(e){const t=f(),{accessToken:r,keyFactory:n}=l();return h(a=>Z(r,a.id),{...e,onSuccess:async(a,s,c)=>{await t.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await t.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(a,s,c)}})}const he=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],U={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},_=({show:e,onClose:t,handleUserTag:r})=>{const n=g.useCallback((a,s)=>{a&&s&&r(s.userName),t()},[t,r]);return o(P,{children:o(ae,{open:e,onCancel:t,title:"Find User or Team",content:o(ne,{placeholder:"Search for a user or team name",onChange:n,typeFilter:ee.ALL,focusOnSelect:!0}),sx:{".MuiDialog-paperFullWidth":{overflowY:"visible",".MuiDialogContent-root":{overflowY:"visible"}}}})})};try{_.displayName="UserMentionModal",_.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var q=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(q||{});const E=({placeholder:e,text:t,setText:r})=>{const[n,a]=g.useState("WRITE"),[s,c]=g.useState(0),[T,m]=g.useState(!1),[C,k]=g.useState(!1),d=g.useRef(null);g.useEffect(()=>{const i=d.current;i&&i.setSelectionRange(s,s)},[d,s]),g.useEffect(()=>{var i;(i=d.current)==null||i.focus()},[T]);const M=i=>{const u=[],y=d.current;if(y){const p=y==null?void 0:y.selectionStart,w=t.substring(0,p),v=t.substring(p,t.length);c(p+i.length),u.push(w,`${C?"":"@"}${i.replace(/\s/g,"")}`,v)}r(u.join("")),k(!1)},R=i=>{const u=d.current&&d.current.selectionStart;u&&u>0&&i.charAt(u-1)==="@"&&(k(!0),m(!0))},b=i=>{const u=d.current;if(u){const y=u.selectionStart,p=u.selectionEnd,w=t.substring(y,p),v=t.substring(0,y),S=t.substring(p,t.length),x=U[i].openSyntax,I=U[i].closeSyntax;switch(i){case"code":{const F=[];F.push(v,x,w,I,S),r(F.join(`\r
`)),u.focus(),c(y+x.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const F=`${v}${x}${w}${I}${S}`;u.focus(),c(y+x.length),r(F)}}}};return Q("div",{className:"bootstrap-4-backport MarkdownEditor",children:[Q("div",{className:"MarkdownEditorControls",children:[o("div",{className:"Tabs",children:Object.keys(q).map(i=>o("button",{className:"Tab",role:"tab","aria-selected":i===n,onClick:u=>{u.stopPropagation(),a(q[i])},children:i},i))}),n==="WRITE"&&Q("div",{className:"MarkdownEditorControlsToolbar",children:[he.map(i=>o("button",{onClick:()=>b(i),children:o(A,{icon:i,label:re(i)})},i)),o("button",{onClick:()=>m(!0),children:o(A,{icon:"tag",label:"Mention"})})]})]}),o("div",{children:n==="WRITE"?o("textarea",{onChange:i=>{r(i.target.value),R(i.target.value)},style:{width:"100%"},rows:6,value:t,ref:d,placeholder:e}):t?o(se,{markdown:t}):"Nothing to preview"}),o(_,{show:T,onClose:()=>m(!1),handleUserTag:M})]})};try{E.displayName="MarkdownEditor",E.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const N=({initialText:e,initialTitle:t,id:r,onClose:n,isReply:a})=>{const[s,c]=g.useState(t??""),[T,m]=g.useState(e??""),{mutate:C,isLoading:k}=de({onSuccess:()=>n()}),{mutate:d,isLoading:M}=ye({onSuccess:()=>n()}),{mutate:R,isLoading:b}=ge({onSuccess:()=>n()}),{mutate:i,isLoading:u}=ie({onSuccess:()=>n()}),{mutate:y,isLoading:p}=oe({onSuccess:()=>n()}),w=M||u||b||k||p,v=(S,x)=>{a?e?y({replyId:r,messageMarkdown:S}):i({threadId:r,messageMarkdown:S}):t?(C({title:x,threadId:r}),d({messageMarkdown:S,threadId:r})):R({forumId:r,title:x,messageMarkdown:S})};return Q("div",{className:"bootstrap-4-backport",children:[!a&&o(ce,{type:"text",placeholder:"Title",value:s,onChange:S=>c(S.target.value)}),o(E,{text:T,setText:m}),Q("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o(L,{onClick:n,variant:"light",children:"Cancel"}),o(L,{disabled:w,onClick:()=>v(T,s),variant:"primary",children:w?"Saving":"Save"})]})]})};try{N.displayName="ForumThreadEditor",N.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}}}catch{}export{N as F,_e as a,qe as b,Ee as c,Ke as d,be as e,Ie as u};
//# sourceMappingURL=ForumThreadEditor-331d4fd2.js.map
