import{j as e,a as p,F as Y}from"./jsx-runtime-095bf462.js";import{r as a,R as de}from"./index-8db94870.js";import{V as ce,W as pe,X as J,Y as ue,Z as me,_ as ye,$ as ge,a0 as fe,a1 as he}from"./SynapseTableCell-dc3d373f.js";import{v as _e,i as c}from"./SynapseClient-07cb66ce.js";import{P as Ce}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-caa14b37.js";import{S as K}from"./RegularExpressions-bc0adf55.js";import{a as Ie}from"./useGetEntityHeaders-d3ee3a23.js";import{I as X,A as Ee}from"./IconSvg-107f29dd.js";import"./SkeletonButton-0864bc76.js";import{S as Se}from"./SkeletonTable-c29b0ab8.js";import{p as we}from"./papaparse.min-84949987.js";import{u as Re}from"./UserSearchBoxV2-43220539.js";import{T as ne}from"./TextField-f454b447.js";import{E as xe}from"./EntityLink-fa02a5ae.js";import{L as be}from"./Link-bf67348e.js";import{T as V}from"./Typography-214fd772.js";import{M as re}from"./FormControlLabel-f9f0f4b1.js";import{E as Te}from"./EntityFinderModal-a006ed17.js";import{V as De,F as Ve}from"./useEntitySelection-69bb47d8.js";import{c as Fe}from"./cloneDeep-105239c7.js";import{B as x}from"./Box-f664662a.js";import{B as Q}from"./Button-f56bbd3a.js";import{I as ke}from"./InputLabel-f64f330c.js";import{T as ve}from"./Tooltip-f72372f7.js";import{I as He}from"./IconButton-2a435ef1.js";import{A as Ne,a as Ae}from"./AlertTitle-ce329963.js";function N({initialValue:n,onChange:o,options:s,delay:m=250,...u}){const[l,f]=a.useState(n);return Re(()=>{o(l)},[l],m),e(ce,{disablePortal:!0,isOptionEqualToValue:(h,y)=>y.length==0||h===y,options:s,value:l,onChange:(h,y)=>{f(y??"")},sx:{marginRight:"10px"},renderInput:h=>e(ne,{...h,...u,value:l,onChange:y=>f(y.target.value)})})}try{N.displayName="DebouncedInput",N.__docgenInfo={description:"",displayName:"DebouncedInput",props:{initialValue:{defaultValue:null,description:"",name:"initialValue",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"string[]"}},delay:{defaultValue:{value:"250"},description:"",name:"delay",required:!1,type:{name:"number"}}}}}catch{}function A({column:n,table:o}){var l;const s=(l=o.getPreFilteredRowModel().flatRows[0])==null?void 0:l.getValue(n.id),m=n.getFilterValue()??"",u=de.useMemo(()=>typeof s=="number"?[]:Array.from(n.getFacetedUniqueValues().keys()).sort(),[n.getFacetedUniqueValues()]);return e(N,{type:"text",options:u,initialValue:m,onChange:f=>n.setFilterValue(f),placeholder:`Filter by ${n.id}... (${n.getFacetedUniqueValues().size})`,list:n.id+"list"})}try{A.displayName="Filter",A.__docgenInfo={description:"",displayName:"Filter",props:{column:{defaultValue:null,description:"",name:"column",required:!0,type:{name:"Column<any, unknown>"}},table:{defaultValue:null,description:"",name:"table",required:!0,type:{name:"Table<any>"}}}}}catch{}function M(n){const{cell:o}=n,{row:s}=o,{original:m}=s,{id:u,isDummy:l}=m;return l?e(be,{href:`${Ce.PORTAL}#!Synapse:${u}`,children:u}):e(xe,{entity:m})}function B(n){const{cell:o}=n;return e(V,{variant:"body1",children:o.getContext().getValue()})}function L(n){const{cell:o}=n;return e(V,{variant:"body1",sx:{textTransform:"capitalize"},children:o.getContext().getValue()})}function O(n){const{table:o}=n;return e(re,{checked:o.getIsAllRowsSelected(),indeterminate:o.getIsSomeRowsSelected(),onClick:o.getToggleAllRowsSelectedHandler()})}function P(n){const{row:o}=n;return e(re,{checked:o.getIsSelected(),disabled:!o.getCanSelect(),indeterminate:o.getIsSomeSelected(),onClick:o.getToggleSelectedHandler()})}try{M.displayName="EntityHeaderNameCell",M.__docgenInfo={description:"",displayName:"EntityHeaderNameCell",props:{}}}catch{}try{B.displayName="EntityHeaderIDCell",B.__docgenInfo={description:"",displayName:"EntityHeaderIDCell",props:{}}}catch{}try{L.displayName="EntityHeaderTypeCell",L.__docgenInfo={description:"",displayName:"EntityHeaderTypeCell",props:{}}}catch{}try{O.displayName="CheckBoxHeader",O.__docgenInfo={description:"",displayName:"CheckBoxHeader",props:{}}}catch{}try{P.displayName="CheckBoxCell",P.__docgenInfo={description:"",displayName:"CheckBoxCell",props:{}}}catch{}const U=n=>p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e("mask",{id:"mask0_6722_37828",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e("g",{mask:"url(#mask0_6722_37828)",children:e("path",{d:"M18 20V17H15V15H18V12H20V15H23V17H20V20H18ZM3 21C2.45 21 1.97917 20.8042 1.5875 20.4125C1.19583 20.0208 1 19.55 1 19V5C1 4.45 1.19583 3.97917 1.5875 3.5875C1.97917 3.19583 2.45 3 3 3H17C17.55 3 18.0208 3.19583 18.4125 3.5875C18.8042 3.97917 19 4.45 19 5V10H17V8H3V19H16V21H3ZM3 6H17V5H3V6Z",fill:"#395979"})})]});try{U.displayName="AddAd",U.__docgenInfo={description:"",displayName:"AddAd",props:{}}}catch{}function Me(n,o,s){const[m,u]=a.useState({}),[l,f]=a.useState(Fe(n)),[h,y]=a.useState(""),[S,I]=a.useState([]),b=a.useCallback(_=>{y(_),o&&o(_)},[o]),E=a.useCallback(_=>{u({}),f(_),s&&s(_),I([]),b("")},[]);return{rowSelection:m,setRowSelection:u,refsInState:l,setRefsInState:E,newEntityIDs:h,setNewEntityIDs:b,parseErrors:S,setParseErrors:I}}const ee=10,te=n=>{const{references:o,isEditable:s,onUpdate:m,removeSelectedRowsButtonText:u="Remove Selected Rows",onUpdateEntityIDsTextbox:l}=n,[f,h]=a.useState([]),[y,S]=a.useState(!1),{rowSelection:I,setRowSelection:b,refsInState:E,setRefsInState:_,newEntityIDs:d,setNewEntityIDs:F,parseErrors:T,setParseErrors:k}=Me(o,l,m),q=a.useCallback(r=>{k([`Invalid Synapse ID(s): ${r.join(",")}`])},[]),z=a.useCallback(r=>{const t=r.map(i=>({targetId:i.trim()}));_([...E,...t])},[E]),oe=a.useCallback(()=>{d?d.includes(",")?we.parse(d,{complete:r=>{if(r.errors.length>0){const t=r.errors.map(i=>i.message);k(t)}else{const t=r.data[0],i=t.filter(C=>!C.trim().match(K));i.length>0?q(i):z(t)}}}):d.trim().match(K)?z([d]):q([d]):(k([]),F(""))},[d]),$=a.useMemo(()=>[{id:"select",header:O,cell:P}],[]),v=a.useMemo(()=>[{accessorFn:r=>r.name,id:"name",cell:M,header:"Name"},{accessorFn:r=>r.id,id:"id",cell:B,header:"SynID"},{accessorFn:r=>r.isDummy?"-":_e(r),id:"type",header:"Type",cell:L,filterFn:"includesString"}],[]),ae=a.useMemo(()=>s?$.concat(v):v,[v,s,$]),j=Object.keys(I).length,{data:w,isSuccess:ie,isLoading:W}=Ie(E,{useErrorBoundary:!0}),H=a.useMemo(()=>{const r=w?w==null?void 0:w.results:[],t=new Set;r.map(g=>t.add(g.id));const C=E.filter(g=>!t.has(g.targetId)).map(g=>({id:g.targetId,name:g.targetId,benefactorId:-1,type:"org.sagebionetworks.repo.model.Project",createdOn:"",modifiedOn:"",createdBy:"",modifiedBy:"",isLatestVersion:!0,isDummy:!0}));return r.concat(C)},[w]),D=pe({data:H,columns:ae,state:{rowSelection:I,columnFilters:f},enableRowSelection:s,onRowSelectionChange:b,onColumnFiltersChange:h,getCoreRowModel:ue(),getFilteredRowModel:me(),getSortedRowModel:ye(),getFacetedRowModel:ge(),getFacetedUniqueValues:fe(),getFacetedMinMaxValues:he(),columnResizeMode:"onChange"});if(W)return e(Se,{numCols:3,numRows:10});if(!ie)return e(Y,{});const se=r=>{const i=H.filter((C,g)=>I[g]!==!0).map(C=>({targetId:C.id}));_(i)},le=[c.PROJECT,c.FOLDER,c.FILE,c.TABLE,c.LINK,c.ENTITY_VIEW,c.DOCKER_REPO,c.SUBMISSION_VIEW,c.DATASET,c.DATASET_COLLECTION,c.MATERIALIZED_VIEW,c.VIRTUAL_TABLE],Z=j>0,R=H.length,G=D.getPrePaginationRowModel().rows.length;return p("div",{children:[p(x,{sx:{display:"flex",justifyContent:"space-between",padding:"12px 10px 10px 5px"},children:[e("div",{children:R>ee&&p(V,{variant:"body1",sx:{marginBottom:"10px"},children:[R," Entities"," ",G<R?`(${G} visible)`:"",Z&&e("span",{children:` (${j} selected)`})]})}),e("div",{children:s&&e(Q,{variant:"contained",disabled:!Z,onClick:se,children:u})})]}),R>0&&e(x,{sx:{overflow:"auto",maxHeight:"250px",paddingLeft:"2px",th:{backgroundColor:"#eee",zIndex:100}},children:p("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e("thead",{children:D.getHeaderGroups().map(r=>e("tr",{children:r.headers.map(t=>{let i="5%";switch(t.id){case"name":i="50%";break;case"id":i="22%";break;case"type":i="22%";break}return p("th",{colSpan:t.colSpan,style:{width:i,position:"sticky",top:"0px",background:"#fff"},children:[t.isPlaceholder?null:p(Y,{children:[p("div",{className:t.column.getCanSort()?"SRC-hand-cursor":"",onClick:t.column.getToggleSortingHandler(),children:[J(t.column.columnDef.header,t.getContext()),{asc:e(X,{icon:"sortUp",wrap:!1,sx:{color:"primary.main",backgroundColor:"none",float:"right",marginRight:"5px"}}),desc:e(X,{icon:"sortDown",wrap:!1,sx:{color:"primary.main",backgroundColor:"none",float:"right",marginRight:"5px"}})}[t.column.getIsSorted()]??null]}),t.column.getCanFilter()&&R>ee?e("div",{children:e(A,{column:t.column,table:D})}):null]}),t.column.getCanResize()&&e("div",{className:`resizer ${t.column.getIsResizing()?"isResizing":""}`,onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler()})]},t.id)})},r.id))}),e("tbody",{children:D.getRowModel().rows.map(r=>e("tr",{style:{height:"30px"},children:r.getVisibleCells().map(t=>e("td",{style:{width:t.column.getSize()},children:J(t.column.columnDef.cell,t.getContext())},t.id))},r.id))})]})}),e(Te,{configuration:{selectMultiple:!0,selectableTypes:le,versionSelection:De.DISALLOWED,initialScope:Ve.ALL_PROJECTS,initialContainer:"root"},promptCopy:"Select Entities to add to the Synapse ID list",show:y,title:"Select Entities",confirmButtonCopy:"Add Entities",onConfirm:r=>{const t=r.map(g=>g.targetId),C=(d.trim().length>0?d.concat(","):d).concat(t.join(","));F(C),S(!1)},onCancel:()=>S(!1)}),s&&p(x,{sx:{marginTop:"10px"},children:[e(ke,{htmlFor:"synIDs",children:"Add Synapse IDs"}),p(x,{sx:{display:"grid",gridTemplateColumns:"auto 50px 150px"},children:[e(ne,{id:"synIDs",name:"synIDs",fullWidth:!0,onChange:r=>{F(r.target.value)},value:d,placeholder:"Enter a list of Synapse IDs (i.e. 'syn123, syn456')"}),e(x,{sx:{padding:"5px 0px 0px 5px"},children:e(ve,{title:"Add a Synapse ID to the list via the Entity Finder",children:e(He,{onClick:()=>{S(!0)},children:e(U,{})})})}),p(Q,{variant:"outlined",onClick:oe,disabled:W||d.trim().length==0,children:[e(Ee,{})," Add Entities"]})]}),T&&T.length>0&&p(Ne,{severity:"error",sx:{my:2},children:[e(Ae,{children:"Parsing errors encountered:"}),e("ul",{children:T.map((r,t)=>e(V,{component:T.length>1?"li":"span",lineHeight:1.5,variant:"smallText1",children:r},t))})]})]})]})};try{te.displayName="EntityHeaderTable",te.__docgenInfo={description:`Renders a sortable/filterable table for a set of entity references.  If editable, onUpdate will be called back
on any entity added/removed.`,displayName:"EntityHeaderTable",props:{references:{defaultValue:null,description:"",name:"references",required:!0,type:{name:"ReferenceList"}},isEditable:{defaultValue:null,description:"",name:"isEditable",required:!0,type:{name:"boolean"}},onUpdate:{defaultValue:null,description:"",name:"onUpdate",required:!1,type:{name:"((updatedRefs: ReferenceList) => void)"}},removeSelectedRowsButtonText:{defaultValue:null,description:"",name:"removeSelectedRowsButtonText",required:!1,type:{name:"string"}},onUpdateEntityIDsTextbox:{defaultValue:null,description:"",name:"onUpdateEntityIDsTextbox",required:!1,type:{name:"((value: string) => void)"}}}}}catch{}export{te as E};
//# sourceMappingURL=EntityHeaderTable-199ae35e.js.map
