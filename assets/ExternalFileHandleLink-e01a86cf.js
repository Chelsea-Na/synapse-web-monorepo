var z=Object.defineProperty;var W=(o,c,e)=>c in o?z(o,c,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[c]=e;var h=(o,c,e)=>(W(o,typeof c!="symbol"?c+"":c,e),e);import{j as s,F as R,a as I}from"./jsx-runtime-9dc53467.js";import{r as F,R as k}from"./index-76fb7be0.js";import{C as Y}from"./ChallengeRegisterButton-e80e7d97.js";import{C as Q}from"./ChallengeTeamWizard-3a5de9cd.js";import{h as _,y as j,b2 as K,b3 as X,n as u,b4 as H,b5 as Z,b6 as ee}from"./SynapseClient-5617d165.js";import"./getEndpoint-ac94413e.js";import"./OrientationBanner-a1ca5cdb.js";import{u as M}from"./useGetEntityChallenge-b1ec62f8.js";import{u as te}from"./useGetUserTeams-5ecc110f.js";import{a as re,b as ne,c as ie}from"./useTeamMembers-d890c5e2.js";import{A as se,C as oe,L as ae,G as le}from"./HelpPopover-5f6932ac.js";import{d as U}from"./ToastMessage-313b7aae.js";import"./AccessTokenPage-82240ed5.js";import"./AccountLevelBadges-da13ff1e.js";import"./LastLoginInfo-502496c2.js";import"./StandaloneLoginForm-1f4bc32f.js";import"./TwoFactorAuthSettingsPanel-e4a313a7.js";import"./TwoFactorEnrollmentForm-d74d0714.js";import"./TwoFactorBackupCodes-705dc5e5.js";import"./CertificationQuiz-d2088978.js";import"./index-bde06080.js";import"./ChallengeSubmission-fe1f2b13.js";import"./FullWidthAlert-706fe840.js";import"./DownloadCartPage-57215afd.js";import"./ShowDownloadV2-f25138e9.js";import"./useEntitySelection-a89d0c03.js";import"./isPlainObject-cb19acc1.js";import"./mapValues-a94bd5d1.js";import"./index.modern-ebb8621a.js";import"./index-c71daf5e.js";import"./EvaluationCard-4985e576.js";import"./EvaluationEditorPage-2bf1e93d.js";import"./ExperimentalMode-2ca10eb7.js";import{R as ce,F as me}from"./index-3a31b023.js";import{O as de}from"./IconSvg-ac78043b.js";import"./FileUpload-241563a3.js";import"./FeaturedDataTabs-29b63668.js";import"./FeaturedToolsList-cd2cfa8a.js";import"./DiscussionThread-ba351fcd.js";import"./ForumPage-b07a1116.js";import"./Goals-bd3e78b2.js";import"./GoogleMap-75ad1b4b.js";import"./Icon-75f30caf.js";import"./OAuthManagement-7de50673.js";import"./ThemesPlot-e9d61184.js";import"./UpsetPlot-20bb01fb.js";import"./ProjectViewCarousel-d609c175.js";import"./Programs-138d6a43.js";import"./QueryCount-aa18c3a6.js";import"./RenderIfInView-df26c1ce.js";import"./Resources-ff82f49c.js";import"./RssFeedCards-9c96b6c7.js";import"./ShowMore-0d3229ca.js";import"./SkeletonButton-007d85cd.js";import"./SkeletonTable-dbfcf115.js";import"./LeftRightPanel-a90477a3.js";import"./LightTooltip-c6bda7cc.js";import"./StyledFormControl-003a613e.js";import"./WideButton-2e6b6d5a.js";import"./InputSizedButton-f0627758.js";import"./SubscriptionItem-2e64a9cd.js";import"./DropdownSelect-d767fe84.js";import"./SubsectionRowRenderer-c9cb26f8.js";import"./SynapseFormWrapper-ea560475.js";import"./SynapseFormSubmissionsGrid-6c21c666.js";import"./SystemUseNotification-42fe424b.js";import"./TableFeedCards-eb3e6a7c.js";import"./TermsAndConditions-e462711f.js";import"./TextField-12f5946f.js";import"./TimelinePlot-c39fd432.js";import"./UserBadge-2f99746f.js";import"./UserCardList-fb04f637.js";import"./UserCardListRotate-240ec14b.js";import"./UserCardListGroups-459461af.js";import"./UserOrTeamBadge-aaef7590.js";import"./UserProfileLinks-264a8917.js";import"./EntityHeaderTable-c8ab8798.js";import"./AccessRequirementRelatedProjectsList-2c56e637.js";import{e as pe,f as ue}from"./useAccessRequirements-bfdd3d39.js";import{u as he}from"./useEntity-f56cb1ec.js";import{S as fe}from"./LoadingScreen-21cf5616.js";import{M as ge}from"./Alert-c3fe2b05.js";import{T as ye}from"./Typography-1d068b0b.js";import{B as D}from"./Button-33299b2c.js";function w(o){const{open:c,projectId:e,onRegisterComplete:n,onCancel:r}=o,{data:i,error:l}=he(e),{accessToken:a}=_(),{data:t,error:m}=M(e),g=!!a,{data:y,error:d}=j({enabled:g}),p=t==null?void 0:t.participantTeamId,E=y==null?void 0:y.ownerId,{data:f,error:x}=re(p,E,{enabled:!!(p&&E)}),{mutateAsync:b,isLoading:T,error:N}=ne(),{data:S,isSuccess:V,error:O}=pe(t==null?void 0:t.participantTeamId,{enabled:!!(t!=null&&t.participantTeamId)}),B=ue((S==null?void 0:S.map(C=>String(C.id)))??[]),G=V&&B.every(C=>C.status==="success"&&C.data.isApproved),J=F.useCallback(async()=>{p&&E&&!(f!=null&&f.isMember)&&await b({teamId:p,userId:E}),n()},[b,n,p,f==null?void 0:f.isMember,E]),L=[l,m,d,x,O,N].filter(C=>!!C);let v=f!=null&&f.isMember?"Continue":"Register";return T&&(v="Registering..."),K(L)?!p||!c?s(R,{}):s(se,{dialogTitle:"Challenge Terms and Conditions",subjectId:p,subjectType:ce.TEAM,teamId:t==null?void 0:t.participantTeamId,renderAsModal:!0,requestObjectName:i==null?void 0:i.name,onHide:()=>{r()},customDialogActions:I(R,{children:[s(D,{variant:"outlined",onClick:r,children:"Cancel"}),s(D,{variant:"contained",onClick:()=>{J()},startIcon:T?s(fe,{}):void 0,disabled:!G||T,children:v})]})}):s(ge,{severity:"error",children:L.map((C,$)=>s(ye,{variant:"body1",children:C.reason},$))})}try{w.displayName="ChallengeRequirementsModal",w.__docgenInfo={description:`The challenge requirements modal will
 1. Display the access requirements that must be accepted to join a participant team. The component will guide the user through meeting the requirements.
 2. If the user has accepted the requirements, the user can click 'Register' to join the team
    If the user has not accepted the requirements, the user cannot register for the challenge.`,displayName:"ChallengeRequirementsModal",props:{open:{defaultValue:null,description:"",name:"open",required:!0,type:{name:"boolean"}},projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},onCancel:{defaultValue:null,description:"",name:"onCancel",required:!0,type:{name:"() => void"}},onRegisterComplete:{defaultValue:null,description:"",name:"onRegisterComplete",required:!0,type:{name:"() => void"}}}}}catch{}function A({projectId:o}){const{accessToken:c}=_(),e=!!c,[n,r]=F.useState(!1),[i,l]=F.useState(!1),[a,t]=F.useState(!1),{data:m}=j(),g=S=>{r(S)},y=()=>{l(!0)},d=()=>{t(!0)},{data:p}=M(o),{data:E}=te(p==null?void 0:p.id,1,0,{enabled:!!(e&&p)}),f=E&&E.results.length>0,{mutate:x}=ie({onSuccess:()=>{U("You are no longer registered for this challenge","info")},onError:S=>{U(S.reason,"danger")}}),b=()=>{e&&p&&m&&x({teamId:p.participantTeamId,userId:m.ownerId})};return I(R,{children:[s(Y,{projectId:o,onJoinClick:y,onLeaveClick:d}),s(w,{open:i,projectId:o,onRegisterComplete:()=>{l(!1),r(!f)},onCancel:()=>{l(!1)}}),s(Q,{projectId:o,onClose:()=>{g(!1)},isShowingModal:n}),s(oe,{open:a,title:"Leave this Challenge?",content:"Are you sure you want to leave this Challenge?",onCancel:()=>t(!1),onConfirm:()=>{b(),t(!1)}})]})}try{A.displayName="ChallengeDetailPage",A.__docgenInfo={description:"",displayName:"ChallengeDetailPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}class q extends k.Component{constructor(e){super(e);h(this,"formRef");h(this,"submitForm",()=>{this.formRef.current.submit()});h(this,"refresh",()=>{if(this.context.accessToken){const e=[u.getUserProfile(this.context.accessToken),u.getEntity(this.context.accessToken,this.props.formSchemaEntityId),u.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(e).then(n=>{const r=n[0];this.getTargetContainer(r,this.context.accessToken).then(i=>{const l=n[1],a=n[2];this.getSchemaFileContent(i,l,a)})}).catch(n=>{this.onError(n)})}});h(this,"getSchemaFileContent",(e,n,r)=>{const i=[u.getFileResult(n,this.context.accessToken,!0,!0),u.getFileResult(r,this.context.accessToken,!0,!0)];Promise.all(i).then(l=>{try{const a=l.map(t=>H(t.fileHandle,t.preSignedURL));Promise.all(a).then(t=>{const m=JSON.parse(t[0]),g=JSON.parse(t[1]);this.getExistingFileData(e,m,g)}).catch(t=>{console.log("getSchemaFileContent: Error getting form content",t)})}catch(a){console.log("getSchemaFileContent: Error getting schema content",a)}}).catch(l=>{this.onError(l)})});h(this,"getExistingFileData",(e,n,r)=>{const l={entityName:`${n.title}.json`,parentId:e};let a,t;u.lookupChildEntity(l,this.context.accessToken).then(m=>u.getEntity(this.context.accessToken,m.id).then(g=>(t=g,this.props.initFormData?u.getFileResult(t,this.context.accessToken,!0,!0).then(async y=>{try{const d=await H(y.fileHandle,y.preSignedURL);a=JSON.parse(d)}catch(d){console.log("getExistingFileData: Error setting form data",d)}}):Promise.resolve()))).finally(()=>{this.setState({formData:a,currentFileEntity:t,formSchema:n,formUiSchema:r})})});h(this,"getTargetContainer",async(e,n)=>{const r={entityName:e.ownerId,parentId:this.props.parentContainerId};try{const i=await u.lookupChildEntity(r,n);return console.log(`EntityForm uploading to https://www.synapse.org/#!Synapse:${i.id}`),this.setState({userprofile:e,containerId:i.id,isLoading:!1}),i.id}catch(i){return i.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(i)}});h(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});h(this,"onError",e=>{this.setState({error:e,isLoading:!1,successfullyUploaded:!1})});h(this,"onSubmit",({formData:e})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const n=new Blob([JSON.stringify(e)],{type:"text/json"});this.createEntityFile(n)});h(this,"createEntityFile",e=>{const n=`${this.state.formSchema.title}.json`;u.uploadFile(this.context.accessToken,n,e).then(r=>{const i=r.fileHandleId;if(this.state.currentFileEntity){const a={...this.state.currentFileEntity,dataFileHandleId:i};return this.setState({currentFileEntity:a}),u.updateEntity(a,this.context.accessToken)}const l={parentId:this.state.containerId,name:n,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:i};return u.createEntity(l,this.context.accessToken)}).then(r=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(r.id)}).catch(r=>{this.onError(r)})});this.formRef=k.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return I("div",{children:[this.state.error&&I("div",{className:"panel panel-danger errors",children:[s("div",{className:"panel-heading",children:s("h3",{className:"panel-title",children:"Error"})}),s("ul",{className:"list-group",children:I("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&s(ae,{validator:le,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:s("div",{style:{display:"none"},children:s("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&I(k.Fragment,{children:[s("span",{children:"Saving…"}),s("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}h(q,"contextType",X);try{q.displayName="EntityForm",q.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}const P=o=>{const{accessToken:c}=_(),{synId:e,className:n}=o,[r,i]=F.useState(void 0);F.useEffect(()=>{(async()=>{try{const m=await u.getEntity(c,e);if(!Z(m))throw new Error(`File Entity expected but found ${m}`);const g={requestedFiles:[{associateObjectId:e,associateObjectType:me.FileEntity,fileHandleId:m.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},d=(await u.getFiles(g,c)).requestedFiles[0].fileHandle;if(d&&ee(d))i({externalFileHandle:d,fileEntity:m});else throw new Error(`Not an external file handle: ${d==null?void 0:d.id}`)}catch(m){console.error("Error on getting external file handle = ",m)}})()},[e,c]);const l=r==null?void 0:r.externalFileHandle,a=r==null?void 0:r.fileEntity;return l?s("a",{href:l.externalURL,className:n,target:"_blank",rel:"noopener noreferrer",children:I("span",{children:[a==null?void 0:a.name,s(de,{style:{marginLeft:5}})]})}):s(R,{})};try{P.displayName="ExternalFileHandleLink",P.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}export{A as C};
