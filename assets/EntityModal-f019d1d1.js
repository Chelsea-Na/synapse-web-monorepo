import{j as e,a as i,F as S}from"./jsx-runtime-9dc53467.js";import{r as h}from"./index-76fb7be0.js";import{h as X,P as Y,t as N,az as E,bh as ee,bi as te,bj as ae,T as ne}from"./ApplicationSessionManager-ba34511b.js";import{g as q,B as L}from"./getEndpoint-ac94413e.js";import{u as j}from"./RequestDownloadCard-e5ab2e33.js";import{d as oe}from"./ToastMessage-3dbe47cb.js";import{u as ie,a as se,S as re}from"./SchemaDrivenAnnotationEditor-bc6802cc.js";import"./OrientationBanner-450e6652.js";import{d as le}from"./useEntity-c52a857e.js";import"./SkeletonButton-4e246cf8.js";import{b as de,C as ce}from"./HelpPopover-8f0a9db2.js";import{S as me}from"./SkeletonTable-3361182b.js";import{d as A}from"./dayjs.min-941aafe8.js";import{F as ue}from"./FullWidthAlert-149d754f.js";import{f as R}from"./DateFormatter-0d931acc.js";import{g as pe,u as _e,a as he}from"./useUploadDestination-e2475e1c.js";import{a as O}from"./UserBadge-2b5f0d5a.js";import{B as M}from"./Button-065a21d4.js";import{S as ye}from"./Skeleton-2007774f.js";import{n as fe}from"./noop-cb277961.js";import{M as Te}from"./Tooltip-248f4fe4.js";function be(o){if(!/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/.test(o))return!1;const r=new Date(o);return r instanceof Date&&!isNaN(r.getTime())&&r.toISOString()===o}function B(o){return typeof o=="number"||typeof o=="boolean"?o.toString():be(o)?R(A(o)):o}function v(o){const{entityId:r,versionNumber:a}=o,[b,c]=h.useState(!1),{isInExperimentalMode:y}=X(),{data:m,isLoading:f,refetch:p}=le(r,a,!0),n=m==null?void 0:m.entityMetadata,l=m==null?void 0:m.annotations,{data:_}=ie(r,{enabled:y}),{data:u,refetch:s}=se(r,{enabled:y&&!!_}),d=y&&!!_,T=!!n&&!!u&&A(n.modifiedOn).diff(A(u.validatedOn))>0,g=h.useCallback(async()=>{c(!0);const t=[p(),s()];await Promise.allSettled(t),c(!1)},[p,s]);return f||b?e(me,{numRows:3,numCols:2}):i(S,{children:[n&&l&&Y(l)?i("div",{className:"placeholder",children:["This"," ",N(E(n.concreteType))," ","has no annotations."]}):null,e("table",{className:"AnnotationsTable",children:i("tbody",{children:[l&&Object.keys(l).map(t=>i("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key",children:t}),e("td",{className:"AnnotationsTable__Row__Value",children:Array.isArray(l[t])?l[t].map(B).join(", "):B(l[t])})]},t)),d?i("tr",{className:"AnnotationsTable__Row",children:[e("td",{className:"AnnotationsTable__Row__Key Schema",children:"Validation Schema"}),e("td",{className:"AnnotationsTable__Row__Value",children:e("a",{href:`${q(L.REPO_ENDPOINT)}/repo/v1/schema/type/registered/${_.jsonSchemaVersionInfo.$id}`,target:"_blank",rel:"noopener noreferrer",children:_.jsonSchemaVersionInfo.schemaName})})]}):null]})}),n&&d&&T&&e(ue,{variant:"warning",description:`This ${N(E(n.concreteType))} has changed since it has been last validated. If this ${N(E(n.concreteType))} is expected to have annotations derived from the Validation Schema, they may not yet be visible.`,primaryButtonConfig:{text:"Reload Annotations",onClick:()=>{g()}},isGlobal:!1})]})}try{v.displayName="AnnotationsTable",v.__docgenInfo={description:"",displayName:"AnnotationsTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const I=({entityId:o,versionNumber:r})=>{var n,l,_,u,s,d,T;const{data:a}=j(o,r),b=a&&ee(a.entity),c=a?pe(a):void 0,y=(n=a==null?void 0:a.entity)==null?void 0:n.parentId,m=c==null?void 0:c.storageLocationId,{data:f}=_e(y,m,{enabled:y!==void 0&&m!=null});let p;return c&&(p=he(c,f)),a?e("table",{className:"MetadataTable",children:i("tbody",{children:[i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Name"}),e("td",{className:"MetadataTable__Row__Value",children:(l=a.entity)==null?void 0:l.name})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Type"}),e("td",{className:"MetadataTable__Row__Value",children:N(a.entityType)})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Synapse ID"}),e("td",{className:"MetadataTable__Row__Value",children:(_=a.entity)==null?void 0:_.id})]}),b&&i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Version"}),e("td",{className:"MetadataTable__Row__Value",children:te(a.entity)})]}),p&&i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Storage"}),e("td",{className:"MetadataTable__Row__Value",children:p})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:" Last Modified By"}),i("td",{className:"MetadataTable__Row__Value",children:[e(O,{userId:(u=a.entity)==null?void 0:u.modifiedBy})," at"," ",R(A((s=a.entity)==null?void 0:s.modifiedOn))]})]}),i("tr",{className:"MetadataTable__Row",children:[e("td",{className:"MetadataTable__Row__Key",children:"Created By"}),i("td",{className:"MetadataTable__Row__Value",children:[e(O,{userId:(d=a.entity)==null?void 0:d.createdBy})," at"," ",R(A((T=a.entity)==null?void 0:T.createdOn))]})]})]})}):null};try{I.displayName="MetadataTable",I.__docgenInfo={description:"",displayName:"MetadataTable",props:{entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}}}}}catch{}const Ne=["METADATA","ANNOTATIONS"];function D(o){const{entityId:r,versionNumber:a,show:b,onClose:c,initialTab:y="METADATA",showTabs:m=!0,onEditModeChanged:f=fe}=o,p=h.useRef(null),[n,l]=h.useState(y),[_,u]=h.useState(!1),[s,d]=h.useState(!1),[T,g]=h.useState(()=>d(!1));h.useEffect(()=>(f(s),()=>{f(!1)}),[s,f]);const{data:t}=j(r,a),k=t&&t.permissions.canEdit,V=t&&ae(t.entityType),x=V&&t.entity.isLatestVersion,K=n==="METADATA"&&t&&!window.location.href.includes(r),P=i(M,{variant:"contained",onClick:()=>window.open(`${q(L.PORTAL_ENDPOINT)}#!Synapse:${r}`,"_blank","noopener"),children:["Open"," ",t?N(t==null?void 0:t.entityType):""]}),$=n==="ANNOTATIONS"&&s,F=e(M,{variant:"contained",onClick:()=>{p.current.formElement.current.requestSubmit()},children:"Save Annotations"}),G=n==="ANNOTATIONS"&&s,U=e(M,{variant:"outlined",onClick:()=>{g(()=>()=>d(!1)),u(!0)},children:"Cancel"}),W=k&&n==="ANNOTATIONS"&&!s,C=V&&!x,z=e(Te,{title:C?"Annotations can only be edited on the latest version":void 0,children:e("span",{children:e(M,{variant:"contained",disabled:C,onClick:()=>{d(!0)},children:"Edit"})})}),H=i(S,{children:[m&&!s?e("div",{className:"Tabs",children:Ne.map(w=>e("div",{className:"Tab",role:"tab",onClick:Q=>{Q.stopPropagation(),l(w)},"aria-selected":w===n,children:w},w))}):null,e("div",{style:n==="ANNOTATIONS"?{}:{display:"none"},children:s?e(ne,{children:e(re,{entityId:r,formRef:p,hideActions:!0,onSuccess:()=>{oe("Annotations successfully updated.","success"),d(!1)},onCancel:()=>d(!1)})}):e(v,{entityId:r,versionNumber:a})}),e("div",{style:n==="METADATA"?{}:{display:"none"},children:e(I,{entityId:r,versionNumber:a})})]}),J=e(ce,{open:_,title:"Unsaved Changes",content:"Any unsaved changes will be lost. Are you sure you want to close the editor?",onCancel:()=>{u(!1)},onConfirm:()=>{u(!1),T()}}),Z=h.useMemo(()=>{if(t!=null&&t.entity.name){if(n==="ANNOTATIONS")return`${s?"Edit ":""}Annotations for ${t.entity.name}`}else return e(ye,{width:"40%"});return t.entity.name},[n,t==null?void 0:t.entity.name,s]);return e(de,{className:"EntityMetadata",open:b,onCancel:()=>{s?(u(!0),g(()=>()=>{d(!1),c()})):c()},maxWidth:s?"md":"sm",title:Z,content:H,actions:i(S,{children:[J,G&&U,$&&F,W&&z,K&&P]})})}try{D.displayName="EntityModal",D.__docgenInfo={description:"",displayName:"EntityModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},entityId:{defaultValue:null,description:"",name:"entityId",required:!0,type:{name:"string"}},versionNumber:{defaultValue:null,description:"",name:"versionNumber",required:!1,type:{name:"number"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},initialTab:{defaultValue:null,description:"",name:"initialTab",required:!1,type:{name:"enum",value:[{value:'"METADATA"'},{value:'"ANNOTATIONS"'}]}},showTabs:{defaultValue:null,description:"",name:"showTabs",required:!1,type:{name:"boolean"}},onEditModeChanged:{defaultValue:null,description:"",name:"onEditModeChanged",required:!1,type:{name:"((isInEditMode: boolean) => void)"}}}}}catch{}export{D as E};
