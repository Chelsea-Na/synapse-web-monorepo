import{j as o,F as V,a as Q}from"./jsx-runtime-670450c2.js";import{r as y}from"./index-f1f749bf.js";import{a9 as u,cS as $,ab as A,bN as f,cT as W,cU as j,cV as G,cW as O,cX as B,cY as H,cZ as z,c_ as Y,c$ as X,d0 as Z,d1 as J,d2 as D,d3 as ee,b2 as ae}from"./SynapseContext-e2a1e11c.js";import{u as h}from"./useMutation-3f4fb40f.js";import{u as te}from"./useInfiniteQuery-8fa007f2.js";import{I as L}from"./IconSvg-5d6274db.js";import{f as se}from"./AccessRequirementList-5fe169ac.js";import{U as ne}from"./UserSearchBoxV2-f1ff6176.js";import{M}from"./Modal-02fe67fa.js";import{s as re}from"./startCase-6fa446f1.js";import{b as ce}from"./isArray-a82322d9.js";import{B as U}from"./Button-7d415009.js";function Fe(e,a,r,n,t,s){const{accessToken:c,keyFactory:T}=u();return te(T.getRepliesQueryKey(e,a,r,n,t),async g=>$(c,e,r,g.pageParam,n,a,t),{...s,getNextPageParam:(g,v)=>{const k=v.flatMap(m=>m.results).length;if(g.totalNumberOfResults>k)return k}})}function Ie(e,a){const{accessToken:r,keyFactory:n}=u(),t=async()=>{const s=await O(e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return A(n.getReplyQueryKey(e.threadId,e.id,e.messageKey),t,a)}function ie(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>W(t,r),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function oe(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>j(t,r),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(t.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function _e(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>G(r,t.replyId),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllRepliesQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function qe(e){const{data:a,isLoading:r}=ue(e),{data:n,isLoading:t}=le(a,{enabled:!!a}),{mutate:s}=me(),{mutate:c}=fe(),T=y.useCallback(()=>{a&&(a!=null&&a.isPinned?c(a):s(a))},[c,s,a]);return{threadData:a,threadBody:n,togglePin:T,isLoading:t||r}}function ue(e,a){const{accessToken:r,keyFactory:n}=u();return A(n.getThreadQueryKey(e),()=>B(e,r),a)}function le(e,a){const{accessToken:r,keyFactory:n}=u(),t=async()=>{const s=await ee(e==null?void 0:e.messageKey,r);return(await fetch(s.messageUrl,{method:"GET",headers:{Accept:"*/*","Access-Control-Request-Headers":"authorization","Content-Type":"text/plain; charset=utf-8"}})).text()};return A(n.getThreadBodyQueryKey(e==null?void 0:e.id,e==null?void 0:e.messageKey),t,a)}function de(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>H(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(t.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ye(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>z(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getThreadQueryKey(s.threadId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function ge(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>Y(r,t),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(t.forumId)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Ke(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>X(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function Ee(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>Z(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function me(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>J(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}function fe(e){const a=f(),{accessToken:r,keyFactory:n}=u();return h(t=>D(r,t.id),{...e,onSuccess:async(t,s,c)=>{await a.invalidateQueries(n.getAllForumThreadsQueryKey(s.forumId)),await a.invalidateQueries(n.getThreadQueryKey(s.id)),e!=null&&e.onSuccess&&await e.onSuccess(t,s,c)}})}const he=["title","bold","italic","strikethrough","code","latex","subscript","superscript","link","image"],N={title:{openSyntax:"###",closeSyntax:""},bold:{openSyntax:"**",closeSyntax:"**"},italic:{openSyntax:"_",closeSyntax:"_"},strikethrough:{openSyntax:"--",closeSyntax:"--"},code:{openSyntax:"```",closeSyntax:"```"},latex:{openSyntax:"$$\\(",closeSyntax:"\\)$$"},subscript:{openSyntax:"~",closeSyntax:"~"},superscript:{openSyntax:"^",closeSyntax:"^"},link:{openSyntax:"[",closeSyntax:"](url)"},image:{openSyntax:"![",closeSyntax:"](image-url)"}},q=({show:e,onClose:a,handleUserTag:r})=>{const n=y.useCallback((t,s)=>{t&&s&&r(s.userName),a()},[a,r]);return o(V,{children:Q(M,{show:e,onHide:a,backdrop:"static",animation:!1,children:[o(M.Header,{closeButton:!0,children:o(M.Title,{children:"Find User or Team"})}),o(M.Body,{children:o(ne,{placeholder:"Search for a user or team name",onChange:n,typeFilter:ae.ALL,focusOnSelect:!0})})]})})};try{q.displayName="UserMentionModal",q.__docgenInfo={description:"",displayName:"UserMentionModal",props:{show:{defaultValue:null,description:"",name:"show",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},handleUserTag:{defaultValue:null,description:"",name:"handleUserTag",required:!0,type:{name:"(user: string) => void"}}}}}catch{}var K=(e=>(e.WRITE="WRITE",e.PREVIEW="PREVIEW",e))(K||{});const E=({placeholder:e,text:a,setText:r})=>{const[n,t]=y.useState("WRITE"),[s,c]=y.useState(0),[T,g]=y.useState(!1),[v,k]=y.useState(!1),m=y.useRef(null);y.useEffect(()=>{const i=m.current;i&&i.setSelectionRange(s,s)},[m,s]),y.useEffect(()=>{var i;(i=m.current)==null||i.focus()},[T]);const R=i=>{const l=[],d=m.current;if(d){const p=d==null?void 0:d.selectionStart,w=a.substring(0,p),b=a.substring(p,a.length);c(p+i.length+1),l.push(w,`${v?"":"@"}${i.replace(/\s/g,"")}`,b)}r(l.join("")),k(!1)},F=i=>{i.key=="@"&&(k(!0),g(!0))},I=i=>{const l=m.current;if(l){const d=l.selectionStart,p=l.selectionEnd,w=a.substring(d,p),b=a.substring(0,d),S=a.substring(p,a.length),x=N[i].openSyntax,_=N[i].closeSyntax;switch(i){case"code":{const C=[];C.push(b,x,w,_,S),r(C.join(`\r
`)),l.focus(),c(d+x.length+2);break}case"title":case"bold":case"italic":case"strikethrough":case"latex":case"subscript":case"superscript":case"link":case"image":{const C=`${b}${x}${w}${_}${S}`;l.focus(),c(d+x.length),r(C)}}}};return Q("div",{className:"bootstrap-4-backport MarkdownEditor",children:[Q("div",{className:"MarkdownEditorControls",children:[o("div",{className:"Tabs",children:Object.keys(K).map(i=>o("button",{className:"Tab",role:"tab","aria-selected":i===n,onClick:l=>{l.stopPropagation(),t(K[i])},children:i},i))}),n==="WRITE"&&Q("div",{className:"MarkdownEditorControlsToolbar",children:[he.map(i=>o("button",{onClick:()=>I(i),children:o(L,{icon:i,label:re(i)})},i)),o("button",{onClick:()=>g(!0),children:o(L,{icon:"tag",label:"Mention"})})]})]}),o("div",{children:n==="WRITE"?o("textarea",{onChange:i=>r(i.target.value),style:{width:"100%"},rows:6,value:a,ref:m,placeholder:e,onKeyDown:F}):a?o(se,{markdown:a}):"Nothing to preview"}),o(q,{show:T,onClose:()=>g(!1),handleUserTag:R})]})};try{E.displayName="MarkdownEditor",E.__docgenInfo={description:"",displayName:"MarkdownEditor",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},setText:{defaultValue:null,description:"",name:"setText",required:!0,type:{name:"(text: string) => void"}}}}}catch{}const P=({initialText:e,initialTitle:a,id:r,onClose:n,isReply:t})=>{const[s,c]=y.useState(a??""),[T,g]=y.useState(e??""),{mutate:v,isLoading:k}=de({onSuccess:()=>n()}),{mutate:m,isLoading:R}=ye({onSuccess:()=>n()}),{mutate:F,isLoading:I}=ge({onSuccess:()=>n()}),{mutate:i,isLoading:l}=ie({onSuccess:()=>n()}),{mutate:d,isLoading:p}=oe({onSuccess:()=>n()}),w=R||l||I||k||p,b=(S,x)=>{t?e?d({replyId:r,messageMarkdown:S}):i({threadId:r,messageMarkdown:S}):a?(v({title:x,threadId:r}),m({messageMarkdown:S,threadId:r})):F({forumId:r,title:x,messageMarkdown:S})};return Q("div",{className:"bootstrap-4-backport",children:[!t&&o(ce,{type:"text",placeholder:"Title",value:s,onChange:S=>c(S.target.value)}),o(E,{text:T,setText:g}),Q("div",{style:{display:"flex",justifyContent:"flex-end"},children:[o(U,{onClick:n,variant:"light",children:"Cancel"}),o(U,{disabled:w,onClick:()=>b(T,s),variant:"primary",children:w?"Saving":"Save"})]})]})};try{P.displayName="ForumThreadEditor",P.__docgenInfo={description:"",displayName:"ForumThreadEditor",props:{initialTitle:{defaultValue:null,description:"",name:"initialTitle",required:!1,type:{name:"string"}},initialText:{defaultValue:null,description:"",name:"initialText",required:!1,type:{name:"string"}},id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isReply:{defaultValue:null,description:"",name:"isReply",required:!0,type:{name:"boolean"}}}}}catch{}export{P as F,_e as a,qe as b,Ke as c,Ee as d,Fe as e,Ie as u};
//# sourceMappingURL=ForumThreadEditor-dee611ed.js.map
