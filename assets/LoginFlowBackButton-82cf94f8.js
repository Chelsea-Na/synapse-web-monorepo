import{r as C,R as D}from"./index-f1f749bf.js";import{be as ne,bf as ae,s as oe,bg as se}from"./SynapseContext-c04df192.js";import{z as V}from"./SynapseConstants-41b9b1f3.js";import{j as c,a as N,F as ie}from"./jsx-runtime-670450c2.js";import{g as q,B as W}from"./getEndpoint-5374ab4d.js";import{F as ue}from"./FullWidthAlert-9afcbd85.js";import{s as le}from"./styled-42ab246b.js";import{T as de}from"./TextField-00f4dfa1.js";import{B as P}from"./Box-b7ffd230.js";import{B as Y}from"./Button-86068eae.js";import{T as x}from"./TextField-b3de9e0e.js";import{L as $}from"./Link-867a3d74.js";import{I as ce}from"./IconSvg-21dc16bf.js";import{I as pe}from"./IconButton-21d62889.js";function Ve(t,r){const[i,n]=C.useState("CHOOSE_AUTH_METHOD"),[s,p]=C.useState(),[u,f]=C.useState(),[l,O]=C.useState();C.useEffect(()=>{const g=new URL(window.location.href.replaceAll("#","/")),{searchParams:h}=g;if(h){const m=h.get("userId"),d=h.get("twoFaToken");m&&d&&(f(parseInt(m,10)),O(d),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(i)||n("VERIFICATION_CODE"))}},[i]),C.useEffect(()=>{r&&(O(r.twoFaToken),f(r.userId),["VERIFICATION_CODE","RECOVERY_CODE","LOGGED_IN"].includes(i)||n("VERIFICATION_CODE"))},[r]);async function E(g){await oe(g.accessToken),localStorage.setItem(V,g.authenticationReceipt),n("LOGGED_IN"),t&&t()}return{step:i,onStepChange:n,submitUsernameAndPassword:async(g,h)=>{p(void 0);try{const m=localStorage.getItem(V),d=await ne(g,h,m);"errorCode"in d?(n("VERIFICATION_CODE"),O(d.twoFaToken),f(d.userId)):await E(d)}catch(m){p(m.reason)}},submitOneTimePassword:async(g,h=i==="RECOVERY_CODE"?"RECOVERY_CODE":"TOTP")=>{if(p(void 0),l==null||u==null){p("You did not first log in with your password or a third-party identity provider.");return}const m={userId:u,twoFaToken:l,otpCode:g,otpType:h};try{const d=await ae(m);await E(d)}catch(d){p(d.reason),(d.reason.includes("The provided twoFaToken is invalid")||d.reason.includes("Token has expired"))&&(console.warn(d),p("Something went wrong. Refresh the page and try again."),window.location.href.includes("twoFaToken")&&window.history.replaceState({},document.title,window.location.href.replaceAll(/(twoFaToken|userId)=[^&]*&?/g,"")))}},errorMessage:s}}const me=le(de)`
  input {
    text-align: center;
  }
`,fe={TextFieldStyled:me},Oe=t=>c(fe.TextFieldStyled,{...t}),y={left:"ArrowLeft",right:"ArrowRight",backspace:"Backspace"};function Ee(t,r){return t<=0?[]:Array.from({length:t},r)}function ge(t,r,i){return t.map((n,s)=>r===s?i:n)}function H(t){return t.join("")}function L(t,r){return[...t,r]}function he(t,r,i){return t.reduce((n,s,p)=>{const{characters:u,restArrayMerged:f}=n;if(p<i)return{restArrayMerged:f,characters:L(u,s)};const[l,...O]=f;return{restArrayMerged:O,characters:L(u,l||"")}},{restArrayMerged:r,characters:[]}).characters}function _e(t){return t.split("")}const j=D.forwardRef((t,r)=>{const{value:i,length:n,onChange:s,TextFieldsProps:p,onComplete:u,validateChar:f,className:l,...O}=t,{onPaste:E,onFocus:T,onKeyDown:R,className:g,...h}=p||{},m=Ee(n,(e,a)=>({character:i[a]||"",inputRef:D.createRef()})),d=e=>m.findIndex(({inputRef:a})=>a.current===e),U=()=>m.map(({character:e})=>e),K=(e,a)=>{const o=ge(U(),e,a);return H(o)},A=e=>{var a,o;(o=(a=m[e])==null?void 0:a.inputRef.current)==null||o.focus()},I=e=>{var a,o;(o=(a=m[e])==null?void 0:a.inputRef.current)==null||o.select()},S=e=>{e+1!==n&&(m[e+1].character?I(e+1):A(e+1))},z=e=>{e>0&&I(e-1)},J=e=>{const a=e.target.value[0]||"",o=d(e.target);if(typeof f=="function"&&!f(a,o))return;const _=K(o,a);s==null||s(_),_.length===n&&(u==null||u(_)),a!==""?_.length<n?S(_.length-1):S(o):_[o]?I(o):z(o)},Q=e=>{e.preventDefault(),e.target.select(),T==null||T(e)},X=e=>{const a=e.target,o=d(a);a.value===e.key?(e.preventDefault(),S(o)):!a.value&&y.backspace===e.key||y.left===e.key?(e.preventDefault(),I(o-1)):y.right===e.key&&(e.preventDefault(),I(o+1)),R==null||R(e)},Z=e=>{e.preventDefault();const a=e.target,o=e.clipboardData.getData("text/plain"),_=d(a),ee=U(),b=he(ee,_e(o),_),M=b.findIndex((te,re)=>re>_&&te===""),w=H(b);if(s==null||s(w),w.length===n){u==null||u(w),A(n-1);return}M!==-1&&A(M),E==null||E(e)};return c(P,{display:"flex",gap:"20px",alignItems:"center",ref:r,className:`MuiOtpInput-Box ${l||""}`,...O,children:m.map(({character:e,inputRef:a},o)=>c(Oe,{autoComplete:"one-time-code",value:e,inputRef:a,className:`MuiOtpInput-TextField MuiOtpInput-TextField-${o+1} ${g||""}`,onPaste:Z,onFocus:Q,onChange:J,onKeyDown:X,...h},o))})});j.defaultProps={value:"",length:4,validateChar:()=>!0,onChange:()=>{},onComplete:()=>{},TextFieldsProps:{}};const k=6,Ce=["0","1","2","3","4","5","6","7","8","9"];function F(t){const{onSubmit:r}=t,[i,n]=D.useState("");return N(P,{children:[c(j,{length:k,value:i,onChange:n,onComplete:r,validateChar:s=>Ce.includes(s)||s==="",gap:0,sx:{".MuiFormControl-root:first-of-type > .MuiInputBase-root":{borderTopRightRadius:0,borderBottomRightRadius:0},".MuiFormControl-root:last-of-type > .MuiInputBase-root":{borderTopLeftRadius:0,borderBottomLeftRadius:0},".MuiFormControl-root:not(:first-of-type):not(:last-of-type) > .MuiInputBase-root":{borderRadius:0}}}),c(Y,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},disabled:i.length!==k,onClick:s=>{s.preventDefault(),r(i)},children:"Submit"})]})}try{F.displayName="TOTPForm",F.__docgenInfo={description:"",displayName:"TOTPForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(value: string) => void"}}}}}catch{}function v(t){const{resetPasswordUrl:r=`${q(W.PORTAL_ENDPOINT)}#!PasswordReset:0`,onSubmit:i}=t,[n,s]=C.useState(""),[p,u]=C.useState("");function f(l){l.preventDefault(),i(n,p)}return N("form",{onSubmit:l=>{f(l)},children:[c(x,{required:!0,fullWidth:!0,autoFocus:!0,autoComplete:"username",label:"Username or Email Address",id:"username",type:"text",value:n,onChange:l=>s(l.target.value)}),c(x,{required:!0,fullWidth:!0,autoComplete:"current-password",label:"Password",id:"current-password",type:"password",value:p,onChange:l=>u(l.target.value)}),c($,{href:r,children:"Forgot password?"}),c(Y,{fullWidth:!0,type:"submit",color:"primary",variant:"contained",sx:{height:"50px",mt:4,mb:2},onClick:l=>{f(l)},children:"Sign in"})]})}try{v.displayName="UsernamePasswordForm",v.__docgenInfo={description:"",displayName:"UsernamePasswordForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"(username: string, password: string) => void"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}}}}}catch{}function B(t){const{ssoRedirectUrl:r,registerAccountUrl:i=`${q(W.PORTAL_ENDPOINT)}#!RegisterAccount:0`,resetPasswordUrl:n,onBeginOAuthSignIn:s,onStepChange:p,step:u,submitUsernameAndPassword:f,submitOneTimePassword:l,errorMessage:O}=t;return N(ie,{children:[u=="CHOOSE_AUTH_METHOD"&&c(se,{onSelectUsernameAndPassword:()=>p("USERNAME_PASSWORD"),onBeginOAuthSignIn:s,ssoRedirectUrl:r}),u==="USERNAME_PASSWORD"&&c(v,{resetPasswordUrl:n,onSubmit:(E,T)=>{f(E,T)}}),u==="VERIFICATION_CODE"&&c(F,{onSubmit:E=>{l(E)}}),(u==="CHOOSE_AUTH_METHOD"||u==="USERNAME_PASSWORD")&&c(P,{display:"flex",justifyContent:"center",children:c($,{href:i,align:"center",children:"Don't have an account? Create one now"})}),O&&c(ue,{variant:"warning",isGlobal:!1,description:O})]})}try{B.displayName="LoginForm",B.__docgenInfo={description:"",displayName:"LoginForm",props:{ssoRedirectUrl:{defaultValue:null,description:"",name:"ssoRedirectUrl",required:!1,type:{name:"string"}},registerAccountUrl:{defaultValue:null,description:"",name:"registerAccountUrl",required:!1,type:{name:"string"}},resetPasswordUrl:{defaultValue:null,description:"",name:"resetPasswordUrl",required:!1,type:{name:"string"}},onBeginOAuthSignIn:{defaultValue:null,description:"",name:"onBeginOAuthSignIn",required:!1,type:{name:"(() => void)"}},step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},twoFactorAuthenticationRequired:{defaultValue:null,description:"",name:"twoFactorAuthenticationRequired",required:!1,type:{name:"TwoFactorAuthErrorResponse"}},submitUsernameAndPassword:{defaultValue:null,description:"",name:"submitUsernameAndPassword",required:!0,type:{name:"(username: string, password: string) => Promise<void>"}},submitOneTimePassword:{defaultValue:null,description:"",name:"submitOneTimePassword",required:!0,type:{name:"(code: string, otpType?: TwoFactorAuthOtpType | undefined) => Promise<void>"}},errorMessage:{defaultValue:null,description:"",name:"errorMessage",required:!0,type:{name:"string | undefined"}}}}}catch{}function Te(t){switch(t){case"CHOOSE_AUTH_METHOD":return"CHOOSE_AUTH_METHOD";case"USERNAME_PASSWORD":return"CHOOSE_AUTH_METHOD";case"VERIFICATION_CODE":return"USERNAME_PASSWORD";case"RECOVERY_CODE":return"VERIFICATION_CODE";case"LOGGED_IN":return"LOGGED_IN"}}function G(t){const{step:r,onStepChange:i,sx:n}=t;return r==="USERNAME_PASSWORD"||r==="VERIFICATION_CODE"?c(pe,{type:"button",onClick:()=>{i(Te(r))},sx:n,children:c(ce,{icon:"arrowBack",wrap:!1,sx:{height:"24px",width:"24px"}})}):null}try{G.displayName="LoginFlowBackButton",G.__docgenInfo={description:"",displayName:"LoginFlowBackButton",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"enum",value:[{value:'"CHOOSE_AUTH_METHOD"'},{value:'"USERNAME_PASSWORD"'},{value:'"VERIFICATION_CODE"'},{value:'"RECOVERY_CODE"'},{value:'"LOGGED_IN"'}]}},onStepChange:{defaultValue:null,description:"",name:"onStepChange",required:!0,type:{name:'(step: "CHOOSE_AUTH_METHOD" | "USERNAME_PASSWORD" | "VERIFICATION_CODE" | "RECOVERY_CODE" | "LOGGED_IN") => void'}},sx:{defaultValue:null,description:"",name:"sx",required:!1,type:{name:"SxProps<{}>"}}}}}catch{}export{G as L,B as a,Ve as u};
//# sourceMappingURL=LoginFlowBackButton-82cf94f8.js.map
