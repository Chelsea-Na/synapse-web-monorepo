import{h as g,D as d}from"./index-3a31b023.js";import{h as y,l as b,n as l,m as p}from"./SynapseClient-5617d165.js";import{u as S}from"./useMutation-0086f62e.js";import{u as m}from"./useInfiniteQuery-7807cef7.js";import"./OrientationBanner-a1ca5cdb.js";import{r as f}from"./index-76fb7be0.js";import"./getEndpoint-ac94413e.js";import"./jsx-runtime-9dc53467.js";function A(e,t){const{accessToken:r,keyFactory:i}=y();return p(i.getSubscribersQueryKey(e.objectId,e.objectType),()=>l.getSubscribers(r,e),t)}function Q(e,t,r){const{accessToken:i,keyFactory:u}=y(),s=async()=>{const c={objectType:t,idList:[e],sortByType:g.OBJECT_ID,sortDirection:d.ASC};return(await l.postSubscriptionList(i,c)).results[0]};return p(u.getSubscriptionQueryKey(e,t),s,r)}function I(e,t,r){const{accessToken:i,keyFactory:u}=y(),s=b();return m(r??u.getAllSubscriptionsQueryKey(e),async c=>{const n=c.pageParam,o=await l.getAllSubscriptions(i,10,n,e);return o.results.forEach(a=>{s.setQueryData(u.getSubscriptionQueryKey(a.objectId,a.objectType),a)}),o},{...t,select:c=>({pages:c.pages.flatMap(n=>n.results),pageParams:c.pageParams}),getNextPageParam:(c,n)=>{const o=n.flatMap(a=>a.results).length;if(c.totalNumberOfResults>o)return o}})}function k(e){const t=b(),{accessToken:r,keyFactory:i}=y();return S(u=>l.postSubscription(r,u),{...e,onSuccess:async(u,s,c)=>{await Promise.all([t.invalidateQueries(i.getAllSubscriptionsQueryKey()),t.invalidateQueries(i.getSubscriptionQueryKey(s.objectId,s.objectType)),t.invalidateQueries(i.getSubscribersQueryKey(s.objectId,s.objectType))]),e!=null&&e.onSuccess&&await e.onSuccess(u,s,c)}})}function L(e){const t=b(),{accessToken:r,keyFactory:i}=y();return S(u=>l.deleteSubscription(r,u.subscriptionId),{...e,onSuccess:async(u,s,c)=>{await Promise.all([t.invalidateQueries(i.getAllSubscriptionsQueryKey()),t.invalidateQueries(i.getSubscriptionQueryKey(s.objectId,s.objectType)),t.invalidateQueries(i.getSubscribersQueryKey(s.objectId,s.objectType))]),e!=null&&e.onSuccess&&await e.onSuccess(u,s,c)}})}const h=(e,t)=>{const{data:r,isLoading:i}=Q(e,t),{mutate:u,isLoading:s}=k(),{mutate:c,isLoading:n}=L(),o=i||s||n,a=f.useCallback(()=>{r?c(r):u({objectId:e,objectType:t})},[c,e,t,u,r]);return{isLoading:o,subscription:r,toggleSubscribed:a,isSubscribed:!!r}};export{h as a,I as b,A as u};
