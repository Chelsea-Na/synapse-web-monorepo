import{a as S,j as e,F as x}from"./jsx-runtime-9dc53467.js";import{r as n}from"./index-76fb7be0.js";import{S as he}from"./StepperDialog-8d44fa94.js";import{C as ge}from"./CreateChallengeTeam-de088b89.js";import{r as Te,i as Ee,a as Ce}from"./jsx-runtime_commonjs-proxy-00bc9f93.js";import{f as Se}from"./DateFormatter-092d39b5.js";import{d as _e}from"./dayjs.min-f79c4412.js";import{a as ye}from"./RadioGroup-bfe7e0a4.js";import{d as be}from"./Search-b46373ca.js";import{B as Z}from"./Box-551bafc7.js";import{b as Re}from"./InputLabel-fd013c0b.js";import"./SkeletonButton-007d85cd.js";import"./HelpPopover-349e17a9.js";import{S as Me}from"./SkeletonTable-fdb2ca5b.js";import{h as V,m as te,n as ae,l as Ie,y as Ne,bC as ve,bD as xe}from"./ApplicationSessionManager-e3b4cd5b.js";import{g as Ae,B as Oe}from"./getEndpoint-ac94413e.js";import"./OrientationBanner-a1ca5cdb.js";import{L as Le}from"./react-router-dom-ac3db81d.js";import{B as C}from"./Box-8faf86fd.js";import{D as we}from"./DataGrid-141e299b.js";import{c as qe}from"./Stack-4eda368b.js";import{T as L}from"./Typography-1d068b0b.js";import{B as Ue}from"./Button-33299b2c.js";import{a as re}from"./useTeam-00d7ce6a.js";import{S as ne}from"./LoadingScreen-21cf5616.js";import{M as se}from"./Alert-c3fe2b05.js";import{M as Fe}from"./TextField-259737a9.js";import{A as Ge}from"./SynapseConstants-eb00dc31.js";import{u as Je}from"./useGetEntityChallenge-2967a925.js";import{u as ke}from"./useGetUserTeams-e972f2f0.js";import{b as He}from"./useTeamMembers-b9887c24.js";const je=qe(),Be=je;function De(a,i){const{accessToken:l,keyFactory:o}=V();return te({...i,queryKey:o.getTeamListQueryKey(a.sort().join()),queryFn:()=>ae.getTeamList(a,l)})}function Qe(a,i){const{accessToken:l,keyFactory:o}=V();return te({...i,queryKey:o.getChallengeTeamListQueryKey(a),queryFn:()=>ae.getAllChallengeTeams(l,a)})}var W={},Ye=Ee;Object.defineProperty(W,"__esModule",{value:!0});var oe=W.default=void 0,Pe=Ye(Te()),Ve=Ce;oe=W.default=(0,Pe.default)((0,Ve.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"ControlPoint");const B=({rowCount:a,onChange:i})=>{const l=a>5?"calc(100% - 8px)":"100%";return S(Z,{sx:{p:"4px 4px",display:"flex",flexGrow:1,width:l,border:"1px solid #F2F2F2","& .Mui-focused":{border:"none",boxShadow:"none"}},children:[e(Z,{sx:{margin:"0px 0 -4px 8px"},"aria-label":"search",children:e(be,{sx:{color:"#878E95"}})}),e(Re,{onChange:i,sx:{"& .MuiInputBase-input":{p:"1px 8px"},ml:1,flex:1,backgroundColor:"white"},placeholder:"Search all teams",inputProps:{"aria-label":"search all teams"}})]})};try{B.displayName="ChallengeTeamSearch",B.__docgenInfo={description:"",displayName:"ChallengeTeamSearch",props:{rowCount:{defaultValue:null,description:"",name:"rowCount",required:!0,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(event: ChangeEvent<HTMLInputElement>) => void"}}}}}catch{}function D({challengeId:a,onSelectTeam:i}){const[l,o]=n.useState([]),[T,b]=n.useState([]),[_,d]=n.useState({}),{data:u}=Qe(a),[R,c]=n.useState(),{data:s,isLoading:M}=De(T,{enabled:!!T.length}),w=r=>{c(r),i(_[r])},I=r=>({id:r.id,name:r.name,created:Se(_e(r.createdOn),"MM/DD/YY"),description:r.description});n.useEffect(()=>{const r=(u==null?void 0:u.map(g=>g.teamId))??[];b(r)},[u]),n.useEffect(()=>{const r=(s==null?void 0:s.list.filter(m=>m.canRequestMembership!==!1))??[],g=[],y={};r.forEach(m=>{g.push(I(m)),y[m.id]=m}),o(g),d(y)},[s]);const q=r=>{const g=r.target.value.toLowerCase(),y=(s==null?void 0:s.list.filter(E=>E.canRequestMembership!==!1))??[];let m=y;g.length&&(m=y.filter(E=>{var A;return E.name.toLowerCase().includes(g)||((A=E.description)==null?void 0:A.toLowerCase().includes(g))})),o(m.map(E=>I(E)))},N=[{field:"radiobutton",headerName:"",width:25,sortable:!1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:r=>e(ye,{value:r.id,checked:r.id===R,onChange:w,label:""})},{field:"name",headerName:"Team Name",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0,renderCell:r=>e(Le,{to:{pathname:`${Ae(Oe.PORTAL_ENDPOINT)}/#!Team:${r.row.id}`},target:"_blank",children:r.row.name})},{field:"created",headerName:"Created On",width:100,filterable:!1,hideable:!1,disableColumnMenu:!0},{field:"description",headerName:"Description",flex:1,filterable:!1,hideable:!1,disableColumnMenu:!0}];return S(C,{sx:{height:220},children:[!M&&S(x,{children:[e(B,{onChange:q,rowCount:l.length}),e(we,{rows:l,columns:N,rowCount:5,hideFooter:!0,density:"compact",sx:{border:"none",height:"100%","& .MuiDataGrid-columnHeader":{backgroundColor:"#F1F3F5"},"& .Mui-odd":{backgroundColor:"#FBFBFC"},".MuiDataGrid-columnHeaderTitleContainer":{justifyContent:"space-between"},".radio":{display:"flex",alignItems:"center",height:"100%"}},getRowClassName:r=>r.indexRelativeToCurrentPage%2===0?"Mui-even":"Mui-odd"})]}),M&&e(Me,{numRows:10,numCols:1})]})}try{D.displayName="ChallengeTeamTable",D.__docgenInfo={description:"",displayName:"ChallengeTeamTable",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const Q=({challengeId:a,onCreateTeam:i,onSelectTeam:l})=>S(Be,{spacing:1,children:[e(L,{variant:"body1",sx:{lineHeight:"20px"},children:'To participate in a challenge, you need to create a new Team or join an existing one.     By default, the participant who creates a team is the "Team Captain" and has the ability to invite and remove members.     All team members will need a Synapse account so that they can login and accept the team invitation.'}),e(C,{sx:{height:270},children:e(D,{challengeId:a,onSelectTeam:l})}),e(C,{children:e(Ue,{color:"primary",variant:"contained",onClick:i,startIcon:e(oe,{}),children:"Create New Team"})})]});try{Q.displayName="SelectChallengeTeam",Q.__docgenInfo={description:"",displayName:"SelectChallengeTeam",props:{challengeId:{defaultValue:null,description:"",name:"challengeId",required:!0,type:{name:"string"}},onCreateTeam:{defaultValue:null,description:"",name:"onCreateTeam",required:!0,type:{name:"() => void"}},onSelectTeam:{defaultValue:null,description:"",name:"onSelectTeam",required:!0,type:{name:"(team: Team) => void"}}}}}catch{}const Y=({createdNewTeam:a,teamId:i})=>{const{data:l,status:o,error:T}=re(i,{enabled:!!i});return i?o==="pending"?e(C,{display:"flex",flexDirection:"column",gap:1,children:e(ne,{})}):o==="error"?e(se,{severity:"error",children:T.message}):S(x,{children:[S(L,{variant:"body1",sx:{lineHeight:"20px"},children:["You have successfully ",a?"created":"joined"," team"," ",e("b",{children:l.name})," and have been added to this challenge."]}),a&&e(C,{children:"Invited team members will be automatically registered for the challenge as soon as they accept the team member invitation."})]}):null};try{Y.displayName="RegistrationSuccessful",Y.__docgenInfo={description:"",displayName:"RegistrationSuccessful",props:{createdNewTeam:{defaultValue:null,description:"",name:"createdNewTeam",required:!0,type:{name:"boolean"}},teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string | undefined"}}}}}catch{}const P=({teamId:a,joinMessageChange:i})=>{const[l,o]=n.useState(""),{data:T,status:b,error:_}=re(a,{enabled:!!a});if(!a)return null;const d=u=>{const R=u.target.value;o(R),i(R)};return b==="pending"?e(C,{display:"flex",flexDirection:"column",gap:1,children:e(ne,{})}):b==="error"?e(se,{severity:"error",children:_.message}):S(x,{children:[S(L,{variant:"body1",sx:{lineHeight:"20px"},children:["The following message will be sent to the Team Manager(s) of the"," ",e("strong",{children:T.name})," team."]}),e(C,{children:e("strong",{children:"Your Message to Team Managers(s)"})}),e(C,{children:e(Fe,{id:"membershipRequestMessage",value:l,fullWidth:!0,multiline:!0,rows:4,autoFocus:!0,onChange:d})})]})};try{P.displayName="JoinRequestForm",P.__docgenInfo={description:"",displayName:"JoinRequestForm",props:{teamId:{defaultValue:null,description:"",name:"teamId",required:!0,type:{name:"string | undefined"}},joinMessageChange:{defaultValue:null,description:"",name:"joinMessageChange",required:!0,type:{name:"(msg: string) => void"}}}}}catch{}const v={SELECT_YOUR_CHALLENGE_TEAM:{id:"SELECT_YOUR_CHALLENGE_TEAM",title:"Select Your Challenge Team",nextStep:"JOIN_REQUEST_FORM",nextEnabled:!1},JOIN_REQUEST_FORM:{id:"JOIN_REQUEST_FORM",title:"Request Team Membership",previousStep:"SELECT_YOUR_CHALLENGE_TEAM",confirmStep:"JOIN_REQUEST_SENT",confirmButtonText:"Send Request",confirmEnabled:!0},JOIN_REQUEST_SENT:{id:"JOIN_REQUEST_SENT",title:"Request Sent",confirmButtonText:"Close",confirmEnabled:!0},CREATE_NEW_TEAM:{id:"CREATE_NEW_TEAM",title:"Create Team",confirmStep:"REGISTRATION_SUCCESSFUL",confirmButtonText:"Finish Registration",confirmEnabled:!1,previousStep:"SELECT_YOUR_CHALLENGE_TEAM"},REGISTRATION_SUCCESSFUL:{id:"REGISTRATION_SUCCESSFUL",title:"Registration Successful!"}},j="",ee=({projectId:a,isShowingModal:i=!1,onClose:l})=>{const{accessToken:o,keyFactory:T}=V(),[b,_]=n.useState(!0),[d,u]=n.useState(v.SELECT_YOUR_CHALLENGE_TEAM),[R,c]=n.useState(),[s,M]=n.useState(),[w,I]=n.useState(!1),[q,N]=n.useState(!1),[r,g]=n.useState(!1),y=Ie(),[m,E]=n.useState({}),[A,ie]=n.useState(""),U=n.useRef(null),{data:p}=Ne(),{data:f}=Je(a),{data:F,error:$}=ke((f==null?void 0:f.id)??j,1);n.useEffect(()=>{if(F){const t=F.results.length>0;t&&(c("Error: You are already a member of a registered submission team for this Challenge."),g(t)),_(!1)}$&&(c("Error: Could not determine if you are already registered for this Challenge."),_(!1))},[F,$]);const{data:O,error:G}=He(s??j,(p==null?void 0:p.ownerId)??j,{enabled:!!s&&!!p});n.useEffect(()=>{O&&E(t=>({...t,[O.teamId]:O}))},[O]),n.useEffect(()=>{G&&c(G.reason)},[G]);const K=()=>{if(s&&s in m){const{canJoin:t,membershipApprovalRequired:h,isMember:k,hasOpenInvitation:H,hasOpenRequest:fe}=m[s];if(k)return{canJoin:!1,errorMessage:"You are already a member of this team."};if(fe)return{canJoin:!1,errorMessage:"Your previous request to join this team is pending review."};if(H||t||h)return{canJoin:!0,needsApproval:h,errorMessage:void 0}}return{canJoin:!1}};n.useEffect(()=>{!!p&&p.ownerId===Ge.toString()&&(_(!1),c("Please login to continue."))},[o,p,a,f]),n.useEffect(()=>{if(s&&s in m&&d.id==="SELECT_YOUR_CHALLENGE_TEAM"){const{canJoin:t,errorMessage:h}=K();if(t){d.nextEnabled||u({...d,nextEnabled:!0});return}d.nextEnabled&&u({...d,nextEnabled:!1}),h&&c(h)}},[m,s,d]);const le=t=>{c(void 0),M(t)},de=(t=s)=>{!t||!p||!o||(N(!0),c(void 0),ve(t,p.ownerId,o).then(()=>{f&&y.invalidateQueries({queryKey:T.getSubmissionTeamsQueryKey(f==null?void 0:f.id)}),J("REGISTRATION_SUCCESSFUL")}).catch(h=>{c(`Error joining team: ${h.reason}`)}).finally(()=>{N(!1)}))},ue=async()=>{p&&s&&(N(!0),u({...d,nextEnabled:!1}),c(void 0),await xe({teamId:s,userId:p.ownerId,message:A},o).then(()=>{u(v.JOIN_REQUEST_SENT)}).catch(t=>{console.error({err:t}),c(`Error requesting membership: ${t.reason}`)}).finally(()=>{N(!1)}))},z=()=>{c(void 0),I(!1),M(void 0),u({...d,nextEnabled:!1}),l()},X={CREATE_NEW_TEAM:()=>{U.current&&U.current.submit()},JOIN_REQUEST_FORM:ue,JOIN_REQUEST_SENT:()=>{z()}},ce=n.useCallback(t=>{u(h=>({...h,confirmEnabled:t}))},[]),me=()=>{switch(d.id){case"SELECT_YOUR_CHALLENGE_TEAM":return o&&f&&!r?e(Q,{challengeId:f.id,onCreateTeam:()=>J("CREATE_NEW_TEAM"),onSelectTeam:t=>{le(t.id)}}):e(x,{});case"JOIN_REQUEST_FORM":return e(P,{teamId:s,joinMessageChange:ie});case"JOIN_REQUEST_SENT":return e(L,{variant:"body1",sx:{lineHeight:"20px"},children:"Team Manager(s) have received your request. Check your Synapse email address for status of your request."});case"REGISTRATION_SUCCESSFUL":return e(Y,{createdNewTeam:w,teamId:s});case"CREATE_NEW_TEAM":return e(ge,{ref:U,challengeId:f.id,onCanSubmitChange:ce,onFinished:t=>{I(!0),M(t),u(v.REGISTRATION_SUCCESSFUL)}});default:return e(x,{})}};function J(t){if(!t||!v[t])return;c(void 0);const{canJoin:h,errorMessage:k,needsApproval:H}=K();switch(t){case"SELECT_YOUR_CHALLENGE_TEAM":I(!1);break;case"JOIN_REQUEST_FORM":if(h){if(!H)return de()}else return c(k);break}u(v[t])}const pe=X[d.id]?X[d.id]:()=>{};return e(he,{errorMessage:R,onCancel:z,onStepChange:J,open:i,onConfirm:()=>{pe()},confirming:q,step:d,content:me(),loading:b})};try{ee.displayName="ChallengeTeamWizard",ee.__docgenInfo={description:"",displayName:"ChallengeTeamWizard",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}},isShowingModal:{defaultValue:{value:"false"},description:"",name:"isShowingModal",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}}}catch{}export{ee as C};
