var R=Object.defineProperty;var H=(s,o,e)=>o in s?R(s,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[o]=e;var h=(s,o,e)=>(H(s,typeof o!="symbol"?o+"":o,e),e);import{a as f,F as w,j as c}from"./jsx-runtime-9dc53467.js";import{r as E,R as S}from"./index-76fb7be0.js";import{C as U}from"./ChallengeRegisterButton-e942815f.js";import{C as q}from"./ChallengeTeamWizard-e7ad5da3.js";import{A as v,C as D,z as P,B as O}from"./SynapseTableCell-5fda444f.js";import{v as N,I as V,aL as j,x as d,aM as I,aN as A,aO as z}from"./SynapseClient-ceb0e6d4.js";import"./getEndpoint-ac94413e.js";import"./OrientationBanner-1c6f5b11.js";import{u as J}from"./useEntity-00649ded.js";import{u as M}from"./useGetEntityChallenge-41a7efc9.js";import{d as x}from"./ToastMessage-02301a16.js";import"./AccessTokenPage-66b9769a.js";import"./AccountLevelBadges-9faf4bfb.js";import"./LastLoginInfo-e25284bc.js";import"./StandaloneLoginForm-f7f397d3.js";import"./TwoFactorAuthSettingsPanel-3d0890c6.js";import"./TwoFactorEnrollmentForm-ef7bc098.js";import"./TwoFactorBackupCodes-e560a28e.js";import"./CertificationQuiz-0423a43d.js";import"./index-c64048e4.js";import"./ChallengeSubmission-5b75f804.js";import"./DownloadCartPage-510a8ca1.js";import"./ShowDownloadV2-e2e43d21.js";import"./useEntitySelection-caca9ae9.js";import"./isPlainObject-ad60ab85.js";import"./mapValues-c1561695.js";import"./index.modern-42b48b42.js";import"./index-c71daf5e.js";import"./EvaluationCard-4c9b65df.js";import"./EvaluationEditorPage-64031500.js";import"./ExperimentalMode-1cc1fc85.js";import{F as $}from"./index-7db48dfb.js";import{O as W}from"./IconSvg-9cb7df33.js";import"./FileUpload-4056bf9b.js";import"./FeaturedDataTabs-f5da4834.js";import"./FeaturedToolsList-f52a91a2.js";import"./DiscussionThread-3524285b.js";import"./ForumPage-40cc6f77.js";import"./FullWidthAlert-88a09c3d.js";import"./Goals-45d98e49.js";import"./GoogleMap-8229c858.js";import"./Icon-dc4c2fbd.js";import"./OAuthManagement-0fc49483.js";import"./ThemesPlot-3e3aee22.js";import"./UpsetPlot-e4688322.js";import"./ProjectViewCarousel-3e0b8083.js";import"./Programs-226ec1f5.js";import"./QueryCount-c2ff7b3c.js";import"./RenderIfInView-df26c1ce.js";import"./Resources-75f2c155.js";import"./RssFeedCards-6ee58bb9.js";import"./ShowMore-0d3229ca.js";import"./SkeletonButton-0a3b2bad.js";import"./SkeletonTable-d1c3c025.js";import"./LeftRightPanel-44366a7b.js";import"./ObservationCard-bb7aafbd.js";import"./StyledFormControl-539bab9f.js";import"./WideButton-2dd27cba.js";import"./InputSizedButton-35908433.js";import"./SubscriptionItem-3d9c9f38.js";import"./DropdownSelect-6b508999.js";import"./SubsectionRowRenderer-8aeb7e8d.js";import"./SynapseFormWrapper-5b9fb008.js";import"./SynapseFormSubmissionsGrid-a4f74e5d.js";import"./SystemUseNotification-0acd2308.js";import"./TableFeedCards-4217a1e6.js";import"./TermsAndConditions-b190467b.js";import"./TextField-2e900427.js";import"./TimelinePlot-02c4abcd.js";import"./UserBadge-d48f6057.js";import"./UserCardList-40fa123e.js";import"./UserCardListRotate-32b672fa.js";import"./UserCardListGroups-7881f25a.js";import"./UserOrTeamBadge-3d7b83c5.js";import"./UserProfileLinks-a2ea14ea.js";import"./EntityHeaderTable-7dc787e8.js";import"./AccessRequirementRelatedProjectsList-a2c934dc.js";import{a as B}from"./useTeamMembers-083b5c8d.js";function k({projectId:s}){const{accessToken:o}=N(),[e,t]=E.useState(!1),[i,r]=E.useState(!1),[a,n]=E.useState(!1),{data:l}=V(),{data:m}=J(s),u=F=>{t(F)},y=()=>{r(!0)},p=()=>{n(!0)},{mutate:b}=B({onSuccess:()=>{x("You are no longer registered for this challenge","info")},onError:F=>{x(F.reason,"danger")}}),L=()=>{o&&g&&l&&b({teamId:g.participantTeamId,userId:l.ownerId})},_=()=>{r(!1),o&&t(!0)},{data:g}=M(s);return f(w,{children:[c(U,{projectId:s,onJoinClick:y,onLeaveClick:p}),i&&c(v,{entityId:s,teamId:g==null?void 0:g.participantTeamId,onHide:_,renderAsModal:!0,requestObjectName:m==null?void 0:m.name,dialogTitle:"Challenge Terms and Conditions"}),e&&c(q,{projectId:s,onClose:()=>{u(!1)},isShowingModal:!0}),a&&c(D,{open:a,title:"Leave this Challenge?",content:"Are you sure you want to leave this Challenge?",onCancel:()=>n(!1),onConfirm:()=>{L(),n(!1)}})]})}try{k.displayName="ChallengeDetailPage",k.__docgenInfo={description:"",displayName:"ChallengeDetailPage",props:{projectId:{defaultValue:null,description:"",name:"projectId",required:!0,type:{name:"string"}}}}}catch{}class C extends S.Component{constructor(e){super(e);h(this,"formRef");h(this,"submitForm",()=>{this.formRef.current.submit()});h(this,"refresh",()=>{if(this.context.accessToken){const e=[d.getUserProfile(this.context.accessToken),d.getEntity(this.context.accessToken,this.props.formSchemaEntityId),d.getEntity(this.context.accessToken,this.props.formUiSchemaEntityId)];Promise.all(e).then(t=>{const i=t[0];this.getTargetContainer(i,this.context.accessToken).then(r=>{const a=t[1],n=t[2];this.getSchemaFileContent(r,a,n)})}).catch(t=>{this.onError(t)})}});h(this,"getSchemaFileContent",(e,t,i)=>{const r=[d.getFileResult(t,this.context.accessToken,!0,!0),d.getFileResult(i,this.context.accessToken,!0,!0)];Promise.all(r).then(a=>{try{const n=a.map(l=>I(l.fileHandle,l.preSignedURL));Promise.all(n).then(l=>{const m=JSON.parse(l[0]),u=JSON.parse(l[1]);this.getExistingFileData(e,m,u)}).catch(l=>{console.log("getSchemaFileContent: Error getting form content",l)})}catch(n){console.log("getSchemaFileContent: Error getting schema content",n)}}).catch(a=>{this.onError(a)})});h(this,"getExistingFileData",(e,t,i)=>{const a={entityName:`${t.title}.json`,parentId:e};let n,l;d.lookupChildEntity(a,this.context.accessToken).then(m=>d.getEntity(this.context.accessToken,m.id).then(u=>(l=u,this.props.initFormData?d.getFileResult(l,this.context.accessToken,!0,!0).then(async y=>{try{const p=await I(y.fileHandle,y.preSignedURL);n=JSON.parse(p)}catch(p){console.log("getExistingFileData: Error setting form data",p)}}):Promise.resolve()))).finally(()=>{this.setState({formData:n,currentFileEntity:l,formSchema:t,formUiSchema:i})})});h(this,"getTargetContainer",async(e,t)=>{const i={entityName:e.ownerId,parentId:this.props.parentContainerId};try{const r=await d.lookupChildEntity(i,t);return console.log(`EntityForm uploading to https://www.synapse.org/#!Synapse:${r.id}`),this.setState({userprofile:e,containerId:r.id,isLoading:!1}),r.id}catch(r){return r.status===404?this.onError(new Error("Your folder has not yet been set up, please retry in a few minutes.")):this.onError(r)}});h(this,"finishedProcessing",()=>{this.setState({isLoading:!1,successfullyUploaded:!0})});h(this,"onError",e=>{this.setState({error:e,isLoading:!1,successfullyUploaded:!1})});h(this,"onSubmit",({formData:e})=>{this.setState({isLoading:!0,successfullyUploaded:!1});const t=new Blob([JSON.stringify(e)],{type:"text/json"});this.createEntityFile(t)});h(this,"createEntityFile",e=>{const t=`${this.state.formSchema.title}.json`;d.uploadFile(this.context.accessToken,t,e).then(i=>{const r=i.fileHandleId;if(this.state.currentFileEntity){const n={...this.state.currentFileEntity,dataFileHandleId:r};return this.setState({currentFileEntity:n}),d.updateEntity(n,this.context.accessToken)}const a={parentId:this.state.containerId,name:t,concreteType:"org.sagebionetworks.repo.model.FileEntity",dataFileHandleId:r};return d.createEntity(a,this.context.accessToken)}).then(i=>{this.finishedProcessing(),this.props.synIdCallback&&this.props.synIdCallback(i.id)}).catch(i=>{this.onError(i)})});this.formRef=S.createRef(),this.state={isLoading:!0,successfullyUploaded:!1}}componentDidMount(){this.refresh()}render(){return f("div",{children:[this.state.error&&f("div",{className:"panel panel-danger errors",children:[c("div",{className:"panel-heading",children:c("h3",{className:"panel-title",children:"Error"})}),c("ul",{className:"list-group",children:f("li",{className:"list-group-item text-danger",children:[this.state.error.name," ",this.state.error.reason,this.state.error.message]})})]}),this.context.accessToken&&!this.state.isLoading&&!this.state.successfullyUploaded&&this.state.formSchema&&this.state.formUiSchema&&!this.state.error&&c(P,{validator:O,formData:this.state.formData,schema:this.state.formSchema,uiSchema:this.state.formUiSchema,onSubmit:this.onSubmit,ref:this.formRef,children:c("div",{style:{display:"none"},children:c("button",{type:"submit",className:"btn btn-info",children:"Submit"})})}),!this.state.error&&this.context.accessToken&&this.state.isLoading&&f(S.Fragment,{children:[c("span",{children:"Savingâ€¦"}),c("span",{style:{marginLeft:"2px"},className:"spinner"})]})]})}}h(C,"contextType",j);try{C.displayName="EntityForm",C.__docgenInfo={description:"",displayName:"EntityForm",props:{parentContainerId:{defaultValue:null,description:"",name:"parentContainerId",required:!0,type:{name:"string"}},formSchemaEntityId:{defaultValue:null,description:"",name:"formSchemaEntityId",required:!0,type:{name:"string"}},formUiSchemaEntityId:{defaultValue:null,description:"",name:"formUiSchemaEntityId",required:!0,type:{name:"string"}},initFormData:{defaultValue:null,description:"",name:"initFormData",required:!0,type:{name:"boolean"}},synIdCallback:{defaultValue:null,description:"",name:"synIdCallback",required:!0,type:{name:"(synId: string) => void"}}}}}catch{}const T=s=>{const{accessToken:o}=N(),{synId:e,className:t}=s,[i,r]=E.useState(void 0);E.useEffect(()=>{(async()=>{try{const m=await d.getEntity(o,e);if(!A(m))throw new Error(`File Entity expected but found ${m}`);const u={requestedFiles:[{associateObjectId:e,associateObjectType:$.FileEntity,fileHandleId:m.dataFileHandleId}],includeFileHandles:!0,includePreSignedURLs:!1,includePreviewPreSignedURLs:!1},p=(await d.getFiles(u,o)).requestedFiles[0].fileHandle;if(p&&z(p))r({externalFileHandle:p,fileEntity:m});else throw new Error(`Not an external file handle: ${p==null?void 0:p.id}`)}catch(m){console.error("Error on getting external file handle = ",m)}})()},[e,o]);const a=i==null?void 0:i.externalFileHandle,n=i==null?void 0:i.fileEntity;return a?c("a",{href:a.externalURL,className:t,target:"_blank",rel:"noopener noreferrer",children:f("span",{children:[n==null?void 0:n.name,c(W,{style:{marginLeft:5}})]})}):c(w,{})};try{T.displayName="ExternalFileHandleLink",T.__docgenInfo={description:"",displayName:"ExternalFileHandleLink",props:{synId:{defaultValue:null,description:"",name:"synId",required:!0,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}export{k as C};
//# sourceMappingURL=ExternalFileHandleLink-9b7c7b97.js.map
